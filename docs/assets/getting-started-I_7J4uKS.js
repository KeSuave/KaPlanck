var bd=Object.defineProperty;var Bd=(i,t,e)=>t in i?bd(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var S=(i,t,e)=>Bd(i,typeof t!="symbol"?t+"":t,e);import{r as $o,j as _,u as ec}from"./index-BGAuv2A4.js";var Cd=Object.defineProperty,p=(i,t)=>Cd(i,"name",{value:t,configurable:!0}),kd=(()=>{for(var i=new Uint8Array(128),t=0;t<64;t++)i[t<26?t+65:t<52?t+71:t<62?t-4:t*4-205]=t;return e=>{for(var s=e.length,r=new Uint8Array((s-(e[s-1]=="=")-(e[s-2]=="="))*3/4|0),n=0,o=0;n<s;){var a=i[e.charCodeAt(n++)],l=i[e.charCodeAt(n++)],c=i[e.charCodeAt(n++)],h=i[e.charCodeAt(n++)];r[o++]=a<<2|l>>4,r[o++]=l<<4|c>>2,r[o++]=c<<6|h}return r}})(),yt,ut=(yt=class{constructor(t,e,s){S(this,"r",255);S(this,"g",255);S(this,"b",255);this.r=yi(t,0,255),this.g=yi(e,0,255),this.b=yi(s,0,255)}static fromArray(t){return new yt(t[0],t[1],t[2])}static fromHex(t){if(typeof t=="number")return new yt(t>>16&255,t>>8&255,t>>0&255);if(typeof t=="string"){let e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(!e)throw new Error("Invalid hex color format");return new yt(parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16))}else throw new Error("Invalid hex color format")}static fromHSL(t,e,s){if(e==0)return new yt(255*s,255*s,255*s);let r=p((h,d,u)=>(u<0&&(u+=1),u>1&&(u-=1),u<1/6?h+(d-h)*6*u:u<1/2?d:u<2/3?h+(d-h)*(2/3-u)*6:h),"hue2rgb"),n=s<.5?s*(1+e):s+e-s*e,o=2*s-n,a=r(o,n,t+1/3),l=r(o,n,t),c=r(o,n,t-1/3);return new yt(Math.round(a*255),Math.round(l*255),Math.round(c*255))}clone(){return new yt(this.r,this.g,this.b)}lighten(t){return new yt(this.r+t,this.g+t,this.b+t)}darken(t){return this.lighten(-t)}invert(){return new yt(255-this.r,255-this.g,255-this.b)}mult(t){return new yt(this.r*t.r/255,this.g*t.g/255,this.b*t.b/255)}lerp(t,e){return new yt(ye(this.r,t.r,e),ye(this.g,t.g,e),ye(this.b,t.b,e))}toHSL(){let t=this.r/255,e=this.g/255,s=this.b/255,r=Math.max(t,e,s),n=Math.min(t,e,s),o=(r+n)/2,a=o,l=o;if(r==n)o=a=0;else{let c=r-n;switch(a=l>.5?c/(2-r-n):c/(r+n),r){case t:o=(e-s)/c+(e<s?6:0);break;case e:o=(s-t)/c+2;break;case s:o=(t-e)/c+4;break}o/=6}return[o,a,l]}eq(t){return this.r===t.r&&this.g===t.g&&this.b===t.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}toArray(){return[this.r,this.g,this.b]}},p(yt,"Color"),S(yt,"RED",new yt(255,0,0)),S(yt,"GREEN",new yt(0,255,0)),S(yt,"BLUE",new yt(0,0,255)),S(yt,"YELLOW",new yt(255,255,0)),S(yt,"MAGENTA",new yt(255,0,255)),S(yt,"CYAN",new yt(0,255,255)),S(yt,"WHITE",new yt(255,255,255)),S(yt,"BLACK",new yt(0,0,0)),yt);function xt(...i){if(i.length===0)return new ut(255,255,255);if(i.length===1){if(i[0]instanceof ut)return i[0].clone();if(typeof i[0]=="string")return ut.fromHex(i[0]);if(Array.isArray(i[0])&&i[0].length===3)return ut.fromArray(i[0])}else if(i.length===2){if(i[0]instanceof ut)return i[0].clone()}else if(i.length===3||i.length===4)return new ut(i[0],i[1],i[2]);throw new Error("Invalid color arguments")}p(xt,"rgb");var Md=p((i,t,e)=>ut.fromHSL(i,t,e),"hsl2rgb");function Ut(i){return i*Math.PI/180}p(Ut,"deg2rad");function os(i){return i*180/Math.PI}p(os,"rad2deg");function yi(i,t,e){return t>e?yi(i,e,t):Math.min(Math.max(i,t),e)}p(yi,"clamp");function ye(i,t,e){if(typeof i=="number"&&typeof t=="number")return i+(t-i)*e;if(i instanceof j&&t instanceof j||i instanceof ut&&t instanceof ut)return i.lerp(t,e);throw new Error(`Bad value for lerp(): ${i}, ${t}. Only number, Vec2 and Color is supported.`)}p(ye,"lerp");function $e(i,t,e,s,r){return s+(i-t)/(e-t)*(r-s)}p($e,"map");function ic(i,t,e,s,r){return yi($e(i,t,e,s,r),s,r)}p(ic,"mapc");var kt,j=(kt=class{constructor(t=0,e=t){S(this,"x",0);S(this,"y",0);this.x=t,this.y=e}static fromAngle(t){let e=Ut(t);return new kt(Math.cos(e),Math.sin(e))}static fromArray(t){return new kt(t[0],t[1])}clone(){return new kt(this.x,this.y)}add(...t){let e=D(...t);return new kt(this.x+e.x,this.y+e.y)}sub(...t){let e=D(...t);return new kt(this.x-e.x,this.y-e.y)}scale(...t){let e=D(...t);return new kt(this.x*e.x,this.y*e.y)}dist(...t){let e=D(...t);return this.sub(e).len()}sdist(...t){let e=D(...t);return this.sub(e).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let t=this.len();return t===0?new kt(0):this.scale(1/t)}normal(){return new kt(this.y,-this.x)}reflect(t){return this.sub(t.scale(2*this.dot(t)))}project(t){return t.scale(t.dot(this)/t.len())}reject(t){return this.sub(this.project(t))}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}angle(...t){let e=D(...t);return os(Math.atan2(this.y-e.y,this.x-e.x))}angleBetween(...t){let e=D(...t);return os(Math.atan2(this.cross(e),this.dot(e)))}lerp(t,e){return new kt(ye(this.x,t.x,e),ye(this.y,t.y,e))}slerp(t,e){let s=this.dot(t),r=this.cross(t),n=Math.atan2(r,s);return this.scale(Math.sin((1-e)*n)).add(t.scale(Math.sin(e*n))).scale(1/r)}isZero(){return this.x===0&&this.y===0}toFixed(t){return new kt(Number(this.x.toFixed(t)),Number(this.y.toFixed(t)))}transform(t){return t.multVec2(this)}eq(t){return this.x===t.x&&this.y===t.y}bbox(){return new Et(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}toArray(){return[this.x,this.y]}},p(kt,"Vec2"),S(kt,"LEFT",new kt(-1,0)),S(kt,"RIGHT",new kt(1,0)),S(kt,"UP",new kt(0,-1)),S(kt,"DOWN",new kt(0,1)),kt);function D(...i){if(i.length===1){if(i[0]instanceof j)return new j(i[0].x,i[0].y);if(Array.isArray(i[0])&&i[0].length===2)return new j(...i[0])}return new j(...i)}p(D,"vec2");var is,Vt=(is=class{constructor(t,e,s,r){S(this,"x",0);S(this,"y",0);S(this,"w",1);S(this,"h",1);this.x=t,this.y=e,this.w=s,this.h=r}scale(t){return new is(this.x+this.w*t.x,this.y+this.h*t.y,this.w*t.w,this.h*t.h)}pos(){return new j(this.x,this.y)}clone(){return new is(this.x,this.y,this.w,this.h)}eq(t){return this.x===t.x&&this.y===t.y&&this.w===t.w&&this.h===t.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}},p(is,"Quad"),is);function Nt(i,t,e,s){return new Vt(i,t,e,s)}p(Nt,"quad");var Qe,vo=(Qe=class{constructor(t,e,s,r){S(this,"a");S(this,"b");S(this,"c");S(this,"d");this.a=t,this.b=e,this.c=s,this.d=r}mul(t){return new Qe(this.a*t.a+this.b*t.c,this.a*t.b+this.b*t.d,this.c*t.a+this.d*t.c,this.c*t.b+this.d*t.d)}transform(t){return D(this.a*t.x+this.b*t.y,this.c*t.x+this.d*t.y)}get inverse(){let t=this.det;return new Qe(this.d/t,-this.b/t,-this.c/t,this.a/t)}get transpose(){return new Qe(this.a,this.c,this.b,this.d)}get eigenvalues(){let t=this.trace/2,e=this.det,s=t+Math.sqrt(t*t-e),r=t-Math.sqrt(t*t-e);return[s,r]}eigenvectors(t,e){return this.c!=0?[[t-this.d,this.c],[e-this.d,this.c]]:this.b!=0?[[this.b,t-this.a],[this.b,e-this.a]]:Math.abs(this.transform(D(1,0)).x-t)<Number.EPSILON?[[1,0],[0,1]]:[[0,1],[1,0]]}get det(){return this.a*this.d-this.b*this.c}get trace(){return this.a+this.d}static rotation(t){let e=Math.cos(t),s=Math.sin(t);return new Qe(e,s,-s,e)}static scale(t,e){return new Qe(t,0,0,e)}},p(Qe,"Mat2"),Qe),di,rn=(di=class{constructor(t,e,s,r,n,o,a,l,c){S(this,"m11");S(this,"m12");S(this,"m13");S(this,"m21");S(this,"m22");S(this,"m23");S(this,"m31");S(this,"m32");S(this,"m33");this.m11=t,this.m12=e,this.m13=s,this.m21=r,this.m22=n,this.m23=o,this.m31=a,this.m32=l,this.m33=c}static fromMat2(t){return new di(t.a,t.b,0,t.c,t.d,0,0,0,1)}toMat2(){return new vo(this.m11,this.m12,this.m21,this.m22)}mul(t){return new di(this.m11*t.m11+this.m12*t.m21+this.m13*t.m31,this.m11*t.m12+this.m12*t.m22+this.m13*t.m32,this.m11*t.m13+this.m12*t.m23+this.m13*t.m33,this.m21*t.m11+this.m22*t.m21+this.m23*t.m31,this.m21*t.m12+this.m22*t.m22+this.m23*t.m32,this.m21*t.m13+this.m22*t.m23+this.m23*t.m33,this.m31*t.m11+this.m32*t.m21+this.m33*t.m31,this.m31*t.m12+this.m32*t.m22+this.m33*t.m32,this.m31*t.m13+this.m32*t.m23+this.m33*t.m33)}get det(){return this.m11*this.m22*this.m33+this.m12*this.m23*this.m31+this.m13*this.m21*this.m32-this.m13*this.m22*this.m31-this.m12*this.m21*this.m33-this.m11*this.m23*this.m32}rotate(t){let e=Math.cos(t),s=Math.sin(t),r=this.m11,n=this.m12;return this.m11=e*this.m11+s*this.m21,this.m12=e*this.m12+s*this.m22,this.m21=e*this.m21-s*r,this.m22=e*this.m22-s*n,this}scale(t,e){return this.m11*=t,this.m12*=t,this.m21*=e,this.m22*=e,this}get inverse(){let t=this.det;return new di((this.m22*this.m33-this.m23*this.m32)/t,(this.m13*this.m32-this.m12*this.m33)/t,(this.m12*this.m23-this.m13*this.m22)/t,(this.m23*this.m31-this.m21*this.m33)/t,(this.m11*this.m33-this.m13*this.m31)/t,(this.m13*this.m21-this.m11*this.m23)/t,(this.m21*this.m32-this.m22*this.m31)/t,(this.m12*this.m31-this.m11*this.m32)/t,(this.m11*this.m22-this.m12*this.m21)/t)}get transpose(){return new di(this.m11,this.m21,this.m31,this.m12,this.m22,this.m32,this.m13,this.m23,this.m33)}},p(di,"Mat3"),di),pe,_i=(pe=class{constructor(t){S(this,"m",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);t&&(this.m=t)}static translate(t){return new pe([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,0,1])}static scale(t){return new pe([t.x,0,0,0,0,t.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(t){t=Ut(-t);let e=Math.cos(t),s=Math.sin(t);return new pe([1,0,0,0,0,e,-s,0,0,s,e,0,0,0,0,1])}static rotateY(t){t=Ut(-t);let e=Math.cos(t),s=Math.sin(t);return new pe([e,0,s,0,0,1,0,0,-s,0,e,0,0,0,0,1])}static rotateZ(t){t=Ut(-t);let e=Math.cos(t),s=Math.sin(t);return new pe([e,-s,0,0,s,e,0,0,0,0,1,0,0,0,0,1])}translate(t){return this.m[12]+=this.m[0]*t.x+this.m[4]*t.y,this.m[13]+=this.m[1]*t.x+this.m[5]*t.y,this.m[14]+=this.m[2]*t.x+this.m[6]*t.y,this.m[15]+=this.m[3]*t.x+this.m[7]*t.y,this}scale(t){return this.m[0]*=t.x,this.m[4]*=t.y,this.m[1]*=t.x,this.m[5]*=t.y,this.m[2]*=t.x,this.m[6]*=t.y,this.m[3]*=t.x,this.m[7]*=t.y,this}rotate(t){t=Ut(-t);let e=Math.cos(t),s=Math.sin(t),r=this.m[0],n=this.m[1],o=this.m[4],a=this.m[5];return this.m[0]=r*e+n*s,this.m[1]=-r*s+n*e,this.m[4]=o*e+a*s,this.m[5]=-o*s+a*e,this}mult(t){let e=[];for(let s=0;s<4;s++)for(let r=0;r<4;r++)e[s*4+r]=this.m[0*4+r]*t.m[s*4+0]+this.m[1*4+r]*t.m[s*4+1]+this.m[2*4+r]*t.m[s*4+2]+this.m[3*4+r]*t.m[s*4+3];return new pe(e)}multVec2(t){return new j(t.x*this.m[0]+t.y*this.m[4]+this.m[12],t.x*this.m[1]+t.y*this.m[5]+this.m[13])}getTranslation(){return new j(this.m[12],this.m[13])}getScale(){if(this.m[0]!=0||this.m[1]!=0){let t=this.m[0]*this.m[5]-this.m[1]*this.m[4],e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new j(e,t/e)}else if(this.m[4]!=0||this.m[5]!=0){let t=this.m[0]*this.m[5]-this.m[1]*this.m[4],e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new j(t/e,e)}else return new j(0,0)}getRotation(){if(this.m[0]!=0||this.m[1]!=0){let t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return os(this.m[1]>0?Math.acos(this.m[0]/t):-Math.acos(this.m[0]/t))}else if(this.m[4]!=0||this.m[5]!=0){let t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return os(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/t):-Math.acos(this.m[4]/t)))}else return 0}getSkew(){if(this.m[0]!=0||this.m[1]!=0){let t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new j(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(t*t),0)}else if(this.m[4]!=0||this.m[5]!=0){let t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new j(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(t*t))}else return new j(0,0)}invert(){let t=[],e=this.m[10]*this.m[15]-this.m[14]*this.m[11],s=this.m[9]*this.m[15]-this.m[13]*this.m[11],r=this.m[9]*this.m[14]-this.m[13]*this.m[10],n=this.m[8]*this.m[15]-this.m[12]*this.m[11],o=this.m[8]*this.m[14]-this.m[12]*this.m[10],a=this.m[8]*this.m[13]-this.m[12]*this.m[9],l=this.m[6]*this.m[15]-this.m[14]*this.m[7],c=this.m[5]*this.m[15]-this.m[13]*this.m[7],h=this.m[5]*this.m[14]-this.m[13]*this.m[6],d=this.m[4]*this.m[15]-this.m[12]*this.m[7],u=this.m[4]*this.m[14]-this.m[12]*this.m[6],f=this.m[5]*this.m[15]-this.m[13]*this.m[7],y=this.m[4]*this.m[13]-this.m[12]*this.m[5],v=this.m[6]*this.m[11]-this.m[10]*this.m[7],g=this.m[5]*this.m[11]-this.m[9]*this.m[7],A=this.m[5]*this.m[10]-this.m[9]*this.m[6],B=this.m[4]*this.m[11]-this.m[8]*this.m[7],F=this.m[4]*this.m[10]-this.m[8]*this.m[6],E=this.m[4]*this.m[9]-this.m[8]*this.m[5];t[0]=this.m[5]*e-this.m[6]*s+this.m[7]*r,t[4]=-(this.m[4]*e-this.m[6]*n+this.m[7]*o),t[8]=this.m[4]*s-this.m[5]*n+this.m[7]*a,t[12]=-(this.m[4]*r-this.m[5]*o+this.m[6]*a),t[1]=-(this.m[1]*e-this.m[2]*s+this.m[3]*r),t[5]=this.m[0]*e-this.m[2]*n+this.m[3]*o,t[9]=-(this.m[0]*s-this.m[1]*n+this.m[3]*a),t[13]=this.m[0]*r-this.m[1]*o+this.m[2]*a,t[2]=this.m[1]*l-this.m[2]*c+this.m[3]*h,t[6]=-(this.m[0]*l-this.m[2]*d+this.m[3]*u),t[10]=this.m[0]*f-this.m[1]*d+this.m[3]*y,t[14]=-(this.m[0]*h-this.m[1]*u+this.m[2]*y),t[3]=-(this.m[1]*v-this.m[2]*g+this.m[3]*A),t[7]=this.m[0]*v-this.m[2]*B+this.m[3]*F,t[11]=-(this.m[0]*g-this.m[1]*B+this.m[3]*E),t[15]=this.m[0]*A-this.m[1]*F+this.m[2]*E;let k=this.m[0]*t[0]+this.m[1]*t[4]+this.m[2]*t[8]+this.m[3]*t[12];for(let w=0;w<4;w++)for(let b=0;b<4;b++)t[w*4+b]*=1/k;return new pe(t)}clone(){return new pe([...this.m])}toString(){return this.m.toString()}},p(pe,"Mat4"),pe);function ja(i,t,e,s=r=>-Math.cos(r)){return i+(s(e)+1)/2*(t-i)}p(ja,"wave");var Fd=1103515245,Ed=12345,Ul=2147483648,yr,sc=(yr=class{constructor(t){S(this,"seed");this.seed=t}gen(){return this.seed=(Fd*this.seed+Ed)%Ul,this.seed/Ul}genNumber(t,e){return t+this.gen()*(e-t)}genVec2(t,e){return new j(this.genNumber(t.x,e.x),this.genNumber(t.y,e.y))}genColor(t,e){return new ut(this.genNumber(t.r,e.r),this.genNumber(t.g,e.g),this.genNumber(t.b,e.b))}genAny(...t){if(t.length===0)return this.gen();if(t.length===1){if(typeof t[0]=="number")return this.genNumber(0,t[0]);if(t[0]instanceof j)return this.genVec2(D(0,0),t[0]);if(t[0]instanceof ut)return this.genColor(xt(0,0,0),t[0])}else if(t.length===2){if(typeof t[0]=="number"&&typeof t[1]=="number")return this.genNumber(t[0],t[1]);if(t[0]instanceof j&&t[1]instanceof j)return this.genVec2(t[0],t[1]);if(t[0]instanceof ut&&t[1]instanceof ut)return this.genColor(t[0],t[1])}throw new Error("More than 2 arguments not supported")}},p(yr,"RNG"),yr),wa=new sc(Date.now());function rc(i){return i!=null&&(wa.seed=i),wa.seed}p(rc,"randSeed");function Jt(...i){return wa.genAny(...i)}p(Jt,"rand");function Ta(...i){return Math.floor(Jt(...i.length>0?i:[2]))}p(Ta,"randi");function nc(i){return Jt()<=i}p(nc,"chance");function La(i){for(let t=i.length-1;t>0;t--){let e=Math.floor(Math.random()*(t+1));[i[t],i[e]]=[i[e],i[t]]}return i}p(La,"shuffle");function oc(i,t){return i.length<=t?i.slice():La(i.slice()).slice(0,t)}p(oc,"chooseMultiple");function ac(i){return i[Ta(i.length)]}p(ac,"choose");function Ra(i,t){return i.pos.x+i.width>t.pos.x&&i.pos.x<t.pos.x+t.width&&i.pos.y+i.height>t.pos.y&&i.pos.y<t.pos.y+t.height}p(Ra,"testRectRect");function lc(i,t){if(i.p1.x===i.p2.x&&i.p1.y===i.p2.y||t.p1.x===t.p2.x&&t.p1.y===t.p2.y)return null;let e=(t.p2.y-t.p1.y)*(i.p2.x-i.p1.x)-(t.p2.x-t.p1.x)*(i.p2.y-i.p1.y);if(e===0)return null;let s=((t.p2.x-t.p1.x)*(i.p1.y-t.p1.y)-(t.p2.y-t.p1.y)*(i.p1.x-t.p1.x))/e,r=((i.p2.x-i.p1.x)*(i.p1.y-t.p1.y)-(i.p2.y-i.p1.y)*(i.p1.x-t.p1.x))/e;return s<0||s>1||r<0||r>1?null:s}p(lc,"testLineLineT");function Vo(i,t){let e=lc(i,t);return e?D(i.p1.x+e*(i.p2.x-i.p1.x),i.p1.y+e*(i.p2.y-i.p1.y)):null}p(Vo,"testLineLine");function Io(i,t){let e=t.p2.sub(t.p1),s=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY;if(e.x!=0){let n=(i.pos.x-t.p1.x)/e.x,o=(i.pos.x+i.width-t.p1.x)/e.x;s=Math.max(s,Math.min(n,o)),r=Math.min(r,Math.max(n,o))}if(e.y!=0){let n=(i.pos.y-t.p1.y)/e.y,o=(i.pos.y+i.height-t.p1.y)/e.y;s=Math.max(s,Math.min(n,o)),r=Math.min(r,Math.max(n,o))}return r>=s&&r>=0&&s<=1}p(Io,"testRectLine");function Cn(i,t){return t.x>i.pos.x&&t.x<i.pos.x+i.width&&t.y>i.pos.y&&t.y<i.pos.y+i.height}p(Cn,"testRectPoint");function za(i,t){let e=Math.max(i.pos.x,Math.min(t.center.x,i.pos.x+i.width)),s=Math.max(i.pos.y,Math.min(t.center.y,i.pos.y+i.height));return D(e,s).sdist(t.center)<=t.radius*t.radius}p(za,"testRectCircle");function Na(i,t){return Oa(t,new _e(i.points()))}p(Na,"testRectPolygon");function qo(i,t){let e=t.sub(i.p1),s=i.p2.sub(i.p1);if(Math.abs(e.cross(s))>Number.EPSILON)return!1;let r=e.dot(s)/s.dot(s);return r>=0&&r<=1}p(qo,"testLinePoint");function Or(i,t){let e=i.p2.sub(i.p1),s=e.dot(e),r=i.p1.sub(t.center),n=2*e.dot(r),o=r.dot(r)-t.radius*t.radius,a=n*n-4*s*o;if(s<=Number.EPSILON||a<0)return!1;if(a==0){let l=-n/(2*s);if(l>=0&&l<=1)return!0}else{let l=(-n+Math.sqrt(a))/(2*s),c=(-n-Math.sqrt(a))/(2*s);if(l>=0&&l<=1||c>=0&&c<=1)return!0}return kn(t,i.p1)}p(Or,"testLineCircle");function jo(i,t){if(Li(t,i.p1)||Li(t,i.p2))return!0;for(let e=0;e<t.pts.length;e++){let s=t.pts[e],r=t.pts[(e+1)%t.pts.length];if(Vo(i,new De(s,r)))return!0}return!1}p(jo,"testLinePolygon");function kn(i,t){return i.center.sdist(t)<i.radius*i.radius}p(kn,"testCirclePoint");function hc(i,t){return i.center.sdist(t.center)<(i.radius+t.radius)*(i.radius+t.radius)}p(hc,"testCircleCircle");function Mn(i,t){let e=t.pts[t.pts.length-1];for(let s of t.pts){if(Or(new De(e,s),i))return!0;e=s}return kn(i,t.pts[0])?!0:Li(t,i.center)}p(Mn,"testCirclePolygon");function Oa(i,t){for(let e=0;e<i.pts.length;e++)if(jo(new De(i.pts[e],i.pts[(e+1)%i.pts.length]),t))return!0;return!!(i.pts.some(e=>Li(t,e))||t.pts.some(e=>Li(i,e)))}p(Oa,"testPolygonPolygon");function Li(i,t){let e=!1,s=i.pts;for(let r=0,n=s.length-1;r<s.length;n=r++)s[r].y>t.y!=s[n].y>t.y&&t.x<(s[n].x-s[r].x)*(t.y-s[r].y)/(s[n].y-s[r].y)+s[r].x&&(e=!e);return e}p(Li,"testPolygonPoint");function To(i,t){t=t.sub(i.center);let e=Ut(i.angle),s=Math.cos(e),r=Math.sin(e),n=t.x*s+t.y*r,o=-t.x*r+t.y*s;return n*n/(i.radiusX*i.radiusX)+o*o/(i.radiusY*i.radiusY)<1}p(To,"testEllipsePoint");function un(i,t){let e=t.center.sub(i.center),s=Ut(i.angle),r=Math.cos(s),n=Math.sin(s),o=e.x*r+e.y*n,a=-e.x*n+e.y*r;return To(new Ni(D(),i.radiusX+t.radius,i.radiusY+t.radius,0),D(o,a))}p(un,"testEllipseCircle");function Ua(i,t){let e=i.toMat2().inverse;return t=new De(e.transform(t.p1.sub(i.center)),e.transform(t.p2.sub(i.center))),Or(t,new Ee(D(),1))}p(Ua,"testEllipseLine");function cc(i,t){if(i.radiusX===i.radiusY)return un(t,new Ee(i.center,i.radiusX));if(t.radiusX===t.radiusY)return un(i,new Ee(t.center,t.radiusX));let e=new rn(1/i.radiusX**2,0,0,0,1/i.radiusY**2,0,0,0,-1),s=new rn(1/t.radiusX**2,0,0,0,1/t.radiusY**2,0,0,0,-1),r=i.center.x,n=i.center.y,o=t.center.x,a=t.center.y,l=Ut(i.angle),c=Ut(t.angle),h=new rn(Math.cos(l),-Math.sin(l),r,Math.sin(l),Math.cos(l),n,0,0,1),d=new rn(Math.cos(c),-Math.sin(c),o,Math.sin(c),Math.cos(c),a,0,0,1),u=h.inverse,f=d.inverse,y=u.transpose.mul(e).mul(u),v=f.transpose.mul(s).mul(f),g=y.m11,A=y.m12,B=y.m13,F=y.m21,E=y.m22,k=y.m23,w=y.m31,b=y.m32,M=y.m33,V=v.m11,L=v.m12,z=v.m13,O=v.m21,H=v.m22,Y=v.m23,tt=v.m31,G=v.m32,Z=v.m33,ot=g*E*M-g*k*b-A*F*M+A*k*w+B*F*b-B*E*w,W=(g*E*Z-g*k*G-g*b*Y+g*M*H-A*F*Z+A*k*tt+A*w*Y-A*M*O+B*F*G-B*E*tt-B*w*H+B*b*O+F*b*z-F*M*L-E*w*z+E*M*V+k*w*L-k*b*V)/ot,ct=(g*H*Z-g*Y*G-A*O*Z+A*Y*tt+B*O*G-B*H*tt-F*L*Z+F*z*G+E*V*Z-E*z*tt-k*V*G+k*L*tt+w*L*Y-w*z*H-b*V*Y+b*z*O+M*V*H-M*L*O)/ot,ft=(V*H*Z-V*Y*G-L*O*Z+L*Y*tt+z*O*G-z*H*tt)/ot;if(W>=0){let X=-3*ct+W**2,Zt=3*W*ft+ct*W**2-4*ct**2,he=-27*ft**2+18*ft*W*ct+W**2*ct**2-4*W**3*ft-4*ct**3;return!(X>0&&Zt<0&&he>0)}else{let X=-3*ct+W**2,Zt=-27*ft**2+18*ft*W*ct+W**2*ct**2-4*W**3*ft-4*ct**3;return!(X>0&&Zt>0)}}p(cc,"testEllipseEllipse");function Ha(i,t){return Lo(i,new _e(t.points()))}p(Ha,"testEllipseRect");function Lo(i,t){let e=i.toMat2().inverse;return t=new _e(t.pts.map(s=>e.transform(s.sub(i.center)))),Mn(new Ee(D(),1),t)}p(Lo,"testEllipsePolygon");function uc(i,t){return i.x===t.x&&i.y===t.y}p(uc,"testPointPoint");function mc(i,t){return t instanceof j?uc(t,i.pt):t instanceof Ee?kn(t,i.pt):t instanceof De?qo(t,i.pt):t instanceof Et?Cn(t,i.pt):t instanceof _e?Li(t,i.pt):t instanceof Ni?To(t,i.pt):!1}p(mc,"testPointShape");function dc(i,t){return t instanceof j?qo(i,t):t instanceof Ee?Or(i,t):t instanceof De?Vo(i,t)!=null:t instanceof Et?Io(t,i):t instanceof _e?jo(i,t):t instanceof Ni?Ua(t,i):!1}p(dc,"testLineShape");function pc(i,t){return t instanceof j?kn(i,t):t instanceof Ee?hc(i,t):t instanceof De?Or(t,i):t instanceof Et?za(t,i):t instanceof _e?Mn(i,t):t instanceof Ni?un(t,i):!1}p(pc,"testCircleShape");function fc(i,t){return t instanceof j?Cn(i,t):t instanceof Ee?za(i,t):t instanceof De?Io(i,t):t instanceof Et?Ra(i,t):t instanceof _e?Na(i,t):t instanceof Ni?Ha(t,i):!1}p(fc,"testRectShape");function yc(i,t){return t instanceof j?Li(i,t):t instanceof Ee?Mn(t,i):t instanceof De?jo(t,i):t instanceof Et?Na(t,i):t instanceof _e?Oa(t,i):t instanceof Ni?Lo(t,i):!1}p(yc,"testPolygonShape");function _c(i,t){return t instanceof j?To(i,t):t instanceof Ee?un(i,t):t instanceof De?Ua(i,t):t instanceof Et?Ha(i,t):t instanceof _e?Lo(i,t):t instanceof Ni?cc(t,i):!1}p(_c,"testEllipseShape");function Ka(i,t,e){let s=i,r=e.p1,n=e.p2,o=t,a=n.sub(r),l=o.cross(a);if(Math.abs(l)<Number.EPSILON)return null;let c=r.sub(s),h=c.cross(a)/l;if(h<=0||h>=1)return null;let d=c.cross(o)/l;if(d<=0||d>=1)return null;let u=a.normal().unit();return t.dot(u)>0&&(u.x*=-1,u.y*=-1),{point:s.add(o.scale(h)),normal:u,fraction:h}}p(Ka,"raycastLine");function vc(i,t,e){let s=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY,n;if(i.x!=0){let o=(e.pos.x-i.x)/t.x,a=(e.pos.x+e.width-i.x)/t.x;n=D(-Math.sign(t.x),0),s=Math.max(s,Math.min(o,a)),r=Math.min(r,Math.max(o,a))}if(i.y!=0){let o=(e.pos.y-i.y)/t.y,a=(e.pos.y+e.height-i.y)/t.y;Math.min(o,a)>s&&(n=D(0,-Math.sign(t.y))),s=Math.max(s,Math.min(o,a)),r=Math.min(r,Math.max(o,a))}return r>=s&&s>=0&&s<=1?{point:i.add(t.scale(s)),normal:n,fraction:s}:null}p(vc,"raycastRect");function Ya(i,t,e){let s=i,r=e.center,n=t,o=n.dot(n),a=s.sub(r),l=2*n.dot(a),c=a.dot(a)-e.radius*e.radius,h=l*l-4*o*c;if(o<=Number.EPSILON||h<0)return null;if(h==0){let d=-l/(2*o);if(d>=0&&d<=1){let u=s.add(n.scale(d));return{point:u,normal:u.sub(r),fraction:d}}}else{let d=(-l+Math.sqrt(h))/(2*o),u=(-l-Math.sqrt(h))/(2*o),f=null;if(d>=0&&d<=1&&(f=d),u>=0&&u<=1&&(f=Math.min(u,f??u)),f!=null){let y=s.add(n.scale(f));return{point:y,normal:y.sub(r).unit(),fraction:f}}}return null}p(Ya,"raycastCircle");function gc(i,t,e){let s=e.pts,r=null,n=s[s.length-1];for(let o=0;o<s.length;o++){let a=s[o],l=Ka(i,t,new De(n,a));l&&(!r||r.fraction>l.fraction)&&(r=l),n=a}return r}p(gc,"raycastPolygon");function Ac(i,t,e){let s=e.toMat2(),r=s.inverse,n=r.transform(i.sub(e.center)),o=r.transform(t),a=Ya(n,o,new Ee(D(),1));if(a){let l=vo.rotation(Ut(-e.angle)),c=vo.scale(e.radiusX,e.radiusY).transform(a.point),h=s.transform(a.point).add(e.center),d=h.dist(i)/t.len();return{point:h,normal:l.transform(D(e.radiusY**2*c.x,e.radiusX**2*c.y)).unit(),fraction:d}}return a}p(Ac,"raycastEllipse");function xc(i,t,e,s=64){let r=i,n=t.len(),o=t.scale(1/n),a=0,l=D(Math.floor(i.x),Math.floor(i.y)),c=D(o.x>0?1:-1,o.y>0?1:-1),h=D(Math.abs(1/o.x),Math.abs(1/o.y)),d=D(c.x>0?l.x+1-i.x:i.x-l.x,c.y>0?l.y+1-i.y:i.y-l.y),u=D(h.x<1/0?h.x*d.x:1/0,h.y<1/0?h.y*d.y:1/0),f=-1;for(;a<=s;){let y=e(l);if(y===!0)return{point:r.add(o.scale(a)),normal:D(f===0?-c.x:0,f===1?-c.y:0),fraction:a/n,gridPos:l};if(y)return y;u.x<u.y?(l.x+=c.x,a=u.x,u.x+=h.x,f=0):(l.y+=c.y,a=u.y,u.y+=h.y,f=1)}return null}p(xc,"raycastGrid");var ss,Sd=(ss=class{constructor(t){S(this,"pt");this.pt=t.clone()}transform(t){return new ss(t.multVec2(this.pt))}bbox(){return new Et(this.pt,0,0)}area(){return 0}clone(){return new ss(this.pt)}collides(t){return mc(this,t)}contains(t){return this.pt.eq(t)}raycast(t,e){return null}random(){return this.pt.clone()}},p(ss,"Point"),ss),rs,De=(rs=class{constructor(t,e){S(this,"p1");S(this,"p2");this.p1=t.clone(),this.p2=e.clone()}transform(t){return new rs(t.multVec2(this.p1),t.multVec2(this.p2))}bbox(){return Et.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new rs(this.p1,this.p2)}collides(t){return dc(this,t)}contains(t){return this.collides(t)}raycast(t,e){return Ka(t,e,this)}random(){return this.p1.add(this.p2.sub(this.p1).scale(Jt(1)))}},p(rs,"Line"),rs),ns,Et=(ns=class{constructor(t,e,s){S(this,"pos");S(this,"width");S(this,"height");this.pos=t.clone(),this.width=e,this.height=s}static fromPoints(t,e){return new ns(t.clone(),e.x-t.x,e.y-t.y)}center(){return new j(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(t){return new _e(this.points().map(e=>t.multVec2(e)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new ns(this.pos.clone(),this.width,this.height)}distToPoint(t){return Math.sqrt(this.sdistToPoint(t))}sdistToPoint(t){let e=this.pos,s=this.pos.add(this.width,this.height),r=Math.max(e.x-t.x,0,t.x-s.x),n=Math.max(e.y-t.y,0,t.y-s.y);return r*r+n*n}collides(t){return fc(this,t)}contains(t){return this.collides(t)}raycast(t,e){return vc(t,e,this)}random(){return this.pos.add(Jt(this.width),Jt(this.height))}},p(ns,"Rect"),ns),Is,Ee=(Is=class{constructor(t,e){S(this,"center");S(this,"radius");this.center=t.clone(),this.radius=e}transform(t){return new Ni(this.center,this.radius,this.radius).transform(t)}bbox(){return Et.fromPoints(this.center.sub(D(this.radius)),this.center.add(D(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new Is(this.center,this.radius)}collides(t){return pc(this,t)}contains(t){return this.collides(t)}raycast(t,e){return Ya(t,e,this)}random(){return this.center.add(j.fromAngle(Jt(360)).scale(Jt(this.radius)))}},p(Is,"Circle"),Is),Ze,Ni=(Ze=class{constructor(t,e,s,r=0){S(this,"center");S(this,"radiusX");S(this,"radiusY");S(this,"angle");this.center=t.clone(),this.radiusX=e,this.radiusY=s,this.angle=r}static fromMat2(t){let e=t.inverse,s=e.transpose.mul(e),[r,n]=s.eigenvalues,[o,a]=s.eigenvectors(r,n),[l,c]=[1/Math.sqrt(r),1/Math.sqrt(n)];return l>c?new Ze(D(),l,c,os(Math.atan2(-o[1],o[0]))):new Ze(D(),c,l,os(Math.atan2(-a[1],a[0])))}toMat2(){let t=Ut(this.angle),e=Math.cos(t),s=Math.sin(t);return new vo(e*this.radiusX,-s*this.radiusY,s*this.radiusX,e*this.radiusY)}transform(t){if(this.angle==0&&t.getRotation()==0)return new Ze(t.multVec2(this.center),t.m[0]*this.radiusX,t.m[5]*this.radiusY);{let e=this.toMat2(),s=t.getRotation(),r=t.getScale();e=rn.fromMat2(e).scale(r.x,r.y).rotate(s).toMat2();let n=Ze.fromMat2(e);return n.center=t.multVec2(this.center),n}}bbox(){if(this.angle==0)return Et.fromPoints(this.center.sub(D(this.radiusX,this.radiusY)),this.center.add(D(this.radiusX,this.radiusY)));{let t=Ut(this.angle),e=Math.cos(t),s=Math.sin(t),r=this.radiusX*e,n=this.radiusX*s,o=this.radiusY*s,a=this.radiusY*e,l=Math.sqrt(r*r+o*o),c=Math.sqrt(n*n+a*a);return Et.fromPoints(this.center.sub(D(l,c)),this.center.add(D(l,c)))}}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new Ze(this.center,this.radiusX,this.radiusY,this.angle)}collides(t){return _c(this,t)}contains(t){t=t.sub(this.center);let e=Ut(this.angle),s=Math.cos(e),r=Math.sin(e),n=t.x*s+t.y*r,o=-t.x*r+t.y*s;return n*n/(this.radiusX*this.radiusX)+o*o/(this.radiusY*this.radiusY)<1}raycast(t,e){return Ac(t,e,this)}random(){return this.center}},p(Ze,"Ellipse"),Ze);function wc(i,t,e,s){let r=t.sub(i),n=s.sub(e),o=r.cross(n);return o<1e-5&&o>-1e-5||(o=e.sub(i).cross(n)/o,o<0||o>1)?null:i.add(r.scale(o))}p(wc,"segmentLineIntersection");var pi,_e=(pi=class{constructor(t){S(this,"pts");if(t.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=t}transform(t){return new pi(this.pts.map(e=>t.multVec2(e)))}bbox(){let t=D(Number.MAX_VALUE),e=D(-Number.MAX_VALUE);for(let s of this.pts)t.x=Math.min(t.x,s.x),e.x=Math.max(e.x,s.x),t.y=Math.min(t.y,s.y),e.y=Math.max(e.y,s.y);return Et.fromPoints(t,e)}area(){let t=0,e=this.pts.length;for(let s=0;s<e;s++){let r=this.pts[s],n=this.pts[(s+1)%e];t+=r.x*n.y*.5,t-=n.x*r.y*.5}return Math.abs(t)}clone(){return new pi(this.pts.map(t=>t.clone()))}collides(t){return yc(this,t)}contains(t){return this.collides(t)}raycast(t,e){return gc(t,e,this)}random(){return D()}cut(t,e){new De(t,e);let s=[],r=[],n=e.sub(t),o=this.pts[this.pts.length-1],a=o.sub(t),l=n.cross(a)>0;return this.pts.forEach(c=>{a=c.sub(t);let h=n.cross(a)>0;if(l!=h){let d=wc(o,c,t,e);s.push(d),r.push(d),l=h}(h?s:r).push(c),o=c}),[s.length?new pi(s):null,r.length?new pi(r):null]}},p(pi,"Polygon"),pi);function bc(i,t,e,s){let r=s*s,n=1-s,o=n*n;return i.scale(o).add(t.scale(2*n*s)).add(e.scale(r))}p(bc,"evaluateQuadratic");function Bc(i,t,e,s){let r=1-s;return t.sub(i).scale(2*r).add(e.sub(t).scale(2*s))}p(Bc,"evaluateQuadraticFirstDerivative");function Cc(i,t,e,s){return e.sub(t.scale(2)).add(i).scale(2)}p(Cc,"evaluateQuadraticSecondDerivative");function Ro(i,t,e,s,r){let n=r*r,o=n*r,a=1-r,l=a*a,c=l*a;return i.scale(c).add(t.scale(3*l*r)).add(e.scale(3*a*n)).add(s.scale(o))}p(Ro,"evaluateBezier");function kc(i,t,e,s,r){let n=r*r,o=1-r,a=o*o;return t.sub(i).scale(3*a).add(e.sub(t).scale(6*o*r)).add(s.sub(e).scale(3*n))}p(kc,"evaluateBezierFirstDerivative");function Mc(i,t,e,s,r){let n=1-r;return e.sub(t.scale(2)).add(i).scale(6*n).add(s.sub(e.scale(2)).add(t).scale(6*r))}p(Mc,"evaluateBezierSecondDerivative");function Fc(i,t,e,s,r){let n=.5*(((-r+2)*r-1)*r),o=.5*((3*r-5)*r*r+2),a=.5*(((-3*r+4)*r+1)*r),l=.5*((r-1)*r*r);return i.scale(n).add(t.scale(o)).add(e.scale(a)).add(s.scale(l))}p(Fc,"evaluateCatmullRom");function Ec(i,t,e,s,r){let n=.5*((-3*r+4)*r-1),o=.5*((9*r-10)*r),a=.5*((-9*r+8)*r+1),l=.5*((3*r-2)*r);return i.scale(n).add(t.scale(o)).add(e.scale(a)).add(s.scale(l))}p(Ec,"evaluateCatmullRomFirstDerivative");function Sc(i){let t=Ga(i),e=t(1);return s=>{let r=s*e,n=t(r,!0);return i(n)}}p(Sc,"normalizedCurve");function Ga(i,t=10,e=10){let s=[0],r=[0],n=1/(t-1)/e,o=0,a=i(0),l=0;for(let c=1;c<t;c++){for(let h=0;h<e;h++){l+=n;let d=i(l),u=d.dist(a);o+=u,a=d}s[c]=o,r[c]=l}return r[t-1]=1,(c,h=!1)=>{if(h){let d=c;if(d<=0)return 0;if(d>=o)return 1;let u=0;for(;s[u+1]<d;)u++;let f=r[u],y=r[u+1],v=s[u],g=s[u+1],A=(d-v)/(g-v);return f+(y-f)*A}else{if(c<=0)return 0;if(c>=1)return s[t-1];let d=0;for(;r[d+1]<c;)d++;let u=r[d],f=r[d+1],y=s[d],v=s[d+1],g=(c-u)/(f-u);return y+(v-y)*g}}}p(Ga,"curveLengthApproximation");function Ur(i,t,e,s){let r=2*i+t-2*s+e,n=-3*i+3*s-2*t-e,o=t,a=i;return l=>{let c=l*l,h=c*l;return r*h+n*c+o*l+a}}p(Ur,"hermite");function Wa(i,t,e,s,r,n=Ur){let o=n(t.x,(1-r)*(e.x-i.x),(1-r)*(s.x-t.x),e.x),a=n(t.y,(1-r)*(e.y-i.y),(1-r)*(s.y-t.y),e.y);return l=>new j(o(l),a(l))}p(Wa,"cardinal");function mn(i,t,e,s,r=Ur){return Wa(i,t,e,s,.5,r)}p(mn,"catmullRom");function Pc(i,t,e,s,r=Ur){return mn(s.add(i.sub(t).scale(6)),i,s,i.add(s.sub(e).scale(6)),r)}p(Pc,"bezier");function Dc(i,t,e,s,r,n,o,a=Ur){let l=a(t.x,.5*(1-r)*(1+o)*(1+n)*(t.x-i.x)+.5*(1-r)*(1-o)*(1-n)*(e.x-t.x),.5*(1-r)*(1+o)*(1-n)*(e.x-t.x)+.5*(1-r)*(1-o)*(1+n)*(s.x-e.x),e.x),c=a(t.y,.5*(1-r)*(1+o)*(1+n)*(t.y-i.y)+.5*(1-r)*(1-o)*(1-n)*(e.y-t.y),.5*(1-r)*(1+o)*(1-n)*(e.y-t.y)+.5*(1-r)*(1-o)*(1+n)*(s.y-e.y),e.y);return h=>new j(l(h),c(h))}p(Dc,"kochanekBartels");function Vc(i,t,e,s){let r=2*i+t-2*s+e,n=-3*i+3*s-2*t+e,o=t;return a=>{let l=a*a;return 3*r*l+2*n*a+o}}p(Vc,"hermiteFirstDerivative");function lr(i){return 0<=i&&i<=1}p(lr,"inZeroOneDomain");function po(i,t){return Math.abs(i-t)<=Number.EPSILON}p(po,"approximately");function hr(i){return i<0?-Math.pow(-i,1/3):Math.pow(i,1/3)}p(hr,"cubeRoot");function Ic(i,t,e,s){let r=3*i-6*t+3*e,n=-3*i+3*t,o=i,a=-i+3*t-3*e+s;if(po(a,0)){if(po(r,0))return po(n,0)?[]:[-o/n].filter(lr);let g=Math.sqrt(n*n-4*r*o),A=2*r;return[(g-n)/A,(-n-g)/A].filter(lr)}r/=a,n/=a,o/=a;let l=(3*n-r*r)/3,c=l/3,h=(2*r*r*r-9*r*n+27*o)/27,d=h/2,u=d*d+c*c*c;if(u<0){let g=-l/3,A=g*g*g,B=Math.sqrt(A),F=-h/(2*B),E=F<-1?-1:F>1?1:F,k=Math.acos(E),w=2*hr(B),b=w*Math.cos(k/3)-r/3,M=w*Math.cos((k+2*Math.PI)/3)-r/3,V=w*Math.cos((k+4*Math.PI)/3)-r/3;return[b,M,V].filter(lr)}if(u===0){let g=d<0?hr(-d):-hr(d),A=2*g-r/3,B=-g-r/3;return[A,B].filter(lr)}let f=Math.sqrt(u),y=hr(f-d),v=hr(f+d);return[y-v-r/3].filter(lr)}p(Ic,"getCubicRoots");function qc(i,t,e,s,r){let n=Ic(i.x-r,t.x-r,e.x-r,s.x-r);return n.length>0?Ro(i,t,e,s,n[0]).y:NaN}p(qc,"cubicBezierYforX");function jc(i){if(!i||i.length==0)throw new Error("Need at least one point for easingLinear.");let t=i.length;return e=>{if(e<=0||i.length==1||e<=i[0].x)return i[0].y;for(let s=0;s<t;s++)if(i[s].x>=e)return $e(e,i[s-1].x,i[s].x,i[s-1].y,i[s].y);return i[i.length-1].y}}p(jc,"easingLinear");function Tc(i,t){return e=>qc(D(0,0),i,t,D(1,1),e)}p(Tc,"easingCubicBezier");function Lc(i,t="jump-end"){let e=1/i,s=t=="jump-start"||t=="jump-both",r=t=="jump-end"||t=="jump-both",n=1/(i+(r?1:0)),o=s?n:0;return a=>{let l=Math.floor(a/e);return o+l*n}}p(Lc,"easingSteps");function Rc(i,t){let e=Number.MAX_VALUE,s={normal:D(0),distance:0};for(let r of[i,t])for(let n=0;n<r.pts.length;n++){let o=r.pts[n],a=r.pts[(n+1)%r.pts.length].sub(o).normal().unit(),l=Number.MAX_VALUE,c=-Number.MAX_VALUE;for(let f=0;f<i.pts.length;f++){let y=i.pts[f].dot(a);l=Math.min(l,y),c=Math.max(c,y)}let h=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(let f=0;f<t.pts.length;f++){let y=t.pts[f].dot(a);h=Math.min(h,y),d=Math.max(d,y)}let u=Math.min(c,d)-Math.max(l,h);if(u<0)return null;if(u<Math.abs(e)){let f=d-l,y=h-c;e=Math.abs(f)<Math.abs(y)?f:y,s.normal=a,s.distance=e}}return s}p(Rc,"sat");function Ja(i,t,e){return(t.x-i.x)*(e.y-i.y)-(t.y-i.y)*(e.x-i.x)>=0}p(Ja,"isOrientedCcw");function zc(i){let t=0,e=i[i.length-1];for(let s=0;s<i.length;s++)t+=(i[s].x-e.x)*(i[s].y+e.y),e=i[s];return t<0}p(zc,"isOrientedCcwPolygon");function fo(i,t,e,s){let r=s.x-e.x,n=s.y-e.y,o=r*(i.y-e.y)-n*(i.x-e.x),a=r*(t.y-e.y)-n*(t.x-e.x);return o*a>=0}p(fo,"onSameSide");function Nc(i,t,e,s){return fo(i,t,e,s)&&fo(i,e,t,s)&&fo(i,s,t,e)}p(Nc,"pointInTriangle");function Oc(i,t,e,s){for(let r of i)if(r!==t&&r!==e&&r!==s&&Nc(r,t,e,s))return!0;return!1}p(Oc,"someInTriangle");function Uc(i,t,e,s){return Ja(i,t,e)&&!Oc(s,i,t,e)}p(Uc,"isEar");function Xa(i){if(i.length<3)return[];if(i.length==3)return[i];let t=[],e=[],s=0;for(let d=0;d<i.length;d++){let u=i[s],f=i[d];(f.x<u.x||f.x==u.x&&f.y<u.y)&&(s=s),t[d]=d+1,e[d]=d-1}t[t.length-1]=0,e[0]=e.length-1,zc(i)||([t,e]=[e,t]);let r=[];for(let d=0;d<i.length;++d)Ja(i[e[d]],i[d],i[t[d]])||r.push(i[d]);let n=[],o=i.length,a=1,l=0,c,h;for(;o>3;){c=t[a],h=e[a];let d=i[h],u=i[a],f=i[c];if(Uc(d,u,f,r))n.push([d,u,f]),t[h]=c,e[c]=h,r.splice(r.indexOf(u),1),--o,l=0;else if(++l>o)return[];a=c}return c=t[a],h=e[a],n.push([i[h],i[a],i[c]]),n}p(Xa,"triangulate");function Hc(i){if(i.length<3)return!1;let t=i.length-2,e=i.length-1,s=0,r=i[e].sub(i[t]),n=i[s].sub(i[e]),o=r.cross(n);for(;s+1<i.length;)if(t=e,e=s,s++,r=i[e].sub(i[t]),n=i[s].sub(i[e]),r.cross(n)*o<0)return!1;return!0}p(Hc,"isConvex");var Pd=p(i=>i[0]instanceof ut,"arrayIsColor"),Dd=p(i=>i[0]instanceof j,"arrayIsVec2"),Vd=p(i=>typeof i[0]=="number","arrayIsNumber"),_r,Kc=(_r=class{constructor(t=(e,s)=>e<s){S(this,"_items");S(this,"_compareFn");this._compareFn=t,this._items=[]}insert(t){this._items.push(t),this.moveUp(this._items.length-1)}remove(){if(this._items.length===0)return null;let t=this._items[0],e=this._items.pop();return this._items.length!==0&&(this._items[0]=e,this.moveDown(0)),t}clear(){this._items.splice(0,this._items.length)}moveUp(t){for(;t>0;){let e=Math.floor((t-1)/2);if(!this._compareFn(this._items[t],this._items[e])&&this._items[t]>=this._items[e])break;this.swap(t,e),t=e}}moveDown(t){for(;t<Math.floor(this._items.length/2);){let e=2*t+1;if(e<this._items.length-1&&!this._compareFn(this._items[e],this._items[e+1])&&++e,this._compareFn(this._items[t],this._items[e]))break;this.swap(t,e),t=e}}swap(t,e){[this._items[t],this._items[e]]=[this._items[e],this._items[t]]}get length(){return this._items.length}},p(_r,"BinaryHeap"),_r);function Yc(i){let t=window.atob(i),e=t.length,s=new Uint8Array(e);for(let r=0;r<e;r++)s[r]=t.charCodeAt(r);return s.buffer}p(Yc,"base64ToArrayBuffer");function Gc(i){return Yc(i.split(",")[1])}p(Gc,"dataURLToArrayBuffer");function zo(i,t){let e=document.createElement("a");e.href=t,e.download=i,e.click()}p(zo,"download");function Qa(i,t){zo(i,"data:text/plain;charset=utf-8,"+t)}p(Qa,"downloadText");function Wc(i,t){Qa(i,JSON.stringify(t))}p(Wc,"downloadJSON");function ba(i,t){let e=URL.createObjectURL(t);zo(i,e),URL.revokeObjectURL(e)}p(ba,"downloadBlob");var Jc=p(i=>i.match(/^data:\w+\/\w+;base64,.+/),"isDataURL"),Id=p(i=>i.split(".").slice(0,-1).join("."),"getFileName");function No(i,t){if(i===t)return!0;let e=typeof i,s=typeof t;if(e!==s)return!1;if(e==="object"&&s==="object"&&i!==null&&t!==null){if(Array.isArray(i)!==Array.isArray(t))return!1;let r=Object.keys(i),n=Object.keys(t);if(r.length!==n.length)return!1;for(let o of r){let a=i[o],l=t[o];if(!No(a,l))return!1}return!0}return!1}p(No,"deepEq");var vr,Xc=(vr=class extends Map{constructor(){super(...arguments);S(this,"lastID",0)}push(e){let s=this.lastID;return this.set(s,e),this.lastID++,s}pushd(e){let s=this.push(e);return()=>this.delete(s)}},p(vr,"Registry"),vr),qs,zs=(qs=class{constructor(t){S(this,"paused",!1);S(this,"cancel");this.cancel=t}static join(t){let e=new qs(()=>t.forEach(s=>s.cancel()));return Object.defineProperty(e,"paused",{get:p(()=>t[0].paused,"get"),set:p(s=>t.forEach(r=>r.paused=s),"set")}),e.paused=!1,e}static replace(t,e){return t.cancel=()=>e.cancel(),e.paused=t.paused,Object.defineProperty(t,"paused",{get:p(()=>e.paused,"get"),set:p(s=>e.paused=s,"set")}),t}},p(qs,"KEventController"),qs),gr,Be=(gr=class{constructor(){S(this,"handlers",new Xc)}add(t){let e=this.handlers.pushd((...r)=>{s.paused||t(...r)}),s=new zs(e);return s}addOnce(t){let e=this.add((...s)=>{e.cancel(),t(...s)});return e}next(){return new Promise(t=>this.addOnce(t))}trigger(...t){this.handlers.forEach(e=>e(...t))}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},p(gr,"KEvent"),gr),Ar,dn=(Ar=class{constructor(){S(this,"handlers",{});S(this,"registers",{})}on(t,e){return this.handlers[t]||(this.handlers[t]=new Be),this.handlers[t].add(e)}onOnce(t,e){let s=this.on(t,(...r)=>{s.cancel(),e(...r)});return s}next(t){return new Promise(e=>{this.onOnce(t,(...s)=>e(s[0]))})}trigger(t,...e){this.handlers[t]&&this.handlers[t].trigger(...e)}remove(t){delete this.handlers[t]}clear(){this.handlers={}}numListeners(t){var e;return((e=this.handlers[t])==null?void 0:e.numListeners())??0}},p(Ar,"KEventHandler"),Ar),qd=p(i=>i instanceof Error?i.message:String(i),"getErrorMessage");function go(i,t){return Number(i.toFixed(t))}p(go,"toFixed");function Ot(i,t){return(...e)=>{let s=e.length;if(s===i.length)return i(...e);if(s===t.length)return t(...e)}}p(Ot,"overload2");var jd=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function Qc(i){if(typeof i!="string")throw new TypeError("string cannot be undefined or null");let t=[],e=0,s=0;for(;e<i.length;){if(s+=Zc(e+s,i),nu(i[e+s])&&s++,iu(i[e+s])&&s++,su(i[e+s])&&s++,ou(i[e+s])){s++;continue}t.push(i.substring(e,e+s)),e+=s,s=0}return t}p(Qc,"runes");function Zc(i,t){let e=t[i];if(!$c(e)||i===t.length-1)return 1;let s=e+t[i+1],r=t.substring(i+2,i+5);return Ba(s)&&Ba(r)?4:tu(s)&&ru(r)?t.slice(i).indexOf(String.fromCodePoint(917631))+2:eu(r)?4:2}p(Zc,"nextUnits");function $c(i){return i&&ds(i[0].charCodeAt(0),55296,56319)}p($c,"isFirstOfSurrogatePair");function Ba(i){return ds(Oo(i),127462,127487)}p(Ba,"isRegionalIndicator");function tu(i){return ds(Oo(i),127988,127988)}p(tu,"isSubdivisionFlag");function eu(i){return ds(Oo(i),127995,127999)}p(eu,"isFitzpatrickModifier");function iu(i){return typeof i=="string"&&ds(i.charCodeAt(0),65024,65039)}p(iu,"isVariationSelector");function su(i){return typeof i=="string"&&ds(i.charCodeAt(0),8400,8447)}p(su,"isDiacriticalMark");function ru(i){let t=i.codePointAt(0);return typeof i=="string"&&typeof t=="number"&&ds(t,917504,917631)}p(ru,"isSupplementarySpecialpurposePlane");function nu(i){return typeof i=="string"&&jd.includes(i.charCodeAt(0))}p(nu,"isGrapheme");function ou(i){return typeof i=="string"&&i.charCodeAt(0)===8205}p(ou,"isZeroWidthJoiner");function Oo(i){let t=i.charCodeAt(0)-55296,e=i.charCodeAt(1)-56320;return(t<<10)+e+65536}p(Oo,"codePointFromSurrogatePair");function ds(i,t,e){return i>=t&&i<=e}p(ds,"betweenInclusive");var qe=p((i,t)=>Array.isArray(i)?i==null?void 0:i.includes(t):i===t,"isEqOrIncludes"),ni=p((i,t)=>Array.isArray(t)?t.some(e=>i.has(e)):i.has(t),"setHasOrIncludes"),Tn=p((i,t,e)=>{var s;i.has(t)?(s=i.get(t))==null||s.push(e):i.set(t,[e])},"mapAddOrPush"),Td=(()=>{let i=0;return()=>i++})(),Ld={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},Rd=p(()=>Fs.lastInputDevice,"getLastInputDeviceType"),zd=p(()=>{let i=Fs.buttons;for(let t in i){let e=i[t].keyboard&&[i[t].keyboard].flat(),s=i[t].keyboardCode&&[i[t].keyboardCode].flat(),r=i[t].gamepad&&[i[t].gamepad].flat(),n=i[t].mouse&&[i[t].mouse].flat();e&&e.forEach(o=>{Tn(Fs.buttonsByKey,o,t)}),s&&s.forEach(o=>{Tn(Fs.buttonsByKeyCode,o,t)}),r&&r.forEach(o=>{Tn(Fs.buttonsByGamepad,o,t)}),n&&n.forEach(o=>{Tn(Fs.buttonsByMouse,o,t)})}},"parseButtonBindings"),xr,on=(xr=class{constructor(){S(this,"pressed",new Set([]));S(this,"pressedRepeat",new Set([]));S(this,"released",new Set([]));S(this,"down",new Set([]))}update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(t){this.pressed.add(t),this.pressedRepeat.add(t),this.down.add(t)}pressRepeat(t){this.pressedRepeat.add(t)}release(t){this.down.delete(t),this.pressed.delete(t),this.released.add(t)}},p(xr,"ButtonState"),xr),wr,Nd=(wr=class{constructor(){S(this,"buttonState",new on);S(this,"stickState",new Map)}},p(wr,"GamepadState"),wr),br,Od=(br=class{constructor(){S(this,"dts",[]);S(this,"timer",0);S(this,"fps",0)}tick(t){this.dts.push(t),this.timer+=t,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((e,s)=>e+s)/this.dts.length)),this.dts=[])}},p(br,"FPSCounter"),br),Fs,Hl=Ld,Ud=p(i=>{let t=i.buttons??{};return{canvas:i.canvas,buttons:t,buttonsByKey:new Map,buttonsByMouse:new Map,buttonsByGamepad:new Map,buttonsByKeyCode:new Map,loopID:null,stopped:!1,dt:0,fixedDt:1/50,restDt:0,time:0,realTime:0,fpsCounter:new Od,timeScale:1,skipTime:!1,isHidden:!1,numFrames:0,mousePos:new j(0),mouseDeltaPos:new j(0),keyState:new on,mouseState:new on,mergedGamepadState:new Nd,gamepadStates:new Map,lastInputDevice:null,buttonState:new on,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:i.canvas.offsetWidth,lastHeight:i.canvas.offsetHeight,events:new dn}},"initAppState"),Hd=p(i=>{if(!i.canvas)throw new Error("Please provide a canvas");let t=Ud(i);Fs=t,zd();function e(){return t.dt*t.timeScale}p(e,"dt");function s(){return t.fixedDt*t.timeScale}p(s,"fixedDt");function r(){return t.restDt*t.timeScale}p(r,"restDt");function n(){return t.isHidden}p(n,"isHidden");function o(){return t.time}p(o,"time");function a(){return t.fpsCounter.fps}p(a,"fps");function l(){return t.numFrames}p(l,"numFrames");function c(){return t.canvas.toDataURL()}p(c,"screenshot");function h(C){t.canvas.style.cursor=C}p(h,"setCursor");function d(){return t.canvas.style.cursor}p(d,"getCursor");function u(C){if(C)try{let I=t.canvas.requestPointerLock();I.catch&&I.catch(R=>console.error(R))}catch(I){console.error(I)}else document.exitPointerLock()}p(u,"setCursorLocked");function f(){return!!document.pointerLockElement}p(f,"isCursorLocked");function y(C){C.requestFullscreen?C.requestFullscreen():C.webkitRequestFullscreen&&C.webkitRequestFullscreen()}p(y,"enterFullscreen");function v(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}p(v,"exitFullscreen");function g(C=!0){C?y(t.canvas):v()}p(g,"setFullscreen");function A(){return document.fullscreenElement===t.canvas||document.webkitFullscreenElement===t.canvas}p(A,"isFullscreen");function B(){t.stopped=!0;let C=Object.entries(ge),I=Object.entries(Zo),R=Object.entries(jn);for(let[U,at]of C)t.canvas.removeEventListener(U,at);for(let[U,at]of I)document.removeEventListener(U,at);for(let[U,at]of R)window.removeEventListener(U,at);Ol.disconnect()}p(B,"quit");function F(C,I){t.loopID!==null&&cancelAnimationFrame(t.loopID);let R=0,U=0,at=p(Ct=>{if(t.stopped)return;if(document.visibilityState!=="visible"){t.loopID=requestAnimationFrame(at);return}let ee=Ct/1e3,It=Math.min(ee-t.realTime,.25),Ci=i.maxFPS?1/i.maxFPS:0;if(t.realTime=ee,U+=It,U>Ci){if(!t.skipTime){for(R+=U,t.dt=t.fixedDt,t.restDt=0;R>t.fixedDt;)R-=t.fixedDt,R<t.fixedDt&&(t.restDt=R),C();t.restDt=R,t.dt=U,t.time+=e(),t.fpsCounter.tick(t.dt)}U=0,t.skipTime=!1,t.numFrames++,I(Yr,jl)}t.loopID=requestAnimationFrame(at)},"frame");at(0)}p(F,"run");function E(){return"ontouchstart"in window||navigator.maxTouchPoints>0}p(E,"isTouchscreen");function k(){return t.mousePos.clone()}p(k,"mousePos");function w(){return t.mouseDeltaPos.clone()}p(w,"mouseDeltaPos");function b(C="left"){return t.mouseState.pressed.has(C)}p(b,"isMousePressed");function M(C="left"){return t.mouseState.down.has(C)}p(M,"isMouseDown");function V(C="left"){return t.mouseState.released.has(C)}p(V,"isMouseReleased");function L(){return t.isMouseMoved}p(L,"isMouseMoved");function z(C){return C===void 0?t.keyState.pressed.size>0:ni(t.keyState.pressed,C)}p(z,"isKeyPressed");function O(C){return C===void 0?t.keyState.pressedRepeat.size>0:ni(t.keyState.pressedRepeat,C)}p(O,"isKeyPressedRepeat");function H(C){return C===void 0?t.keyState.down.size>0:ni(t.keyState.down,C)}p(H,"isKeyDown");function Y(C){return C===void 0?t.keyState.released.size>0:ni(t.keyState.released,C)}p(Y,"isKeyReleased");function tt(C){return C===void 0?t.mergedGamepadState.buttonState.pressed.size>0:ni(t.mergedGamepadState.buttonState.pressed,C)}p(tt,"isGamepadButtonPressed");function G(C){return C===void 0?t.mergedGamepadState.buttonState.down.size>0:ni(t.mergedGamepadState.buttonState.down,C)}p(G,"isGamepadButtonDown");function Z(C){return C===void 0?t.mergedGamepadState.buttonState.released.size>0:ni(t.mergedGamepadState.buttonState.released,C)}p(Z,"isGamepadButtonReleased");function ot(C){return C===void 0?t.buttonState.pressed.size>0:ni(t.buttonState.pressed,C)}p(ot,"isButtonPressed");function W(C){return C===void 0?t.buttonState.down.size>0:ni(t.buttonState.down,C)}p(W,"isButtonDown");function ct(C){return C===void 0?t.buttonState.released.size>0:ni(t.buttonState.released,C)}p(ct,"isButtonReleased");function ft(C){var I;return(I=t.buttons)==null?void 0:I[C]}p(ft,"getButton");function X(C,I){t.buttons[C]={...t.buttons[C],...I}}p(X,"setButton");function Zt(C){t.buttonState.press(C),t.events.trigger("buttonPress",C)}p(Zt,"pressButton");function he(C){t.buttonState.release(C),t.events.trigger("buttonRelease",C)}p(he,"releaseButton");function ve(C){return t.events.on("resize",C)}p(ve,"onResize");let xi=Ot(C=>t.events.on("keyDown",C),(C,I)=>t.events.on("keyDown",R=>qe(C,R)&&I(R))),Ui=Ot(C=>t.events.on("keyPress",I=>C(I)),(C,I)=>t.events.on("keyPress",R=>qe(C,R)&&I(R))),ps=Ot(C=>t.events.on("keyPressRepeat",C),(C,I)=>t.events.on("keyPressRepeat",R=>qe(C,R)&&I(R))),fs=Ot(C=>t.events.on("keyRelease",C),(C,I)=>t.events.on("keyRelease",R=>qe(C,R)&&I(R))),wi=Ot(C=>t.events.on("mouseDown",I=>C(I)),(C,I)=>t.events.on("mouseDown",R=>qe(C,R)&&I(R))),Gt=Ot(C=>t.events.on("mousePress",I=>C(I)),(C,I)=>t.events.on("mousePress",R=>qe(C,R)&&I(R))),Vn=Ot(C=>t.events.on("mouseRelease",I=>C(I)),(C,I)=>t.events.on("mouseRelease",R=>R===C&&I(R)));function ys(C){return t.events.on("mouseMove",()=>C(k(),w()))}p(ys,"onMouseMove");function Q(C){return t.events.on("charInput",C)}p(Q,"onCharInput");function ht(C){return t.events.on("touchStart",C)}p(ht,"onTouchStart");function dt(C){return t.events.on("touchMove",C)}p(dt,"onTouchMove");function bt(C){return t.events.on("touchEnd",C)}p(bt,"onTouchEnd");function Ht(C){return t.events.on("scroll",C)}p(Ht,"onScroll");function gt(C){return t.events.on("hide",C)}p(gt,"onHide");function ae(C){return t.events.on("show",C)}p(ae,"onShow");let Hi=Ot(C=>t.events.on("gamepadButtonPress",(I,R)=>C(I,R)),(C,I)=>t.events.on("gamepadButtonPress",(R,U)=>qe(C,R)&&I(R,U))),Jo=Ot(C=>t.events.on("gamepadButtonDown",(I,R)=>C(I,R)),(C,I)=>t.events.on("gamepadButtonDown",(R,U)=>qe(C,R)&&I(R,U))),Xo=Ot(C=>t.events.on("gamepadButtonRelease",(I,R)=>C(I,R)),(C,I)=>t.events.on("gamepadButtonRelease",(R,U)=>qe(C,R)&&I(R,U)));function In(C,I){return t.events.on("gamepadStick",(R,U,at)=>R===C&&I(U,at))}p(In,"onGamepadStick");function qn(C){t.events.on("gamepadConnect",C)}p(qn,"onGamepadConnect");function Hr(C){t.events.on("gamepadDisconnect",C)}p(Hr,"onGamepadDisconnect");function Ke(C){return t.mergedGamepadState.stickState.get(C)||new j(0)}p(Ke,"getGamepadStick");function bi(){return[...t.charInputted]}p(bi,"charInputted");function Gs(){return[...t.gamepads]}p(Gs,"getGamepads");let Ie=Ot(C=>t.events.on("buttonPress",I=>C(I)),(C,I)=>t.events.on("buttonPress",R=>qe(C,R)&&I(R))),Kr=Ot(C=>t.events.on("buttonDown",I=>C(I)),(C,I)=>t.events.on("buttonDown",R=>qe(C,R)&&I(R))),Bi=Ot(C=>t.events.on("buttonRelease",I=>C(I)),(C,I)=>t.events.on("buttonRelease",R=>qe(C,R)&&I(R)));function Yr(){t.events.trigger("input"),t.keyState.down.forEach(C=>t.events.trigger("keyDown",C)),t.mouseState.down.forEach(C=>t.events.trigger("mouseDown",C)),t.buttonState.down.forEach(C=>{t.events.trigger("buttonDown",C)}),Ll()}p(Yr,"processInput");function jl(){t.keyState.update(),t.mouseState.update(),t.buttonState.update(),t.mergedGamepadState.buttonState.update(),t.mergedGamepadState.stickState.forEach((C,I)=>{t.mergedGamepadState.stickState.set(I,new j(0))}),t.charInputted=[],t.isMouseMoved=!1,t.mouseDeltaPos=new j(0),t.gamepadStates.forEach(C=>{C.buttonState.update(),C.stickState.forEach((I,R)=>{C.stickState.set(R,new j(0))})})}p(jl,"resetInput");function Qo(C){let I={index:C.index,isPressed:p(R=>{var U;return((U=t.gamepadStates.get(C.index))==null?void 0:U.buttonState.pressed.has(R))||!1},"isPressed"),isDown:p(R=>{var U;return((U=t.gamepadStates.get(C.index))==null?void 0:U.buttonState.down.has(R))||!1},"isDown"),isReleased:p(R=>{var U;return((U=t.gamepadStates.get(C.index))==null?void 0:U.buttonState.released.has(R))||!1},"isReleased"),getStick:p(R=>{var U;return((U=t.gamepadStates.get(C.index))==null?void 0:U.stickState.get(R))||D()},"getStick")};return t.gamepads.push(I),t.gamepadStates.set(C.index,{buttonState:new on,stickState:new Map([["left",new j(0)],["right",new j(0)]])}),I}p(Qo,"registerGamepad");function Tl(C){t.gamepads=t.gamepads.filter(I=>I.index!==C.index),t.gamepadStates.delete(C.index)}p(Tl,"removeGamepad");function Ll(){var C,I;for(let R of navigator.getGamepads())R&&!t.gamepadStates.has(R.index)&&Qo(R);for(let R of t.gamepads){let U=navigator.getGamepads()[R.index];if(!U)continue;let at=(i.gamepads??{})[U.id]||Hl[U.id]||Hl.default,Ct=t.gamepadStates.get(R.index);if(Ct){for(let ee=0;ee<U.buttons.length;ee++){let It=at.buttons[ee],Ci=U.buttons[ee],ri=t.buttonsByGamepad.has(It);if(Ci.pressed){if(Ct.buttonState.down.has(It)){t.events.trigger("gamepadButtonDown",It,R);continue}t.lastInputDevice="gamepad",ri&&((C=t.buttonsByGamepad.get(It))==null||C.forEach(ki=>{t.buttonState.press(ki),t.events.trigger("buttonPress",ki)})),t.mergedGamepadState.buttonState.press(It),Ct.buttonState.press(It),t.events.trigger("gamepadButtonPress",It,R)}else Ct.buttonState.down.has(It)&&(ri&&((I=t.buttonsByGamepad.get(It))==null||I.forEach(ki=>{t.buttonState.release(ki),t.events.trigger("buttonRelease",ki)})),t.mergedGamepadState.buttonState.release(It),Ct.buttonState.release(It),t.events.trigger("gamepadButtonRelease",It,R))}for(let ee in at.sticks){let It=at.sticks[ee];if(!It)continue;let Ci=new j(U.axes[It.x],U.axes[It.y]);Ct.stickState.set(ee,Ci),t.mergedGamepadState.stickState.set(ee,Ci),t.events.trigger("gamepadStick",ee,Ci,R)}}}}p(Ll,"processGamepad");let ge={},Zo={},jn={},Rl=i.pixelDensity||1;ge.mousemove=C=>{let I=new j(C.offsetX,C.offsetY),R=new j(C.movementX,C.movementY);if(A()){let U=t.canvas.width/Rl,at=t.canvas.height/Rl,Ct=window.innerWidth,ee=window.innerHeight,It=Ct/ee,Ci=U/at;if(It>Ci){let ri=ee/at,ki=(Ct-U*ri)/2;I.x=$e(C.offsetX-ki,0,U*ri,0,U),I.y=$e(C.offsetY,0,at*ri,0,at)}else{let ri=Ct/U,ki=(ee-at*ri)/2;I.x=$e(C.offsetX,0,U*ri,0,U),I.y=$e(C.offsetY-ki,0,at*ri,0,at)}}t.events.onOnce("input",()=>{t.isMouseMoved=!0,t.mousePos=I,t.mouseDeltaPos=R,t.events.trigger("mouseMove")})};let zl=["left","middle","right","back","forward"];ge.mousedown=C=>{t.events.onOnce("input",()=>{var R;let I=zl[C.button];I&&(t.lastInputDevice="mouse",t.buttonsByMouse.has(I)&&((R=t.buttonsByMouse.get(I))==null||R.forEach(U=>{t.buttonState.press(U),t.events.trigger("buttonPress",U)})),t.mouseState.press(I),t.events.trigger("mousePress",I))})},ge.mouseup=C=>{t.events.onOnce("input",()=>{var R;let I=zl[C.button];I&&(t.buttonsByMouse.has(I)&&((R=t.buttonsByMouse.get(I))==null||R.forEach(U=>{t.buttonState.release(U),t.events.trigger("buttonRelease",U)})),t.mouseState.release(I),t.events.trigger("mouseRelease",I))})};let wd=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),Nl={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};ge.keydown=C=>{wd.has(C.key)&&C.preventDefault(),t.events.onOnce("input",()=>{var U,at;let I=Nl[C.key]||C.key.toLowerCase(),R=C.code;if(I===void 0)throw new Error(`Unknown key: ${C.key}`);I.length===1?(t.events.trigger("charInput",I),t.charInputted.push(I)):I==="space"&&(t.events.trigger("charInput"," "),t.charInputted.push(" ")),C.repeat?(t.keyState.pressRepeat(I),t.events.trigger("keyPressRepeat",I)):(t.lastInputDevice="keyboard",t.buttonsByKey.has(I)&&((U=t.buttonsByKey.get(I))==null||U.forEach(Ct=>{t.buttonState.press(Ct),t.events.trigger("buttonPress",Ct)})),t.buttonsByKeyCode.has(R)&&((at=t.buttonsByKeyCode.get(R))==null||at.forEach(Ct=>{t.buttonState.press(Ct),t.events.trigger("buttonPress",Ct)})),t.keyState.press(I),t.events.trigger("keyPressRepeat",I),t.events.trigger("keyPress",I))})},ge.keyup=C=>{t.events.onOnce("input",()=>{var U,at;let I=Nl[C.key]||C.key.toLowerCase(),R=C.code;t.buttonsByKey.has(I)&&((U=t.buttonsByKey.get(I))==null||U.forEach(Ct=>{t.buttonState.release(Ct),t.events.trigger("buttonRelease",Ct)})),t.buttonsByKeyCode.has(R)&&((at=t.buttonsByKeyCode.get(R))==null||at.forEach(Ct=>{t.buttonState.release(Ct),t.events.trigger("buttonRelease",Ct)})),t.keyState.release(I),t.events.trigger("keyRelease",I)})},ge.touchstart=C=>{C.preventDefault(),t.events.onOnce("input",()=>{var U;let I=[...C.changedTouches],R=t.canvas.getBoundingClientRect();i.touchToMouse!==!1&&(t.mousePos=new j(I[0].clientX-R.x,I[0].clientY-R.y),t.lastInputDevice="mouse",t.buttonsByMouse.has("left")&&((U=t.buttonsByMouse.get("left"))==null||U.forEach(at=>{t.buttonState.press(at),t.events.trigger("buttonPress",at)})),t.mouseState.press("left"),t.events.trigger("mousePress","left")),I.forEach(at=>{t.events.trigger("touchStart",new j(at.clientX-R.x,at.clientY-R.y),at)})})},ge.touchmove=C=>{C.preventDefault(),t.events.onOnce("input",()=>{let I=[...C.changedTouches],R=t.canvas.getBoundingClientRect();if(i.touchToMouse!==!1){let U=t.mousePos;t.mousePos=new j(I[0].clientX-R.x,I[0].clientY-R.y),t.mouseDeltaPos=t.mousePos.sub(U),t.events.trigger("mouseMove")}I.forEach(U=>{t.events.trigger("touchMove",new j(U.clientX-R.x,U.clientY-R.y),U)})})},ge.touchend=C=>{t.events.onOnce("input",()=>{var U;let I=[...C.changedTouches],R=t.canvas.getBoundingClientRect();i.touchToMouse!==!1&&(t.mousePos=new j(I[0].clientX-R.x,I[0].clientY-R.y),t.mouseDeltaPos=new j(0,0),t.buttonsByMouse.has("left")&&((U=t.buttonsByMouse.get("left"))==null||U.forEach(at=>{t.buttonState.release(at),t.events.trigger("buttonRelease",at)})),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),I.forEach(at=>{t.events.trigger("touchEnd",new j(at.clientX-R.x,at.clientY-R.y),at)})})},ge.touchcancel=C=>{t.events.onOnce("input",()=>{let I=[...C.changedTouches],R=t.canvas.getBoundingClientRect();i.touchToMouse!==!1&&(t.mousePos=new j(I[0].clientX-R.x,I[0].clientY-R.y),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),I.forEach(U=>{t.events.trigger("touchEnd",new j(U.clientX-R.x,U.clientY-R.y),U)})})},ge.wheel=C=>{C.preventDefault(),t.events.onOnce("input",()=>{t.events.trigger("scroll",new j(C.deltaX,C.deltaY))})},ge.contextmenu=C=>C.preventDefault(),Zo.visibilitychange=()=>{document.visibilityState==="visible"?(t.skipTime=!0,t.isHidden=!1,t.events.trigger("show")):(t.isHidden=!0,t.events.trigger("hide"))},jn.gamepadconnected=C=>{let I=Qo(C.gamepad);t.events.onOnce("input",()=>{t.events.trigger("gamepadConnect",I)})},jn.gamepaddisconnected=C=>{let I=Gs().filter(R=>R.index===C.gamepad.index)[0];Tl(C.gamepad),t.events.onOnce("input",()=>{t.events.trigger("gamepadDisconnect",I)})};for(let[C,I]of Object.entries(ge))t.canvas.addEventListener(C,I);for(let[C,I]of Object.entries(Zo))document.addEventListener(C,I);for(let[C,I]of Object.entries(jn))window.addEventListener(C,I);let Ol=new ResizeObserver(C=>{for(let I of C)if(I.target===t.canvas){if(t.lastWidth===t.canvas.offsetWidth&&t.lastHeight===t.canvas.offsetHeight)return;t.lastWidth=t.canvas.offsetWidth,t.lastHeight=t.canvas.offsetHeight,t.events.onOnce("input",()=>{t.events.trigger("resize")})}});return Ol.observe(t.canvas),{state:t,dt:e,fixedDt:s,restDt:r,time:o,run:F,canvas:t.canvas,fps:a,numFrames:l,quit:B,isHidden:n,setFullscreen:g,isFullscreen:A,setCursor:h,screenshot:c,getGamepads:Gs,getCursor:d,setCursorLocked:u,isCursorLocked:f,isTouchscreen:E,mousePos:k,mouseDeltaPos:w,isKeyDown:H,isKeyPressed:z,isKeyPressedRepeat:O,isKeyReleased:Y,isMouseDown:M,isMousePressed:b,isMouseReleased:V,isMouseMoved:L,isGamepadButtonPressed:tt,isGamepadButtonDown:G,isGamepadButtonReleased:Z,getGamepadStick:Ke,isButtonPressed:ot,isButtonDown:W,isButtonReleased:ct,setButton:X,getButton:ft,pressButton:Zt,releaseButton:he,charInputted:bi,onResize:ve,onKeyDown:xi,onKeyPress:Ui,onKeyPressRepeat:ps,onKeyRelease:fs,onMouseDown:wi,onMousePress:Gt,onMouseRelease:Vn,onMouseMove:ys,onCharInput:Q,onTouchStart:ht,onTouchMove:dt,onTouchEnd:bt,onScroll:Ht,onHide:gt,onShow:ae,onGamepadButtonDown:Jo,onGamepadButtonPress:Hi,onGamepadButtonRelease:Xo,onGamepadStick:In,onGamepadConnect:qn,onGamepadDisconnect:Hr,onButtonPress:Ie,onButtonDown:Kr,onButtonRelease:Bi,getLastInputDeviceType:Rd,events:t.events}},"initApp");function Xt(){return x.app.dt()}p(Xt,"dt");function Ao(){return x.app.fixedDt()}p(Ao,"fixedDt");function xo(){return x.app.restDt()}p(xo,"restDt");var Kd=new j(-1,-1),Yd=new j(0,-1),Gd=new j(1,-1),Wd=new j(-1,0),Jd=new j(0,0),Xd=new j(1,0),Qd=new j(-1,1),Zd=new j(0,1),$d=new j(1,1);function Ns(i){switch(i){case"topleft":return Kd;case"top":return Yd;case"topright":return Gd;case"left":return Wd;case"center":return Jd;case"right":return Xd;case"botleft":return Qd;case"bot":return Zd;case"botright":return $d;default:return i}}p(Ns,"anchorPt");function au(i){switch(i){case"left":return 0;case"center":return .5;case"right":return 1;default:return 0}}p(au,"alignPt");function lu(i){return i.createBuffer(1,1,44100)}p(lu,"createEmptyAudioBuffer");var Ln=2.5949095,Kl=1.70158+1,Yl=2*Math.PI/3,Gl=2*Math.PI/4.5,yo={linear:p(i=>i,"linear"),easeInSine:p(i=>1-Math.cos(i*Math.PI/2),"easeInSine"),easeOutSine:p(i=>Math.sin(i*Math.PI/2),"easeOutSine"),easeInOutSine:p(i=>-(Math.cos(Math.PI*i)-1)/2,"easeInOutSine"),easeInQuad:p(i=>i*i,"easeInQuad"),easeOutQuad:p(i=>1-(1-i)*(1-i),"easeOutQuad"),easeInOutQuad:p(i=>i<.5?2*i*i:1-Math.pow(-2*i+2,2)/2,"easeInOutQuad"),easeInCubic:p(i=>i*i*i,"easeInCubic"),easeOutCubic:p(i=>1-Math.pow(1-i,3),"easeOutCubic"),easeInOutCubic:p(i=>i<.5?4*i*i*i:1-Math.pow(-2*i+2,3)/2,"easeInOutCubic"),easeInQuart:p(i=>i*i*i*i,"easeInQuart"),easeOutQuart:p(i=>1-Math.pow(1-i,4),"easeOutQuart"),easeInOutQuart:p(i=>i<.5?8*i*i*i*i:1-Math.pow(-2*i+2,4)/2,"easeInOutQuart"),easeInQuint:p(i=>i*i*i*i*i,"easeInQuint"),easeOutQuint:p(i=>1-Math.pow(1-i,5),"easeOutQuint"),easeInOutQuint:p(i=>i<.5?16*i*i*i*i*i:1-Math.pow(-2*i+2,5)/2,"easeInOutQuint"),easeInExpo:p(i=>i===0?0:Math.pow(2,10*i-10),"easeInExpo"),easeOutExpo:p(i=>i===1?1:1-Math.pow(2,-10*i),"easeOutExpo"),easeInOutExpo:p(i=>i===0?0:i===1?1:i<.5?Math.pow(2,20*i-10)/2:(2-Math.pow(2,-20*i+10))/2,"easeInOutExpo"),easeInCirc:p(i=>1-Math.sqrt(1-Math.pow(i,2)),"easeInCirc"),easeOutCirc:p(i=>Math.sqrt(1-Math.pow(i-1,2)),"easeOutCirc"),easeInOutCirc:p(i=>i<.5?(1-Math.sqrt(1-Math.pow(2*i,2)))/2:(Math.sqrt(1-Math.pow(-2*i+2,2))+1)/2,"easeInOutCirc"),easeInBack:p(i=>Kl*i*i*i-1.70158*i*i,"easeInBack"),easeOutBack:p(i=>1+Kl*Math.pow(i-1,3)+1.70158*Math.pow(i-1,2),"easeOutBack"),easeInOutBack:p(i=>i<.5?Math.pow(2*i,2)*((Ln+1)*2*i-Ln)/2:(Math.pow(2*i-2,2)*((Ln+1)*(i*2-2)+Ln)+2)/2,"easeInOutBack"),easeInElastic:p(i=>i===0?0:i===1?1:-Math.pow(2,10*i-10)*Math.sin((i*10-10.75)*Yl),"easeInElastic"),easeOutElastic:p(i=>i===0?0:i===1?1:Math.pow(2,-10*i)*Math.sin((i*10-.75)*Yl)+1,"easeOutElastic"),easeInOutElastic:p(i=>i===0?0:i===1?1:i<.5?-(Math.pow(2,20*i-10)*Math.sin((20*i-11.125)*Gl))/2:Math.pow(2,-20*i+10)*Math.sin((20*i-11.125)*Gl)/2+1,"easeInOutElastic"),easeInBounce:p(i=>1-yo.easeOutBounce(1-i),"easeInBounce"),easeOutBounce:p(i=>i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375,"easeOutBounce"),easeInOutBounce:p(i=>i<.5?(1-yo.easeOutBounce(1-2*i))/2:(1+yo.easeOutBounce(2*i-1))/2,"easeInOutBounce")},pn=yo;function hu(i,t,e){let s=[],r=t;for(s.push(r);r!==i;){if(r=e.get(r),r==null)return null;s.push(r)}return s.reverse()}p(hu,"buildPath");function cu(i,t,e){var o;let s=new Kc((a,l)=>a.cost<l.cost);s.insert({cost:0,node:t});let r=new Map;r.set(t,t);let n=new Map;for(n.set(t,0);s.length!==0;){let a=(o=s.remove())==null?void 0:o.node;if(a===e)break;let l=i.getNeighbours(a);for(let c of l){let h=(n.get(a)||0)+i.getCost(a,c)+i.getHeuristic(c,e);(!n.has(c)||h<n.get(c))&&(n.set(c,h),s.insert({cost:h,node:c}),r.set(c,a))}}return hu(t,e,r)}p(cu,"aStarSearch");var Br,tp=(Br=class{constructor(t,e,s){S(this,"a");S(this,"b");S(this,"polygon");this.a=t,this.b=e,this.polygon=new WeakRef(s)}isLeft(t,e){return(this.b.x-this.a.x)*(e-this.a.y)-(t-this.a.x)*(this.b.y-this.a.y)}get middle(){return this.a.add(this.b).scale(.5)}},p(Br,"NavEdge"),Br),Cr,ep=(Cr=class{constructor(t){S(this,"_edges");S(this,"_centroid");S(this,"_id");this._id=t}get id(){return this._id}set edges(t){this._edges=t;let e=0,s=0,r=0;for(let n of this._edges){n.polygon=new WeakRef(this);let o=n.a.x*n.b.y-n.a.y*n.b.x;e+=(n.a.x+n.b.x)*o,s+=(n.a.y+n.b.y)*o,r+=o}r/=2,this._centroid=D(e/(6*r),s/(6*r))}get edges(){return this._edges}get centroid(){return this._centroid}contains(t){let e=!1;for(let s of this.edges)s.b.y>t.y!=s.a.y>t.y&&t.x<(s.a.x-s.b.x)*(t.y-s.b.y)/(s.a.y-s.b.y)+s.b.x&&(e=!e);return e}},p(Cr,"NavPolygon"),Cr),kr,ip=(kr=class{constructor(){S(this,"_polygons");S(this,"_pointCache");S(this,"_edgeCache");this._polygons=[],this._pointCache={},this._edgeCache={}}_addPoint(t){let e=this._pointCache[`${t.x}_${t.y}`];return e||(e=t.clone(),this._pointCache[`${t.x}_${t.y}`]=e,e)}_addEdge(t){let e=`${t.a.x}_${t.a.y}-${t.b.x}_${t.b.y}`;return this._edgeCache[e]=t,t}_findEdge(t,e){let s=`${t.x}_${t.y}-${e.x}_${e.y}`;return this._edgeCache[s]}_findCommonEdge(t,e){for(let s of t.edges){let r=this._findEdge(s.b,s.a);if(r&&r.polygon.deref().id===e.id)return r}return null}addPolygon(t){let e=new ep(this._polygons.length),s=t.map((r,n)=>new tp(r,t[(n+1)%t.length],e));e.edges=s,this._polygons.push(e);for(let r of e.edges)this._addEdge(r);return e}addRect(t,e){let s=this._addPoint(t),r=this._addPoint(t.add(e.x,0)),n=this._addPoint(t.add(e)),o=this._addPoint(t.add(0,e.y));return this.addPolygon([s,r,n,o])}_getLocation(t){for(let e of this._polygons)if(e.contains(t))return e;return null}getNeighbours(t){let e=[];for(let s of this._polygons[t].edges){let r=this._findEdge(s.b,s.a);if(r){let n=r.polygon.deref();n&&e.push(n.id)}}return e}getCost(t,e){return 1}getHeuristic(t,e){let s=this._polygons[t],r=this._polygons[e],n=s.centroid.x-r.centroid.x,o=s.centroid.y-r.centroid.y;return Math.sqrt(n*n+o*o)}getPath(t,e){return t===void 0||e===void 0?[]:t===e?[t,e]:cu(this,t,e)}getWaypointPath(t,e,s){let r=(s==null?void 0:s.type)||"centroids",n=this._getLocation(t),o=this._getLocation(e);if(n===void 0||o===void 0)return[];let a=this.getPath(n.id,o.id);if(!a)return[];if(r==="edges"){let l=[];for(let c=1;c<a.length;c++){let h=this._polygons[a[c-1]],d=this._polygons[a[c]],u=this._findCommonEdge(h,d);l.push(u.middle.add(d.centroid.sub(u.middle).unit().scale(4)))}return[t,...l,e]}else return[t,...a.slice(1,-1).map(l=>this._polygons[l].centroid),e]}},p(kr,"NavMesh"),kr);function pr(i){let t=new _i;return i.pos&&t.translate(i.pos),i.scale&&t.scale(i.scale),i.angle&&t.rotate(i.angle),i.parent?t.mult(i.parent.transform):t}p(pr,"calcTransform");function uu(i){return new j(i.x/te()*2-1,-i.y/ie()*2+1)}p(uu,"screen2ndc");function ur(i,t,e,s,r,n=1){s=Ut(s%360),r=Ut(r%360),r<=s&&(r+=Math.PI*2);let o=[],a=Math.ceil((r-s)/Ut(8)*n),l=(r-s)/a,c=D(Math.cos(s),Math.sin(s)),h=D(Math.cos(l),Math.sin(l));for(let d=0;d<=a;d++)o.push(i.add(t*c.x,e*c.y)),c=D(c.x*h.x-c.y*h.y,c.x*h.y+c.y*h.x);return o}p(ur,"getArcPts");function mu(...i){let t=xt(...i),e=i[3]??1;x.gfx.bgColor=t,x.gfx.bgAlpha=e,x.gfx.ggl.gl.clearColor(t.r/255,t.g/255,t.b/255,e)}p(mu,"setBackground");function du(){var i,t;return((t=(i=x.gfx.bgColor)==null?void 0:i.clone)==null?void 0:t.call(i))??null}p(du,"getBackground");function Dt(...i){if(i[0]===void 0)return;let t=D(...i);t.x===0&&t.y===0||x.gfx.transform.translate(t)}p(Dt,"pushTranslate");function Ce(){x.gfx.transformStack.push(x.gfx.transform.clone())}p(Ce,"pushTransform");function pu(i){x.gfx.transform=i.clone()}p(pu,"pushMatrix");function Lr(...i){if(i[0]===void 0)return;let t=D(...i);t.x===1&&t.y===1||x.gfx.transform.scale(t)}p(Lr,"pushScale");function Ls(i){i&&x.gfx.transform.rotate(i)}p(Ls,"pushRotate");function fe(){x.gfx.transformStack.length>0&&(x.gfx.transform=x.gfx.transformStack.pop())}p(fe,"popTransform");function ke(){x.gfx.renderer.flush()}p(ke,"flush");function te(){return x.gfx.width}p(te,"width");function ie(){return x.gfx.height}p(ie,"height");function Za(){return(x.gfx.viewport.width+x.gfx.viewport.height)/(x.gfx.width+x.gfx.height)}p(Za,"getViewportScale");function fu(i){return new j(i.x*x.gfx.viewport.width/x.gfx.width,i.y*x.gfx.viewport.height/x.gfx.height)}p(fu,"contentToView");function yu(i){return new j((i.x-x.gfx.viewport.x)*te()/x.gfx.viewport.width,(i.y-x.gfx.viewport.y)*ie()/x.gfx.viewport.height)}p(yu,"windowToContent");function $a(){return yu(x.app.mousePos())}p($a,"mousePos");function fn(){return D(te()/2,ie()/2)}p(fn,"center");var _u=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",Uo="topleft",sp="monospace",wo="monospace",Ca="linear",tl=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],rp=tl.reduce((i,t)=>i+t.size,0),vu=2048,np=vu*4*rp,op=vu*6,ap=`
attribute vec2 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 0.0, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,lp=`
precision mediump float;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	return v_color * texture2D(u_tex, v_uv);
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,ka=`
vec4 vert(vec2 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,Ma=`
vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,hp=new Set(["id","require"]),cp=new Set(["add","fixedUpdate","update","draw","destroy","inspect","drawInspect"]),up=200,mp=640,dp=65536,Mr,pp=(Mr=class{constructor(t,e,s){S(this,"textures",[]);S(this,"bigTextures",[]);S(this,"canvas");S(this,"c2d");S(this,"x",0);S(this,"y",0);S(this,"curHeight",0);S(this,"gfx");this.gfx=t,this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=s,this.textures=[ts.fromImage(t,this.canvas)],this.bigTextures=[];let r=this.canvas.getContext("2d");if(!r)throw new Error("Failed to get 2d context");this.c2d=r}add(t){if(t.width>this.canvas.width||t.height>this.canvas.height){let r=ts.fromImage(this.gfx,t);return this.bigTextures.push(r),[r,new Vt(0,0,1,1)]}this.x+t.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+t.height>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(ts.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let e=this.textures[this.textures.length-1],s=new j(this.x,this.y);return this.x+=t.width,t.height>this.curHeight&&(this.curHeight=t.height),t instanceof ImageData?this.c2d.putImageData(t,s.x,s.y):this.c2d.drawImage(t,s.x,s.y),e.update(this.canvas),[e,new Vt(s.x/this.canvas.width,s.y/this.canvas.height,t.width/this.canvas.width,t.height/this.canvas.height)]}free(){for(let t of this.textures)t.free();for(let t of this.bigTextures)t.free()}},p(Mr,"TexPacker"),Mr);function Se(i){return typeof i!="string"||Jc(i)?i:x.assets.urlPrefix+i}p(Se,"fixURL");var js,He=(js=class{constructor(t){S(this,"loaded",!1);S(this,"data",null);S(this,"error",null);S(this,"onLoadEvents",new Be);S(this,"onErrorEvents",new Be);S(this,"onFinishEvents",new Be);t.then(e=>{this.loaded=!0,this.data=e,this.onLoadEvents.trigger(e)}).catch(e=>{if(this.error=e,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(e);else throw e}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(t){let e=new js(Promise.resolve(t));return e.data=t,e.loaded=!0,e}onLoad(t){return this.loaded&&this.data?t(this.data):this.onLoadEvents.add(t),this}onError(t){return this.loaded&&this.error?t(this.error):this.onErrorEvents.add(t),this}onFinish(t){return this.loaded?t():this.onFinishEvents.add(t),this}then(t){return this.onLoad(t)}catch(t){return this.onError(t)}finally(t){return this.onFinish(t)}},p(js,"Asset"),js),Fr,Ws=(Fr=class{constructor(){S(this,"assets",new Map);S(this,"lastUID",0)}add(t,e){let s=t??this.lastUID+++"",r=new He(e);return this.assets.set(s,r),r}addLoaded(t,e){let s=t??this.lastUID+++"",r=He.loaded(e);return this.assets.set(s,r),r}get(t){return this.assets.get(t)}progress(){if(this.assets.size===0)return 1;let t=0;return this.assets.forEach(e=>{e.loaded&&t++}),t/this.assets.size}},p(Fr,"AssetBucket"),Fr);function Ho(i){return fetch(i).then(t=>{if(!t.ok)throw new Error(`Failed to fetch "${i}"`);return t})}p(Ho,"fetchURL");function Fn(i){return Ho(i).then(t=>t.json())}p(Fn,"fetchJSON");function gu(i){return Ho(i).then(t=>t.text())}p(gu,"fetchText");function Au(i){return Ho(i).then(t=>t.arrayBuffer())}p(Au,"fetchArrayBuffer");function xu(i){return i!==void 0&&(x.assets.urlPrefix=i),x.assets.urlPrefix}p(xu,"loadRoot");function wu(i,t){return x.assets.custom.add(i,Fn(Se(t)))}p(wu,"loadJSON");function En(i){let t=new Image;return t.crossOrigin="anonymous",t.src=i,new Promise((e,s)=>{t.onload=()=>e(t),t.onerror=()=>s(new Error(`Failed to load image from "${i}"`))})}p(En,"loadImg");function as(){let i=[x.assets.sprites,x.assets.sounds,x.assets.shaders,x.assets.fonts,x.assets.bitmapFonts,x.assets.custom];return i.reduce((t,e)=>t+e.progress(),0)/i.length}p(as,"loadProgress");function bu(i){return x.assets.custom.get(i)??null}p(bu,"getAsset");function bo(i){return x.assets.custom.add(null,i)}p(bo,"load");var fp=p(i=>({urlPrefix:"",sprites:new Ws,fonts:new Ws,bitmapFonts:new Ws,sounds:new Ws,shaders:new Ws,custom:new Ws,music:{},packer:new pp(i,2048,2048),loaded:!1}),"initAssets"),yp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==",fi,ls=(fi=class{constructor(t,e,s={},r=null){S(this,"tex");S(this,"frames",[new Vt(0,0,1,1)]);S(this,"anims",{});S(this,"slice9",null);this.tex=t,e&&(this.frames=e),this.anims=s,this.slice9=r}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(t,e={}){return typeof t=="string"?fi.fromURL(t,e):Promise.resolve(fi.fromImage(t,e))}static fromImage(t,e={}){let[s,r]=x.assets.packer.add(t),n=e.frames?e.frames.map(o=>new Vt(r.x+o.x*r.w,r.y+o.y*r.h,o.w*r.w,o.h*r.h)):il(e.sliceX||1,e.sliceY||1,r.x,r.y,r.w,r.h);return new fi(s,n,e.anims,e.slice9)}static fromURL(t,e={}){return En(t).then(s=>fi.fromImage(s,e))}},p(fi,"SpriteData"),fi);function an(i){if(typeof i=="string"){let t=el(i);if(t)return t;if(as()<1)return null;throw new Error(`Sprite not found: ${i}`)}else{if(i instanceof ls)return He.loaded(i);if(i instanceof He)return i;throw new Error(`Invalid sprite: ${i}`)}}p(an,"resolveSprite");function el(i){return x.assets.sprites.get(i)??null}p(el,"getSprite");function fr(i,t,e={sliceX:1,sliceY:1,anims:{}}){return t=Se(t),Array.isArray(t)?t.some(s=>typeof s=="string")?x.assets.sprites.add(i,Promise.all(t.map(s=>typeof s=="string"?En(s):Promise.resolve(s))).then(s=>Fa(s,e))):x.assets.sprites.addLoaded(i,Fa(t,e)):typeof t=="string"?x.assets.sprites.add(i,ls.from(t,e)):x.assets.sprites.addLoaded(i,ls.fromImage(t,e))}p(fr,"loadSprite");function il(i=1,t=1,e=0,s=0,r=1,n=1){let o=[],a=r/i,l=n/t;for(let c=0;c<t;c++)for(let h=0;h<i;h++)o.push(new Vt(e+h*a,s+c*l,a,l));return o}p(il,"slice");function Fa(i,t={}){let e=document.createElement("canvas"),s=i[0].width,r=i[0].height;e.width=s*i.length,e.height=r;let n=e.getContext("2d");if(!n)throw new Error("Failed to create canvas context");i.forEach((a,l)=>{a instanceof ImageData?n.putImageData(a,l*s,0):n.drawImage(a,l*s,0)});let o=n.getImageData(0,0,i.length*s,r);return ls.fromImage(o,{...t,sliceX:i.length,sliceY:1})}p(Fa,"createSpriteSheet");function Bu(i="bean"){return fr(i,yp)}p(Bu,"loadBean");function Cu(i,t,e){t=Se(t),e=Se(e),typeof t=="string"&&!e&&(e=Id(t)+".json");let s=typeof e=="string"?Fn(e):Promise.resolve(e);return x.assets.sprites.add(i,s.then(r=>{let n=r.meta.size,o=r.frames.map(l=>new Vt(l.frame.x/n.w,l.frame.y/n.h,l.frame.w/n.w,l.frame.h/n.h)),a={};for(let l of r.meta.frameTags)l.from===l.to?a[l.name]=l.from:a[l.name]={from:l.from,to:l.to,speed:10,loop:!0,pingpong:l.direction==="pingpong"};return ls.from(t,{frames:o,anims:a})}))}p(Cu,"loadAseprite");var Er,_o=(Er=class{constructor(t,e={}){S(this,"fontface");S(this,"filter",Ca);S(this,"outline",null);S(this,"size",64);if(this.fontface=t,this.filter=e.filter??Ca,this.size=e.size??64,this.size>256)throw new Error("Max font size: 256");e.outline&&(this.outline={width:1,color:xt(0,0,0)},typeof e.outline=="number"?this.outline.width=e.outline:typeof e.outline=="object"&&(e.outline.width&&(this.outline.width=e.outline.width),e.outline.color&&(this.outline.color=e.outline.color)))}},p(Er,"FontData"),Er);function sl(i){if(!i)return sl(x.globalOpt.font??sp);if(typeof i=="string"){let t=nl(i),e=rl(i);if(t)return t.data??t;if(e)return e.data??e;if(document.fonts.check(`64px ${i}`))return i;if(as()<1)return null;throw new Error(`Font not found: ${i}`)}else if(i instanceof He)return i.data?i.data:i;return i}p(sl,"resolveFont");function rl(i){return x.assets.fonts.get(i)??null}p(rl,"getFont");function ku(i,t,e={}){let s=Se(t),r=new FontFace(i,typeof t=="string"?`url(${s})`:s);return document.fonts.add(r),x.assets.fonts.add(i,r.load().catch(n=>{throw new Error(`Failed to load font from "${s}": ${n}`)}).then(n=>new _o(n,e)))}p(ku,"loadFont");function Mu(i,t,e,s){let r=i.width/t,n={},o=s.split("").entries();for(let[a,l]of o)n[l]=new Vt(a%r*t,Math.floor(a/r)*e,t,e);return{tex:i,map:n,size:e}}p(Mu,"makeFont");function nl(i){return x.assets.bitmapFonts.get(i)??null}p(nl,"getBitmapFont");function Fu(i,t,e,s,r={}){let n=Se(t);return x.assets.bitmapFonts.add(i,En(n).then(o=>Mu(ts.fromImage(x.gfx.ggl,o,r),e,s,r.chars??_u)))}p(Fu,"loadBitmapFont");function Eu(i,t){return t=Se(t),x.assets.sprites.add(i,new Promise(async e=>{let s=typeof t=="string"?await Fn(t):t,r=await Promise.all(s.frames.map(En)),n=document.createElement("canvas");n.width=s.width,n.height=s.height*s.frames.length;let o=n.getContext("2d");if(!o)throw new Error("Failed to create canvas context");r.forEach((l,c)=>{o.drawImage(l,0,c*s.height)});let a=await fr(null,n,{sliceY:s.frames.length,anims:s.anims});e(a)}))}p(Eu,"loadPedit");var Sr,_p=(Sr=class{constructor(t,e,s,r){S(this,"ctx");S(this,"glProgram");this.ctx=t,t.onDestroy(()=>this.free());let n=t.gl,o=n.createShader(n.VERTEX_SHADER),a=n.createShader(n.FRAGMENT_SHADER);if(!o||!a)throw new Error("Failed to create shader");n.shaderSource(o,e),n.shaderSource(a,s),n.compileShader(o),n.compileShader(a);let l=n.createProgram();if(this.glProgram=l,n.attachShader(l,o),n.attachShader(l,a),r.forEach((c,h)=>n.bindAttribLocation(l,h,c)),n.linkProgram(l),!n.getProgramParameter(l,n.LINK_STATUS)){let c=n.getShaderInfoLog(o);if(c)throw new Error("VERTEX SHADER "+c);let h=n.getShaderInfoLog(a);if(h)throw new Error("FRAGMENT SHADER "+h)}n.deleteShader(o),n.deleteShader(a)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(t){let e=this.ctx.gl;for(let s in t){let r=t[s],n=e.getUniformLocation(this.glProgram,s);if(typeof r=="number")e.uniform1f(n,r);else if(r instanceof _i)e.uniformMatrix4fv(n,!1,new Float32Array(r.m));else if(r instanceof ut)e.uniform3f(n,r.r,r.g,r.b);else if(r instanceof j)e.uniform2f(n,r.x,r.y);else if(Array.isArray(r))r[0],Vd(r)?e.uniform1fv(n,r):Dd(r)?e.uniform2fv(n,r.map(o=>[o.x,o.y]).flat()):Pd(r)&&e.uniform3fv(n,r.map(o=>[o.r,o.g,o.b]).flat());else throw new Error("Unsupported uniform data type")}}free(){this.ctx.gl.deleteProgram(this.glProgram)}},p(Sr,"Shader"),Sr);function Ko(i,t=ka,e=Ma){let s=ap.replace("{{user}}",t??ka),r=lp.replace("{{user}}",e??Ma);try{return new _p(i,s,r,tl.map(n=>n.name))}catch(n){let o=/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/,a=qd(n).match(o);if(!(a!=null&&a.groups))throw n;let l=Number(a.groups.line)-14,c=a.groups.msg.trim(),h=a.groups.type.toLowerCase();throw new Error(`${h} shader line ${l}: ${c}`)}}p(Ko,"makeShader");function Su(i){if(!i)return x.gfx.defShader;if(typeof i=="string"){let t=ol(i);if(t)return t.data??t;if(as()<1)return null;throw new Error(`Shader not found: ${i}`)}else if(i instanceof He)return i.data?i.data:i;return i}p(Su,"resolveShader");function ol(i){return x.assets.shaders.get(i)??null}p(ol,"getShader");function Pu(i,t,e){return x.assets.shaders.addLoaded(i,Ko(x.gfx.ggl,t,e))}p(Pu,"loadShader");function Du(i,t,e){t=Se(t),e=Se(e);let s=p(n=>n?gu(n):Promise.resolve(null),"resolveUrl"),r=Promise.all([s(t),s(e)]).then(([n,o])=>Ko(x.gfx.ggl,n,o));return x.assets.shaders.add(i,r)}p(Du,"loadShaderURL");var ji,yn=(ji=class{constructor(t){S(this,"buf");this.buf=t}static fromArrayBuffer(t){return new Promise((e,s)=>x.audio.ctx.decodeAudioData(t,e,s)).then(e=>new ji(e))}static fromURL(t){return Jc(t)?ji.fromArrayBuffer(Gc(t)):Au(t).then(e=>ji.fromArrayBuffer(e))}},p(ji,"SoundData"),ji);function Vu(i){if(typeof i=="string"){let t=al(i);if(t)return t;if(as()<1)return null;throw new Error(`Sound not found: ${i}`)}else{if(i instanceof yn)return He.loaded(i);if(i instanceof He)return i;throw new Error(`Invalid sound: ${i}`)}}p(Vu,"resolveSound");function al(i){return x.assets.sounds.get(i)??null}p(al,"getSound");function Iu(i,t){return t=Se(t),x.assets.sounds.add(i,typeof t=="string"?yn.fromURL(t):yn.fromArrayBuffer(t))}p(Iu,"loadSound");function qu(i,t){let e=Se(t),s=new Audio(e);return s.preload="auto",x.assets.music[i]=e}p(qu,"loadMusic");function ll(i,t){return i=Se(i),bo(typeof t=="string"?new Promise((e,s)=>{Fn(t).then(r=>{ll(i,r).then(e).catch(s)})}):ls.from(i).then(e=>{let s={};for(let r in t){let n=t[r],o=e.frames[0],a=2048*o.w,l=2048*o.h,c=n.frames?n.frames.map(d=>new Vt(o.x+(n.x+d.x)/a*o.w,o.y+(n.y+d.y)/l*o.h,d.w/a*o.w,d.h/l*o.h)):il(n.sliceX||1,n.sliceY||1,o.x+n.x/a*o.w,o.y+n.y/l*o.h,n.width/a*o.w,n.height/l*o.h),h=new ls(e.tex,c,n.anims);x.assets.sprites.addLoaded(r,h),s[r]=h}return s}))}p(ll,"loadSpriteAtlas");function Oi(i,t,e=!1,s,r,n={}){let o=s??x.gfx.defTex,a=r??x.gfx.defShader,l=Su(a);if(!l||l instanceof He)return;let c=x.gfx.fixed||e?x.gfx.transform:x.game.cam.transform.mult(x.gfx.transform),h=[];for(let d of i){let u=uu(c.multVec2(d.pos));h.push(u.x,u.y,d.uv.x,d.uv.y,d.color.r/255,d.color.g/255,d.color.b/255,d.opacity)}x.gfx.renderer.push(x.gfx.ggl.gl.TRIANGLES,h,t,l,o,n)}p(Oi,"drawRaw");function Ti(i){if(!i.pts)throw new Error('drawPolygon() requires property "pts".');let t=i.pts.length;if(!(t<3)){if(Ce(),Dt(i.pos),Lr(i.scale),Ls(i.angle),Dt(i.offset),i.fill!==!1){let e=i.color??ut.WHITE,s=i.pts.map((n,o)=>({pos:new j(n.x,n.y),uv:i.uv?i.uv[o]:new j(0,0),color:i.colors&&i.colors[o]?i.colors[o].mult(e):e,opacity:i.opacity??1})),r;i.triangulate?r=Xa(i.pts).map(n=>n.map(o=>i.pts.indexOf(o))).flat():r=[...Array(t-2).keys()].map(n=>[0,n+1,n+2]).flat(),Oi(s,i.indices??r,i.fixed,i.uv?i.tex:x.gfx.defTex,i.shader,i.uniform??void 0)}i.outline&&Yo({pts:[...i.pts,i.pts[0]],radius:i.radius,width:i.outline.width,color:i.outline.color,join:i.outline.join,uniform:i.uniform,fixed:i.fixed,opacity:i.opacity??i.outline.opacity}),fe()}}p(Ti,"drawPolygon");function hl(i){if(i.radiusX===void 0||i.radiusY===void 0)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(i.radiusX===0||i.radiusY===0)return;let t=i.start??0,e=i.end??360,s=Ns(i.anchor??"center").scale(new j(-i.radiusX,-i.radiusY)),r=ur(s,i.radiusX,i.radiusY,t,e,i.resolution);r.unshift(s);let n=Object.assign({},i,{pts:r,radius:0,...i.gradient?{colors:[i.gradient[0],...Array(r.length-1).fill(i.gradient[1])]}:{}});if(e-t>=360&&i.outline){i.fill!==!1&&Ti(Object.assign({},n,{outline:null})),Ti(Object.assign({},n,{pts:r.slice(1),fill:!1}));return}Ti(n)}p(hl,"drawEllipse");function Os(i){if(typeof i.radius!="number")throw new Error('drawCircle() requires property "radius".');i.radius!==0&&hl(Object.assign({},i,{radiusX:i.radius,radiusY:i.radius,angle:0}))}p(Os,"drawCircle");function mr(i){let{p1:t,p2:e}=i;if(!t||!e)throw new Error('drawLine() requires properties "p1" and "p2".');let s=i.width||1,r=e.sub(t).unit().normal().scale(s*.5),n=[t.sub(r),t.add(r),e.add(r),e.sub(r)].map(o=>({pos:new j(o.x,o.y),uv:new j(0),color:i.color??ut.WHITE,opacity:i.opacity??1}));Oi(n,[0,1,3,1,2,3],i.fixed,x.gfx.defTex,i.shader,i.uniform??void 0)}p(mr,"drawLine");function ju(i){let t=i.pts,e=[],s=(i.width||1)*.5,r=t[0]===t[t.length-1]||t[0].eq(t[t.length-1]),n=i.pos||D(0,0),o;r?o=t[0].sub(t[t.length-2]):o=t[1].sub(t[0]);let a=o.len(),l=o.normal().scale(-s/a),c,h=t[0];if(!r)switch(i.cap){case"square":{let y=o.scale(-s/a);e.push(h.add(y).add(l)),e.push(h.add(y).sub(l));break}case"round":{let y=Math.max(s,10),v=Math.PI/y,g=l.scale(-1),A=Math.cos(v),B=Math.sin(v);for(let F=0;F<y;F++)e.push(h),e.push(h.sub(g)),g=D(g.x*A-g.y*B,g.x*B+g.y*A)}}for(let y=1;y<t.length;y++){if(h===t[y]||h.eq(t[y]))continue;c=h,h=t[y];let v=h.sub(c),g=v.len(),A=v.normal().scale(-s/g),B=o.cross(v);if(Math.abs(B)/(a*g)<.05){e.push(c.add(l)),e.push(c.sub(l)),o.dot(v)<0&&(e.push(c.sub(l)),e.push(c.add(l))),o=v,a=g,l=A;continue}let F=A.sub(l).cross(v)/B,E=l.add(o.scale(F));B>0?(e.push(c.add(E)),e.push(c.sub(l)),e.push(c.add(E)),e.push(c.sub(A))):(e.push(c.add(l)),e.push(c.sub(E)),e.push(c.add(A)),e.push(c.sub(E))),o=v,a=g,l=A}if(!r)switch(e.push(h.add(l)),e.push(h.sub(l)),i.cap){case"square":{let y=o.scale(s/a);e.push(h.add(y).add(l)),e.push(h.add(y).sub(l));break}case"round":{let y=Math.max(s,10),v=Math.PI/y,g=l.scale(1),A=Math.cos(v),B=Math.sin(v);for(let F=0;F<y;F++)g=D(g.x*A-g.y*B,g.x*B+g.y*A),e.push(h),e.push(h.sub(g))}}if(e.length<4)return;let d=e.map(y=>({pos:n.add(y),uv:D(),color:i.color||ut.WHITE,opacity:i.opacity??1})),u=[],f=0;for(let y=0;y<e.length-2;y+=2)u[f++]=y+1,u[f++]=y,u[f++]=y+2,u[f++]=y+2,u[f++]=y+3,u[f++]=y+1;r&&(u[f++]=e.length-1,u[f++]=e.length-2,u[f++]=0,u[f++]=0,u[f++]=1,u[f++]=e.length-1),Oi(d,u,i.fixed,x.gfx.defTex,i.shader,i.uniform??void 0)}p(ju,"_drawLinesBevel");function Tu(i){let t=i.pts,e=[],s=(i.width||1)*.5,r=t[0]===t[t.length-1]||t[0].eq(t[t.length-1]),n=i.pos||D(0,0),o;r?o=t[0].sub(t[t.length-2]):o=t[1].sub(t[0]);let a=o.len(),l=o.normal().scale(-s/a),c,h=t[0];if(!r)switch(i.cap){case"square":{let y=o.scale(-s/a);e.push(h.add(y).add(l)),e.push(h.add(y).sub(l));break}case"round":{let y=Math.max(s,10),v=Math.PI/y,g=l.scale(-1),A=Math.cos(v),B=Math.sin(v);for(let F=0;F<y;F++)e.push(h),e.push(h.sub(g)),g=D(g.x*A-g.y*B,g.x*B+g.y*A)}}for(let y=1;y<t.length;y++){if(h===t[y]||h.eq(t[y]))continue;c=h,h=t[y];let v=h.sub(c),g=v.len(),A=v.normal().scale(-s/g),B=o.cross(v);if(Math.abs(B)/(a*g)<.05){e.push(c.add(l)),e.push(c.sub(l)),o.dot(v)<0&&(e.push(c.sub(l)),e.push(c.add(l))),o=v,a=g,l=A;continue}let F=A.sub(l).cross(v)/B,E=l.add(o.scale(F));if(B>0){let k=c.add(E),w=Math.max(s,10),b=Ut(l.angleBetween(A)/w),M=l,V=Math.cos(b),L=Math.sin(b);for(let z=0;z<w;z++)e.push(k),e.push(c.sub(M)),M=D(M.x*V-M.y*L,M.x*L+M.y*V)}else{let k=c.sub(E),w=Math.max(s,10),b=Ut(l.angleBetween(A)/w),M=l,V=Math.cos(b),L=Math.sin(b);for(let z=0;z<w;z++)e.push(c.add(M)),e.push(k),M=D(M.x*V-M.y*L,M.x*L+M.y*V)}o=v,a=g,l=A}if(!r)switch(e.push(h.add(l)),e.push(h.sub(l)),i.cap){case"square":{let y=o.scale(s/a);e.push(h.add(y).add(l)),e.push(h.add(y).sub(l));break}case"round":{let y=Math.max(s,10),v=Math.PI/y,g=l.scale(1),A=Math.cos(v),B=Math.sin(v);for(let F=0;F<y;F++)g=D(g.x*A-g.y*B,g.x*B+g.y*A),e.push(h),e.push(h.sub(g))}}if(e.length<4)return;let d=e.map(y=>({pos:n.add(y),uv:D(),color:i.color||ut.WHITE,opacity:i.opacity??1})),u=[],f=0;for(let y=0;y<e.length-2;y+=2)u[f++]=y+1,u[f++]=y,u[f++]=y+2,u[f++]=y+2,u[f++]=y+3,u[f++]=y+1;r&&(u[f++]=e.length-1,u[f++]=e.length-2,u[f++]=0,u[f++]=0,u[f++]=1,u[f++]=e.length-1),Oi(d,u,i.fixed,x.gfx.defTex,i.shader,i.uniform??void 0)}p(Tu,"_drawLinesRound");function Lu(i){let t=i.pts,e=[],s=(i.width||1)*.5,r=t[0]===t[t.length-1]||t[0].eq(t[t.length-1]),n=i.pos||D(0,0),o;r?o=t[0].sub(t[t.length-2]):o=t[1].sub(t[0]);let a=o.len(),l=o.normal().scale(-s/a),c,h=t[0];if(!r)switch(i.cap){case"square":{let y=o.scale(-s/a);e.push(h.add(y).add(l)),e.push(h.add(y).sub(l));break}case"round":{let y=Math.max(s,10),v=Math.PI/y,g=l.scale(-1),A=Math.cos(v),B=Math.sin(v);for(let F=0;F<y;F++)e.push(h),e.push(h.sub(g)),g=D(g.x*A-g.y*B,g.x*B+g.y*A)}}for(let y=1;y<t.length;y++){if(h===t[y]||h.eq(t[y]))continue;c=h,h=t[y];let v=h.sub(c),g=v.len(),A=v.normal().scale(-s/g),B=o.cross(v);if(Math.abs(B)/(a*g)<.05){e.push(c.add(l)),e.push(c.sub(l)),o.dot(v)<0&&(e.push(c.sub(l)),e.push(c.add(l))),o=v,a=g,l=A;continue}let F=A.sub(l).cross(v)/B,E=l.add(o.scale(F));e.push(c.add(E)),e.push(c.sub(E)),o=v,a=g,l=A}if(!r)switch(e.push(h.add(l)),e.push(h.sub(l)),i.cap){case"square":{let y=o.scale(s/a);e.push(h.add(y).add(l)),e.push(h.add(y).sub(l));break}case"round":{let y=Math.max(s,10),v=Math.PI/y,g=l.scale(1),A=Math.cos(v),B=Math.sin(v);for(let F=0;F<y;F++)g=D(g.x*A-g.y*B,g.x*B+g.y*A),e.push(h),e.push(h.sub(g))}}if(e.length<4)return;let d=e.map(y=>({pos:n.add(y),uv:D(),color:i.color||ut.WHITE,opacity:i.opacity??1})),u=[],f=0;for(let y=0;y<e.length-2;y+=2)u[f++]=y+1,u[f++]=y,u[f++]=y+2,u[f++]=y+2,u[f++]=y+3,u[f++]=y+1;r&&(u[f++]=e.length-1,u[f++]=e.length-2,u[f++]=0,u[f++]=0,u[f++]=1,u[f++]=e.length-1),Oi(d,u,i.fixed,x.gfx.defTex,i.shader,i.uniform??void 0)}p(Lu,"_drawLinesMiter");function Yo(i){let t=i.pts,e=i.width??1;if(!t)throw new Error('drawLines() requires property "pts".');if(!(t.length<2)){if(t.length>2)switch(i.join){case"bevel":return ju(i);case"round":return Tu(i);case"miter":return Lu(i)}if(i.radius&&t.length>=3){mr(Object.assign({},i,{p1:t[0],p2:t[1]}));for(let s=1;s<t.length-2;s++){let r=t[s],n=t[s+1];mr(Object.assign({},i,{p1:r,p2:n}))}mr(Object.assign({},i,{p1:t[t.length-2],p2:t[t.length-1]}))}else for(let s=0;s<t.length-1;s++)mr(Object.assign({},i,{p1:t[s],p2:t[s+1]})),i.join!=="none"&&Os(Object.assign({},i,{pos:t[s],radius:e/2}))}}p(Yo,"drawLines");function cl(i,t){let e=t.segments??16,s=[];for(let r=0;r<=e;r++)s.push(i(r/e));Yo({pts:s,width:t.width||1,pos:t.pos,color:t.color,opacity:t.opacity})}p(cl,"drawCurve");function Ru(i){cl(t=>Ro(i.pt1,i.pt2,i.pt3,i.pt4,t),i)}p(Ru,"drawBezier");var Ts,ts=(Ts=class{constructor(t,e,s,r={}){S(this,"ctx");S(this,"src",null);S(this,"glTex");S(this,"width");S(this,"height");this.ctx=t;let n=t.gl,o=t.gl.createTexture();if(!o)throw new Error("Failed to create texture");this.glTex=o,t.onDestroy(()=>this.free()),this.width=e,this.height=s;let a={linear:n.LINEAR,nearest:n.NEAREST}[r.filter??t.opts.texFilter??"nearest"],l={repeat:n.REPEAT,clampToEdge:n.CLAMP_TO_EDGE}[r.wrap??"clampToEdge"];this.bind(),e&&s&&n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,s,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,a),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,a),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,l),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,l),this.unbind()}static fromImage(t,e,s={}){let r=new Ts(t,e.width,e.height,s);return r.update(e),r.src=e,r}update(t,e=0,s=0){let r=this.ctx.gl;this.bind(),r.texSubImage2D(r.TEXTURE_2D,0,e,s,r.RGBA,r.UNSIGNED_BYTE,t),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},p(Ts,"Texture"),Ts),Pr,Bo=(Pr=class{constructor(t,e,s,r={}){S(this,"ctx");S(this,"tex");S(this,"glFramebuffer");S(this,"glRenderbuffer");this.ctx=t;let n=t.gl;t.onDestroy(()=>this.free()),this.tex=new ts(t,e,s,r);let o=n.createFramebuffer(),a=n.createRenderbuffer();if(!o||!a)throw new Error("Failed to create framebuffer");this.glFramebuffer=o,this.glRenderbuffer=a,this.bind(),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,e,s),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.tex.glTex,0),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let t=this.ctx.gl,e=new Uint8ClampedArray(this.width*this.height*4);this.bind(),t.readPixels(0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,e),this.unbind();let s=this.width*4,r=new Uint8Array(s);for(let n=0;n<(this.height/2|0);n++){let o=n*s,a=(this.height-n-1)*s;r.set(e.subarray(o,o+s)),e.copyWithin(o,a,a+s),e.set(r,a)}return new ImageData(e,this.width,this.height)}toDataURL(){let t=document.createElement("canvas"),e=t.getContext("2d");if(t.width=this.width,t.height=this.height,!e)throw new Error("Failed to get 2d context");return e.putImageData(this.toImageData(),0,0),t.toDataURL()}clear(){let t=this.ctx.gl;t.clear(t.COLOR_BUFFER_BIT)}draw(t){this.bind(),t(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let t=this.ctx.gl;t.deleteFramebuffer(this.glFramebuffer),t.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},p(Pr,"FrameBuffer"),Pr),Dr,vp=(Dr=class{constructor(t,e,s,r){S(this,"ctx");S(this,"glVBuf");S(this,"glIBuf");S(this,"vqueue",[]);S(this,"iqueue",[]);S(this,"stride");S(this,"maxVertices");S(this,"maxIndices");S(this,"vertexFormat");S(this,"numDraws",0);S(this,"curPrimitive",null);S(this,"curTex",null);S(this,"curShader",null);S(this,"curUniform",{});let n=t.gl;this.vertexFormat=e,this.ctx=t,this.stride=e.reduce((a,l)=>a+l.size,0),this.maxVertices=s,this.maxIndices=r;let o=n.createBuffer();if(!o)throw new Error("Failed to create vertex buffer");this.glVBuf=o,t.pushArrayBuffer(this.glVBuf),n.bufferData(n.ARRAY_BUFFER,s*4,n.DYNAMIC_DRAW),t.popArrayBuffer(),this.glIBuf=n.createBuffer(),t.pushElementArrayBuffer(this.glIBuf),n.bufferData(n.ELEMENT_ARRAY_BUFFER,r*4,n.DYNAMIC_DRAW),t.popElementArrayBuffer()}push(t,e,s,r,n=null,o={}){(t!==this.curPrimitive||n!==this.curTex||r!==this.curShader||!No(this.curUniform,o)||this.vqueue.length+e.length*this.stride>this.maxVertices||this.iqueue.length+s.length>this.maxIndices)&&this.flush();let a=this.vqueue.length/this.stride;for(let l of e)this.vqueue.push(l);for(let l of s)this.iqueue.push(l+a);this.curPrimitive=t,this.curShader=r,this.curTex=n,this.curUniform=o}flush(){var e,s;if(!this.curPrimitive||!this.curShader||this.vqueue.length===0||this.iqueue.length===0)return;let t=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),t.bufferSubData(t.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),(e=this.curTex)==null||e.bind(),t.drawElements(this.curPrimitive,this.iqueue.length,t.UNSIGNED_SHORT,0),(s=this.curTex)==null||s.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let t=this.ctx.gl;t.deleteBuffer(this.glVBuf),t.deleteBuffer(this.glIBuf)}},p(Dr,"BatchRenderer"),Dr);function Qi(i){let t=[],e=p(n=>{t.push(n),i(n)},"push"),s=p(()=>{t.pop(),i(r()??null)},"pop"),r=p(()=>t[t.length-1],"cur");return[e,s,r]}p(Qi,"genStack");function zu(i,t={}){let e=[];function s(k){e.push(k)}p(s,"onDestroy");function r(){e.forEach(w=>w());let k=i.getExtension("WEBGL_lose_context");k&&k.loseContext()}p(r,"destroy");let n=null;function o(k){if(No(k,n))return;n=k;let w=k.reduce((b,M)=>b+M.size,0);k.reduce((b,M,V)=>(i.vertexAttribPointer(V,M.size,i.FLOAT,!1,w*4,b),i.enableVertexAttribArray(V),b+M.size*4),0)}p(o,"setVertexFormat");let[a,l]=Qi(k=>i.bindTexture(i.TEXTURE_2D,k)),[c,h]=Qi(k=>i.bindBuffer(i.ARRAY_BUFFER,k)),[d,u]=Qi(k=>i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,k)),[f,y]=Qi(k=>i.bindFramebuffer(i.FRAMEBUFFER,k)),[v,g]=Qi(k=>i.bindRenderbuffer(i.RENDERBUFFER,k)),[A,B]=Qi(k=>{if(!k)return;let{x:w,y:b,w:M,h:V}=k;i.viewport(w,b,M,V)}),[F,E]=Qi(k=>i.useProgram(k));return A({x:0,y:0,w:i.drawingBufferWidth,h:i.drawingBufferHeight}),{gl:i,opts:t,onDestroy:s,destroy:r,pushTexture2D:a,popTexture2D:l,pushArrayBuffer:c,popArrayBuffer:h,pushElementArrayBuffer:d,popElementArrayBuffer:u,pushFramebuffer:f,popFramebuffer:y,pushRenderbuffer:v,popRenderbuffer:g,pushViewport:A,popViewport:B,pushProgram:F,popProgram:E,setVertexFormat:o}}p(zu,"initGfx");var ta={};function Ea(i,t){t.pos&&(i.pos=i.pos.add(t.pos)),t.scale&&(i.scale=i.scale.scale(D(t.scale))),t.angle&&(i.angle+=t.angle),t.color&&i.ch.length===1&&(i.color=i.color.mult(t.color)),t.opacity!=null&&(i.opacity*=t.opacity)}p(Ea,"applyCharTransform");function Co(i){let t={},e="",s=[],r=String(i),n=p(o=>{s.length>0&&(t[e.length]=s.slice()),e+=o},"emit");for(;r!=="";){if(r[0]==="\\"){if(r.length===1)throw new Error("Styled text error: \\ at end of string");n(r[1]),r=r.slice(2);continue}if(r[0]==="["){let o=/^\[(\/)?(\w+?)\]/.exec(r);if(!o){n(r[0]),r=r.slice(1);continue}let[a,l,c]=o;if(l!==void 0){let h=s.pop();if(h!==c)throw h!==void 0?new Error(`Styled text error: mismatched tags. Expected [/${h}], got [/${c}]`):new Error(`Styled text error: stray end tag [/${c}]`)}else s.push(c);r=r.slice(a.length);continue}n(r[0]),r=r.slice(1)}if(s.length>0)throw new Error(`Styled text error: unclosed tags ${s}`);return{charStyleMap:t,text:e}}p(Co,"compileStyledText");function hs(i){var B,F,E;if(i.text===void 0)throw new Error('formatText() requires property "text".');let t=sl(i.font);if(!i.text||i.text===""||t instanceof He||!t)return{width:0,height:0,chars:[],opt:i,renderedText:""};let{charStyleMap:e,text:s}=Co(i.text+""),r=Qc(s);if(t instanceof _o||typeof t=="string"){let k=t instanceof _o?t.fontface.family:t,w=t instanceof _o?{outline:t.outline,filter:t.filter}:{outline:null,filter:Ca},b=ta[k]??{font:{tex:new ts(x.gfx.ggl,2048,2048,{filter:w.filter}),map:{},size:64},cursor:new j(0),outline:w.outline};ta[k]||(ta[k]=b),t=b.font;for(let M of r)if(!b.font.map[M]){let V=x.fontCacheC2d;if(!V)throw new Error("fontCacheC2d is not defined.");if(!x.fontCacheCanvas)throw new Error("fontCacheCanvas is not defined.");V.clearRect(0,0,x.fontCacheCanvas.width,x.fontCacheCanvas.height),V.font=`${t.size}px ${k}`,V.textBaseline="top",V.textAlign="left",V.fillStyle="#ffffff";let L=V.measureText(M),z=Math.ceil(L.width);if(!z)continue;let O=L.fontBoundingBoxAscent+L.fontBoundingBoxDescent;b.outline&&b.outline.width&&b.outline.color&&(V.lineJoin="round",V.lineWidth=b.outline.width*2,V.strokeStyle=b.outline.color.toHex(),V.strokeText(M,b.outline.width,b.outline.width),z+=b.outline.width*2,O+=b.outline.width*3),V.fillText(M,((B=b.outline)==null?void 0:B.width)??0,((F=b.outline)==null?void 0:F.width)??0);let H=V.getImageData(0,0,z,O);if(b.cursor.x+z>2048&&(b.cursor.x=0,b.cursor.y+=O,b.cursor.y>2048))throw new Error("Font atlas exceeds character limit");t.tex.update(H,b.cursor.x,b.cursor.y),t.map[M]=new Vt(b.cursor.x,b.cursor.y,z,O),b.cursor.x+=z}}let n=i.size||t.size,o=D(i.scale??1).scale(n/t.size),a=i.lineSpacing??0,l=i.letterSpacing??0,c=0,h=0,d=0,u=[],f=[],y=0,v=null,g=0;for(;y<r.length;){let k=r[y];if(k===`
`)d+=n+a,u.push({width:c-l,chars:f}),v=null,g=0,c=0,f=[];else{let w=t.map[k];if(w){let b=w.w*o.x;i.width&&c+b>i.width&&(d+=n+a,v!=null&&(y-=f.length-v,k=r[y],w=t.map[k],b=w.w*o.x,f=f.slice(0,v-1),c=g),v=null,g=0,u.push({width:c-l,chars:f}),c=0,f=[]),f.push({tex:t.tex,width:w.w,height:w.h,quad:new Vt(w.x/t.tex.width,w.y/t.tex.height,w.w/t.tex.width,w.h/t.tex.height),ch:k,pos:new j(c,d),opacity:i.opacity??1,color:i.color??ut.WHITE,scale:D(o),angle:0}),k===" "&&(v=f.length,g=c),c+=b,h=Math.max(h,c),c+=l}}y++}u.push({width:c-l,chars:f}),d+=n,i.width&&(h=i.width);let A=[];for(let k=0;k<u.length;k++){let w=(h-u[k].width)*au(i.align??"left");for(let b of u[k].chars){let M=t.map[b.ch],V=A.length+k;if(b.pos=b.pos.add(w,0).add(M.w*o.x*.5,M.h*o.y*.5),i.transform){let L=typeof i.transform=="function"?i.transform(V,b.ch):i.transform;L&&Ea(b,L)}if(e[V]){let L=e[V];for(let z of L){let O=(E=i.styles)==null?void 0:E[z],H=typeof O=="function"?O(V,b.ch):O;H&&Ea(b,H)}}A.push(b)}}return{width:h,height:d,chars:A,opt:i,renderedText:s}}p(hs,"formatText");function Rr(i){if(i.width===void 0||i.height===void 0)throw new Error('drawUVQuad() requires property "width" and "height".');if(i.width<=0||i.height<=0)return;let t=i.width,e=i.height,s=Ns(i.anchor||Uo).scale(new j(t,e).scale(-.5)),r=i.quad||new Vt(0,0,1,1),n=i.color||xt(255,255,255),o=i.opacity??1,a=i.tex?.1/i.tex.width:0,l=i.tex?.1/i.tex.height:0,c=r.x+a,h=r.y+l,d=r.w-a*2,u=r.h-l*2;Ce(),Dt(i.pos),Ls(i.angle),Lr(i.scale),Dt(s),Oi([{pos:new j(-t/2,e/2),uv:new j(i.flipX?c+d:c,i.flipY?h:h+u),color:n,opacity:o},{pos:new j(-t/2,-e/2),uv:new j(i.flipX?c+d:c,i.flipY?h+u:h),color:n,opacity:o},{pos:new j(t/2,-e/2),uv:new j(i.flipX?c:c+d,i.flipY?h+u:h),color:n,opacity:o},{pos:new j(t/2,e/2),uv:new j(i.flipX?c:c+d,i.flipY?h:h+u),color:n,opacity:o}],[0,1,3,1,2,3],i.fixed,i.tex,i.shader,i.uniform??void 0),fe()}p(Rr,"drawUVQuad");function cs(i){Ce(),Dt(i.opt.pos),Ls(i.opt.angle),Dt(Ns(i.opt.anchor??"topleft").add(1,1).scale(i.width,i.height).scale(-.5)),i.chars.forEach(t=>{Rr({tex:t.tex,width:t.width,height:t.height,pos:t.pos,scale:t.scale,angle:t.angle,color:t.color,opacity:t.opacity,quad:t.quad,anchor:"center",uniform:i.opt.uniform,shader:i.opt.shader,fixed:i.opt.fixed})}),fe()}p(cs,"drawFormattedText");function Me(i){if(i.width===void 0||i.height===void 0)throw new Error('drawRect() requires property "width" and "height".');if(i.width<=0||i.height<=0)return;let t=i.width,e=i.height,s=Ns(i.anchor||Uo).add(1,1).scale(new j(t,e).scale(-.5)),r=[new j(0,0),new j(t,0),new j(t,e),new j(0,e)];if(i.radius){let n=Math.min(t,e)/2,o=Array.isArray(i.radius)?i.radius.map(a=>Math.min(n,a)):new Array(4).fill(Math.min(n,i.radius));r=[new j(o[0],0),...o[1]?ur(new j(t-o[1],o[1]),o[1],o[1],270,360):[D(t,0)],...o[2]?ur(new j(t-o[2],e-o[2]),o[2],o[2],0,90):[D(t,e)],...o[3]?ur(new j(o[3],e-o[3]),o[3],o[3],90,180):[D(0,e)],...o[0]?ur(new j(o[0],o[0]),o[0],o[0],180,270):[]]}Ti(Object.assign({},i,{offset:s,pts:r,...i.gradient?{colors:i.horizontal?[i.gradient[0],i.gradient[1],i.gradient[1],i.gradient[0]]:[i.gradient[0],i.gradient[0],i.gradient[1],i.gradient[1]]}:{}}))}p(Me,"drawRect");function qi(i){ke();let t=x.gfx.width,e=x.gfx.height;x.gfx.width=x.gfx.viewport.width,x.gfx.height=x.gfx.viewport.height,i(),ke(),x.gfx.width=t,x.gfx.height=e}p(qi,"drawUnscaled");function Sa(i,t){qi(()=>{let e=D(8);Ce(),Dt(i);let s=hs({text:t,font:wo,size:16,pos:e,color:xt(255,255,255),fixed:!0}),r=s.width+e.x*2,n=s.height+e.x*2;i.x+r>=te()&&Dt(D(-r,0)),i.y+n>=ie()&&Dt(D(0,-n)),Me({width:r,height:n,color:xt(0,0,0),radius:4,opacity:.8,fixed:!0}),cs(s),fe()})}p(Sa,"drawInspectText");function ul(i){if(!i.p1||!i.p2||!i.p3)throw new Error('drawTriangle() requires properties "p1", "p2" and "p3".');return Ti(Object.assign({},i,{pts:[i.p1,i.p2,i.p3]}))}p(ul,"drawTriangle");function Nu(){if(x.debug.inspect){let i=null;for(let t of x.game.root.get("*",{recursive:!0}))if(t.c("area")&&t.isHovering()){i=t;break}if(x.game.root.drawInspect(),i){let t=[],e=i.inspect();for(let s in e)e[s]?t.push(`${e[s]}`):t.push(`${s}`);Sa(fu($a()),t.join(`
`))}Sa(D(8),`FPS: ${x.debug.fps()}`)}x.debug.paused&&qi(()=>{Ce(),Dt(te(),0),Dt(-8,8);let i=32;Me({width:i,height:i,anchor:"topright",color:xt(0,0,0),opacity:.8,radius:4,fixed:!0});for(let t=1;t<=2;t++)Me({width:4,height:i*.6,anchor:"center",pos:D(-i/3*t,i*.5),color:xt(255,255,255),radius:2,fixed:!0});fe()}),x.debug.timeScale!==1&&qi(()=>{Ce(),Dt(te(),ie()),Dt(-8,-8);let i=8,t=hs({text:x.debug.timeScale.toFixed(1),font:wo,size:16,color:xt(255,255,255),pos:D(-i),anchor:"botright",fixed:!0});Me({width:t.width+i*2+i*4,height:t.height+i*2,anchor:"botright",color:xt(0,0,0),opacity:.8,radius:4,fixed:!0});for(let e=0;e<2;e++){let s=x.debug.timeScale<1;ul({p1:D(-t.width-i*(s?2:3.5),-i),p2:D(-t.width-i*(s?2:3.5),-i-t.height),p3:D(-t.width-i*(s?3.5:2),-i-t.height/2),pos:D(-e*i*1+(s?-i*.5:0),0),color:xt(255,255,255),fixed:!0})}cs(t),fe()}),x.debug.curRecording&&qi(()=>{Ce(),Dt(0,ie()),Dt(24,-24),Os({radius:12,color:xt(255,0,0),opacity:ja(0,1,x.app.time()*4),fixed:!0}),fe()}),x.debug.showLog&&x.game.logs.length>0&&qi(()=>{Ce(),Dt(0,ie()),Dt(8,-8);let i=8,t=[];for(let s of x.game.logs){let r="",n=s.msg instanceof Error?"error":"info";r+=`[time]${s.time.toFixed(2)}[/time]`,r+=" ",r+=`[${n}]${ko(s.msg)}[/${n}]`,t.push(r)}x.game.logs=x.game.logs.filter(s=>x.app.time()-s.time<(x.globalOpt.logTime||4));let e=hs({text:t.join(`
`),font:wo,pos:D(i,-i),anchor:"botleft",size:16,width:te()*.6,lineSpacing:i/2,fixed:!0,styles:{time:{color:xt(127,127,127)},info:{color:xt(255,255,255)},error:{color:xt(255,0,127)}}});Me({width:e.width+i*2,height:e.height+i*2,anchor:"botleft",color:xt(0,0,0),radius:4,opacity:.8,fixed:!0}),cs(e),fe()})}p(Nu,"drawDebug");function ko(i,t=!1){var e="",s;return t&&typeof i=="string"&&(i=JSON.stringify(i)),Array.isArray(i)&&(e=["[",i.map(r=>ko(r,!0)).join(", "),"]"].join(""),i=e),typeof i=="object"&&i.toString===Object.prototype.toString&&(i.constructor!==Object&&(e+=i.constructor.name+" "),e+=["{",(s=Object.getOwnPropertyNames(i).map(r=>`${/^\w+$/.test(r)?r:JSON.stringify(r)}: ${ko(i[r],!0)}`).join(", "))?` ${s} `:"","}"].join(""),i=e),String(i).replaceAll(new RegExp("(?<!\\\\)\\[","g"),"\\[")}p(ko,"prettyDebug");function Ou(){let i=x.game.cam,t=j.fromAngle(Jt(0,360)).scale(i.shake);i.shake=ye(i.shake,0,5*Xt()),i.transform=new _i().translate(fn()).scale(i.scale).rotate(i.angle).translate((i.pos??fn()).scale(-1).add(t)),x.game.root.draw(),ke()}p(Ou,"drawFrame");function Uu(){let i=as();x.game.events.numListeners("loading")>0?x.game.events.trigger("loading",i):qi(()=>{let t=te()/2,e=24,s=D(te()/2,ie()/2).sub(D(t/2,e/2));Me({pos:D(0),width:te(),height:ie(),color:xt(0,0,0)}),Me({pos:s,width:t,height:e,fill:!1,outline:{width:4}}),Me({pos:s,width:t*i,height:e})})}p(Uu,"drawLoadScreen");function ml(i,t,e){let s=x.gfx.ggl.gl;ke(),s.clear(s.STENCIL_BUFFER_BIT),s.enable(s.STENCIL_TEST),s.stencilFunc(s.NEVER,1,255),s.stencilOp(s.REPLACE,s.REPLACE,s.REPLACE),t(),ke(),s.stencilFunc(e,1,255),s.stencilOp(s.KEEP,s.KEEP,s.KEEP),i(),ke(),s.disable(s.STENCIL_TEST)}p(ml,"drawStenciled");function Hu(i,t){let e=x.gfx.ggl.gl;ml(i,t,e.EQUAL)}p(Hu,"drawMasked");function _n(i){if(!i.tex)throw new Error('drawTexture() requires property "tex".');let t=i.quad??new Vt(0,0,1,1),e=i.tex.width*t.w,s=i.tex.height*t.h,r=new j(1);if(i.tiled){let n=Ns(i.anchor||Uo).add(new j(1,1)).scale(.5).scale(i.width||e,i.height||s),o=(i.width||e)/e,a=(i.height||s)/s,l=Math.floor(o),c=Math.floor(a),h=o-l,d=a-c,u=(l+h?1:0)*(c+d?1:0),f=new Array(u*6),y=new Array(u*4),v=0,g=p((A,B,F,E,k)=>{f[v*6+0]=v*4+0,f[v*6+1]=v*4+1,f[v*6+2]=v*4+3,f[v*6+3]=v*4+1,f[v*6+4]=v*4+2,f[v*6+5]=v*4+3,y[v*4+0]={pos:new j(A-n.x,B-n.y),uv:new j(k.x,k.y),color:i.color||ut.WHITE,opacity:i.opacity||1},y[v*4+1]={pos:new j(A+F-n.x,B-n.y),uv:new j(k.x+k.w,k.y),color:i.color||ut.WHITE,opacity:i.opacity||1},y[v*4+2]={pos:new j(A+F-n.x,B+E-n.y),uv:new j(k.x+k.w,k.y+k.h),color:i.color||ut.WHITE,opacity:i.opacity||1},y[v*4+3]={pos:new j(A-n.x,B+E-n.y),uv:new j(k.x,k.y+k.h),color:i.color||ut.WHITE,opacity:i.opacity||1},v++},"addQuad");for(let A=0;A<c;A++){for(let B=0;B<l;B++)g(B*e,A*s,e,s,t);h&&g(l*e,A*s,e*h,s,new Vt(t.x,t.y,t.w*h,t.h))}if(d){for(let A=0;A<l;A++)g(A*e,c*s,e,s*d,new Vt(t.x,t.y,t.w,t.h*d));h&&g(l*e,c*s,e*h,s*d,new Vt(t.x,t.y,t.w*h,t.h*d))}Oi(y,f,i.fixed,i.tex,i.shader,i.uniform??void 0)}else i.width&&i.height?(r.x=i.width/e,r.y=i.height/s):i.width?(r.x=i.width/e,r.y=r.x):i.height&&(r.y=i.height/s,r.x=r.y),Rr(Object.assign({},i,{scale:r.scale(i.scale||new j(1)),tex:i.tex,quad:t,width:e,height:s}))}p(_n,"drawTexture");function Ku(i){if(!i.sprite)throw new Error('drawSprite() requires property "sprite"');let t=an(i.sprite);if(!t||!t.data)return;let e=t.data.frames[i.frame??0];if(!e)throw new Error(`Frame not found: ${i.frame??0}`);_n(Object.assign({},i,{tex:t.data.tex,quad:e.scale(i.quad??new Vt(0,0,1,1))}))}p(Ku,"drawSprite");function Yu(i,t){let e=x.gfx.ggl.gl;ml(i,t,e.NOTEQUAL)}p(Yu,"drawSubtracted");function Pa(i){cs(hs(i))}p(Pa,"drawText");var gp=p((i,t)=>{let e=Ko(t,ka,Ma),s=i.pixelDensity??1,r=i.scale??1,{gl:n}=t,o=ts.fromImage(t,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),a=i.width&&i.height?new Bo(t,i.width*s*r,i.height*s*r):new Bo(t,n.drawingBufferWidth,n.drawingBufferHeight),l=null,c=1;i.background&&(typeof i.background=="string"?l=xt(i.background):(l=xt(...i.background),c=i.background[3]??1),n.clearColor(l.r/255,l.g/255,l.b/255,c??1)),n.enable(n.BLEND),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);let h=new vp(t,tl,np,op),d=ts.fromImage(t,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{lastDrawCalls:0,ggl:t,defShader:e,defTex:o,frameBuffer:a,postShader:null,postShaderUniform:null,renderer:h,transform:new _i,transformStack:[],bgTex:d,bgColor:l,bgAlpha:c,width:i.width??n.drawingBufferWidth/s/r,height:i.height??n.drawingBufferHeight/s/r,viewport:{x:0,y:0,width:n.drawingBufferWidth,height:n.drawingBufferHeight},fixed:!1}},"initAppGfx");function dl(){let i=x.pixelDensity,t=x.gfx.ggl.gl.drawingBufferWidth/i,e=x.gfx.ggl.gl.drawingBufferHeight/i;if(x.globalOpt.letterbox){if(!x.globalOpt.width||!x.globalOpt.height)throw new Error("Letterboxing requires width and height defined.");let s=t/e,r=x.globalOpt.width/x.globalOpt.height;if(s>r){let n=e*r,o=(t-n)/2;x.gfx.viewport={x:o,y:0,width:n,height:e}}else{let n=t/r,o=(e-n)/2;x.gfx.viewport={x:0,y:o,width:t,height:n}}return}if(x.globalOpt.stretch&&(!x.globalOpt.width||!x.globalOpt.height))throw new Error("Stretching requires width and height defined.");x.gfx.viewport={x:0,y:0,width:t,height:e}}p(dl,"updateViewport");function es(i){return i.fixed?!0:i.parent?es(i.parent):!1}p(es,"isFixed");function us(i){return{color:i.color,opacity:i.opacity,anchor:i.anchor,outline:i.outline,shader:i.shader,uniform:i.uniform}}p(us,"getRenderProps");function Gu(i,t={}){return{id:"circle",radius:i,draw(){Os(Object.assign(us(this),{radius:this.radius,fill:t.fill}))},renderArea(){return new Et(new j(this.anchor?0:-this.radius),this.radius*2,this.radius*2)},inspect(){return`radius: ${Math.ceil(this.radius)}`}}}p(Gu,"circle");function pl(...i){return{id:"color",color:xt(...i),inspect(){return`color: ${this.color.toString()}`}}}p(pl,"color");function Wu(i){return{add(){this.canvas=i}}}p(Wu,"drawon");function Ju(i=1){let t,e=0,s=!1;return{require:["opacity"],add(){t=this.opacity,this.opacity=0},update(){s||(e+=Xt(),this.opacity=$e(e,0,i,0,t),e>=i&&(this.opacity=t,s=!0))}}}p(Ju,"fadeIn");function Xu(i="intersect"){return{id:"mask",mask:i}}p(Xu,"mask");function fl(i){return{id:"opacity",opacity:i??1,fadeIn(t=1,e=x.k.easings.linear){return x.game.root.tween(0,this.opacity,t,s=>this.opacity=s,e)},fadeOut(t=1,e=x.k.easings.linear){return x.game.root.tween(this.opacity,0,t,s=>this.opacity=s,e)},inspect(){return`opacity: ${go(this.opacity,1)}`}}}p(fl,"opacity");function Qu(i=1,t=xt(0,0,0),e=1,s="miter",r=10,n="butt"){return{id:"outline",outline:{width:i,color:t,opacity:e,join:s,miterLimit:r,cap:n},inspect(){return`outline: ${this.outline.width}px, ${this.outline.color}`}}}p(Qu,"outline");var Vr,Ap=(Vr=class{constructor(){S(this,"pos",D(0));S(this,"vel",D(0));S(this,"acc",D(0));S(this,"angle",0);S(this,"angularVelocity",0);S(this,"damping",0);S(this,"t");S(this,"lt",null);S(this,"gc");this.t=0,this.gc=!0}get progress(){return this.lt?this.t/this.lt:this.t}},p(Vr,"Particle"),Vr);function Zu(i,t){let e=t.lifetime,s=[],r=i.colors||[ut.WHITE],n=i.opacities||[1],o=i.quads||[new Vt(0,0,1,1)],a=i.scales||[1],l=i.lifeTime,c=t.direction,h=t.spread,d=i.speed||[0,0],u=i.angle||[0,0],f=i.angularVelocity||[0,0],y=i.acceleration||[D(0),D(0)],v=i.damping||[0,0],g=[],A=new Array(i.max),B=0,F=0;for(let w=0;w<i.max;w++){g[w*6+0]=w*4+0,g[w*6+1]=w*4+1,g[w*6+2]=w*4+3,g[w*6+3]=w*4+1,g[w*6+4]=w*4+2,g[w*6+5]=w*4+3;for(let b=0;b<4;b++)A[w*4+b]={pos:new j(0,0),uv:new j(0,0),color:xt(255,255,255),opacity:1};s[w]=new Ap}let E=new Be;function k(w=0){for(;w<i.max;){if(s[w].gc)return w;w++}return null}return p(k,"nextFree"),{id:"particles",emit(w){let b=0;for(let M=0;M<w;M++){if(b=k(b),b==null)return;let V=Jt(c-h,c+h),L=j.fromAngle(V).scale(Jt(d[0],d[1])),z=Jt(u[0],u[1]),O=Jt(f[0],f[1]),H=D(Jt(y[0].x,y[1].x),Jt(y[0].y,y[1].y)),Y=Jt(v[0],v[1]),tt=l?Jt(l[0],l[1]):null,G=t.shape?t.shape.random():D(),Z=s[b];Z.lt=tt,Z.pos=G,Z.vel=L,Z.acc=H,Z.angle=z,Z.angularVelocity=O,Z.damping=Y,Z.angularVelocity=O,Z.gc=!1}B+=w},update(){if(e!==void 0&&e<=0)return;let w=Xt();for(let b of s)if(!b.gc){if(b.t+=w,b.lt&&b.t>=b.lt){b.gc=!0,B--;continue}b.vel=b.vel.add(b.acc.scale(w)).scale(1-b.damping*w),b.pos=b.pos.add(b.vel.scale(w)),b.angle+=b.angularVelocity*w}for(e!==void 0&&(e-=w,e<=0&&E.trigger()),F+=w;B<i.max&&t.rate&&F>t.rate;)this.emit(1),B++,F-=t.rate},draw(){if(!(e!==void 0&&e<=0)){for(let w=0;w<s.length;w++){let b=s[w];if(b.gc)continue;let M=b.progress,V=Math.floor(b.progress*r.length),L=V<r.length-1?ye(r[V],r[V+1],$e(M,V/r.length,(V+1)/r.length,0,1)):r[V],z=Math.floor(b.progress*n.length),O=z<n.length-1?ye(n[z],n[z+1],$e(M,z/n.length,(z+1)/n.length,0,1)):n[z],H=Math.floor(b.progress*o.length),Y=o[H],tt=Math.floor(b.progress*a.length),G=a[tt],Z=Math.cos(b.angle*Math.PI/180),ot=Math.sin(b.angle*Math.PI/180),W=(i.texture?i.texture.width:10)*Y.w/2,ct=(i.texture?i.texture.height:10)*Y.h/2,ft=w*4,X=A[ft];X.pos.x=b.pos.x+-W*G*Z- -ct*G*ot,X.pos.y=b.pos.y+-W*G*ot+-ct*G*Z,X.uv.x=Y.x,X.uv.y=Y.y,X.color.r=L.r,X.color.g=L.g,X.color.b=L.b,X.opacity=O,X=A[ft+1],X.pos.x=b.pos.x+W*G*Z- -ct*G*ot,X.pos.y=b.pos.y+W*G*ot+-ct*G*Z,X.uv.x=Y.x+Y.w,X.uv.y=Y.y,X.color.r=L.r,X.color.g=L.g,X.color.b=L.b,X.opacity=O,X=A[ft+2],X.pos.x=b.pos.x+W*G*Z-ct*G*ot,X.pos.y=b.pos.y+W*G*ot+ct*G*Z,X.uv.x=Y.x+Y.w,X.uv.y=Y.y+Y.h,X.color.r=L.r,X.color.g=L.g,X.color.b=L.b,X.opacity=O,X=A[ft+3],X.pos.x=b.pos.x+-W*G*Z-ct*G*ot,X.pos.y=b.pos.y+-W*G*ot+ct*G*Z,X.uv.x=Y.x,X.uv.y=Y.y+Y.h,X.color.r=L.r,X.color.g=L.g,X.color.b=L.b,X.opacity=O}Oi(A,g,this.fixed,i.texture,this.shader,this.uniform)}},onEnd(w){return E.add(w)},inspect(){return`count: ${B}/${i.max}`}}}p(Zu,"particles");function $u(i,t={}){if(i.length<3)throw new Error(`Polygon's need more than two points, ${i.length} points provided`);return{id:"polygon",pts:i,colors:t.colors,uv:t.uv,tex:t.tex,radius:t.radius,draw(){Ti(Object.assign(us(this),{pts:this.pts,colors:this.colors,uv:this.uv,tex:this.tex,radius:this.radius,fill:t.fill,triangulate:t.triangulate}))},renderArea(){return new _e(this.pts)},inspect(){return`polygon: ${this.pts.map(e=>`[${e.x},${e.y}]`).join(",")}`}}}p($u,"polygon");function yl(i,t,e){let s;return x.game.root.get("area").forEach(r=>{if(e&&e.some(o=>r.is(o)))return;let n=r.worldArea().raycast(i,t);n&&(s?n.fraction<s.fraction&&(s=n,s.object=r):(s=n,s.object=r))}),s}p(yl,"raycast");function _l(i,t,e={}){return{id:"rect",width:i,height:t,radius:e.radius||0,draw(){Me(Object.assign(us(this),{width:this.width,height:this.height,radius:this.radius,fill:e.fill}))},renderArea(){return new Et(D(0),this.width,this.height)},inspect(){return`rect: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)}h)`}}}p(_l,"rect");function tm(i,t){return{id:"shader",shader:i,...typeof t=="function"?{uniform:t(),update(){this.uniform=t()}}:{uniform:t},inspect(){return`shader: ${i}`}}}p(tm,"shader");function em(...i){return i.length>0&&(x.game.cam.pos=D(...i)),x.game.cam.pos?x.game.cam.pos.clone():fn()}p(em,"camPos");function im(...i){return i.length>0&&(x.game.cam.scale=D(...i)),x.game.cam.scale.clone()}p(im,"camScale");function sm(i){return i!==void 0&&(x.game.cam.angle=i),x.game.cam.angle}p(sm,"camRot");function rm(i=xt(255,255,255),t=1){let e=x.game.root.add([_l(te(),ie()),pl(i),fl(1),kl()]),s=e.fadeOut(t);return s.onEnd(()=>xl(e)),s}p(rm,"camFlash");function nm(){return x.game.cam.transform.clone()}p(nm,"camTransform");function om(i=12){x.game.cam.shake+=i}p(om,"shake");function Mo(i){return x.game.cam.transform.multVec2(i)}p(Mo,"toScreen");function vl(i){return x.game.cam.transform.invert().multVec2(i)}p(vl,"toWorld");function am(i,t){if(!t.tileWidth||!t.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let e=x.game.root.add([vn(t.pos??D(0))]),s=i.length,r=0,n=null,o=null,a=null,l=null,c=p(w=>w.x+w.y*r,"tile2Hash"),h=p(w=>D(Math.floor(w%r),Math.floor(w/r)),"hash2Tile"),d=p(()=>{n=[];for(let w of e.children)u(w)},"createSpatialMap"),u=p(w=>{let b=c(w.tilePos);n[b]?n[b].push(w):n[b]=[w]},"insertIntoSpatialMap"),f=p(w=>{let b=c(w.tilePos);if(n[b]){let M=n[b].indexOf(w);M>=0&&n[b].splice(M,1)}},"removeFromSpatialMap"),y=p(()=>{let w=!1;for(let b of e.children){let M=e.pos2Tile(b.pos);(b.tilePos.x!=M.x||b.tilePos.y!=M.y)&&(w=!0,f(b),b.tilePos.x=M.x,b.tilePos.y=M.y,u(b))}w&&e.trigger("spatialMapChanged")},"updateSpatialMap"),v=p(()=>{let w=e.getSpatialMap(),b=e.numRows()*e.numColumns();o?o.length=b:o=new Array(b),o.fill(1,0,b);for(let M=0;M<w.length;M++){let V=w[M];if(V){let L=0;for(let z of V)if(z.isObstacle){L=1/0;break}else L+=z.cost;o[M]=L||1}}},"createCostMap"),g=p(()=>{let w=e.getSpatialMap(),b=e.numRows()*e.numColumns();a?a.length=b:a=new Array(b),a.fill(15,0,b);for(let M=0;M<w.length;M++){let V=w[M];if(V){let L=V.length,z=15;for(let O=0;O<L;O++)z|=V[O].edgeMask;a[M]=z}}},"createEdgeMap"),A=p(()=>{let w=e.numRows()*e.numColumns(),b=p((V,L)=>{let z=[];for(z.push(V);z.length>0;){let O=z.pop();E(O).forEach(H=>{l[H]<0&&(l[H]=L,z.push(H))})}},"traverse");l?l.length=w:l=new Array(w),l.fill(-1,0,w);let M=0;for(let V=0;V<o.length;V++){if(l[V]>=0){M++;continue}b(V,M),M++}},"createConnectivityMap"),B=p((w,b)=>o[b],"getCost"),F=p((w,b)=>{let M=h(w),V=h(b);return M.dist(V)},"getHeuristic"),E=p((w,b)=>{let M=[],V=Math.floor(w%r),L=V>0&&a[w]&1&&o[w-1]!==1/0,z=w>=r&&a[w]&2&&o[w-r]!==1/0,O=V<r-1&&a[w]&4&&o[w+1]!==1/0,H=w<r*s-r-1&&a[w]&8&&o[w+r]!==1/0;return b?(L&&(z&&M.push(w-r-1),M.push(w-1),H&&M.push(w+r-1)),z&&M.push(w-r),O&&(z&&M.push(w-r+1),M.push(w+1),H&&M.push(w+r+1)),H&&M.push(w+r)):(L&&M.push(w-1),z&&M.push(w-r),O&&M.push(w+1),H&&M.push(w+r)),M},"getNeighbours"),k={id:"level",tileWidth(){return t.tileWidth},tileHeight(){return t.tileHeight},spawn(w,...b){let M=D(...b),V=(()=>{if(typeof w=="string"){if(t.tiles[w]){if(typeof t.tiles[w]!="function")throw new Error("Level symbol def must be a function returning a component list");return t.tiles[w](M)}else if(t.wildcardTile)return t.wildcardTile(w,M)}else{if(Array.isArray(w))return w;throw new Error("Expected a symbol or a component list")}})();if(!V)return null;let L=!1,z=!1;for(let H of V)H.id==="tile"&&(z=!0),H.id==="pos"&&(L=!0);L||V.push(vn(this.tile2Pos(M))),z||V.push(wl());let O=e.add(V);return L&&(O.tilePosOffset=O.pos.clone()),O.tilePos=M,O.transform=pr(O),n&&(u(O),this.trigger("spatialMapChanged"),this.trigger("navigationMapInvalid")),O},numColumns(){return r},numRows(){return s},levelWidth(){return r*this.tileWidth()},levelHeight(){return s*this.tileHeight()},tile2Pos(...w){return D(...w).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...w){let b=D(...w);return D(Math.floor(b.x/this.tileWidth()),Math.floor(b.y/this.tileHeight()))},getSpatialMap(){return n||d(),n},onSpatialMapChanged(w){return this.on("spatialMapChanged",w)},onNavigationMapInvalid(w){return this.on("navigationMapInvalid",w)},getAt(w){n||d();let b=c(w);return n[b]||[]},raycast(w,b){let M=this.toWorld(w),V=this.toWorld(w.add(b)).sub(M),L=1/this.tileWidth(),z=w.scale(L),O=xc(z,b,H=>{let Y=this.getAt(H);if(Y.some(G=>G.isObstacle))return!0;let tt=null;for(let G of Y)if(G.is("area")){let Z=G.worldArea().raycast(M,V);Z&&(tt?Z.fraction<tt.fraction&&(tt=Z,tt.object=G):(tt=Z,tt.object=G))}return tt&&(tt.point=this.fromWorld(tt.point).scale(L)),tt||!1},64);return O&&(O.point=O.point.scale(this.tileWidth())),O},update(){n&&y()},invalidateNavigationMap(){o=null,a=null,l=null},onNavigationMapChanged(w){return this.on("navigationMapChanged",w)},getTilePath(w,b,M={}){var Z;if(o||v(),a||g(),l||A(),w.x<0||w.x>=r||w.y<0||w.y>=s||b.x<0||b.x>=r||b.y<0||b.y>=s)return null;let V=c(w),L=c(b);if(o[L]===1/0)return null;if(V===L)return[];if(l[V]!=-1&&l[V]!==l[L])return null;let z=new Kc((ot,W)=>ot.cost<W.cost);z.insert({cost:0,node:V});let O=new Map;O.set(V,V);let H=new Map;for(H.set(V,0);z.length!==0;){let ot=(Z=z.remove())==null?void 0:Z.node;if(ot===L)break;let W=E(ot,M.allowDiagonals);for(let ct of W){let ft=(H.get(ot)||0)+B(ot,ct)+F(ct,L);(!H.has(ct)||ft<H.get(ct))&&(H.set(ct,ft),z.insert({cost:ft,node:ct}),O.set(ct,ot))}}let Y=[],tt=L,G=h(tt);for(Y.push(G);tt!==V;){let ot=O.get(tt);if(ot===void 0)throw new Error("Bug in pathfinding algorithm");tt=ot;let W=h(tt);Y.push(W)}return Y.reverse()},getPath(w,b,M={}){let V=this.tileWidth(),L=this.tileHeight(),z=this.getTilePath(this.pos2Tile(w),this.pos2Tile(b),M);return z?[w,...z.slice(1,-1).map(O=>O.scale(V,L).add(V/2,L/2)),b]:null}};return e.use(k),e.onNavigationMapInvalid(()=>{e.invalidateNavigationMap(),e.trigger("navigationMapChanged")}),i.forEach((w,b)=>{let M=w.split("");r=Math.max(M.length,r),M.forEach((V,L)=>{e.spawn(V,D(L,b))})}),e}p(am,"addLevel");function Ai(i,t,e){return x.game.objEvents.registers[i]||(x.game.objEvents.registers[i]=new Xc),x.game.objEvents.on(i,(s,...r)=>{s.is(t)&&e(s,...r)})}p(Ai,"on");var xp=Ot(i=>{let t=x.game.root.add([{fixedUpdate:i}]);return{get paused(){return t.paused},set paused(e){t.paused=e},cancel:p(()=>t.destroy(),"cancel")}},(i,t)=>Ai("fixedUpdate",i,t)),wp=Ot(i=>{let t=x.game.root.add([{update:i}]);return{get paused(){return t.paused},set paused(e){t.paused=e},cancel:p(()=>t.destroy(),"cancel")}},(i,t)=>Ai("update",i,t)),bp=Ot(i=>{let t=x.game.root.add([{draw:i}]);return{get paused(){return t.hidden},set paused(e){t.hidden=e},cancel:p(()=>t.destroy(),"cancel")}},(i,t)=>Ai("draw",i,t)),lm=Ot(i=>x.game.events.on("add",i),(i,t)=>Ai("add",i,t)),Bp=Ot(i=>x.game.events.on("destroy",i),(i,t)=>Ai("destroy",i,t));function hm(i,t,e){return Ai("collide",i,(s,r,n)=>r.is(t)&&e(s,r,n))}p(hm,"onCollide");function cm(i,t,e){return Ai("collideUpdate",i,(s,r,n)=>r.is(t)&&e(s,r,n))}p(cm,"onCollideUpdate");function um(i,t,e){return Ai("collideEnd",i,(s,r,n)=>r.is(t)&&e(s,r,n))}p(um,"onCollideEnd");function Sn(i,t){x.game.root.get(i,{recursive:!0}).forEach(t),lm(i,t)}p(Sn,"forAllCurrentAndFuture");var Cp=Ot(i=>x.app.onMousePress(i),(i,t)=>{let e=[];return Sn(i,s=>{if(!s.area)throw new Error("onClick() requires the object to have area() component");e.push(s.onClick(()=>t(s)))}),zs.join(e)});function mm(i,t){let e=[];return Sn(i,s=>{if(!s.area)throw new Error("onHover() requires the object to have area() component");e.push(s.onHover(()=>t(s)))}),zs.join(e)}p(mm,"onHover");function dm(i,t){let e=[];return Sn(i,s=>{if(!s.area)throw new Error("onHoverUpdate() requires the object to have area() component");e.push(s.onHoverUpdate(()=>t(s)))}),zs.join(e)}p(dm,"onHoverUpdate");function pm(i,t){let e=[];return Sn(i,s=>{if(!s.area)throw new Error("onHoverEnd() requires the object to have area() component");e.push(s.onHoverEnd(()=>t(s)))}),zs.join(e)}p(pm,"onHoverEnd");function fm(i){x.game.events.on("loading",i)}p(fm,"onLoading");function ym(i){x.app.onResize(i)}p(ym,"onResize");function _m(i){x.game.events.on("error",i)}p(_m,"onError");function Go(i){x.assets.loaded?i():x.game.events.on("load",i)}p(Go,"onLoad");function Wo(i=[]){let t=new Map,e=[],s={},r=new dn,n=[],o=null,a=!1,l={id:Td(),hidden:!1,transform:new _i,children:[],parent:null,set paused(h){if(h!==a){a=h;for(let d of n)d.paused=h}},get paused(){return a},get tags(){let h=[];for(let[d,u]of t.entries())Object.keys(u).length==1&&h.push(d);return h},add(h){let d=Array.isArray(h)?Wo(h):h;if(d.parent)throw new Error("Cannot add a game obj that already has a parent.");return d.parent=this,d.transform=pr(d),this.children.push(d),d.trigger("add",d),x.game.events.trigger("add",d),d},readd(h){let d=this.children.indexOf(h);return d!==-1&&(this.children.splice(d,1),this.children.push(h)),h},remove(h){let d=this.children.indexOf(h);if(d!==-1){h.parent=null,this.children.splice(d,1);let u=p(f=>{f.trigger("destroy"),x.game.events.trigger("destroy",f),f.children.forEach(y=>u(y))},"trigger");u(h)}},removeAll(h){if(h)this.get(h).forEach(d=>this.remove(d));else for(let d of[...this.children])this.remove(d)},fixedUpdate(){this.paused||(this.children.forEach(h=>h.fixedUpdate()),this.trigger("fixedUpdate"))},update(){this.paused||(this.children.forEach(h=>h.update()),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&(ke(),this.canvas.bind());let h=x.gfx.fixed;this.fixed&&(x.gfx.fixed=!0),Ce(),Dt(this.pos),Lr(this.scale),Ls(this.angle);let d=this.children.sort((u,f)=>{let y=u.layerIndex??x.game.defaultLayerIndex,v=f.layerIndex??x.game.defaultLayerIndex;return y-v||(u.z??0)-(f.z??0)});if(this.mask){let u={intersect:x.k.drawMasked,subtract:x.k.drawSubtracted}[this.mask];if(!u)throw new Error(`Invalid mask func: "${this.mask}"`);u(()=>{d.forEach(f=>f.draw())},()=>{this.trigger("draw")})}else this.trigger("draw"),d.forEach(u=>u.draw());fe(),x.gfx.fixed=h,this.canvas&&(ke(),this.canvas.unbind())},drawInspect(){this.hidden||(Ce(),Dt(this.pos),Lr(this.scale),Ls(this.angle),this.children.forEach(h=>h.drawInspect()),this.trigger("drawInspect"),fe())},use(h){if(!h)return;if(typeof h=="string")return this.use({id:h});let d=[];h.id?(this.unuse(h.id),s[h.id]=[],d=s[h.id],t.set(h.id,h)):e.push(h);for(let f in h){if(hp.has(f))continue;let y=Object.getOwnPropertyDescriptor(h,f);if(y)if(typeof y.value=="function"&&(h[f]=h[f].bind(this)),y.set&&Object.defineProperty(h,f,{set:y.set.bind(this)}),y.get&&Object.defineProperty(h,f,{get:y.get.bind(this)}),cp.has(f)){let v=f==="add"?()=>{var g;o=p(A=>d.push(A),"onCurCompCleanup"),(g=h[f])==null||g.call(h),o=null}:h[f];d.push(this.on(f,v).cancel)}else if(this[f]===void 0)Object.defineProperty(this,f,{get:p(()=>h[f],"get"),set:p(v=>h[f]=v,"set"),configurable:!0,enumerable:!0}),d.push(()=>delete this[f]);else throw new Error(`Duplicate component property: "${f}"`)}let u=p(()=>{if(h.require){for(let f of h.require)if(!this.c(f))throw new Error(`Component "${h.id}" requires component "${f}"`)}},"checkDeps");h.destroy&&d.push(h.destroy.bind(this)),this.exists()?(u(),h.add&&(o=p(f=>d.push(f),"onCurCompCleanup"),h.add.call(this),o=null)):h.require&&d.push(this.on("add",u).cancel)},unuse(h){if(t.has(h)){for(let d of t.values())if(d.require&&d.require.includes(h))throw new Error(`Can't unuse. Component "${d.id}" requires component "${h}"`);t.delete(h)}s[h]&&(s[h].forEach(d=>d()),delete s[h])},c(h){return t.get(h)??null},get(h,d={}){let u=d.recursive?this.children.flatMap(p(function f(y){return[y,...y.children.flatMap(f)]},"recurse")):this.children;if(u=u.filter(f=>h?f.is(h):!0),d.liveUpdate){let f=p(v=>d.recursive?this.isAncestorOf(v):v.parent===this,"isChild"),y=[];y.push(x.k.onAdd(v=>{f(v)&&v.is(h)&&u.push(v)})),y.push(x.k.onDestroy(v=>{if(f(v)&&v.is(h)){let g=u.findIndex(A=>A.id===v.id);g!==-1&&u.splice(g,1)}})),this.onDestroy(()=>{for(let v of y)v.cancel()})}return u},query(h){let d=h.hierarchy||"children",u=h.include,f=h.exclude,y=[];switch(d){case"children":y=this.children;break;case"siblings":y=this.parent?this.parent.children.filter(g=>g!==this):[];break;case"ancestors":let v=this.parent;for(;v;)y.push(v),v=v.parent;break;case"descendants":y=this.children.flatMap(p(function g(A){return[A,...A.children.flatMap(g)]},"recurse"));break}if(u&&((h.includeOp||"and")==="and"||!Array.isArray(h.include)?y=y.filter(v=>v.is(u)):y=y.filter(v=>h.include.some(g=>v.is(g)))),f&&((h.includeOp||"and")==="and"||!Array.isArray(h.include)?y=y.filter(v=>!v.is(f)):y=y.filter(v=>!h.exclude.some(g=>v.is(g)))),h.visible===!0&&(y=y.filter(v=>v.visible)),h.distance){if(!this.pos)throw Error("Can't do a distance query from an object without pos");let v=h.distanceOp||"near",g=h.distance*h.distance;v==="near"?y=y.filter(A=>A.pos&&this.pos.sdist(A.pos)<=g):y=y.filter(A=>A.pos&&this.pos.sdist(A.pos)>g)}return h.name&&(y=y.filter(v=>v.name===h.name)),y},isAncestorOf(h){return h.parent?h.parent===this||this.isAncestorOf(h.parent):!1},exists(){return x.game.root.isAncestorOf(this)},is(h){if(h==="*")return!0;if(Array.isArray(h)){for(let d of h)if(!this.c(d))return!1;return!0}else return this.c(h)!=null},on(h,d){let u=r.on(h,d.bind(this));return o&&o(()=>u.cancel()),u},trigger(h,...d){r.trigger(h,...d),x.game.objEvents.trigger(h,this,...d)},destroy(){this.parent&&this.parent.remove(this)},inspect(){var d;let h={};for(let[u,f]of t)h[u]=((d=f.inspect)==null?void 0:d.call(f))??null;for(let[u,f]of e.entries()){if(f.inspect){h[u]=f.inspect();continue}for(let[y,v]of Object.entries(f))typeof v!="function"&&(h[y]=`${y}: ${v}`)}return h},onAdd(h){return this.on("add",h)},onFixedUpdate(h){return this.on("fixedUpdate",h)},onUpdate(h){return this.on("update",h)},onDraw(h){return this.on("draw",h)},onDestroy(h){return this.on("destroy",h)},clearEvents(){r.clear()}},c=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick","onButtonPress","onButtonDown","onButtonRelease"];for(let h of c)l[h]=(...d)=>{var f,y;let u=(y=(f=x.app)[h])==null?void 0:y.call(f,...d);return n.push(u),l.onDestroy(()=>u.cancel()),l.on("sceneEnter",()=>{var g,A;n.splice(n.indexOf(u),1);let v=(A=(g=x.app)[h])==null?void 0:A.call(g,...d);zs.replace(u,v),n.push(u)}),u};for(let h of i)l.use(h);return l}p(Wo,"make");var kp=p(()=>({events:new dn,objEvents:new dn,root:Wo([]),gravity:null,scenes:{},currentScene:null,layers:null,defaultLayerIndex:0,logs:[],cam:{pos:null,scale:new j(1),angle:0,shake:0,transform:new _i}}),"initGame");function vm(i){x.game.gravity=i?(x.game.gravity||D(0,1)).unit().scale(i):null}p(vm,"setGravity");function gm(){return x.game.gravity?x.game.gravity.len():0}p(gm,"getGravity");function Am(i){x.game.gravity=i.unit().scale(x.game.gravity?x.game.gravity.len():1)}p(Am,"setGravityDirection");function ln(){return x.game.gravity?x.game.gravity.unit():D(0,1)}p(ln,"getGravityDirection");var Mp=kd("//uUBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAATAAAeAAANDQ0NDRoaGhoaKCgoKCg1NTU1NTVDQ0NDQ1BQUFBQXl5eXl5ra2tra2t5eXl5eYaGhoaGlJSUlJShoaGhoaGvr6+vr7y8vLy8ysrKysrX19fX19fl5eXl5fLy8vLy//////8AAAA5TEFNRTMuMTAwAaoAAAAAAAAAABSAJAOPhgAAgAAAHgBaqIlmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uUBAAP8h1kPIABR4BEDGeQAEbkSb2RAACBFMEyMiAAASJw4xjgwAGyRvfIoZT2QKGV5YNw/tKID9+X93qXtBQUFBQ/e+EFKTQUT/dy3f5dK/3d04rkXHpufCClDAaH7jDMgFAQEGfPt+jI352U9vU4GLRpzkUDeeeTQggQe2ggF3d7/3j697DnhCH5iGf38//iNj9oy2Jk71oj+CBAABGNB4RJNMwgCABCB//8//l////1z6XEGd73az07sOkwZD9VYgjzjmQ6j4EMfZM86OJ7GUWwvFw3ZPcdVEtczf9RNf6xMyxLjZZgjMQ7KDkLSU8g2E12UDUWrf//////9LdtFdeeqKwSitW9SJL59VM5pyUGiBNiK0jIGO0j7p3pUpWpaeqi1nTvqP3b43mGmM6HeXFjIlRwiFiIDQRRAGgkDQhxMMv//+f1//6XM/PfMvysJa3993MjDjhaRkrV3cRPXjGptDDGTHtFKUeMHU0K5STvVfMtVX/UXHctt1Z1//uUBB0AgnZkQAAgRTBMzIgAACiqCdB9E1QRgAFuIuGmhjABPZRJRCHi4etY2gcEYRwFw5KFBMMRV/////z6kX2ppnJszEzKbkZKEumm+pBRUDBg9IsgXGXrazn1QhmGjBrLVjT5Xvir0HT7d//HSZh18IZdji2N5JZgbA3DwQAahogSDqUhQuNtpJmBTwAGMY2QP3c/dy4EKsAABoXEJEFmlf/c4TgYtwcAbwfD4gOOoS1QIH7jDnNzYVe1x4mNFyD2jMVaaykjV29ePMARwXcUOgAFr+UjhVz4jhwMDFxPKgYs3cDFpohVgAAYAIO7u8eAAjRNA7hBFAwN3ACDvu7nETkLMrnyIj8v/9fNwhF9vKRfm82P5zPPmLV/WKs9G3d16n/v3rubEN0zgs7RdWrHne9brdv5bI4EwEAM6lj7aVdTKtXQHgLdzCKQ2kcihe4FyMcD1r3nR4TWxuax5EOZJEs3DEQnjyqyB8cSfrI6GEcoJxiHBDEfrTOFYrO1//uUBCgAA406ym5hgAB1R1ktzDwACxDBZzj0gAFhGrA3HoACypAXH9HY4umZan4ZlZKldajczMzMzOTnzMvnb77f/1IuSzHIbnJLJdapWmwUAQBXqWPtqV1OyqVqXhB9abR90OyKEsM51pIJK/nXplbDPtKz2dH+oVWeZSm8z7nvAZ19bneqhk3qeBhrhZiLbCc8sRnXb520RnPFd61/AgSR4f8CVlfWpD/////+N6/jv8v4f/6Ln///06c8YYcQIaGmAJ9VhMHEZYc9Kn0TOOYKv2cibDoZieAaGy4Cd6AfGkxQQr+agomAw+dC7AkjOxklIZEpUgmHxXP7/znl/4qT9Z/8+T2a0WF9/lvpv39if/KZnV6Gp1vQRmN1rYDAADfLGQxVR2d49LQLXdImm5n40smwjQ4aIYKMeKCOEw0OBV5cHA8cFV8mB5LyIIeksHspy79/iTv9SH+v66f2Wn/i+Lt//x9y//5MohgAAXiTCVBil4RUZ7XUvPRCD9Uc//uUBAoAAro3Wzc9AABXRutm56AACrUhc6eYT0FWpC508wnoO35hs9j6x7PQOB0PF0JWIkYwigNPoXUBA0cKA6JwDB7lRKDm/93r/mb6iEqL5lv3Vq//6YgYd1AgECi4xACCYbHyukYAAF4kwlQYpeEVGe11Lz0Qg/VHDt+YbPY+sez0DgdDxdCViJGMIoDT6F1AQNHCgOicAwe5USg5v/d6/5m+ohKi+Zb91av/+mIGHdQIBAouMQAgmGx8rptmoLKSACTuBBUPFsH6RlCz+UhoKeVfJy/eqOspBG4PScFOnOxYJJcf/nVzmyfR42Zwxy//hfSUrPq1SzFnO7q/SzNUzst+GQpnZ/kLwzVZ9xJ2lVa02zUFlJABJ3AgqHi2D9IyhZ/KQ0FPKvk5fvVHWUgjcHpOCnTnYsEkuP/zq5zZPo8bM4Y5f/wvpKVn1apZiznd1fpZmqZ2W/DIUzs/yF4Zqs+4k7SqtaYkWgEGMgppYQlMVdKcos2bWFZbFIJp//uUBAsAAr0wWe1hAABXpgs9rCAACwS5azj0gAFgly1nHpAAVgWmZa3LaUWCcGh5HgOEYkViyQUjrX+G5FUr5Dla1ZhtXDf7ckpazXwzeusqq+zXwUePSw8NYzlZKWfbyzod4dCRItAIMZBTSwhKYq6U5RZs2sKy2KQTSrAtMy1uW0osE4NDyPAcIxIrFkgpHWv8NyKpXyHK1qzDauG/25JS1mvhm9dZVV9mvgo8elh4axnKyUs+3lnQ7w6EkIEIIZFKlBSAGwRMrEIEuM658s5gvyVtFDrQtgTY2YSPlAJcgwlXLmokM8sUQJYJOm3eaW04jWVsoghX+ZBt3SHFZOypVez//VONpL+du6U+4WLXBC79cuhAhBDIpUoKQA2CJlYhAlxnXPlnMF+StoodaFsCbGzCR8oBLkGEq5c1EhnliiBLBJ027zS2nEaytlEEK/zINu6Q4rJ2VKr2f/6pxtJfzt3Sn3Cxa4IXfrl6IGEh4icUSUDRZk/k88VFEmCy//uUBAkAAociWgZh4ABQ5EtAzDwAC6zBXBmXgAF1mCuDMvAART7WmhWQ9QwYJexoKJ+z1bcQqfEFmtDtXH8lUg2omFi2b/4+UhW/j+bHgwAM8SqMAQFxYj9wqAwhlftf//sSQMJDxE4okoGizJ/J54qKJMFkin2tNCsh6hgwS9jQUT9nq24hU+ILNaHauP5KpBtRMLFs3/x8pCt/H82PBgAZ4lUYAgLixH7hUBhDK/a///YmHznKbibgJd0lEi0TfuHXCfhZ0faHA6GL3GuUpLTgTwnd/upcFAbo+BGMfzKxWE9PNg+sbrEwwRLn6uFElWTc/zN8Yvf5V3xV29///8OO/f7j3cT0mgMTPP9uPEwIQ+c5TcTcBLukokWib9w64T8LOj7Q4HQxe41ylJacCeE7v91LgoDdHwIxj+ZWKwnp5sH1jdYmGCJc/Vwokqybn+ZvjF7/Ku+Ku3v///hx37/ce7iek0BiZ5/tx4mBCmI5QXQAgigG+j0P8fdg2Xjs//uUBAiAAqwlWwY94ABVhKtgx7wACoilZ7z0AAFUlOz3noAAii2PkO1AMBYBIssJqQ5PtEdSQ2WE3xIF22b19axY89F5QQmWCwxJrf51h5mt74jRvBahCxQkS0MgJxY15ITjX3sb+vlGI5QXQAgigG+j0P8fdg2Xjsii2PkO1AMBYBIssJqQ5PtEdSQ2WE3xIF22b19axY89F5QQmWCwxJrf51h5mt74jRvBahCxQkS0MgJxY15ITjX3sb+vlEBsAgCSkHfwmFY/MMKQyg4tjhHeuR2mpSZWstSwEQAw00wZaogwgZL3PPVWw9vuB51zUXf3Df/ytV917DjxQEGA+0mbu4YYg4TnkRcMGQsxH/Ioc1AbAIAkpB38JhWPzDCkMoOLY4R3rkdpqUmVrLUsBEAMNNMGWqIMIGS9zz1VsPb7gedc1F39w3/8rVfdew48UQIFwus29HKDIAW8tcsSGAOKXK/jHmF1AkIAAC8ZUaEFwTHUylbannoarv7HwxH8//uUBAwEAtAx18sMQuBVJisaYSJeCmhnX6eZLQFZJy208wmidE7zXIRk0ZLYCqc1eg1sKc3HZuweFNeSCHHGg+JyhTcd8RE3/+rJXIdH6UpI2qUdVtHGRCOewEOXGUfKG2/v+RIoA0MAAAByh2gABL0EpLTwNTz0qzjM2ER8SF2lsSRLESGiqG5JXMCauo+aTB1GQKTyJd6SDnG6Iv8rkaoYeRihQbVGzJSSQ4sOghQh7vhkf+T0agMeCYAcAABBO40gsg/gOpfIiHoQgldEIGLVK9EaTFmFH9jkkvLA41VT/4q0XDJLUopJkJmWHAqZyRAPJOvBUS+NYSLC4FFjoJkUfGP/La3XNJCMJPep5CkIaRQCSTuM4ikUepPHAnZLEErtHuqs1EWDizBAvsdVeWBxqqn9aiS9FK24Z0KUhvVkY7ZbylKV/SrKiK0yrKqFkPe3/sZ//8xt6t2dajIDpFMRf6tSU9FIlJJKChTJIgq2hhZlrTlNcpaB/Xv5rDOU//uUBA2AAoQl1lVgwARQxLrKrBgAjCyVTrmngAGFkqnXNPAAg4ANdH9PKxIijn/xmvyjW2ZISnLe5yUtyv2ufSTfVJUGyoFiU6s6Crgyd2PEyn5Ul/85kUElPRSJSSSgoUySIKtoYWZa05TXKWgf17+awzlIOADXR/TxLEiKOf/GZ/KNbZkhKct7nJS3K/a59JN9UlQbKgWJTqzoKuDJ3Y8TKflSX/zmRQSCs10kCQCFAcBJCZCbl2c0bF5RBELfoQBmp3G2m3m3lgZoN0/BmhutukeGPbe/GtGj9jtiXNZdfDjIwYiYvnePS27ebO75y/Edksl4SONB/PlBrg6dNh8h+pW2//lktFhYcFZrpIEgEKA4CSEyE3Ls5o2LyiCIW/QgDNTuNtNvNvLAzQbp+DNDdbdI8Me29+NaNH7HbEuay6+HGRgxExfO8elt282d3zl+I7JZLwkcaD+fKDXB06bD5D9Stt//LJaLCw4AhAEAACKEywIJz0PRwTBn6tS2//uUBAmAAmUjVNdhAABMpGqa7CAACWiNUay8pYEtEao1l5SwsvqET9LUv/TIpAROYdsSHIoHxzccjRUPRZmVQnHLH7FYdB9rF8Q11yOCAKeHZHyIhMO///lWz0JPcAQgCAABFCZYEE56Ho4Jgz9WpbWX1CJ+lqX/pkUgInMO2JDkUD45uORoqHoszKoTjlj9isOg+1i+Ia65HBAFPDsj5EQmHf//yrZ6EnuACgcjEAKT2Dfl0wUuCCDwOHgDLjMYs6OLViO840e/fHfBZmadNu+NYYNVT84fPkYRCJ/K5V3vsq0Gh0H0YgBP+moubbodw+IHr/kgAoHIxACk9g35dMFLggg8Dh4Ay4zGLOji1YjvONHv3x3wWZmnTbvjWGDVU/OHz5GEQifyuVd77KtBodB9GIAT/pqLm26HcPiB6/5KAE6OeESRRgDMViF4jCI2bT5fbThs6iKGQfPTVaYtXdjMROEbiIqKlZk1KJAzpcWEnNs6FapfKXq1jerLEhaS//uUBB+BAmUqVWsMKrhMpUqtYYVXCTSlTzWSgAE0lKp2sFAAqcgRPyRHxKsBPAQVtIgCdHPCJIowBmKxC8RhEbNp8vtpw2dRFDIPnpqtMWruxmInCNxEVFSsyalEgZ0uLCTm2dCtUvlL1axvVliQtJVOQIn5Ij4lWAngIK2kQCHQhVnhkMD1BlLGveBt13z8bjbsI+MtfqdjdaAQiJFeBGV0AQFB2Qr8QDBc8iiATM25R8+fqp/Izn9CHGC7CEg5BTqd6jM4IBoADCiIYSTWAeAwKIoGBRr+EfZ3bjcbhhdDLX6nY3WgEIiRXgRloICoOyFfiA4+RRAJmbco+fP1U/kZz+hDjBdhCQcgp1O9QZnAQAbiCQAm485bonLdZ5NLqAAAEaPfiGAJsDpfUrAhC8wIZFkkEsiX6UBGvscp3FQfN5VNjWCnQ6AGqvk/UqZBbG3rpCt0gR7qtiNBxOfSeTupa6fMjXaMuYTclIn9ZIVayP2pYMiVUajtVYufukCu//uUBDWABAw9Uu5p4AKDx9qdzLwAiiyjShmngAFFlGlDNPAAm9bW7Vct6q61jNa/e6f/0cL33T31CoACacjUkabckdbjkoAAQ2Pe5fJoCshU+EXmCMRGkCbpN6UCNfKFHfcVB8kSOgSgDsuTAAtXyfqVMgtjb10hW6QI91XCQyZP85jl1K90+ZGuz5Ewl0gGT+skKsGAr0weA/JVRqO1Vi5+6QK6b1tbtFct6q61jNa+26fG/RwvfdPeIpm6BswQctcoCeIAYEYf1mWXRGbxQSwlUiCoY91ytUSo4mqDAgHrhQ3Y/4l2ptfeDG/xHfQXlda18S59aW+rZz8/Gtf7vXU0aFeJUKxkREA+tA5tnJGCDlrlATxADAjD+syy6IzeKCWEqkQVDHuuVqiVHE1QYEA9cKG7H/Eu1Nr7wY3+I76C8rrWviXPrS31bOfn41r/d66mjQrxKhWMiIgH1oHNs5Iw4nNwugqcGVUIoOnFryq5YBVMFyLPEAM4rxNXgSVW//uUBA+AAtkszwZtgABapZngzbAACxyZTzmkgAljkynnNJABzA8PYTFvx2VIR78NqPytscLolrRXGbLUv3rfHNp37BGU77n4xv9NNmu7larWfrk294JgJMNJQ9k6Z//3mHE5uF0FTgyqhFB04teVXLAKpguRZ4gBnFeJq8CSq2YHh7CYt+OypCPfhtR+VtjhdEtaK4zZal+9b45tO/YIynfc/GN/pps13crVaz9cm3vBMBJhpKLJ0z//vAA/m9Y8//8wALImAAl3wUQQSnfKuPXkDS5Ql5I8JfOufQG0twDlAxToCFKYarEoVqWFNJ6nNVd9fnX5/O72D/GEfeJf1TBIwjlyh7XHDg+dW/e///9oGG0YAH83rHn//mABZEwAEu+CiCCU75Vx68gaXKEvJHhL51z6A2luAcoGKdAQpTDVYlCtSwppPU5qrvr86/P53ewf4wj7xL+qYJGEcuUPa44cHzq373///tAw2joy5iMKijE5A82dFg4+liKoGBQF//uUBAmAAqobToZt4ABVI2nQzbwAClBrX7j0gBFKDWv3HpACuAcKpXhYKYZtV8OtethxIYxrF3onBiRVg0Z5VNJHjodV8sWdI031RiPzue4vQ9IA5zgUawg6s0J1ixM4H0rkVfR6DLmIwqKMTkDzZ0WDj6WIqgYFAW4BwqleFgphm1Xw6162HEhjGsXeicGJFWDRnlU2I8dDqvlizpGm+qMR+dz3F6HpAHOcCjWEHVmhOsWJnA+lcir6PQCI3I43G43HIxGIwIABFJObxBmwXEYYlhzHKcYl4ccyEKlyI6ONNnSpVx1pORjqKXEvGgpRqN/VI1tIQnEAogesbyZtJhhEj7rQutav+WB4ClRCCI3I43G43HIxGIwIABFJObxBmwXEYYlhzHKcYl4ccyEKlyI6ONNnSpVx1pORjqKXEvGgpRqN/VI1tIQnEAogesbyZtJhhEj7rQutav+WB4ClRDWAElxIBP/fgA5BRsQaBJEcORBgUrqXzDOmyQ7B8Js0//uUBA+AAnIbz+9swABNA3nq7ZgACYxbKSxpgQEzi6UljTAh0ph0igLRRPKosl/+21oMFkUfTMlPbu5vLWMhsIpBoJlEBWacSYwqxs0adkSycpqwAugFfb4AMMU0BUCAJUc6VBAkwaXzDlPhDsnkNmmlMVAKAOiieBJHkv/22tBkzUfXZJ+37zy1jILgmkGjpRAVmnCVjCrGzRozkSydWoAAhAKsACEHAmDZAyOJvjXlQsCbLAhfALBGnDuUyMsKxSWoyN41Ma1yzl81ldaycS4FmOc/HeG0F0EouNMvOJY8wRknQ2MHFgo50O9wABCAVYAEIOBMGyBkcTfGvKhYE2WBC+AWCNOHcpkZYViktRkbxqY1rlnL5rK61k4lwLMc5+Od4vceyz2aZfD2t6Yf1T8VpbBUmvyf/6WSCIaFJmBQHBBPnChjBCJpALOEZzWEOoXAjEVcJwU6QNMnCQemw5lYr1wP4Yrd7Kh813KsJITdZtDZdO/Nb/EeIEOq6mn9//uUBCMMglwayou4eTBKg1lRdw8mCRxbKCzswxEuGGWdow2oj0ziXaKZIIhoUmYFAcEE+cKGMEImkAs4RnNYQ6hcCMRVwnBTpA0ycJB6bDmVivXA/hit3sqHzXcqwkhN1m0Nl0781v8R4gQ3qup/2PTcl2geDKLS0Dlz62OeezARhAXGxQHQWEYYrFAT3TZw4FCwS4JDTF8AkaliQVaJoBk2ZlkiTQ2GgZmiQ1TzBSo+AA7JnYoKkVD1ZLuX4AtuEAwAFeAsHNMiPlXBIxSunQZU2GQTJoCe6bOHAoWCXBIaYvkUWljkvhpGS5mWFUrqaky+ZUivDyLT+PkTH9Nf5Jc8MPCT5LS5agFKBGvwAEGuOYUBgViPhKwULrvceUN2EYE5cfjEPVa76oYHc8iajBh079LyeBx+8xsatjP5+f/v9moz085O0y92c1/TLeIQBc5iarAMAtQBhIDsHMLAswKiDlZBMLgFd7jyhuwXBjO4/GIeq131ERQsohipJqEF//uUBDuAAl4rSc1swABNpWkWriAAT6S1N7msABH4Fqa3NYACK3Y2lxKnyqWlj4I9evjntWStpWltoH3a1c9wPfBQe51tv4QIRW5JWpHY2wmAQCAA3Ez8JQ0wQP/M2RNaIDhCYutAAONBBkAlvb4j4+qi40CU4Bh3bhxXygTVd/7vSq0iY6iSWWXrsXQ29eVJCqUsoXWy7X/vdWvP1JZg/tBEovFId////7rne699onXkM9DUl/+GAZBQDf8JEQCKo//+ogQCRyuRRuRthMAgEABkJp6CMpiBP+aMybcYnwznWkEqoAuaC5GfvF8HZFWg/FXSa8blglIwmKgd/7XpVaYZFGTZZe5DuQPushJSpXIpuwbX/vdWvL6kswcmPQFF4Ef3////LXO917pQHTyGedqP//DAMgoD3/CREAiqP/2eqv////////3dk90KlpVV3eUWVjHLZSMUp5hxnpOcO1WpXVXu4ijKYTSd3IJ7Kzt6Wp7FWiGQUEGFRgdCgpRM//uUBB8P8lRjwIcAoABJLFgQ4BQASJmNAgAFHEkIsiAAAaegRMowxhYVZBMOCoAh7/////////79CTkvIITTqZkZjVGEMPHvEBE7IZXMpGVFYqsKyOYw5jjmOZkFDdkZLkW+9NjEIZxbiYixXO5QkcoRVQoYBgYPlK+XmRGbwXaEFZGvWIpZLWEizxltQ9uELQV7E73d3HESrONG7w3dTdpF6Skf/zNT3I6rIKxJy1oKCtGGjj5FDxcKB+HpYd/3//i3rZFOT0N05+QpgWZYZ3pi5biJNCj4fRQQwYK8p48BQUTWPDTbNjkPn8+1VXKvJ7dJ5Gb2mESWLjnHOYNH07r6//////////icK81KXqTXuvQEteLGdY0DKwrjQVTIMKbgE0b41Egi1KxtuNwUpf9X+bNqTUlXbDClWgIlS4wMVc1F0QZc3/N/yto/7eUShjGUstRgIUZXKUrFYwU5SgKOxgYE+krfVkf6St/VpnMaYwpwoCjoZwoCZwqFC4LH//uUBD+P4jNjPwAjN8I7THfwAEnqR8mAugCAcQkHsheEERr40LUwj//hIzL//9k/9rJZ9lks+yyVDL/////81YHZUMj//yZZLHIy7/5qwMHHIyZZL/sslQyNWt/I1DBQYRxPYaxS/////5kn///6on0VEVP/6on/7OVFVO5QwUGEOzyhgaoqKhQwMGCUjt////8qaLdr/qTiyzLxaJxpRTt6RBhIhDZMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq"),Fp=p(()=>(()=>{let i=new(window.AudioContext||window.webkitAudioContext),t=i.createGain();t.connect(i.destination);let e=new yn(lu(i));return i.decodeAudioData(Mp.buffer.slice(0)).then(s=>{e.buf=s}).catch(s=>{console.error("Failed to load burp: ",s)}),{ctx:i,masterNode:t,burpSnd:e}})(),"initAudio");function xm(i,t={}){let e=new Be,s=new Audio(i);s.crossOrigin="anonymous",x.audio.ctx.createMediaElementSource(s).connect(x.audio.masterNode);function r(){x.debug.paused||x.app.isHidden()&&!x.globalOpt.backgroundAudio||x.audio.ctx.resume()}p(r,"resumeAudioCtx");function n(){r(),s.play()}return p(n,"play"),t.paused||n(),s.onended=()=>e.trigger(),{play(){n()},seek(o){s.currentTime=o},stop(){s.pause(),this.seek(0)},set loop(o){s.loop=o},get loop(){return s.loop},set paused(o){o?s.pause():n()},get paused(){return s.paused},time(){return s.currentTime},duration(){return s.duration},set volume(o){s.volume=yi(o,0,1)},get volume(){return s.volume},set speed(o){s.playbackRate=Math.max(o,0)},get speed(){return s.playbackRate},set detune(o){},get detune(){return 0},onEnd(o){return e.add(o)},then(o){return this.onEnd(o)}}}p(xm,"playMusic");function wm(i,t={}){if(typeof i=="string"&&x.assets.music[i])return xm(x.assets.music[i],t);let e=x.audio.ctx,s=t.paused??!1,r=e.createBufferSource(),n=new Be,o=e.createGain(),a=e.createStereoPanner(),l=t.seek??0,c=0,h=0,d=!1;r.loop=!!t.loop,r.detune.value=t.detune??0,r.playbackRate.value=t.speed??1,r.connect(a),r.onended=()=>{var g;y()>=(((g=r.buffer)==null?void 0:g.duration)??Number.POSITIVE_INFINITY)&&n.trigger()},a.pan.value=t.pan??0,a.connect(o),o.connect(x.audio.masterNode),o.gain.value=t.volume??1;let u=p(g=>{r.buffer=g.buf,s||(c=e.currentTime,r.start(0,l),d=!0)},"start"),f=Vu(i);f instanceof He&&f.onLoad(u);let y=p(()=>{if(!r.buffer)return 0;let g=s?h-c:e.currentTime-c,A=r.buffer.duration;return r.loop?g%A:Math.min(g,A)},"getTime"),v=p(g=>{let A=e.createBufferSource();return A.buffer=g.buffer,A.loop=g.loop,A.playbackRate.value=g.playbackRate.value,A.detune.value=g.detune.value,A.onended=g.onended,A.connect(a),A},"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(g){if(s!==g)if(s=g,g)d&&(r.stop(),d=!1),h=e.currentTime;else{r=v(r);let A=h-c;r.start(0,A),d=!0,c=e.currentTime-A,h=0}},get paused(){return s},play(g=0){this.seek(g),this.paused=!1},seek(g){var A;(A=r.buffer)!=null&&A.duration&&(g>r.buffer.duration||(s?(r=v(r),c=h-g):(r.stop(),r=v(r),c=e.currentTime-g,r.start(0,g),d=!0,h=0)))},set speed(g){r.playbackRate.value=g},get speed(){return r.playbackRate.value},set detune(g){r.detune.value=g},get detune(){return r.detune.value},set volume(g){o.gain.value=Math.max(g,0)},get volume(){return o.gain.value},set pan(g){a.pan.value=g},get pan(){return a.pan.value},set loop(g){r.loop=g},get loop(){return r.loop},duration(){var g;return((g=r.buffer)==null?void 0:g.duration)??0},time(){return y()%this.duration()},onEnd(g){return n.add(g)},then(g){return this.onEnd(g)}}}p(wm,"play");function gl(i){return x.k.play(x.audio.burpSnd,i)}p(gl,"burp");function bm(i){return i!==void 0&&(x.audio.masterNode.gain.value=i),x.audio.masterNode.gain.value}p(bm,"volume");function Al(){x.app.onHide(()=>{x.globalOpt.backgroundAudio||x.audio.ctx.suspend()}),x.app.onShow(()=>{!x.globalOpt.backgroundAudio&&!x.debug.paused&&x.audio.ctx.resume()}),x.app.onResize(()=>{if(x.app.isFullscreen())return;let i=x.globalOpt.width&&x.globalOpt.height;i&&!x.globalOpt.stretch&&!x.globalOpt.letterbox||(x.canvas.width=x.canvas.offsetWidth*x.pixelDensity,x.canvas.height=x.canvas.offsetHeight*x.pixelDensity,dl(),i||(x.gfx.frameBuffer.free(),x.gfx.frameBuffer=new Bo(x.gfx.ggl,x.gfx.ggl.gl.drawingBufferWidth,x.gfx.ggl.gl.drawingBufferHeight),x.gfx.width=x.gfx.ggl.gl.drawingBufferWidth/x.pixelDensity/x.gscale,x.gfx.height=x.gfx.ggl.gl.drawingBufferHeight/x.pixelDensity/x.gscale))}),x.globalOpt.debug!==!1&&(x.app.onKeyPress(x.globalOpt.debugKey??"f1",()=>x.debug.inspect=!x.debug.inspect),x.app.onKeyPress("f2",()=>x.debug.clearLog()),x.app.onKeyPress("f8",()=>x.debug.paused=!x.debug.paused),x.app.onKeyPress("f7",()=>{x.debug.timeScale=go(yi(x.debug.timeScale-.2,0,2),1)}),x.app.onKeyPress("f9",()=>{x.debug.timeScale=go(yi(x.debug.timeScale+.2,0,2),1)}),x.app.onKeyPress("f10",()=>x.debug.stepFrame())),x.globalOpt.burp&&x.app.onKeyPress("b",()=>gl())}p(Al,"initEvents");function Bm(i,t={}){let e=x.game.root.add([vn(i),Cl()]),s=(t.speed||1)*5,r=t.scale||1;e.add([Fo(x.boomSprite),gn(0),So("center"),Va(s,r),...t.comps??[]]);let n=e.add([Fo(x.kaSprite),gn(0),So("center"),Eo(),...t.comps??[]]);return n.wait(.4/s,()=>n.use(Va(s,r))),n.onDestroy(()=>e.destroy()),e}p(Bm,"addKaboom");var Ep=p(function(i,t){if(x.game.layers)throw Error("Layers can only be assigned once.");let e=i.indexOf(t);if(e==-1)throw Error("The default layer name should be present in the layers list.");x.game.layers=i,x.game.defaultLayerIndex=e},"layers");function xl(i){i.destroy()}p(xl,"destroy");function Cm(){return x.game.root}p(Cm,"getTreeRoot");function km(i,t){x.game.scenes[i]=t}p(km,"scene");function Mm(i,...t){if(!x.game.scenes[i])throw new Error(`Scene not found: ${i}`);x.game.events.onOnce("frameEnd",()=>{x.game.events.trigger("sceneLeave",i),x.app.events.clear(),x.game.events.clear(),x.game.objEvents.clear(),[...x.game.root.children].forEach(e=>{!e.stay||e.scenesToStay&&!e.scenesToStay.includes(i)?x.game.root.remove(e):e.trigger("sceneEnter",i)}),x.game.root.clearEvents(),Al(),x.game.cam={pos:null,scale:D(1),angle:0,shake:0,transform:new _i},x.game.scenes[i](...t)}),x.game.currentScene=i}p(Mm,"go");function Fm(i){return x.game.events.on("sceneLeave",i)}p(Fm,"onSceneLeave");function Em(){return x.game.currentScene}p(Em,"getSceneName");function Fo(i,t={}){let e=null,s=null,r=null,n=new Be;if(!i)throw new Error("Please pass the resource name or data to sprite()");let o=p((l,c,h,d)=>{let u=D(1,1);return h&&d?(u.x=h/(l.width*c.w),u.y=d/(l.height*c.h)):h?(u.x=h/(l.width*c.w),u.y=u.x):d&&(u.y=d/(l.height*c.h),u.x=u.y),u},"calcTexScale"),a=p((l,c)=>{if(!c)return;let h=c.frames[0].clone();t.quad&&(h=h.scale(t.quad));let d=o(c.tex,h,t.width,t.height);l.width=c.tex.width*h.w*d.x,l.height=c.tex.height*h.h*d.y,t.anim&&l.play(t.anim),e=c,n.trigger(e)},"setSpriteData");return{id:"sprite",width:0,height:0,frame:t.frame||0,quad:t.quad||new Vt(0,0,1,1),animSpeed:t.animSpeed??1,flipX:t.flipX??!1,flipY:t.flipY??!1,get sprite(){return i.toString()},set sprite(l){let c=an(l);c&&c.onLoad(h=>a(this,h))},get animFrame(){if(!e||!s||r===null)return this.frame;let l=e.anims[s.name];return typeof l=="number"?l:this.frame-Math.min(l.from,l.to)},draw(){if(!e)return;let l=e.frames[this.frame??0];if(!l)throw new Error(`Frame not found: ${this.frame??0}`);if(e.slice9){let{left:c,right:h,top:d,bottom:u}=e.slice9,f=e.tex.width*l.w,y=e.tex.height*l.h,v=this.width-c-h,g=this.height-d-u,A=c/f,B=h/f,F=1-A-B,E=d/y,k=u/y,w=1-E-k,b=[Nt(0,0,A,E),Nt(A,0,F,E),Nt(A+F,0,B,E),Nt(0,E,A,w),Nt(A,E,F,w),Nt(A+F,E,B,w),Nt(0,E+w,A,k),Nt(A,E+w,F,k),Nt(A+F,E+w,B,k),Nt(0,0,c,d),Nt(c,0,v,d),Nt(c+v,0,h,d),Nt(0,d,c,g),Nt(c,d,v,g),Nt(c+v,d,h,g),Nt(0,d+g,c,u),Nt(c,d+g,v,u),Nt(c+v,d+g,h,u)];for(let M=0;M<9;M++){let V=b[M],L=b[M+9];_n(Object.assign(us(this),{pos:L.pos(),tex:e.tex,quad:l.scale(V),flipX:this.flipX,flipY:this.flipY,tiled:t.tiled,width:L.w,height:L.h}))}}else _n(Object.assign(us(this),{tex:e.tex,quad:l.scale(this.quad??new Vt(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:t.tiled,width:this.width,height:this.height}))},add(){let l=an(i);l?l.onLoad(c=>a(this,c)):Go(()=>a(this,an(i).data))},update(){if(!e||!s||r===null)return;let l=e.anims[s.name];if(typeof l=="number"){this.frame=l;return}if(l.speed===0)throw new Error("Sprite anim speed cannot be 0");s.timer+=Xt()*this.animSpeed,s.timer>=1/s.speed&&(s.timer=0,this.frame+=r,(this.frame<Math.min(l.from,l.to)||this.frame>Math.max(l.from,l.to))&&(s.loop?s.pingpong?(this.frame-=r,r*=-1,this.frame+=r):this.frame=l.from:s.pingpong?r===Math.sign(l.to-l.from)?(this.frame=l.to,r*=-1,this.frame+=r):(this.frame=l.from,s.onEnd(),this.stop()):(this.frame=l.to,s.onEnd(),this.stop())))},play(l,c={}){if(!e){n.add(()=>this.play(l,c));return}let h=e.anims[l];if(h===void 0)throw new Error(`Anim not found: ${l}`);s&&this.stop(),s=typeof h=="number"?{name:l,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:p(()=>{},"onEnd")}:{name:l,timer:0,loop:c.loop??h.loop??!1,pingpong:c.pingpong??h.pingpong??!1,speed:c.speed??h.speed??10,onEnd:c.onEnd??(()=>{})},r=typeof h=="number"?null:h.from<h.to?1:-1,this.frame=typeof h=="number"?h:h.from,this.trigger("animStart",l)},stop(){if(!s)return;let l=s.name;s=null,this.trigger("animEnd",l)},numFrames(){return(e==null?void 0:e.frames.length)??0},getCurAnim(){return s},curAnim(){return s==null?void 0:s.name},getAnim(l){return(e==null?void 0:e.anims[l])??null},hasAnim(l){return!!this.getAnim(l)},onAnimEnd(l){return this.on("animEnd",l)},onAnimStart(l){return this.on("animStart",l)},renderArea(){return new Et(D(0),this.width,this.height)},inspect(){return typeof i=="string"?`sprite: "${i}"`:null}}}p(Fo,"sprite");function Sm(i,t={}){function e(r){var o,a;let n=hs(Object.assign(us(r),{text:r.text+"",size:r.textSize,font:r.font,width:t.width&&r.width,align:r.align,letterSpacing:r.letterSpacing,lineSpacing:r.lineSpacing,transform:r.textTransform,styles:r.textStyles}));return t.width||(r.width=n.width/(((o=r.scale)==null?void 0:o.x)||1)),r.height=n.height/(((a=r.scale)==null?void 0:a.y)||1),n}p(e,"update");let s={id:"text",set text(r){i=r,e(this),this.renderedText=Co(i).text},get text(){return i},textSize:t.size??36,font:t.font,width:t.width??0,height:0,align:t.align,lineSpacing:t.lineSpacing,letterSpacing:t.letterSpacing,textTransform:t.transform,textStyles:t.styles,renderedText:i?Co(i).text:"",add(){Go(()=>e(this))},draw(){cs(e(this))},renderArea(){return new Et(D(0),this.width,this.height)}};return e(s),s}p(Sm,"text");function Pm(i,t){return{id:"rect",width:i,height:t,draw(){Rr(Object.assign(us(this),{width:this.width,height:this.height}))},renderArea(){return new Et(D(0),this.width,this.height)},inspect(){return`uvquad: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)})h`}}}p(Pm,"uvquad");function Dm(i={}){let t=null,e=null,s=null,r=null;return{id:"agent",require:["pos","tile"],agentSpeed:i.speed??100,allowDiagonals:i.allowDiagonals??!0,getDistanceToTarget(){return t?this.pos.dist(t):0},getNextLocation(){return e&&s?e[s]:null},getPath(){return e?e.slice():null},getTarget(){return t},isNavigationFinished(){return e?s===null:!0},isTargetReachable(){return e!==null},isTargetReached(){return t?this.pos.eq(t):!0},setTarget(n){t=n,e=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),s=e?0:null,e&&s!==null?(r||(r=this.getLevel().onNavigationMapChanged(()=>{t&&e&&s!==null&&(e=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),e?(s=0,this.trigger("navigationNext",this,e[s])):(s=null,this.trigger("navigationEnded",this)))}),this.onDestroy(()=>r==null?void 0:r.cancel())),this.trigger("navigationStarted",this),this.trigger("navigationNext",this,e[s])):this.trigger("navigationEnded",this)},update(){if(t&&e&&s!==null){if(this.pos.sdist(e[s])<2)if(s===e.length-1){this.pos=t.clone(),s=null,this.trigger("navigationEnded",this),this.trigger("targetReached",this);return}else s++,this.trigger("navigationNext",this,e[s]);this.moveTo(e[s],this.agentSpeed)}},onNavigationStarted(n){return this.on("navigationStarted",n)},onNavigationNext(n){return this.on("navigationNext",n)},onNavigationEnded(n){return this.on("navigationEnded",n)},onTargetReached(n){return this.on("targetReached",n)},inspect(){return"agent: "+JSON.stringify({target:JSON.stringify(t),path:JSON.stringify(e)})}}}p(Dm,"agent");function Vm(i){let t=i.graph;return{id:"pathfinder",require:["pos"],navigateTo(e){var s;return(s=this.graph)==null?void 0:s.getWaypointPath(this.pos,e,i.navigationOpt)},get graph(){if(t)return t;let e=this.parent;for(;e;){if(e.is("pathfinderMap"))return e.graph;e=e.parent}},set graph(e){t=e}}}p(Vm,"pathfinder");function Im(i={}){let t=i.waypoints,e=i.speed||100,s=i.endBehavior||"stop",r=0,n=t!=null;return{id:"patrol",require:["pos"],get patrolSpeed(){return e},set patrolSpeed(o){e=o},get waypoints(){return t},set waypoints(o){t=o,r=0,n=!1},get nextLocation(){return t?t[r]:void 0},update(){let o=this.nextLocation;if(!(!t||!o||n)&&(this.moveTo(o,e),this.pos.sdist(o)<9))switch(s){case"loop":r=(r+1)%t.length;break;case"ping-pong":r=r+1,r==t.length&&(t.reverse(),r=0);break;case"stop":r=Math.min(r+1,t.length-1),r==t.length-1&&(n=!0,this.trigger("patrolFinished"));break}},onPatrolFinished(o){return this.on("patrolFinished",o)}}}p(Im,"patrol");function qm(i,t={}){let e=typeof i=="function"?i:()=>x.game.root.query(i),s=t.checkFrequency||1,r=typeof t.direction=="number"?j.fromAngle(t.direction):t.direction,n=0;return{id:"sentry",require:["pos"],direction:typeof t.direction=="number"?j.fromAngle(t.direction):t.direction,spotted:[],set directionAngle(o){this.direction=o!==void 0?j.fromAngle(o):void 0},get directionAngle(){return this.direction?this.direction.angle():void 0},fieldOfView:t.fieldOfView||200,isWithinFieldOfView(o,a,l){let c=(typeof a=="number"?j.fromAngle(a):a)||r,h=l||t.fieldOfView;if(!c||!h||h>=360)return!0;let d=h/2;return o.pos&&c.angleBetween(o.pos.sub(this.pos))<=d},hasLineOfSight(o){let a=yl(this.pos,o.pos.sub(this.pos),t.raycastExclude);return a!=null&&a.object===o},update(){if(n+=Xt(),n>s){n-=s;let o=e();if(o.length&&r&&this.fieldOfView&&this.fieldOfView<360){let a=this.fieldOfView/2;o=o.filter(l=>l.pos&&r.angleBetween(l.pos.sub(this.pos))<=a)}o.length&&t.lineOfSight&&(o=o.filter(a=>a.pos&&this.hasLineOfSight(a))),o.length>0&&(this.spotted=o,this.trigger("objectSpotted",o))}},onObjectsSpotted(o){return this.on("objectSpotted",o)}}}p(qm,"sentry");function wl(i={}){let t=D(0),e=i.isObstacle??!1,s=i.cost??0,r=i.edges??[],n=p(()=>{let a={left:1,top:2,right:4,bottom:8};return r.map(l=>a[l]||0).reduce((l,c)=>l|c,0)},"getEdgeMask"),o=n();return{id:"tile",tilePosOffset:i.offset??D(0),set tilePos(a){let l=this.getLevel();t=a.clone(),this.pos=D(this.tilePos.x*l.tileWidth(),this.tilePos.y*l.tileHeight()).add(this.tilePosOffset)},get tilePos(){return t},set isObstacle(a){e!==a&&(e=a,this.getLevel().invalidateNavigationMap())},get isObstacle(){return e},set cost(a){s!==a&&(s=a,this.getLevel().invalidateNavigationMap())},get cost(){return s},set edges(a){r=a,o=n(),this.getLevel().invalidateNavigationMap()},get edges(){return r},get edgeMask(){return o},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(D(-1,0))},moveRight(){this.tilePos=this.tilePos.add(D(1,0))},moveUp(){this.tilePos=this.tilePos.add(D(0,-1))},moveDown(){this.tilePos=this.tilePos.add(D(0,1))}}}p(wl,"tile");var Ir,bl=(Ir=class{constructor(t,e,s){S(this,"name");S(this,"duration");S(this,"loops");S(this,"direction");S(this,"easing");S(this,"interpolation");S(this,"isFinished");S(this,"timing");S(this,"easings");S(this,"relative");this.name=t,this.duration=e.duration,this.loops=e.loops||0,this.direction=e.direction||"forward",this.easing=e.easing||pn.linear,this.interpolation=e.interpolation||"linear",this.isFinished=!1,this.timing=e.timing,this.easings=e.easings,this.relative=s}update(t,e){return!0}getLowerKeyIndexAndRelativeTime(t,e,s){let r=e-1,n=t/this.duration;if(this.loops!==0&&n>=this.loops)return[r,0];let o=Math.trunc(n);if(n-=o,(this.direction=="reverse"||this.direction=="ping-pong"&&o&1)&&(n=1-n),s){let a=0;for(;s[a+1]!==void 0&&s[a+1]<n;)a++;return a>=r?[r,0]:[a,(n-s[a])/(s[a+1]-s[a])]}else{let a=Math.floor((e-1)*n);return[a,(n-a/r)*r]}}setValue(t,e,s){if(this.relative)switch(e){case"pos":t.pos=t.base.pos.add(s);break;case"angle":t.angle=t.base.angle+s;break;case"scale":t.scale=t.base.scale.scale(s);break;case"opacity":t.opacity=t.base.opacity*s;break;default:t[e]=s}else t[e]=s}serialize(){let t={duration:this.duration,keys:[]};return this.loops&&(t.loops=this.loops),this.direction!=="forward"&&(t.direction=this.direction),this.easing!=pn.linear&&(t.easing=this.easing.name),this.interpolation!=="linear"&&(t.interpolation=this.interpolation),this.timing&&(t.timing=this.timing),this.easings&&(t.easings=this.easings.map(e=>this.easing.name)),t}},p(Ir,"AnimateChannel"),Ir);function Da(i,t){return t.add(t.sub(i))}p(Da,"reflect");var qr,Sp=(qr=class extends bl{constructor(e,s,r,n){super(e,r,n);S(this,"keys");this.keys=s}update(e,s){let[r,n]=this.getLowerKeyIndexAndRelativeTime(s,this.keys.length,this.timing);if(n==0||this.interpolation==="none")this.setValue(e,this.name,this.keys[r]);else{let o=this.easings?this.easings[r]:this.easing;this.setValue(e,this.name,ye(this.keys[r],this.keys[r+1],o(n)))}return n==1}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}},p(qr,"AnimateChannelNumber"),qr),jr,Pp=(jr=class extends bl{constructor(e,s,r,n,o){var a;super(e,r,n);S(this,"keys");S(this,"curves");S(this,"dcurves");if(this.keys=s,this.interpolation==="spline"){this.curves=[],o&&(this.dcurves=[]);for(let l=0;l<this.keys.length-1;l++){let c=this.keys[l],h=l+1,d=this.keys[h],u=l>0?this.keys[l-1]:Da(d,c),f=h<this.keys.length-1?this.keys[h+1]:Da(c,d);this.curves.push(mn(u,c,d,f)),o&&((a=this.dcurves)==null||a.push(mn(u,c,d,f,Vc)))}}}update(e,s){let[r,n]=this.getLowerKeyIndexAndRelativeTime(s,this.keys.length,this.timing);if(n==0||this.interpolation==="none")this.setValue(e,this.name,this.keys[r]);else{let o=this.easings?this.easings[r]:this.easing;switch(this.interpolation){case"linear":this.setValue(e,this.name,this.keys[r].lerp(this.keys[r+1],o(n)));break;case"slerp":this.setValue(e,this.name,this.keys[r].slerp(this.keys[r+1],o(n)));break;case"spline":if(this.curves){this.setValue(e,this.name,this.curves[r](o(n))),this.dcurves&&this.setValue(e,"angle",this.dcurves[r](o(n)).angle());break}}}return n==1}serialize(){return Object.assign(super.serialize(),{keys:this.keys.map(e=>[e.x,e.y])})}},p(jr,"AnimateChannelVec2"),jr),Tr,Dp=(Tr=class extends bl{constructor(e,s,r,n){super(e,r,n);S(this,"keys");this.keys=s}update(e,s){let[r,n]=this.getLowerKeyIndexAndRelativeTime(s,this.keys.length,this.timing);if(n==0||this.interpolation=="none")this.setValue(e,this.name,this.keys[r]);else{let o=this.easings?this.easings[r]:this.easing;this.setValue(e,this.name,this.keys[r].lerp(this.keys[r+1],o(n)))}return n==1}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}},p(Tr,"AnimateChannelColor"),Tr);function jm(i={}){let t=[],e=0,s=!1;return{id:"animate",require:i.followMotion?["rotate"]:void 0,base:{pos:D(0,0),angle:0,scale:D(1,1),opacity:1},add(){i.relative&&(this.is("pos")&&(this.base.pos=this.pos.clone()),this.is("rotate")&&(this.base.angle=this.angle),this.is("scale")&&(this.base.scale=this.scale),this.is("opacity")&&(this.base.opacity=this.opacity))},update(){let r=!0,n;e+=Xt();for(let o of t)n=o.update(this,e),n&&!o.isFinished&&(o.isFinished=!0,this.trigger("animateChannelFinished",o.name)),r&&(r=n);r&&!s&&(s=!0,this.trigger("animateFinished"))},animate(r,n,o){s=!1,this.unanimate(r),typeof n[0]=="number"?t.push(new Sp(r,n,o,i.relative||!1)):n[0]instanceof j?t.push(new Pp(r,n,o,i.relative||!1,r==="pos"&&(i.followMotion||!1))):n[0]instanceof ut&&t.push(new Dp(r,n,o,i.relative||!1))},unanimate(r){let n=t.findIndex(o=>o.name===r);n>=0&&t.splice(n,1)},unanimateAll(){t.splice(0,t.length)},onAnimateFinished(r){return this.on("animateFinished",r)},onAnimateChannelFinished(r){return this.on("animateChannelFinished",r)},serializeAnimationChannels(){return t.reduce((r,n)=>(r[n.name]=n.serialize(),r),{})},serializeAnimationOptions(){let r={};return i.followMotion&&(r.followMotion=!0),i.relative&&(r.relative=!0),r}}}p(jm,"animate");function Bl(i,t){let e={name:i.name};return i.is("animate")&&(e.channels=i.serializeAnimationChannels(),Object.assign(e,i.serializeAnimationOptions())),i.children.length>0&&(e.children=i.children.filter(s=>s.is("named")).map(s=>Bl(s,s.name))),e}p(Bl,"serializeAnimation");function Va(i=2,t=1){let e=0;return{require:["scale"],update(){let s=Math.sin(e*i)*t;s<0&&this.destroy(),this.scale=D(s),e+=Xt()}}}p(Va,"boom");function Tm(i,t){if(i==null)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(e=1){this.setHP(i-e),this.trigger("hurt",e)},heal(e=1){let s=i;this.setHP(i+e),this.trigger("heal",i-s)},hp(){return i},maxHP(){return t??null},setMaxHP(e){t=e},setHP(e){i=t?Math.min(t,e):e,i<=0&&this.trigger("death")},onHurt(e){return this.on("hurt",e)},onHeal(e){return this.on("heal",e)},onDeath(e){return this.on("death",e)},inspect(){return`health: ${i}`}}}p(Tm,"health");function Lm(i,t={}){if(i==null)throw new Error("lifespan() requires time");let e=t.fade??0;return{id:"lifespan",require:["opacity"],async add(){await x.game.root.wait(i),this.opacity=this.opacity??1,e>0&&await x.game.root.tween(this.opacity,0,e,s=>this.opacity=s,pn.linear),this.destroy()}}}p(Lm,"lifespan");function Rm(i){return{id:"named",name:i}}p(Rm,"named");function zm(i,t,e){if(!i)throw new Error("state() requires an initial state");let s={};function r(l){s[l]||(s[l]={enter:new Be,end:new Be,update:new Be,draw:new Be})}p(r,"initStateEvents");function n(l,c,h){return r(c),s[c][l].add(h)}p(n,"on");function o(l,c,...h){r(c),s[c][l].trigger(...h)}p(o,"trigger");let a=!1;return{id:"state",state:i,enterState(l,...c){if(a=!0,t&&!t.includes(l))throw new Error(`State not found: ${l}`);let h=this.state;if(e){if(!(e!=null&&e[h]))return;let d=typeof e[h]=="string"?[e[h]]:e[h];if(!d.includes(l))throw new Error(`Cannot transition state from "${h}" to "${l}". Available transitions: ${d.map(u=>`"${u}"`).join(", ")}`)}o("end",h,...c),this.state=l,o("enter",l,...c),o("enter",`${h} -> ${l}`,...c)},onStateTransition(l,c,h){return n("enter",`${l} -> ${c}`,h)},onStateEnter(l,c){return n("enter",l,c)},onStateUpdate(l,c){return n("update",l,c)},onStateDraw(l,c){return n("draw",l,c)},onStateEnd(l,c){return n("end",l,c)},update(){a||(o("enter",i),a=!0),o("update",this.state)},draw(){o("draw",this.state)},inspect(){return`state: ${this.state}`}}}p(zm,"state");function Cl(i){return{id:"stay",stay:!0,scenesToStay:i}}p(Cl,"stay");function Nm(i=!0,t){let e,s;return{id:"textInput",hasFocus:i,require:["text"],add(){e=x.k.onCharInput(r=>{this.hasFocus&&(!t||this.text.length<t)&&(x.k.isKeyDown("shift")?this.text+=r.toUpperCase():this.text+=r)}),s=x.k.onKeyPressRepeat("backspace",()=>{this.hasFocus&&(this.text=this.text.slice(0,-1))})},destroy(){e.cancel(),s.cancel()}}}p(Nm,"textInput");function Eo(){return{id:"timer",wait(i,t){let e=[];t&&e.push(t);let s=0,r=this.onUpdate(()=>{s+=x.app.state.dt,s>=i&&(e.forEach(n=>n()),r.cancel())});return{get paused(){return r.paused},set paused(n){r.paused=n},cancel:r.cancel,onEnd(n){e.push(n)},then(n){return this.onEnd(n),this}}},loop(i,t){let e=null,s=p(()=>{e=this.wait(i,s),t()},"newAction");return e=this.wait(0,s),{get paused(){return(e==null?void 0:e.paused)??!1},set paused(r){e&&(e.paused=r)},cancel:p(()=>e==null?void 0:e.cancel(),"cancel")}},tween(i,t,e,s,r=pn.linear){let n=0,o=[],a=this.onUpdate(()=>{n+=x.app.state.dt;let l=Math.min(n/e,1);s(ye(i,t,r(l))),l===1&&(a.cancel(),s(t),o.forEach(c=>c()))});return{get paused(){return a.paused},set paused(l){a.paused=l},onEnd(l){o.push(l)},then(l){return this.onEnd(l),this},cancel(){a.cancel()},finish(){a.cancel(),s(t),o.forEach(l=>l())}}}}}p(Eo,"timer");var Ia=0;function Om(){return Ia>0}p(Om,"usesArea");function Um(i={}){let t={},e=new Set;return{id:"area",collisionIgnore:i.collisionIgnore??[],add(){Ia++,this.area.cursor&&this.onHover(()=>x.app.setCursor(this.area.cursor)),this.onCollideUpdate((s,r)=>{if(!s.id)throw new Error("area() requires the object to have an id");t[s.id]||this.trigger("collide",s,r),r&&(t[s.id]=r,e.add(s.id))})},destroy(){Ia--},fixedUpdate(){for(let s in t)e.has(Number(s))||(this.trigger("collideEnd",t[s].target),delete t[s]);e.clear()},drawInspect(){let s=this.localArea();Ce(),Dt(this.area.offset);let r={outline:{width:4/Za(),color:xt(0,0,255)},anchor:this.anchor,fill:!1,fixed:es(this)};s instanceof Et?Me({...r,pos:s.pos,width:s.width*this.area.scale.x,height:s.height*this.area.scale.y}):s instanceof _e?Ti({...r,pts:s.pts,scale:this.area.scale}):s instanceof Ee&&Os({...r,pos:s.center,radius:s.radius}),fe()},area:{shape:i.shape??null,scale:i.scale?D(i.scale):D(1),offset:i.offset??D(0),cursor:i.cursor??null},isClicked(){return x.app.isMousePressed()&&this.isHovering()},isHovering(){let s=es(this)?x.k.mousePos():x.k.toWorld(x.k.mousePos());return this.hasPoint(s)},checkCollision(s){if(!s.id)throw new Error("checkCollision() requires the object to have an id");return t[s.id]??null},getCollisions(){return Object.values(t)},isColliding(s){if(!s.id)throw new Error("isColliding() requires the object to have an id");return!!t[s.id]},isOverlapping(s){if(!s.id)throw new Error("isOverlapping() requires the object to have an id");let r=t[s.id];return r&&r.hasOverlap()},onClick(s,r="left"){let n=x.app.onMousePress(r,()=>{this.isHovering()&&s()});return this.onDestroy(()=>n.cancel()),n},onHover(s){let r=!1;return this.onUpdate(()=>{r?r=this.isHovering():this.isHovering()&&(r=!0,s())})},onHoverUpdate(s){return this.onUpdate(()=>{this.isHovering()&&s()})},onHoverEnd(s){let r=!1;return this.onUpdate(()=>{r?this.isHovering()||(r=!1,s()):r=this.isHovering()})},onCollide(s,r){if(typeof s=="function"&&r===void 0)return this.on("collide",s);if(typeof s=="string")return this.onCollide((n,o)=>{n.is(s)&&(r==null||r(n,o))});throw new Error("onCollide() requires either a function or a tag")},onCollideUpdate(s,r){if(typeof s=="function"&&r===void 0)return this.on("collideUpdate",s);if(typeof s=="string")return this.on("collideUpdate",(n,o)=>n.is(s)&&(r==null?void 0:r(n,o)));throw new Error("onCollideUpdate() requires either a function or a tag")},onCollideEnd(s,r){if(typeof s=="function"&&r===void 0)return this.on("collideEnd",s);if(typeof s=="string")return this.on("collideEnd",n=>n.is(s)&&(r==null?void 0:r(n)));throw new Error("onCollideEnd() requires either a function or a tag")},hasPoint(s){return Li(this.worldArea(),s)},resolveCollision(s){let r=this.checkCollision(s);r&&!r.resolved&&(this.pos=this.pos.add(r.displacement),r.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let s=this.localArea();if(!(s instanceof _e||s instanceof Et))throw new Error("Only support polygon and rect shapes for now");let r=this.transform.clone().translate(this.area.offset).scale(D(this.area.scale??1));if(s instanceof Et){let n=Ns(this.anchor||Uo).add(1,1).scale(-.5).scale(s.width,s.height);r.translate(n)}return s.transform(r)},screenArea(){let s=this.worldArea();return es(this)?s:s.transform(x.game.cam.transform)},inspect(){var s,r,n,o,a,l,c;return((s=this.area.scale)==null?void 0:s.x)==((r=this.area.scale)==null?void 0:r.y)?`area: ${(o=(n=this.area.scale)==null?void 0:n.x)==null?void 0:o.toFixed(1)}x`:`area: (${(l=(a=this.area.scale)==null?void 0:a.x)==null?void 0:l.toFixed(1)}x, ${(c=this.area.scale.y)==null?void 0:c.toFixed(1)}y)`}}}p(Um,"area");function Hm(i={}){let t=null,e=null,s=!1,r=D(0),n=null,o=null,a;return{id:"body",require:["pos"],vel:D(0),drag:i.drag??0,jumpForce:i.jumpForce??mp,gravityScale:i.gravityScale??1,isStatic:i.isStatic??!1,mass:i.mass??1,add(){if(n=this.pos.clone(),o=this.pos.clone(),a=this.pos.clone(),this.mass===0)throw new Error("Can't set body mass to 0");this.is("area")&&(this.onCollideUpdate((l,c)=>{if(!c||!l.is("body")||c.resolved)return;this.trigger("beforePhysicsResolve",c);let h=c.reverse();if(l.trigger("beforePhysicsResolve",h),!(c.resolved||h.resolved)&&!(this.isStatic&&l.isStatic)){if(!this.isStatic&&!l.isStatic){let d=this.mass+l.mass;this.pos=this.pos.add(c.displacement.scale(l.mass/d)),l.pos=l.pos.add(c.displacement.scale(-this.mass/d)),this.transform=pr(this),l.transform=pr(l)}else{let d=!this.isStatic&&l.isStatic?c:c.reverse();d.source.pos=d.source.pos.add(d.displacement),d.source.transform=pr(d.source)}c.resolved=!0,this.trigger("physicsResolve",c),l.trigger("physicsResolve",c.reverse())}}),this.onPhysicsResolve(l=>{if(x.game.gravity)if(l.isBottom()&&this.isFalling()){this.vel=this.vel.reject(x.game.gravity.unit());let c=t;t=l.target,c!=t&&(e=l.target.pos),s?s=!1:c||(this.trigger("ground",t),l.target.trigger("land",this))}else l.isTop()&&this.isJumping()&&(this.vel=this.vel.reject(x.game.gravity.unit()),this.trigger("headbutt",l.target),l.target.trigger("headbutted",this))}))},update(){t&&this.isColliding(t)&&t.exists()&&t.is("body")&&(e&&!t.pos.eq(e)&&i.stickToPlatform!==!1&&this.moveBy(t.pos.sub(e)),e=t.pos);let l=xo();l&&(this.pos.x==a.x&&(this.pos.x=ye(n.x,o.x,l/Ao()),a.x=this.pos.x),this.pos.y==a.y&&(this.pos.y=ye(n.y,o.y,l/Ao()),a.y=this.pos.y))},fixedUpdate(){if(n&&(this.pos.x==a.x&&(this.pos.x=n.x),this.pos.y==a.y&&(this.pos.y=n.y),n=null),x.game.gravity&&!this.isStatic){s&&(t=null,e=null,this.trigger("fallOff"),s=!1),t&&(!this.isColliding(t)||!t.exists()||!t.is("body"))&&(s=!0);let l=this.vel.clone();this.vel=this.vel.add(x.game.gravity.scale(this.gravityScale*Xt()));let c=i.maxVelocity??dp;this.vel.slen()>c*c&&(this.vel=this.vel.unit().scale(c)),l.dot(x.game.gravity)<0&&this.vel.dot(x.game.gravity)>=0&&this.trigger("fall")}if(this.vel.x+=r.x*Xt(),this.vel.y+=r.y*Xt(),this.vel.x*=1-this.drag*Xt(),this.vel.y*=1-this.drag*Xt(),this.move(this.vel),xo()){n=this.pos.clone();let l=this.vel.add(r.scale(Xt()));o=this.pos.add(l.scale(Xt())),a=this.pos.clone()}r.x=0,r.y=0},onPhysicsResolve(l){return this.on("physicsResolve",l)},onBeforePhysicsResolve(l){return this.on("beforePhysicsResolve",l)},curPlatform(){return t},isGrounded(){return t!==null},isFalling(){return this.vel.dot(ln())>0},isJumping(){return this.vel.dot(ln())<0},applyImpulse(l){this.vel=this.vel.add(l)},addForce(l){r.x+=l.x/this.mass,r.y+=l.y/this.mass},jump(l){t=null,e=null,this.vel=ln().scale(-l||-this.jumpForce)},onGround(l){return this.on("ground",l)},onFall(l){return this.on("fall",l)},onFallOff(l){return this.on("fallOff",l)},onHeadbutt(l){return this.on("headbutt",l)},onLand(l){return this.on("land",l)},onHeadbutted(l){return this.on("headbutted",l)},inspect(){return`gravityScale: ${this.gravityScale}x`}}}p(Hm,"body");function Km(i=2){let t=i;return{id:"doubleJump",require:["body"],numJumps:i,add(){this.onGround(()=>{t=this.numJumps})},doubleJump(e){t<=0||(t<this.numJumps&&this.trigger("doubleJump"),t--,this.jump(e))},onDoubleJump(e){return this.on("doubleJump",e)},inspect(){return`jumpsLeft: ${t}`}}}p(Km,"doubleJump");function Ym(i){return{id:"surfaceEffector",require:["area"],speed:i.speed,speedVariation:i.speedVariation??0,forceScale:i.speedVariation??.9,add(){this.onCollideUpdate("body",(t,e)=>{var o;let s=e==null?void 0:e.normal.normal(),r=t.vel.project(s),n=(o=s==null?void 0:s.scale(this.speed))==null?void 0:o.sub(r);t.addForce(n==null?void 0:n.scale(t.mass*this.forceScale))})}}}p(Ym,"surfaceEffector");function Gm(i){return{id:"areaEffector",require:["area"],useGlobalAngle:i.useGlobalAngle||!1,forceAngle:i.forceAngle,forceMagnitude:i.forceMagnitude,forceVariation:i.forceVariation??0,linearDrag:i.linearDrag??0,add(){this.onCollideUpdate("body",(t,e)=>{let s=j.fromAngle(this.forceAngle).scale(this.forceMagnitude);t.addForce(s),this.linearDrag&&t.addForce(t.vel.scale(-this.linearDrag))})}}}p(Gm,"areaEffector");function Wm(i){return{id:"pointEffector",require:["area","pos"],forceMagnitude:i.forceMagnitude,forceVariation:i.forceVariation??0,distanceScale:i.distanceScale??1,forceMode:i.forceMode||"inverseLinear",linearDrag:i.linearDrag??0,add(){this.onCollideUpdate("body",(t,e)=>{let s=this.pos.sub(t.pos),r=s.len(),n=r*this.distanceScale/10,o=this.forceMode==="constant"?1:this.forceMode==="inverseLinear"?1/n:1/n**2,a=s.scale(this.forceMagnitude*o/r);t.addForce(a),this.linearDrag&&t.addForce(t.vel.scale(-this.linearDrag))})}}}p(Wm,"pointEffector");function Jm(i){return{id:"constantForce",require:["body"],force:i.force,update(){this.force&&this.addForce(this.force)}}}p(Jm,"constantForce");function Xm(i){return{id:"buoyancyEffector",require:["area"],surfaceLevel:i.surfaceLevel,density:i.density??1,linearDrag:i.linearDrag??1,angularDrag:i.angularDrag??.2,flowAngle:i.flowAngle??0,flowMagnitude:i.flowMagnitude??0,flowVariation:i.flowVariation??0,add(){this.onCollideUpdate("body",(t,e)=>{let s=t,r=s.worldArea(),[n,o]=r.cut(D(-100,this.surfaceLevel),D(100,this.surfaceLevel));n&&(this.applyBuoyancy(s,n),this.applyDrag(s,n)),this.flowMagnitude&&s.addForce(j.fromAngle(this.flowAngle).scale(this.flowMagnitude))})},applyBuoyancy(t,e){let s=this.density*e.area(),r=D(0,1).scale(-s);t.addForce(r)},applyDrag(t,e){let s=t.vel,r=this.density*this.linearDrag,n=s.scale(-r);t.addForce(n)}}}p(Xm,"buoyancyEffector");function So(i){if(!i)throw new Error("Please define an anchor");return{id:"anchor",anchor:i,inspect(){return typeof this.anchor=="string"?"anchor: "+this.anchor:"anchor: "+this.anchor.toString()}}}p(So,"anchor");function kl(){return{id:"fixed",fixed:!0}}p(kl,"fixed");function Qm(i,t){return{id:"follow",require:["pos"],follow:{obj:i,offset:t??D(0)},add(){i.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){i.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}p(Qm,"follow");function Zm(i){var e;let t=(e=x.game.layers)==null?void 0:e.indexOf(i);return{id:"layer",get layerIndex(){return t??null},get layer(){var s;return t?((s=x.game.layers)==null?void 0:s[t])??null:null},set layer(s){var r;if(t=(r=x.game.layers)==null?void 0:r.indexOf(s),t==-1)throw Error("Invalid layer name")},inspect(){return`layer: ${this.layer}`}}}p(Zm,"layer");function $m(i,t){let e=typeof i=="number"?j.fromAngle(i):i.unit();return{id:"move",require:["pos"],update(){this.move(e.scale(t))}}}p($m,"move");function td(i={}){let t=i.distance??up,e=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let s=this.screenPos();if(!s)return!1;let r=new Et(D(0),te(),ie());return!Cn(r,s)&&r.sdistToPoint(s)>t*t},onExitScreen(s){return this.on("exitView",s)},onEnterScreen(s){return this.on("enterView",s)},update(){this.isOffScreen()?(e||(this.trigger("exitView"),e=!0),i.hide&&(this.hidden=!0),i.pause&&(this.paused=!0),i.destroy&&this.destroy()):(e&&(this.trigger("enterView"),e=!1),i.hide&&(this.hidden=!1),i.pause&&(this.paused=!1))}}}p(td,"offscreen");function vn(...i){return{id:"pos",pos:D(...i),moveBy(...t){this.pos=this.pos.add(D(...t))},move(...t){this.moveBy(D(...t).scale(Xt()))},moveTo(...t){if(typeof t[0]=="number"&&typeof t[1]=="number")return this.moveTo(D(t[0],t[1]),t[2]);let e=t[0],s=t[1];if(s===void 0){this.pos=D(e);return}let r=e.sub(this.pos);if(r.len()<=s*Xt()){this.pos=D(e);return}this.move(r.unit().scale(s))},worldPos(t=null){return t?(this.pos=this.pos.add(this.fromWorld(t)),null):this.parent?this.parent.transform.multVec2(this.pos):this.pos},toWorld(t){return this.parent?this.parent.transform.multVec2(this.pos.add(t)):this.pos.add(t)},fromWorld(t){return this.parent?this.parent.transform.invert().multVec2(t).sub(this.pos):t.sub(this.pos)},screenPos(t=null){if(t)return this.pos=this.pos.add(this.fromScreen(t)),null;{let e=this.worldPos();return e?es(this)?e:Mo(e):null}},toScreen(t){let e=this.toWorld(t);return es(this)?e:Mo(e)},fromScreen(t){return es(this)?this.fromWorld(t):this.fromWorld(vl(t))},toOther(t,e){return t.fromWorld(this.toWorld(e))},fromOther(t,e){return t.toOther(this,e)},inspect(){return`pos: (${Math.round(this.pos.x)}x, ${Math.round(this.pos.y)}y)`},drawInspect(){Os({color:xt(255,0,0),radius:4/Za()})}}}p(vn,"pos");function ed(i){return{id:"rotate",angle:i??0,rotateBy(t){this.angle+=t},rotateTo(t){this.angle=t},inspect(){return`angle: ${Math.round(this.angle)}`}}}p(ed,"rotate");function gn(...i){if(i.length===0)return gn(1);let t=D(...i);return{id:"scale",set scale(e){if(!(e instanceof j))throw Error("The scale property on scale is a vector. Use scaleTo or scaleBy to set the scale with a number.");t=D(e)},get scale(){return t},scaleTo(...e){t=D(...e)},scaleBy(...e){t=t.scale(D(...e))},inspect(){return t.x==t.y?`scale: ${t.x.toFixed(1)}x`:`scale: (${t.x.toFixed(1)}x, ${t.y.toFixed(1)}y)`}}}p(gn,"scale");function id(i){return{id:"z",z:i,inspect(){return`z: ${this.z}`}}}p(id,"z");var Vp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOcAAACDCAYAAAB2kQxsAAAAAXNSR0IArs4c6QAABqxJREFUeJztnU1yFDkQRtMEB+AG7Fk6fBPO6ZsQLGc/N5gbMAtosJvqKv2kpPxS763A0W5XSXqVqZ+SngzgF58/fflx/7N///vnacW1gBkFD2Z2LOYNBF3Dx9UXAGs5kxLWwhNxU2qlJHrOhwLfkNZoiaBzIa3dCFJYLXgSboKXmETPeVDQyamR8vX55fe/v37/9vBzCDoH0tqktEpZ+t0IOh4KOBm16euZmETPtVDAiRgRLRF0HRRuEkrFrE1hzR4Lipxj+bD6AqCPz5++/Bgp5tXfdv1CeAdPPmFmSkn0nE+a0drdFm6XiOkdKWEuKRptTXqlLuqqFNaM6Dkb+T5nbb+npo8WjZVinqFantFJk9bWojaRThq7HzKN8wiPJ7aCoJHEZN5zHvJp7RE1DTV6SnZ1fa/PL1MjJtF5HmnT2tJF3GZ/BIj05I8ULUtR6ypER7ogjxpw61rRGxEal4KYjNyORzatbUlHSxr06tFcBTHPiN5NUEJWzlZKG/aKRqYk5tl1IKgPafucZ7w+vxSluLP6olHnL6MQQfYV6bpk/+BRZXm+cXHEiApSipZHlE6tRBDMkxmyysl5VsmtjXiFoJmiZU35ZWK0oNv1OY+omSv0GDDKJCaMI42cHg25dvFCi6QZxVS6ViVSpLUz38A4oiS9ySjlW2althGWKZrN6XNuOVpbwq0ReIzqZhfTrHwE/PZZuEYqcnqO0tZQGxVqRylprLGIEDXNkLOKEakbYsYiiphmiQaEZuD9BghixiKSmGYJIueqBt4TRZEyHtHENCNyNtMaRREzHhHFNBOKnKv7myVcVXKka4WfRBXTjMjpypl8iBmP6MsOmed0Bgk1UHjxXlpORIAWIqeybyGtha1QEdNMRM5s7wLCGpTENBORE6AXNTHNkBM2QFFMM4F5ToX5TYiLqphmRE7YmMhimiEnJEb9XBdJOUlp4Qp1Mc1E5QQ4I/qyvFJCy8n8JnijEjXNAi3fQ0TwIEM6e2OqnAgII8kkptkgOZEQZlN6BquZjqhVFxlBOkZq4Z6WASAFQQ8jZwQJ70FK8CTiaeb3fDSLJyMiwiwiS/q0SkwEBE+85jYjSTpcTiSE2WQRtVlOpAMVemVdtjXmlZxICFlQk/TJjHcmYS96JJ0p6KmcZggKeWmVdPopYwgKuxJVUuQE+EU0Sd99KYICxJH0ry9DUIA/rFy3WyWnGYLCnqyQ9PCXERTgmJmSPvwlBAU4p1bUWklPP1yytA9JYWdGRtLLDyEowDUjomiRwQgKUIZnJC3OgREUoByPSDpkDyEkBfhJj6RNQ7xEUYA6aiS9Cdo8SUoUBaijVtCuFQwICtBGiajdawARFKCNK0HdVtEjKUAd0+Q0q9v/FklhJ1rmP4e8JEoUBejfq2jYNgtEUdgJzwN7u6dSSkBQyMSME7O7FyHUQpoLCqw8rv5o+d6Uw3NvfzjagUkAZvOlLH1lLMyx8wCzWBEhW3ZDmLZ7NTsrwCpmyui5A1+IPidigjcjhZy14/vytBYxwRsPMVcf/2c2QU72wQUVIgj5lqFyIiZEJ5qQb1me1gLMJLKM93wY9cVETYiGkphmg+RETFhJljY2LHICQB/uchI1AXxwlRMxAfwgrYVtUHvxwk1OoiaAL8MjJ2ICtOEip1q6APnJEBS6VwiRzp4vtM5YBvf3m/EeI8DyvUZK33z4+v1bqsZ7dN+3n2W6zwgMO44hY0X1vIqkXh419x7lXh9ds8oyviFyRqmcXrxf2FUtF89ymFkG6nI2p7WZB4FGvUWfLcVt4ahsdy+TR7ifz6lc0F5v0GfalmXldpE3esrr6PrTR84sjNjS4kpQhQhaUi4lD6KR1xK9DHupfoKoR02vSFDy9FWNoKVivv1/lG7OfZkqR043OZUbWgmtFaomaGl51ZTHCnFv5bqNnFGjZvRtEFUEHSHmI1ZHWgVBXZ5+sxvX7ANlPChpjKsknSllKaPlRU4nZo0Yjq6wiIJGFPMML2mj3M8ZRRe4QkzF6FhCJEFbBn4i0iKswn11yenZiLLKeMRqQdWiZSmlkqrcV9d0gPfksAcqBW+2ZqAoq5gZGSrnTtGwlVmCIqUepxWxerj7iIyNZ7SgiKmJhJw7NJpRgiKmLuHl3KnReA4UIaU+y+WkcbzHQ1DEzMGQ9aJH0BDK6RE0y9wlTDp2HuppERQxc0FFBaZGUMTMB5UlQG/fHyk1odJEaBUUMXWh4oSoFRQxtaHyxMi2uBseQwUKciUoYuaAShTlkaCImQcqUph7QREzF/8DSS/2GZ2/N/sAAAAASUVORK5CYII=",Ip="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOcAAACDCAYAAAB2kQxsAAAAAXNSR0IArs4c6QAABdRJREFUeJzt3d3N3TYMgGG16ADdoAhyl7UyV9bqXRB0g2zQXgRGDcOWSIoUaX3vAwQBknMk/4gWLcnHrQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACDEb9kb8FH99eeXf6Wf/efn35ynDyj1pEsb6G6NUxOYZ7sdB/QtPdnWRnn29gbKMYDUspPs0SgPb22cHANo/JG9AZF6wWBp3JLgeir36bvff3x9LOvzp2/dbSFA97bk5I4a9VMD7TXOUcP0uJ+d6emu5d6V1QvMs5nj8FZPx37X/b2TFpzShtnafeP0DipJMFnLnN3/w1OQ7tZgP+pA4VVKcHo0TG36KNULKGt5XsHZmi1APS5WM2Vqg0i7vbsG6YcIznN9vRTxXHavgdxtv6Tc3vc1pAHqdaG6ipwKYprpf1sFp6aH0gRTrxxLubPB2avHu+c/l3mICvqnsr//+Cq+qGrK1Xw/wzbBaRkNvSv3yew9cq+cu89L6nu6F/cMzCgzF1ftANlbe+Otp1IkDVxyVfbo6Z481f3507dhvXfbrk3HpdtjKTNqKuio8678c7mzF6ns6arfMyrVNoA75wMfNU2hKSeCx3Fq7dc+SPfDc39H9Vqn2CT//4bsYeT1PecOJyGSJdh6PZOlbElPZz2PHtlD1cUeS4LT4z5IOihwfNaD5ERm9qxH/dZ7Vmt9M999CtCZbdLUP/p3r2zFQ0paG8lr4Eb6+ZWBcSeq/qhyK6bXUfXOSgtO7/tOb9eT1NveqKttpYbiyXu/euV51JV16/T6e86zyF5TUp731V5Sp+Z7M71h9QvFNWWuvr0Sy4LzLfNvrel6zRX1e+hN2VzrnNlfaYD0xhCs++851lDh3vNV95xe6YvHgb8bwbNcuc+f09wbaUj2dzYgjz93//5kh94t0quCM8OKK6glKKuM0EYHfhUZWd8WwenZa0rLsp6s2YY66o0k9WUvS4NManBaGuo1eDIHgUZ1ePdkntsfFaCz5VZJdStsxyt7ziMNXHEAK5yk1mqmhrMPf1fcp57Vqe3SqZTMEduZhqAZyaywFne0DVHngHTZ11bznE88l/1lBZ9meP8851plWkBCO7drmQvWnL/sY/fKtFaqN3iy6iofsQxNktJnTMgfPXJUz3w3VaP5vOQ7Iyszvy2DczSi+aYFET2jINUEqFcAS4+rV480WlwRWXe07dLa0YGvfl9kmbTvPZJ1TXGvn4t4yuRp+2aMgk27wkm63DIztU3vOVfueC8wK4zKWtK0M+nvJXmOdlt65MgFFCva06qsKz044SvjIiN5TjLaaHxhtNyyouXBGZ1WSn66Ivt+M7pRZAWoZsDq+t2emeM1am/WtHxFG9runrO1/n1CxLK7CilxJM/H4bwuTJJBvWtgvm0gcNu01uvpd8la1soLE7xkpYDea4Ot6W3GOSzRc3o/qHw2M9qmXWA+uw+jbd0hyO9Yz0+vJ9QGcO/8ZV2YUqYVPN8dImXp3aJ/w1XTGGYfKZN+P7IXiXqO1uINLzFOm/Pz+BV4C03PNEqpZl//ELXP1ro8nhLyKLPHMyAiXyvh4cMFZ2uyAJXc62gzgJl1nhrSLMEzcLx+5qQnIhgqv6qhTHC2Zmus1tUuowCVDkRU6j0jgiJqhLPSSq2q7wMtMSBkdbcQWjNCq2nMlRrTnajAPP/t+c5Sj3K8VNueQ+pGzaa2MyOb2sZseW2dpL6ZnjMzfeQFt/Fe3XP2WIfGvRY6a569jCJ9TaIlcCS9KQE5p1TP2VrMbwLNDlZEvpE5AkGxh9f2nLO/QOetytIwAnMf6SfS2ns+jaZ6B4i2sWvSvF0HWOAj/aRGNFAaPXbw2rS2Rzr0T/ChshKNM3qd4135BCaqK9VAKy+lAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/4DBC0k0jFtF9wAAAAASUVORK5CYII=",qp="3001.0.0",x={k:null,globalOpt:null,gfx:null,game:null,app:null,assets:null,fontCacheCanvas:null,fontCacheC2d:null,debug:null,audio:null,pixelDensity:null,canvas:null,gscale:null,kaSprite:null,boomSprite:null},jp=p((i={})=>{x.k&&(console.warn("KAPLAY already initialized, you are calling kaplay() multiple times, it may lead bugs!"),x.k.quit()),x.globalOpt=i;let t=i.root??document.body;t===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let e=i.canvas??t.appendChild(document.createElement("canvas"));x.canvas=e;let s=i.scale??1;x.gscale=s;let r=i.width&&i.height&&!i.stretch&&!i.letterbox;r?(e.width=i.width*s,e.height=i.height*s):(e.width=e.parentElement.offsetWidth,e.height=e.parentElement.offsetHeight);let n=["outline: none","cursor: default"];if(r){let Q=e.width,ht=e.height;n.push(`width: ${Q}px`),n.push(`height: ${ht}px`)}else n.push("width: 100%"),n.push("height: 100%");i.crisp&&(n.push("image-rendering: pixelated"),n.push("image-rendering: crisp-edges")),e.style.cssText=n.join(";");let o=i.pixelDensity||1;x.pixelDensity=o,e.width*=o,e.height*=o,e.tabIndex=0;let a=document.createElement("canvas");a.width=256,a.height=256,x.fontCacheCanvas=a;let l=a.getContext("2d",{willReadFrequently:!0});x.fontCacheC2d=l;let c=Hd({canvas:e,touchToMouse:i.touchToMouse,gamepads:i.gamepads,pixelDensity:i.pixelDensity,maxFPS:i.maxFPS,buttons:i.buttons});x.app=c;let h=[],d=c.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});if(!d)throw new Error("WebGL not supported");let u=d,f=zu(u,{texFilter:i.texFilter}),y=gp(i,f);x.gfx=y;let v=Fp();x.audio=v;let g=fp(f);x.assets=g;let A=kp();x.game=A,A.root.use(Eo());function B(Q,ht){let dt=new Bo(f,Q,ht);return{clear:p(()=>dt.clear(),"clear"),free:p(()=>dt.free(),"free"),toDataURL:p(()=>dt.toDataURL(),"toDataURL"),toImageData:p(()=>dt.toImageData(),"toImageData"),width:dt.width,height:dt.height,draw:p(bt=>{ke(),dt.bind(),bt(),ke(),dt.unbind()},"draw")}}p(B,"makeCanvas");function F(){u.clear(u.COLOR_BUFFER_BIT),y.frameBuffer.bind(),u.clear(u.COLOR_BUFFER_BIT),y.bgColor||qi(()=>{Rr({width:te(),height:ie(),quad:new Vt(0,0,te()/64,ie()/64),tex:y.bgTex,fixed:!0})}),y.renderer.numDraws=0,y.fixed=!1,y.transformStack.length=0,y.transform=new _i}p(F,"frameStart");function E(Q,ht){y.postShader=Q,y.postShaderUniform=ht??null}p(E,"usePostEffect");function k(){ke(),y.lastDrawCalls=y.renderer.numDraws,y.frameBuffer.unbind(),u.viewport(0,0,u.drawingBufferWidth,u.drawingBufferHeight);let Q=y.width,ht=y.height;y.width=u.drawingBufferWidth/o,y.height=u.drawingBufferHeight/o,_n({flipY:!0,tex:y.frameBuffer.tex,pos:new j(y.viewport.x,y.viewport.y),width:y.viewport.width,height:y.viewport.height,shader:y.postShader,uniform:typeof y.postShaderUniform=="function"?y.postShaderUniform():y.postShaderUniform,fixed:!0}),ke(),y.width=Q,y.height=ht}p(k,"frameEnd");let w=!1,b={inspect:!1,timeScale:1,showLog:!0,fps:p(()=>c.fps(),"fps"),numFrames:p(()=>c.numFrames(),"numFrames"),stepFrame:he,drawCalls:p(()=>y.lastDrawCalls,"drawCalls"),clearLog:p(()=>A.logs=[],"clearLog"),log:p((...Q)=>{let ht=i.logMax??8,dt=Q.length>1?Q.concat(" ").join(" "):Q[0];A.logs.unshift({msg:dt,time:c.time()}),A.logs.length>ht&&(A.logs=A.logs.slice(0,ht))},"log"),error:p(Q=>b.log(new Error(Q.toString?Q.toString():Q)),"error"),curRecording:null,numObjects:p(()=>G("*",{recursive:!0}).length,"numObjects"),get paused(){return w},set paused(Q){w=Q,Q?v.ctx.suspend():v.ctx.resume()}};x.debug=b;function M(Q,ht){try{return JSON.parse(window.localStorage[Q])}catch{return ht?(V(Q,ht),ht):null}}p(M,"getData");function V(Q,ht){window.localStorage[Q]=JSON.stringify(ht)}p(V,"setData");function L(Q,...ht){let dt=Q(Gt),bt;typeof dt=="function"?bt=dt(...ht)(Gt):bt=dt;for(let Ht in bt)Gt[Ht]=bt[Ht],i.global!==!1&&(window[Ht]=bt[Ht]);return Gt}p(L,"plug");function z(Q){let ht=c.canvas.captureStream(Q),dt=v.ctx.createMediaStreamDestination();v.masterNode.connect(dt);let bt=new MediaRecorder(ht),Ht=[];return bt.ondataavailable=gt=>{gt.data.size>0&&Ht.push(gt.data)},bt.onerror=()=>{v.masterNode.disconnect(dt),ht.getTracks().forEach(gt=>gt.stop())},bt.start(),{resume(){bt.resume()},pause(){bt.pause()},stop(){return bt.stop(),v.masterNode.disconnect(dt),ht.getTracks().forEach(gt=>gt.stop()),new Promise(gt=>{bt.onstop=()=>{gt(new Blob(Ht,{type:"video/mp4"}))}})},download(gt="kaboom.mp4"){this.stop().then(ae=>ba(gt,ae))}}}p(z,"record");function O(){return document.activeElement===c.canvas}p(O,"isFocused");let H=A.root.add.bind(A.root),Y=A.root.readd.bind(A.root),tt=A.root.removeAll.bind(A.root),G=A.root.get.bind(A.root),Z=A.root.wait.bind(A.root),ot=A.root.loop.bind(A.root),W=A.root.query.bind(A.root),ct=A.root.tween.bind(A.root),ft=fr(null,Ip),X=fr(null,Vp);x.kaSprite=ft,x.boomSprite=X;function Zt(){A.root.fixedUpdate()}p(Zt,"fixedUpdateFrame");function he(){A.root.update()}p(he,"updateFrame");const ys=class ys{constructor(ht,dt,bt,Ht,gt=!1){S(this,"source");S(this,"target");S(this,"normal");S(this,"distance");S(this,"resolved",!1);this.source=ht,this.target=dt,this.normal=bt,this.distance=Ht,this.resolved=gt}get displacement(){return this.normal.scale(this.distance)}reverse(){return new ys(this.target,this.source,this.normal.scale(-1),this.distance,this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.cross(A.gravity||D(0,1))>0}isRight(){return this.displacement.cross(A.gravity||D(0,1))<0}isTop(){return this.displacement.dot(A.gravity||D(0,1))>0}isBottom(){return this.displacement.dot(A.gravity||D(0,1))<0}preventResolution(){this.resolved=!0}};p(ys,"Collision");let ve=ys;function xi(){if(!Om())return;let Q={},ht=i.hashGridSize||64,dt=new _i,bt=[];function Ht(gt){if(bt.push(dt.clone()),gt.pos&&dt.translate(gt.pos),gt.scale&&dt.scale(gt.scale),gt.angle&&dt.rotate(gt.angle),gt.transform=dt.clone(),gt.c("area")&&!gt.paused){let ae=gt,Hi=ae.worldArea().bbox(),Jo=Math.floor(Hi.pos.x/ht),Xo=Math.floor(Hi.pos.y/ht),In=Math.ceil((Hi.pos.x+Hi.width)/ht),qn=Math.ceil((Hi.pos.y+Hi.height)/ht),Hr=new Set;for(let Ke=Jo;Ke<=In;Ke++)for(let bi=Xo;bi<=qn;bi++)if(!Q[Ke])Q[Ke]={},Q[Ke][bi]=[ae];else if(!Q[Ke][bi])Q[Ke][bi]=[ae];else{let Gs=Q[Ke][bi];t:for(let Ie of Gs){if(Ie.paused||!Ie.exists()||Hr.has(Ie.id))continue;for(let Bi of ae.collisionIgnore)if(Ie.is(Bi))continue t;for(let Bi of Ie.collisionIgnore)if(ae.is(Bi))continue t;let Kr=Rc(ae.worldArea(),Ie.worldArea());if(Kr){let Bi=new ve(ae,Ie,Kr.normal,Kr.distance);ae.trigger("collideUpdate",Ie,Bi);let Yr=Bi.reverse();Yr.resolved=Bi.resolved,Ie.trigger("collideUpdate",ae,Yr)}Hr.add(Ie.id)}Gs.push(ae)}}gt.children.forEach(Ht),dt=bt.pop()}p(Ht,"checkObj"),Ht(A.root)}p(xi,"checkFrame");function Ui(Q){console.error(Q),v.ctx.suspend();let ht=Q.message??String(Q)??"Unknown error, check console for more info";c.run(()=>{},()=>{F(),qi(()=>{let dt=te(),bt=ie(),Ht={size:36,width:dt-32*2,letterSpacing:4,lineSpacing:4,font:wo,fixed:!0};Me({width:dt,height:bt,color:xt(0,0,255),fixed:!0});let gt=hs({...Ht,text:"Error",pos:D(32),color:xt(255,128,0),fixed:!0});cs(gt),Pa({...Ht,text:ht,pos:D(32,32+gt.height+16),fixed:!0}),fe(),A.events.trigger("error",Q)}),k()})}p(Ui,"handleErr");function ps(Q){h.push(Q)}p(ps,"onCleanup");function fs(){A.events.onOnce("frameEnd",()=>{c.quit(),u.clear(u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT|u.STENCIL_BUFFER_BIT);let Q=u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS);for(let ht=0;ht<Q;ht++)u.activeTexture(u.TEXTURE0+ht),u.bindTexture(u.TEXTURE_2D,null),u.bindTexture(u.TEXTURE_CUBE_MAP,null);u.bindBuffer(u.ARRAY_BUFFER,null),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,null),u.bindRenderbuffer(u.RENDERBUFFER,null),u.bindFramebuffer(u.FRAMEBUFFER,null),f.destroy(),h.forEach(ht=>ht())})}p(fs,"quit");let wi=!0;c.run(()=>{try{g.loaded&&(b.paused||Zt(),xi())}catch(Q){Ui(Q)}},(Q,ht)=>{try{Q(),g.loaded||as()===1&&!wi&&(g.loaded=!0,A.events.trigger("load")),!g.loaded&&i.loadingScreen!==!1||wi?(F(),Uu(),k()):(b.paused||he(),xi(),F(),Ou(),i.debug!==!1&&Nu(),k()),wi&&(wi=!1),A.events.trigger("frameEnd"),ht()}catch(dt){Ui(dt)}}),dl(),Al();let Gt={_k:x,VERSION:qp,loadRoot:xu,loadProgress:as,loadSprite:fr,loadSpriteAtlas:ll,loadSound:Iu,loadMusic:qu,loadBitmapFont:Fu,loadFont:ku,loadShader:Pu,loadShaderURL:Du,loadAseprite:Cu,loadPedit:Eu,loadBean:Bu,loadJSON:wu,load:bo,getSound:al,getFont:rl,getBitmapFont:nl,getSprite:el,getShader:ol,getAsset:bu,Asset:He,SpriteData:ls,SoundData:yn,width:te,height:ie,center:fn,dt:Xt,fixedDt:Ao,restDt:xo,time:c.time,screenshot:c.screenshot,record:z,isFocused:O,setCursor:c.setCursor,getCursor:c.getCursor,setCursorLocked:c.setCursorLocked,isCursorLocked:c.isCursorLocked,setFullscreen:c.setFullscreen,isFullscreen:c.isFullscreen,isTouchscreen:c.isTouchscreen,onLoad:Go,onLoading:fm,onResize:ym,onGamepadConnect:c.onGamepadConnect,onGamepadDisconnect:c.onGamepadDisconnect,onError:_m,onCleanup:ps,camPos:em,camScale:im,camFlash:rm,camRot:sm,camTransform:nm,shake:om,toScreen:Mo,toWorld:vl,setGravity:vm,getGravity:gm,setGravityDirection:Am,getGravityDirection:ln,setBackground:mu,getBackground:du,getGamepads:c.getGamepads,getTreeRoot:Cm,add:H,make:Wo,destroy:xl,destroyAll:tt,get:G,query:W,readd:Y,pos:vn,scale:gn,rotate:ed,color:pl,opacity:fl,anchor:So,area:Um,sprite:Fo,text:Sm,polygon:$u,rect:_l,circle:Gu,uvquad:Pm,outline:Qu,particles:Zu,body:Hm,surfaceEffector:Ym,areaEffector:Gm,pointEffector:Wm,buoyancyEffector:Xm,constantForce:Jm,doubleJump:Km,shader:tm,textInput:Nm,timer:Eo,fixed:kl,stay:Cl,health:Tm,lifespan:Lm,named:Rm,state:zm,z:id,layer:Zm,move:$m,offscreen:td,follow:Qm,fadeIn:Ju,mask:Xu,drawon:Wu,raycast:yl,tile:wl,animate:jm,serializeAnimation:Bl,agent:Dm,sentry:qm,patrol:Im,pathfinder:Vm,on:Ai,onFixedUpdate:xp,onUpdate:wp,onDraw:bp,onAdd:lm,onDestroy:Bp,onClick:Cp,onCollide:hm,onCollideUpdate:cm,onCollideEnd:um,onHover:mm,onHoverUpdate:dm,onHoverEnd:pm,onKeyDown:c.onKeyDown,onKeyPress:c.onKeyPress,onKeyPressRepeat:c.onKeyPressRepeat,onKeyRelease:c.onKeyRelease,onMouseDown:c.onMouseDown,onMousePress:c.onMousePress,onMouseRelease:c.onMouseRelease,onMouseMove:c.onMouseMove,onCharInput:c.onCharInput,onTouchStart:c.onTouchStart,onTouchMove:c.onTouchMove,onTouchEnd:c.onTouchEnd,onScroll:c.onScroll,onHide:c.onHide,onShow:c.onShow,onGamepadButtonDown:c.onGamepadButtonDown,onGamepadButtonPress:c.onGamepadButtonPress,onGamepadButtonRelease:c.onGamepadButtonRelease,onGamepadStick:c.onGamepadStick,onButtonPress:c.onButtonPress,onButtonDown:c.onButtonDown,onButtonRelease:c.onButtonRelease,mousePos:$a,mouseDeltaPos:c.mouseDeltaPos,isKeyDown:c.isKeyDown,isKeyPressed:c.isKeyPressed,isKeyPressedRepeat:c.isKeyPressedRepeat,isKeyReleased:c.isKeyReleased,isMouseDown:c.isMouseDown,isMousePressed:c.isMousePressed,isMouseReleased:c.isMouseReleased,isMouseMoved:c.isMouseMoved,isGamepadButtonPressed:c.isGamepadButtonPressed,isGamepadButtonDown:c.isGamepadButtonDown,isGamepadButtonReleased:c.isGamepadButtonReleased,getGamepadStick:c.getGamepadStick,isButtonPressed:c.isButtonPressed,isButtonDown:c.isButtonDown,isButtonReleased:c.isButtonReleased,setButton:c.setButton,getButton:c.getButton,pressButton:c.pressButton,releaseButton:c.releaseButton,getLastInputDeviceType:c.getLastInputDeviceType,charInputted:c.charInputted,loop:ot,wait:Z,play:wm,volume:bm,burp:gl,audioCtx:v.ctx,Line:De,Rect:Et,Circle:Ee,Ellipse:Ni,Point:Sd,Polygon:_e,Vec2:j,Color:ut,Mat4:_i,Quad:Vt,RNG:sc,rand:Jt,randi:Ta,randSeed:rc,vec2:D,rgb:xt,hsl2rgb:Md,quad:Nt,choose:ac,chooseMultiple:oc,shuffle:La,chance:nc,lerp:ye,tween:ct,easings:pn,map:$e,mapc:ic,wave:ja,deg2rad:Ut,rad2deg:os,clamp:yi,evaluateQuadratic:bc,evaluateQuadraticFirstDerivative:Bc,evaluateQuadraticSecondDerivative:Cc,evaluateBezier:Ro,evaluateBezierFirstDerivative:kc,evaluateBezierSecondDerivative:Mc,evaluateCatmullRom:Fc,evaluateCatmullRomFirstDerivative:Ec,curveLengthApproximation:Ga,normalizedCurve:Sc,hermite:Ur,cardinal:Wa,catmullRom:mn,bezier:Pc,kochanekBartels:Dc,easingSteps:Lc,easingLinear:jc,easingCubicBezier:Tc,testLineLine:Vo,testRectRect:Ra,testRectLine:Io,testRectPoint:Cn,testCirclePolygon:Mn,testLinePoint:qo,testLineCircle:Or,isConvex:Hc,triangulate:Xa,NavMesh:ip,drawSprite:Ku,drawText:Pa,formatText:hs,drawRect:Me,drawLine:mr,drawLines:Yo,drawTriangle:ul,drawCircle:Os,drawEllipse:hl,drawUVQuad:Rr,drawPolygon:Ti,drawCurve:cl,drawBezier:Ru,drawFormattedText:cs,drawMasked:Hu,drawSubtracted:Yu,pushTransform:Ce,popTransform:fe,pushTranslate:Dt,pushScale:Lr,pushRotate:Ls,pushMatrix:pu,usePostEffect:E,makeCanvas:B,debug:b,scene:km,getSceneName:Em,go:Mm,onSceneLeave:Fm,layers:Ep,addLevel:am,getData:M,setData:V,download:zo,downloadJSON:Wc,downloadText:Qa,downloadBlob:ba,plug:L,ASCII_CHARS:_u,canvas:c.canvas,addKaboom:Bm,LEFT:j.LEFT,RIGHT:j.RIGHT,UP:j.UP,DOWN:j.DOWN,RED:ut.RED,GREEN:ut.GREEN,BLUE:ut.BLUE,YELLOW:ut.YELLOW,MAGENTA:ut.MAGENTA,CYAN:ut.CYAN,WHITE:ut.WHITE,BLACK:ut.BLACK,quit:fs,KEvent:Be,KEventHandler:dn,KEventController:zs};x.k=Gt;let Vn=i.plugins;if(Vn&&Vn.forEach(L),i.global!==!1)for(let Q in Gt)window[Q]=Gt[Q];return i.focus!==!1&&c.canvas.focus(),Gt},"kaplay"),Tp=jp;/**
 * Planck.js v1.1.2
 * @license The MIT license
 * @copyright Copyright (c) 2024 Erin Catto, Ali Shakiba
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var qa=function(i,t){return qa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,s){e.__proto__=s}||function(e,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])},qa(i,t)};function oe(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");qa(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var ne=function(){return ne=Object.assign||function(t){for(var e,s=1,r=arguments.length;s<r;s++){e=arguments[s];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},ne.apply(this,arguments)},Ve=function(i,t){(i===null||typeof i>"u")&&(i={});var e=ne({},i);for(var s in t)t.hasOwnProperty(s)&&typeof i[s]>"u"&&(e[s]=t[s]);if(typeof Object.getOwnPropertySymbols=="function")for(var r=Object.getOwnPropertySymbols(t),n=0;n<r.length;n++){var o=r[n];t.propertyIsEnumerable(o)&&typeof i[o]>"u"&&(e[o]=t[o])}return e},Lp=Math.random,Fe=1e-9,Rp=Number.isFinite;function zp(i){return i|=i>>1,i|=i>>2,i|=i>>4,i|=i>>8,i|=i>>16,i+1}function Np(i){return i>0&&(i&i-1)===0}function sd(i,t,e){return typeof t>"u"?(e=1,t=0):typeof e>"u"&&(e=t,t=0),e>t?(i=(i-t)%(e-t),i+(i<0?e:t)):(i=(i-e)%(t-e),i+(i<=0?t:e))}function se(i,t,e){return i<t?t:i>e?e:i}function Op(i,t){return typeof i>"u"?(t=1,i=0):typeof t>"u"&&(t=i,i=0),i===t?i:Lp()*(t-i)+i}var Us=Object.create(Math);Us.EPSILON=Fe;Us.isFinite=Rp;Us.nextPowerOfTwo=zp;Us.isPowerOfTwo=Np;Us.mod=sd;Us.clamp=se;Us.random=Op;var Wl=Math.abs,ea=Math.sqrt,Jl=Math.max,Xl=Math.min,m=function(){function i(t,e){if(!(this instanceof i))return new i(t,e);typeof t>"u"?(this.x=0,this.y=0):typeof t=="object"?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}return i.prototype._serialize=function(){return{x:this.x,y:this.y}},i._deserialize=function(t){var e=Object.create(i.prototype);return e.x=t.x,e.y=t.y,e},i.zero=function(){var t=Object.create(i.prototype);return t.x=0,t.y=0,t},i.neo=function(t,e){var s=Object.create(i.prototype);return s.x=t,s.y=e,s},i.clone=function(t){return i.neo(t.x,t.y)},i.prototype.toString=function(){return JSON.stringify(this)},i.isValid=function(t){return t===null||typeof t>"u"?!1:Number.isFinite(t.x)&&Number.isFinite(t.y)},i.assert=function(t){},i.prototype.clone=function(){return i.clone(this)},i.prototype.setZero=function(){return this.x=0,this.y=0,this},i.prototype.set=function(t,e){return typeof t=="object"?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),this},i.prototype.setNum=function(t,e){return this.x=t,this.y=e,this},i.prototype.setVec2=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.wSet=function(t,e,s,r){return typeof s<"u"||typeof r<"u"?this.setCombine(t,e,s,r):this.setMul(t,e)},i.prototype.setCombine=function(t,e,s,r){var n=t*e.x+s*r.x,o=t*e.y+s*r.y;return this.x=n,this.y=o,this},i.prototype.setMul=function(t,e){var s=t*e.x,r=t*e.y;return this.x=s,this.y=r,this},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},i.prototype.wAdd=function(t,e,s,r){return typeof s<"u"||typeof r<"u"?this.addCombine(t,e,s,r):this.addMul(t,e)},i.prototype.addCombine=function(t,e,s,r){var n=t*e.x+s*r.x,o=t*e.y+s*r.y;return this.x+=n,this.y+=o,this},i.prototype.addMul=function(t,e){var s=t*e.x,r=t*e.y;return this.x+=s,this.y+=r,this},i.prototype.wSub=function(t,e,s,r){return typeof s<"u"||typeof r<"u"?this.subCombine(t,e,s,r):this.subMul(t,e)},i.prototype.subCombine=function(t,e,s,r){var n=t*e.x+s*r.x,o=t*e.y+s*r.y;return this.x-=n,this.y-=o,this},i.prototype.subMul=function(t,e){var s=t*e.x,r=t*e.y;return this.x-=s,this.y-=r,this},i.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.mul=function(t){return this.x*=t,this.y*=t,this},i.prototype.length=function(){return i.lengthOf(this)},i.prototype.lengthSquared=function(){return i.lengthSquared(this)},i.prototype.normalize=function(){var t=this.length();if(t<Fe)return 0;var e=1/t;return this.x*=e,this.y*=e,t},i.lengthOf=function(t){return ea(t.x*t.x+t.y*t.y)},i.lengthSquared=function(t){return t.x*t.x+t.y*t.y},i.distance=function(t,e){var s=t.x-e.x,r=t.y-e.y;return ea(s*s+r*r)},i.distanceSquared=function(t,e){var s=t.x-e.x,r=t.y-e.y;return s*s+r*r},i.areEqual=function(t,e){return t===e||typeof e=="object"&&e!==null&&t.x===e.x&&t.y===e.y},i.skew=function(t){return i.neo(-t.y,t.x)},i.dot=function(t,e){return t.x*e.x+t.y*e.y},i.cross=function(t,e){return typeof e=="number"?i.neo(e*t.y,-e*t.x):typeof t=="number"?i.neo(-t*e.y,t*e.x):t.x*e.y-t.y*e.x},i.crossVec2Vec2=function(t,e){return t.x*e.y-t.y*e.x},i.crossVec2Num=function(t,e){return i.neo(e*t.y,-e*t.x)},i.crossNumVec2=function(t,e){return i.neo(-t*e.y,t*e.x)},i.addCross=function(t,e,s){if(typeof s=="number")return i.neo(s*e.y+t.x,-s*e.x+t.y);if(typeof e=="number")return i.neo(-e*s.y+t.x,e*s.x+t.y)},i.addCrossVec2Num=function(t,e,s){return i.neo(s*e.y+t.x,-s*e.x+t.y)},i.addCrossNumVec2=function(t,e,s){return i.neo(-e*s.y+t.x,e*s.x+t.y)},i.add=function(t,e){return i.neo(t.x+e.x,t.y+e.y)},i.wAdd=function(t,e,s,r){return typeof s<"u"||typeof r<"u"?i.combine(t,e,s,r):i.mulNumVec2(t,e)},i.combine=function(t,e,s,r){return i.zero().setCombine(t,e,s,r)},i.sub=function(t,e){return i.neo(t.x-e.x,t.y-e.y)},i.mul=function(t,e){if(typeof t=="object")return i.neo(t.x*e,t.y*e);if(typeof e=="object")return i.neo(t*e.x,t*e.y)},i.mulVec2Num=function(t,e){return i.neo(t.x*e,t.y*e)},i.mulNumVec2=function(t,e){return i.neo(t*e.x,t*e.y)},i.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},i.neg=function(t){return i.neo(-t.x,-t.y)},i.abs=function(t){return i.neo(Wl(t.x),Wl(t.y))},i.mid=function(t,e){return i.neo((t.x+e.x)*.5,(t.y+e.y)*.5)},i.upper=function(t,e){return i.neo(Jl(t.x,e.x),Jl(t.y,e.y))},i.lower=function(t,e){return i.neo(Xl(t.x,e.x),Xl(t.y,e.y))},i.prototype.clamp=function(t){var e=this.x*this.x+this.y*this.y;if(e>t*t){var s=t/ea(e);this.x*=s,this.y*=s}return this},i.clamp=function(t,e){var s=i.neo(t.x,t.y);return s.clamp(e),s},i.scaleFn=function(t,e){return function(s){return i.neo(s.x*t,s.y*e)}},i.translateFn=function(t,e){return function(s){return i.neo(s.x+t,s.y+e)}},i}(),je=Math.max,Ye=Math.min,Wt=function(){function i(t,e){if(!(this instanceof i))return new i(t,e);this.lowerBound=m.zero(),this.upperBound=m.zero(),typeof t=="object"&&this.lowerBound.setVec2(t),typeof e=="object"?this.upperBound.setVec2(e):typeof t=="object"&&this.upperBound.setVec2(t)}return i.prototype.isValid=function(){return i.isValid(this)},i.isValid=function(t){return t===null||typeof t>"u"?!1:m.isValid(t.lowerBound)&&m.isValid(t.upperBound)&&m.sub(t.upperBound,t.lowerBound).lengthSquared()>=0},i.assert=function(t){},i.prototype.getCenter=function(){return m.neo((this.lowerBound.x+this.upperBound.x)*.5,(this.lowerBound.y+this.upperBound.y)*.5)},i.prototype.getExtents=function(){return m.neo((this.upperBound.x-this.lowerBound.x)*.5,(this.upperBound.y-this.lowerBound.y)*.5)},i.prototype.getPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+this.upperBound.y-this.lowerBound.y)},i.prototype.combine=function(t,e){e=e||this;var s=t.lowerBound,r=t.upperBound,n=e.lowerBound,o=e.upperBound,a=Ye(s.x,n.x),l=Ye(s.y,n.y),c=je(o.x,r.x),h=je(o.y,r.y);this.lowerBound.setNum(a,l),this.upperBound.setNum(c,h)},i.prototype.combinePoints=function(t,e){this.lowerBound.setNum(Ye(t.x,e.x),Ye(t.y,e.y)),this.upperBound.setNum(je(t.x,e.x),je(t.y,e.y))},i.prototype.set=function(t){this.lowerBound.setNum(t.lowerBound.x,t.lowerBound.y),this.upperBound.setNum(t.upperBound.x,t.upperBound.y)},i.prototype.contains=function(t){var e=!0;return e=e&&this.lowerBound.x<=t.lowerBound.x,e=e&&this.lowerBound.y<=t.lowerBound.y,e=e&&t.upperBound.x<=this.upperBound.x,e=e&&t.upperBound.y<=this.upperBound.y,e},i.prototype.extend=function(t){return i.extend(this,t),this},i.extend=function(t,e){return t.lowerBound.x-=e,t.lowerBound.y-=e,t.upperBound.x+=e,t.upperBound.y+=e,t},i.testOverlap=function(t,e){var s=e.lowerBound.x-t.upperBound.x,r=t.lowerBound.x-e.upperBound.x,n=e.lowerBound.y-t.upperBound.y,o=t.lowerBound.y-e.upperBound.y;return!(s>0||n>0||r>0||o>0)},i.areEqual=function(t,e){return m.areEqual(t.lowerBound,e.lowerBound)&&m.areEqual(t.upperBound,e.upperBound)},i.diff=function(t,e){var s=je(0,Ye(t.upperBound.x,e.upperBound.x)-je(e.lowerBound.x,t.lowerBound.x)),r=je(0,Ye(t.upperBound.y,e.upperBound.y)-je(e.lowerBound.y,t.lowerBound.y)),n=t.upperBound.x-t.lowerBound.x,o=t.upperBound.y-t.lowerBound.y,a=e.upperBound.x-e.lowerBound.x,l=e.upperBound.y-e.lowerBound.y;return n*o+a*l-s*r},i.prototype.rayCast=function(t,e){for(var s=-1/0,r=1/0,n=e.p1,o=m.sub(e.p2,e.p1),a=m.abs(o),l=m.zero(),c="x";c!==null;c=c==="x"?"y":null)if(a.x<Fe){if(n[c]<this.lowerBound[c]||this.upperBound[c]<n[c])return!1}else{var h=1/o[c],d=(this.lowerBound[c]-n[c])*h,u=(this.upperBound[c]-n[c])*h,f=-1;if(d>u){var y=d;d=u,u=y,f=1}if(d>s&&(l.setZero(),l[c]=f,s=d),r=Ye(r,u),s>r)return!1}return s<0||e.maxFraction<s?!1:(t.fraction=s,t.normal=l,!0)},i.prototype.toString=function(){return JSON.stringify(this)},i.combinePoints=function(t,e,s){return t.lowerBound.x=Ye(e.x,s.x),t.lowerBound.y=Ye(e.y,s.y),t.upperBound.x=je(e.x,s.x),t.upperBound.y=je(e.y,s.y),t},i.combinedPerimeter=function(t,e){var s=Ye(t.lowerBound.x,e.lowerBound.x),r=Ye(t.lowerBound.y,e.lowerBound.y),n=je(t.upperBound.x,e.upperBound.x),o=je(t.upperBound.y,e.upperBound.y);return 2*(n-s+o-r)},i}(),Rn=Math.PI,rt=function(){function i(){}return Object.defineProperty(i,"polygonRadius",{get:function(){return 2*i.linearSlop},enumerable:!1,configurable:!0}),i.lengthUnitsPerMeter=1,i.maxManifoldPoints=2,i.maxPolygonVertices=12,i.aabbExtension=.1,i.aabbMultiplier=2,i.linearSlop=.005,i.angularSlop=2/180*Rn,i.maxSubSteps=8,i.maxTOIContacts=32,i.maxTOIIterations=20,i.maxDistanceIterations=20,i.velocityThreshold=1,i.maxLinearCorrection=.2,i.maxAngularCorrection=8/180*Rn,i.maxTranslation=2,i.maxRotation=.5*Rn,i.baumgarte=.2,i.toiBaugarte=.75,i.timeToSleep=.5,i.linearSleepTolerance=.01,i.angularSleepTolerance=2/180*Rn,i}(),K=function(){function i(){}return Object.defineProperty(i,"maxManifoldPoints",{get:function(){return rt.maxManifoldPoints},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxPolygonVertices",{get:function(){return rt.maxPolygonVertices},enumerable:!1,configurable:!0}),Object.defineProperty(i,"aabbExtension",{get:function(){return rt.aabbExtension*rt.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"aabbMultiplier",{get:function(){return rt.aabbMultiplier},enumerable:!1,configurable:!0}),Object.defineProperty(i,"linearSlop",{get:function(){return rt.linearSlop*rt.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"linearSlopSquared",{get:function(){return rt.linearSlop*rt.lengthUnitsPerMeter*rt.linearSlop*rt.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"angularSlop",{get:function(){return rt.angularSlop},enumerable:!1,configurable:!0}),Object.defineProperty(i,"polygonRadius",{get:function(){return 2*rt.linearSlop},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxSubSteps",{get:function(){return rt.maxSubSteps},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxTOIContacts",{get:function(){return rt.maxTOIContacts},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxTOIIterations",{get:function(){return rt.maxTOIIterations},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxDistanceIterations",{get:function(){return rt.maxDistanceIterations},enumerable:!1,configurable:!0}),Object.defineProperty(i,"velocityThreshold",{get:function(){return rt.velocityThreshold*rt.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxLinearCorrection",{get:function(){return rt.maxLinearCorrection*rt.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxAngularCorrection",{get:function(){return rt.maxAngularCorrection},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxTranslation",{get:function(){return rt.maxTranslation*rt.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxTranslationSquared",{get:function(){return rt.maxTranslation*rt.lengthUnitsPerMeter*rt.maxTranslation*rt.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxRotation",{get:function(){return rt.maxRotation},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxRotationSquared",{get:function(){return rt.maxRotation*rt.maxRotation},enumerable:!1,configurable:!0}),Object.defineProperty(i,"baumgarte",{get:function(){return rt.baumgarte},enumerable:!1,configurable:!0}),Object.defineProperty(i,"toiBaugarte",{get:function(){return rt.toiBaugarte},enumerable:!1,configurable:!0}),Object.defineProperty(i,"timeToSleep",{get:function(){return rt.timeToSleep},enumerable:!1,configurable:!0}),Object.defineProperty(i,"linearSleepTolerance",{get:function(){return rt.linearSleepTolerance*rt.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"linearSleepToleranceSqr",{get:function(){return rt.linearSleepTolerance*rt.lengthUnitsPerMeter*rt.linearSleepTolerance*rt.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"angularSleepTolerance",{get:function(){return rt.angularSleepTolerance},enumerable:!1,configurable:!0}),Object.defineProperty(i,"angularSleepToleranceSqr",{get:function(){return rt.angularSleepTolerance*rt.angularSleepTolerance},enumerable:!1,configurable:!0}),i}(),hn=function(){function i(t){this._list=[],this._max=1/0,this._hasCreateFn=!1,this._createCount=0,this._hasAllocateFn=!1,this._allocateCount=0,this._hasReleaseFn=!1,this._releaseCount=0,this._hasDisposeFn=!1,this._disposeCount=0,this._list=[],this._max=t.max||this._max,this._createFn=t.create,this._hasCreateFn=typeof this._createFn=="function",this._allocateFn=t.allocate,this._hasAllocateFn=typeof this._allocateFn=="function",this._releaseFn=t.release,this._hasReleaseFn=typeof this._releaseFn=="function",this._disposeFn=t.dispose,this._hasDisposeFn=typeof this._disposeFn=="function"}return i.prototype.max=function(t){return typeof t=="number"?(this._max=t,this):this._max},i.prototype.size=function(){return this._list.length},i.prototype.allocate=function(){var t;return this._list.length>0?t=this._list.shift():(this._createCount++,this._hasCreateFn?t=this._createFn():t={}),this._allocateCount++,this._hasAllocateFn&&this._allocateFn(t),t},i.prototype.release=function(t){this._list.length<this._max?(this._releaseCount++,this._hasReleaseFn&&this._releaseFn(t),this._list.push(t)):(this._disposeCount++,this._hasDisposeFn&&(t=this._disposeFn(t)))},i.prototype.toString=function(){return" +"+this._createCount+" >"+this._allocateCount+" <"+this._releaseCount+" -"+this._disposeCount+" ="+this._list.length+"/"+this._max},i}(),Ql=Math.abs,Ae=Math.max,Up=function(){function i(t){this.aabb=new Wt,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=-1,this.id=t}return i.prototype.toString=function(){return this.id+": "+this.userData},i.prototype.isLeaf=function(){return this.child1==null},i}(),Zl=new hn({create:function(){return new Up},release:function(i){i.userData=null,i.parent=null,i.child1=null,i.child2=null,i.height=-1,i.id=void 0}}),Hp=function(){function i(){this.inputPool=new hn({create:function(){return{}},release:function(t){}}),this.stackPool=new hn({create:function(){return[]},release:function(t){t.length=0}}),this.iteratorPool=new hn({create:function(){return new Kp},release:function(t){t.close()}}),this.m_root=null,this.m_nodes={},this.m_lastProxyId=0}return i.prototype.getUserData=function(t){var e=this.m_nodes[t];return e.userData},i.prototype.getFatAABB=function(t){var e=this.m_nodes[t];return e.aabb},i.prototype.allocateNode=function(){var t=Zl.allocate();return t.id=++this.m_lastProxyId,this.m_nodes[t.id]=t,t},i.prototype.freeNode=function(t){delete this.m_nodes[t.id],Zl.release(t)},i.prototype.createProxy=function(t,e){var s=this.allocateNode();return s.aabb.set(t),Wt.extend(s.aabb,K.aabbExtension),s.userData=e,s.height=0,this.insertLeaf(s),s.id},i.prototype.destroyProxy=function(t){var e=this.m_nodes[t];this.removeLeaf(e),this.freeNode(e)},i.prototype.moveProxy=function(t,e,s){var r=this.m_nodes[t];return r.aabb.contains(e)?!1:(this.removeLeaf(r),r.aabb.set(e),e=r.aabb,Wt.extend(e,K.aabbExtension),s.x<0?e.lowerBound.x+=s.x*K.aabbMultiplier:e.upperBound.x+=s.x*K.aabbMultiplier,s.y<0?e.lowerBound.y+=s.y*K.aabbMultiplier:e.upperBound.y+=s.y*K.aabbMultiplier,this.insertLeaf(r),!0)},i.prototype.insertLeaf=function(t){if(this.m_root==null){this.m_root=t,this.m_root.parent=null;return}for(var e=t.aabb,s=this.m_root;!s.isLeaf();){var r=s.child1,n=s.child2,o=s.aabb.getPerimeter(),a=Wt.combinedPerimeter(s.aabb,e),l=2*a,c=2*(a-o),h=Wt.combinedPerimeter(e,r.aabb),d=h+c;if(!r.isLeaf()){var u=r.aabb.getPerimeter();d-=u}var f=Wt.combinedPerimeter(e,n.aabb),y=f+c;if(!n.isLeaf()){var u=n.aabb.getPerimeter();y-=u}if(l<d&&l<y)break;d<y?s=r:s=n}var v=s,g=v.parent,A=this.allocateNode();for(A.parent=g,A.userData=null,A.aabb.combine(e,v.aabb),A.height=v.height+1,g!=null?(g.child1===v?g.child1=A:g.child2=A,A.child1=v,A.child2=t,v.parent=A,t.parent=A):(A.child1=v,A.child2=t,v.parent=A,t.parent=A,this.m_root=A),s=t.parent;s!=null;){s=this.balance(s);var r=s.child1,n=s.child2;s.height=1+Ae(r.height,n.height),s.aabb.combine(r.aabb,n.aabb),s=s.parent}},i.prototype.removeLeaf=function(t){if(t===this.m_root){this.m_root=null;return}var e=t.parent,s=e.parent,r;if(e.child1===t?r=e.child2:r=e.child1,s!=null){s.child1===e?s.child1=r:s.child2=r,r.parent=s,this.freeNode(e);for(var n=s;n!=null;){n=this.balance(n);var o=n.child1,a=n.child2;n.aabb.combine(o.aabb,a.aabb),n.height=1+Ae(o.height,a.height),n=n.parent}}else this.m_root=r,r.parent=null,this.freeNode(e)},i.prototype.balance=function(t){var e=t;if(e.isLeaf()||e.height<2)return t;var s=e.child1,r=e.child2,n=r.height-s.height;if(n>1){var o=r.child1,a=r.child2;return r.child1=e,r.parent=e.parent,e.parent=r,r.parent!=null?r.parent.child1===t?r.parent.child1=r:r.parent.child2=r:this.m_root=r,o.height>a.height?(r.child2=o,e.child2=a,a.parent=e,e.aabb.combine(s.aabb,a.aabb),r.aabb.combine(e.aabb,o.aabb),e.height=1+Ae(s.height,a.height),r.height=1+Ae(e.height,o.height)):(r.child2=a,e.child2=o,o.parent=e,e.aabb.combine(s.aabb,o.aabb),r.aabb.combine(e.aabb,a.aabb),e.height=1+Ae(s.height,o.height),r.height=1+Ae(e.height,a.height)),r}if(n<-1){var l=s.child1,c=s.child2;return s.child1=e,s.parent=e.parent,e.parent=s,s.parent!=null?s.parent.child1===e?s.parent.child1=s:s.parent.child2=s:this.m_root=s,l.height>c.height?(s.child2=l,e.child1=c,c.parent=e,e.aabb.combine(r.aabb,c.aabb),s.aabb.combine(e.aabb,l.aabb),e.height=1+Ae(r.height,c.height),s.height=1+Ae(e.height,l.height)):(s.child2=c,e.child1=l,l.parent=e,e.aabb.combine(r.aabb,l.aabb),s.aabb.combine(e.aabb,c.aabb),e.height=1+Ae(r.height,l.height),s.height=1+Ae(e.height,c.height)),s}return e},i.prototype.getHeight=function(){return this.m_root==null?0:this.m_root.height},i.prototype.getAreaRatio=function(){if(this.m_root==null)return 0;for(var t=this.m_root,e=t.aabb.getPerimeter(),s=0,r,n=this.iteratorPool.allocate().preorder(this.m_root);r=n.next();)r.height<0||(s+=r.aabb.getPerimeter());return this.iteratorPool.release(n),s/e},i.prototype.computeHeight=function(t){var e;if(typeof t<"u"?e=this.m_nodes[t]:e=this.m_root,e.isLeaf())return 0;var s=this.computeHeight(e.child1.id),r=this.computeHeight(e.child2.id);return 1+Ae(s,r)},i.prototype.validateStructure=function(t){if(t!=null){this.m_root;var e=t.child1,s=t.child2;t.isLeaf()||(this.validateStructure(e),this.validateStructure(s))}},i.prototype.validateMetrics=function(t){if(t!=null){var e=t.child1,s=t.child2;if(!t.isLeaf()){e.height,s.height;var r=new Wt;r.combine(e.aabb,s.aabb),this.validateMetrics(e),this.validateMetrics(s)}}},i.prototype.validate=function(){},i.prototype.getMaxBalance=function(){for(var t=0,e,s=this.iteratorPool.allocate().preorder(this.m_root);e=s.next();)if(!(e.height<=1)){var r=Ql(e.child2.height-e.child1.height);t=Ae(t,r)}return this.iteratorPool.release(s),t},i.prototype.rebuildBottomUp=function(){for(var t=[],e=0,s,r=this.iteratorPool.allocate().preorder(this.m_root);s=r.next();)s.height<0||(s.isLeaf()?(s.parent=null,t[e]=s,++e):this.freeNode(s));for(this.iteratorPool.release(r);e>1;){for(var n=1/0,o=-1,a=-1,l=0;l<e;++l)for(var c=t[l].aabb,h=l+1;h<e;++h){var d=t[h].aabb,u=Wt.combinedPerimeter(c,d);u<n&&(o=l,a=h,n=u)}var f=t[o],y=t[a],v=this.allocateNode();v.child1=f,v.child2=y,v.height=1+Ae(f.height,y.height),v.aabb.combine(f.aabb,y.aabb),v.parent=null,f.parent=v,y.parent=v,t[a]=t[e-1],t[o]=v,--e}this.m_root=t[0]},i.prototype.shiftOrigin=function(t){for(var e,s=this.iteratorPool.allocate().preorder(this.m_root);e=s.next();){var r=e.aabb;r.lowerBound.x-=t.x,r.lowerBound.y-=t.y,r.upperBound.x-=t.x,r.upperBound.y-=t.y}this.iteratorPool.release(s)},i.prototype.query=function(t,e){var s=this.stackPool.allocate();for(s.push(this.m_root);s.length>0;){var r=s.pop();if(r!=null&&Wt.testOverlap(r.aabb,t))if(r.isLeaf()){var n=e(r.id);if(n===!1)return}else s.push(r.child1),s.push(r.child2)}this.stackPool.release(s)},i.prototype.rayCast=function(t,e){var s=t.p1,r=t.p2,n=m.sub(r,s);n.normalize();var o=m.crossNumVec2(1,n),a=m.abs(o),l=t.maxFraction,c=new Wt,h=m.combine(1-l,s,l,r);c.combinePoints(s,h);var d=this.stackPool.allocate(),u=this.inputPool.allocate();for(d.push(this.m_root);d.length>0;){var f=d.pop();if(f!=null&&Wt.testOverlap(f.aabb,c)!==!1){var y=f.aabb.getCenter(),v=f.aabb.getExtents(),g=Ql(m.dot(o,m.sub(s,y)))-m.dot(a,v);if(!(g>0))if(f.isLeaf()){u.p1=m.clone(t.p1),u.p2=m.clone(t.p2),u.maxFraction=l;var A=e(u,f.id);if(A===0)break;A>0&&(l=A,h=m.combine(1-l,s,l,r),c.combinePoints(s,h))}else d.push(f.child1),d.push(f.child2)}}this.stackPool.release(d),this.inputPool.release(u)},i}(),Kp=function(){function i(){this.parents=[],this.states=[]}return i.prototype.preorder=function(t){return this.parents.length=0,this.parents.push(t),this.states.length=0,this.states.push(0),this},i.prototype.next=function(){for(;this.parents.length>0;){var t=this.parents.length-1,e=this.parents[t];if(this.states[t]===0)return this.states[t]=1,e;if(this.states[t]===1&&(this.states[t]=2,e.child1))return this.parents.push(e.child1),this.states.push(1),e.child1;if(this.states[t]===2&&(this.states[t]=3,e.child2))return this.parents.push(e.child2),this.states.push(1),e.child2;this.parents.pop(),this.states.pop()}},i.prototype.close=function(){this.parents.length=0},i}(),Yp=Math.max,Gp=Math.min,Wp=function(){function i(){var t=this;this.m_tree=new Hp,this.m_moveBuffer=[],this.query=function(e,s){t.m_tree.query(e,s)},this.queryCallback=function(e){if(e===t.m_queryProxyId)return!0;var s=Gp(e,t.m_queryProxyId),r=Yp(e,t.m_queryProxyId),n=t.m_tree.getUserData(s),o=t.m_tree.getUserData(r);return t.m_callback(n,o),!0}}return i.prototype.getUserData=function(t){return this.m_tree.getUserData(t)},i.prototype.testOverlap=function(t,e){var s=this.m_tree.getFatAABB(t),r=this.m_tree.getFatAABB(e);return Wt.testOverlap(s,r)},i.prototype.getFatAABB=function(t){return this.m_tree.getFatAABB(t)},i.prototype.getProxyCount=function(){return this.m_moveBuffer.length},i.prototype.getTreeHeight=function(){return this.m_tree.getHeight()},i.prototype.getTreeBalance=function(){return this.m_tree.getMaxBalance()},i.prototype.getTreeQuality=function(){return this.m_tree.getAreaRatio()},i.prototype.rayCast=function(t,e){this.m_tree.rayCast(t,e)},i.prototype.shiftOrigin=function(t){this.m_tree.shiftOrigin(t)},i.prototype.createProxy=function(t,e){var s=this.m_tree.createProxy(t,e);return this.bufferMove(s),s},i.prototype.destroyProxy=function(t){this.unbufferMove(t),this.m_tree.destroyProxy(t)},i.prototype.moveProxy=function(t,e,s){var r=this.m_tree.moveProxy(t,e,s);r&&this.bufferMove(t)},i.prototype.touchProxy=function(t){this.bufferMove(t)},i.prototype.bufferMove=function(t){this.m_moveBuffer.push(t)},i.prototype.unbufferMove=function(t){for(var e=0;e<this.m_moveBuffer.length;++e)this.m_moveBuffer[e]===t&&(this.m_moveBuffer[e]=null)},i.prototype.updatePairs=function(t){for(this.m_callback=t;this.m_moveBuffer.length>0;)if(this.m_queryProxyId=this.m_moveBuffer.pop(),this.m_queryProxyId!==null){var e=this.m_tree.getFatAABB(this.m_queryProxyId);this.m_tree.query(e,this.queryCallback)}},i}(),rd=Math.sin,nd=Math.cos,Ml=Math.sqrt;function q(i,t){return{x:i,y:t}}function Jp(i){return{s:rd(i),c:nd(i)}}function Qt(i,t,e){return i.x=t,i.y=e,i}function P(i,t){return i.x=t.x,i.y=t.y,i}function J(i){return i.x=0,i.y=0,i}function An(i){return i.x=-i.x,i.y=-i.y,i}function Ne(i,t){return i.x+=t.x,i.y+=t.y,i}function Xp(i,t,e){return i.x=t.x+e.x,i.y=t.x+e.y,i}function Ii(i,t){return i.x-=t.x,i.y-=t.y,i}function st(i,t,e){return i.x=t.x-e.x,i.y=t.y-e.y,i}function $l(i,t){return i.x*=t,i.y*=t,i}function $(i,t,e){return i.x=t*e.x,i.y=t*e.y,i}function ti(i,t,e){return i.x+=t*e.x,i.y+=t*e.y,i}function nn(i,t,e){return i.x-=t*e.x,i.y-=t*e.y,i}function Bt(i,t,e,s,r){return i.x=t*e.x+s*r.x,i.y=t*e.y+s*r.y,i}function ui(i,t,e,s,r,n,o){return i.x=t*e.x+s*r.x+n*o.x,i.y=t*e.y+s*r.y+n*o.y,i}function Qp(i){var t=Ml(i.x*i.x+i.y*i.y);if(t!==0){var e=1/t;i.x*=e,i.y*=e}return t}function ei(i){var t=Ml(i.x*i.x+i.y*i.y);if(t>0){var e=1/t;i.x*=e,i.y*=e}return i}function Ps(i,t,e){var s=e*t.y,r=-e*t.x;return i.x=s,i.y=r,i}function be(i,t,e){var s=-t*e.y,r=t*e.x;return i.x=s,i.y=r,i}function lt(i,t){return i.x*t.y-i.y*t.x}function N(i,t){return i.x*t.x+i.y*t.y}function Ds(i){return i.x*i.x+i.y*i.y}function od(i,t){var e=i.x-t.x,s=i.y-t.y;return Ml(e*e+s*s)}function Vs(i,t){var e=i.x-t.x,s=i.y-t.y;return e*e+s*s}function Zp(i,t){return i.c=nd(t),i.s=rd(t),i}function Ue(i,t,e){return i.x=t.c*e.x-t.s*e.y,i.y=t.s*e.x+t.c*e.y,i}function dr(i,t,e){var s=t.c*e.x+t.s*e.y,r=-t.s*e.x+t.c*e.y;return i.x=s,i.y=r,i}function $p(i,t,e,s){var r=t.c*s.x+t.s*s.y,n=-t.s*s.x+t.c*s.y,o=e.c*r-e.s*n,a=e.s*r+e.c*n;return i.x=o,i.y=a,i}function Hs(i,t,e){return{p:q(i,t),q:Jp(e)}}function Po(i,t){return i.p.x=t.p.x,i.p.y=t.p.y,i.q.s=t.q.s,i.q.c=t.q.c,i}function it(i,t,e){var s=t.q.c*e.x-t.q.s*e.y+t.p.x,r=t.q.s*e.x+t.q.c*e.y+t.p.y;return i.x=s,i.y=r,i}function Fl(i,t,e){var s=e.x-t.p.x,r=e.y-t.p.y,n=t.q.c*s+t.q.s*r,o=-t.q.s*s+t.q.c*r;return i.x=n,i.y=o,i}function ad(i,t,e,s){var r=t.q.c*s.x-t.q.s*s.y+t.p.x,n=t.q.s*s.x+t.q.c*s.y+t.p.y,o=r-e.p.x,a=n-e.p.y,l=e.q.c*o+e.q.s*a,c=-e.q.s*o+e.q.c*a;return i.x=l,i.y=c,i}function ld(i,t,e){var s=t.q.c*e.q.c+t.q.s*e.q.s,r=t.q.c*e.q.s-t.q.s*e.q.c,n=t.q.c*(e.p.x-t.p.x)+t.q.s*(e.p.y-t.p.y),o=-t.q.s*(e.p.x-t.p.x)+t.q.c*(e.p.y-t.p.y);return i.q.c=s,i.q.s=r,i.p.x=n,i.p.y=o,i}var th=Math.sin,eh=Math.cos,tf=Math.atan2,T=function(){function i(t){if(!(this instanceof i))return new i(t);typeof t=="number"?this.setAngle(t):typeof t=="object"?this.setRot(t):this.setIdentity()}return i.neo=function(t){var e=Object.create(i.prototype);return e.setAngle(t),e},i.clone=function(t){var e=Object.create(i.prototype);return e.s=t.s,e.c=t.c,e},i.identity=function(){var t=Object.create(i.prototype);return t.s=0,t.c=1,t},i.isValid=function(t){return t===null||typeof t>"u"?!1:Number.isFinite(t.s)&&Number.isFinite(t.c)},i.assert=function(t){},i.prototype.setIdentity=function(){this.s=0,this.c=1},i.prototype.set=function(t){typeof t=="object"?(this.s=t.s,this.c=t.c):(this.s=th(t),this.c=eh(t))},i.prototype.setRot=function(t){this.s=t.s,this.c=t.c},i.prototype.setAngle=function(t){this.s=th(t),this.c=eh(t)},i.prototype.getAngle=function(){return tf(this.s,this.c)},i.prototype.getXAxis=function(){return m.neo(this.c,this.s)},i.prototype.getYAxis=function(){return m.neo(-this.s,this.c)},i.mul=function(t,e){if("c"in e&&"s"in e){var s=i.identity();return s.s=t.s*e.c+t.c*e.s,s.c=t.c*e.c-t.s*e.s,s}else if("x"in e&&"y"in e)return m.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},i.mulRot=function(t,e){var s=i.identity();return s.s=t.s*e.c+t.c*e.s,s.c=t.c*e.c-t.s*e.s,s},i.mulVec2=function(t,e){return m.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},i.mulSub=function(t,e,s){var r=t.c*(e.x-s.x)-t.s*(e.y-s.y),n=t.s*(e.x-s.x)+t.c*(e.y-s.y);return m.neo(r,n)},i.mulT=function(t,e){if("c"in e&&"s"in e){var s=i.identity();return s.s=t.c*e.s-t.s*e.c,s.c=t.c*e.c+t.s*e.s,s}else if("x"in e&&"y"in e)return m.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)},i.mulTRot=function(t,e){var s=i.identity();return s.s=t.c*e.s-t.s*e.c,s.c=t.c*e.c+t.s*e.s,s},i.mulTVec2=function(t,e){return m.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)},i}(),ef=Math.atan2,ih=Math.PI,_s=q(0,0),zr=function(){function i(){this.localCenter=m.zero(),this.c=m.zero(),this.a=0,this.alpha0=0,this.c0=m.zero(),this.a0=0}return i.prototype.recycle=function(){J(this.localCenter),J(this.c),this.a=0,this.alpha0=0,J(this.c0),this.a0=0},i.prototype.setTransform=function(t){it(_s,t,this.localCenter),P(this.c,_s),P(this.c0,_s),this.a=this.a0=ef(t.q.s,t.q.c)},i.prototype.setLocalCenter=function(t,e){P(this.localCenter,t),it(_s,e,this.localCenter),P(this.c,_s),P(this.c0,_s)},i.prototype.getTransform=function(t,e){e===void 0&&(e=0),Zp(t.q,(1-e)*this.a0+e*this.a),Bt(t.p,1-e,this.c0,e,this.c),Ii(t.p,Ue(_s,t.q,this.localCenter))},i.prototype.advance=function(t){var e=(t-this.alpha0)/(1-this.alpha0);Bt(this.c0,e,this.c,1-e,this.c0),this.a0=e*this.a+(1-e)*this.a0,this.alpha0=t},i.prototype.forward=function(){this.a0=this.a,P(this.c0,this.c)},i.prototype.normalize=function(){var t=sd(this.a0,-ih,+ih);this.a-=this.a0-t,this.a0=t},i.prototype.set=function(t){P(this.localCenter,t.localCenter),P(this.c,t.c),this.a=t.a,this.alpha0=t.alpha0,P(this.c0,t.c0),this.a0=t.a0},i}(),ii=function(){function i(t,e){if(!(this instanceof i))return new i(t,e);this.p=m.zero(),this.q=T.identity(),typeof t<"u"&&this.p.setVec2(t),typeof e<"u"&&this.q.setAngle(e)}return i.clone=function(t){var e=Object.create(i.prototype);return e.p=m.clone(t.p),e.q=T.clone(t.q),e},i.neo=function(t,e){var s=Object.create(i.prototype);return s.p=m.clone(t),s.q=T.clone(e),s},i.identity=function(){var t=Object.create(i.prototype);return t.p=m.zero(),t.q=T.identity(),t},i.prototype.setIdentity=function(){this.p.setZero(),this.q.setIdentity()},i.prototype.set=function(t,e){typeof e>"u"?(this.p.set(t.p),this.q.set(t.q)):(this.p.set(t),this.q.set(e))},i.prototype.setNum=function(t,e){this.p.setVec2(t),this.q.setAngle(e)},i.prototype.setTransform=function(t){this.p.setVec2(t.p),this.q.setRot(t.q)},i.isValid=function(t){return t===null||typeof t>"u"?!1:m.isValid(t.p)&&T.isValid(t.q)},i.assert=function(t){},i.mul=function(t,e){if(Array.isArray(e)){for(var s=[],r=0;r<e.length;r++)s[r]=i.mul(t,e[r]);return s}else{if("x"in e&&"y"in e)return i.mulVec2(t,e);if("p"in e&&"q"in e)return i.mulXf(t,e)}},i.mulAll=function(t,e){for(var s=[],r=0;r<e.length;r++)s[r]=i.mul(t,e[r]);return s},i.mulFn=function(t){return function(e){return i.mul(t,e)}},i.mulVec2=function(t,e){var s=t.q.c*e.x-t.q.s*e.y+t.p.x,r=t.q.s*e.x+t.q.c*e.y+t.p.y;return m.neo(s,r)},i.mulXf=function(t,e){var s=i.identity();return s.q=T.mulRot(t.q,e.q),s.p=m.add(T.mulVec2(t.q,e.p),t.p),s},i.mulT=function(t,e){if("x"in e&&"y"in e)return i.mulTVec2(t,e);if("p"in e&&"q"in e)return i.mulTXf(t,e)},i.mulTVec2=function(t,e){var s=e.x-t.p.x,r=e.y-t.p.y,n=t.q.c*s+t.q.s*r,o=-t.q.s*s+t.q.c*r;return m.neo(n,o)},i.mulTXf=function(t,e){var s=i.identity();return s.q.setRot(T.mulTRot(t.q,e.q)),s.p.setVec2(T.mulTVec2(t.q,m.sub(e.p,t.p))),s},i}(),sf=function(){function i(){this.v=m.zero(),this.w=0}return i}(),hd=Math.sin,cd=Math.cos,rf=function(){function i(){this.c=m.zero(),this.a=0}return i.prototype.getTransform=function(t,e){return t.q.c=cd(this.a),t.q.s=hd(this.a),t.p.x=this.c.x-(t.q.c*e.x-t.q.s*e.y),t.p.y=this.c.y-(t.q.s*e.x+t.q.c*e.y),t},i}();function zn(i,t,e,s){return i.q.c=cd(s),i.q.s=hd(s),i.p.x=e.x-(i.q.c*t.x-i.q.s*t.y),i.p.y=e.y-(i.q.s*t.x+i.q.c*t.y),i}var Ks=function(){function i(){this.style={},this.appData={}}return i.isValid=function(t){return t===null||typeof t>"u"?!1:typeof t.m_type=="string"&&typeof t.m_radius=="number"},i}(),sh=new Wt,rh=new Wt,nh=q(0,0),nf={userData:null,friction:.2,restitution:0,density:0,isSensor:!1,filterGroupIndex:0,filterCategoryBits:1,filterMaskBits:65535},oh=function(){function i(t,e){this.aabb=new Wt,this.fixture=t,this.childIndex=e,this.proxyId}return i}(),Do=function(){function i(t,e,s){this.style={},this.appData={},e.shape?(s=e,e=e.shape):typeof s=="number"&&(s={density:s}),s=Ve(s,nf),this.m_body=t,this.m_friction=s.friction,this.m_restitution=s.restitution,this.m_density=s.density,this.m_isSensor=s.isSensor,this.m_filterGroupIndex=s.filterGroupIndex,this.m_filterCategoryBits=s.filterCategoryBits,this.m_filterMaskBits=s.filterMaskBits,this.m_shape=e,this.m_next=null,this.m_proxies=[],this.m_proxyCount=0;for(var r=this.m_shape.getChildCount(),n=0;n<r;++n)this.m_proxies[n]=new oh(this,n);this.m_userData=s.userData}return i.prototype._reset=function(){var t=this.getBody(),e=t.m_world.m_broadPhase;this.destroyProxies(e),this.m_shape._reset&&this.m_shape._reset();for(var s=this.m_shape.getChildCount(),r=0;r<s;++r)this.m_proxies[r]=new oh(this,r);this.createProxies(e,t.m_xf),t.resetMassData()},i.prototype._serialize=function(){return{friction:this.m_friction,restitution:this.m_restitution,density:this.m_density,isSensor:this.m_isSensor,filterGroupIndex:this.m_filterGroupIndex,filterCategoryBits:this.m_filterCategoryBits,filterMaskBits:this.m_filterMaskBits,shape:this.m_shape}},i._deserialize=function(t,e,s){var r=s(Ks,t.shape),n=r&&new i(e,r,t);return n},i.prototype.getType=function(){return this.m_shape.m_type},i.prototype.getShape=function(){return this.m_shape},i.prototype.isSensor=function(){return this.m_isSensor},i.prototype.setSensor=function(t){t!=this.m_isSensor&&(this.m_body.setAwake(!0),this.m_isSensor=t)},i.prototype.getUserData=function(){return this.m_userData},i.prototype.setUserData=function(t){this.m_userData=t},i.prototype.getBody=function(){return this.m_body},i.prototype.getNext=function(){return this.m_next},i.prototype.getDensity=function(){return this.m_density},i.prototype.setDensity=function(t){this.m_density=t},i.prototype.getFriction=function(){return this.m_friction},i.prototype.setFriction=function(t){this.m_friction=t},i.prototype.getRestitution=function(){return this.m_restitution},i.prototype.setRestitution=function(t){this.m_restitution=t},i.prototype.testPoint=function(t){return this.m_shape.testPoint(this.m_body.getTransform(),t)},i.prototype.rayCast=function(t,e,s){return this.m_shape.rayCast(t,e,this.m_body.getTransform(),s)},i.prototype.getMassData=function(t){this.m_shape.computeMass(t,this.m_density)},i.prototype.getAABB=function(t){return this.m_proxies[t].aabb},i.prototype.createProxies=function(t,e){this.m_proxyCount=this.m_shape.getChildCount();for(var s=0;s<this.m_proxyCount;++s){var r=this.m_proxies[s];this.m_shape.computeAABB(r.aabb,e,s),r.proxyId=t.createProxy(r.aabb,r)}},i.prototype.destroyProxies=function(t){for(var e=0;e<this.m_proxyCount;++e){var s=this.m_proxies[e];t.destroyProxy(s.proxyId),s.proxyId=null}this.m_proxyCount=0},i.prototype.synchronize=function(t,e,s){for(var r=0;r<this.m_proxyCount;++r){var n=this.m_proxies[r];this.m_shape.computeAABB(sh,e,n.childIndex),this.m_shape.computeAABB(rh,s,n.childIndex),n.aabb.combine(sh,rh),st(nh,s.p,e.p),t.moveProxy(n.proxyId,n.aabb,nh)}},i.prototype.setFilterData=function(t){this.m_filterGroupIndex=t.groupIndex,this.m_filterCategoryBits=t.categoryBits,this.m_filterMaskBits=t.maskBits,this.refilter()},i.prototype.getFilterGroupIndex=function(){return this.m_filterGroupIndex},i.prototype.setFilterGroupIndex=function(t){this.m_filterGroupIndex=t,this.refilter()},i.prototype.getFilterCategoryBits=function(){return this.m_filterCategoryBits},i.prototype.setFilterCategoryBits=function(t){this.m_filterCategoryBits=t,this.refilter()},i.prototype.getFilterMaskBits=function(){return this.m_filterMaskBits},i.prototype.setFilterMaskBits=function(t){this.m_filterMaskBits=t,this.refilter()},i.prototype.refilter=function(){if(this.m_body!=null){for(var t=this.m_body.getContactList();t;){var e=t.contact,s=e.getFixtureA(),r=e.getFixtureB();(s==this||r==this)&&e.flagForFiltering(),t=t.next}var n=this.m_body.getWorld();if(n!=null)for(var o=n.m_broadPhase,a=0;a<this.m_proxyCount;++a)o.touchProxy(this.m_proxies[a].proxyId)}},i.prototype.shouldCollide=function(t){if(t.m_filterGroupIndex===this.m_filterGroupIndex&&t.m_filterGroupIndex!==0)return t.m_filterGroupIndex>0;var e=(t.m_filterMaskBits&this.m_filterCategoryBits)!==0,s=(t.m_filterCategoryBits&this.m_filterMaskBits)!==0,r=e&&s;return r},i}(),cr="static",ah="kinematic",Ge="dynamic",Nn=q(0,0),vs=q(0,0),On=q(0,0),Un=q(0,0),lh=Hs(0,0,0),of={type:cr,position:m.zero(),angle:0,linearVelocity:m.zero(),angularVelocity:0,linearDamping:0,angularDamping:0,fixedRotation:!1,bullet:!1,gravityScale:1,allowSleep:!0,awake:!0,active:!0,userData:null},_t=function(){function i(t,e){this.style={},this.appData={},e=Ve(e,of),this.m_world=t,this.m_awakeFlag=e.awake,this.m_autoSleepFlag=e.allowSleep,this.m_bulletFlag=e.bullet,this.m_fixedRotationFlag=e.fixedRotation,this.m_activeFlag=e.active,this.m_islandFlag=!1,this.m_toiFlag=!1,this.m_userData=e.userData,this.m_type=e.type,this.m_type==Ge?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_xf=ii.identity(),this.m_xf.p.setVec2(e.position),this.m_xf.q.setAngle(e.angle),this.m_sweep=new zr,this.m_sweep.setTransform(this.m_xf),this.c_velocity=new sf,this.c_position=new rf,this.m_force=m.zero(),this.m_torque=0,this.m_linearVelocity=m.clone(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_gravityScale=e.gravityScale,this.m_sleepTime=0,this.m_jointList=null,this.m_contactList=null,this.m_fixtureList=null,this.m_prev=null,this.m_next=null,this.m_destroyed=!1}return i.prototype._serialize=function(){for(var t=[],e=this.m_fixtureList;e;e=e.m_next)t.push(e);return{type:this.m_type,bullet:this.m_bulletFlag,position:this.m_xf.p,angle:this.m_xf.q.getAngle(),linearVelocity:this.m_linearVelocity,angularVelocity:this.m_angularVelocity,fixtures:t}},i._deserialize=function(t,e,s){var r=new i(e,t);if(t.fixtures)for(var n=t.fixtures.length-1;n>=0;n--){var o=s(Do,t.fixtures[n],r);r._addFixture(o)}return r},i.prototype.isWorldLocked=function(){return!!(this.m_world&&this.m_world.isLocked())},i.prototype.getWorld=function(){return this.m_world},i.prototype.getNext=function(){return this.m_next},i.prototype.setUserData=function(t){this.m_userData=t},i.prototype.getUserData=function(){return this.m_userData},i.prototype.getFixtureList=function(){return this.m_fixtureList},i.prototype.getJointList=function(){return this.m_jointList},i.prototype.getContactList=function(){return this.m_contactList},i.prototype.isStatic=function(){return this.m_type==cr},i.prototype.isDynamic=function(){return this.m_type==Ge},i.prototype.isKinematic=function(){return this.m_type==ah},i.prototype.setStatic=function(){return this.setType(cr),this},i.prototype.setDynamic=function(){return this.setType(Ge),this},i.prototype.setKinematic=function(){return this.setType(ah),this},i.prototype.getType=function(){return this.m_type},i.prototype.setType=function(t){if(this.isWorldLocked()!=!0&&this.m_type!=t){this.m_type=t,this.resetMassData(),this.m_type==cr&&(this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_sweep.forward(),this.synchronizeFixtures()),this.setAwake(!0),this.m_force.setZero(),this.m_torque=0;for(var e=this.m_contactList;e;){var s=e;e=e.next,this.m_world.destroyContact(s.contact)}this.m_contactList=null;for(var r=this.m_world.m_broadPhase,n=this.m_fixtureList;n;n=n.m_next)for(var o=0;o<n.m_proxyCount;++o)r.touchProxy(n.m_proxies[o].proxyId)}},i.prototype.isBullet=function(){return this.m_bulletFlag},i.prototype.setBullet=function(t){this.m_bulletFlag=!!t},i.prototype.isSleepingAllowed=function(){return this.m_autoSleepFlag},i.prototype.setSleepingAllowed=function(t){this.m_autoSleepFlag=!!t,this.m_autoSleepFlag==!1&&this.setAwake(!0)},i.prototype.isAwake=function(){return this.m_awakeFlag},i.prototype.setAwake=function(t){t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_force.setZero(),this.m_torque=0)},i.prototype.isActive=function(){return this.m_activeFlag},i.prototype.setActive=function(t){if(t!=this.m_activeFlag)if(this.m_activeFlag=!!t,this.m_activeFlag){for(var e=this.m_world.m_broadPhase,s=this.m_fixtureList;s;s=s.m_next)s.createProxies(e,this.m_xf);this.m_world.m_newFixture=!0}else{for(var e=this.m_world.m_broadPhase,s=this.m_fixtureList;s;s=s.m_next)s.destroyProxies(e);for(var r=this.m_contactList;r;){var n=r;r=r.next,this.m_world.destroyContact(n.contact)}this.m_contactList=null}},i.prototype.isFixedRotation=function(){return this.m_fixedRotationFlag},i.prototype.setFixedRotation=function(t){this.m_fixedRotationFlag!=t&&(this.m_fixedRotationFlag=!!t,this.m_angularVelocity=0,this.resetMassData())},i.prototype.getTransform=function(){return this.m_xf},i.prototype.setTransform=function(t,e){if(this.isWorldLocked()!=!0){typeof e=="number"?this.m_xf.setNum(t,e):this.m_xf.setTransform(t),this.m_sweep.setTransform(this.m_xf);for(var s=this.m_world.m_broadPhase,r=this.m_fixtureList;r;r=r.m_next)r.synchronize(s,this.m_xf,this.m_xf);this.setAwake(!0)}},i.prototype.synchronizeTransform=function(){this.m_sweep.getTransform(this.m_xf,1)},i.prototype.synchronizeFixtures=function(){this.m_sweep.getTransform(lh,0);for(var t=this.m_world.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.synchronize(t,lh,this.m_xf)},i.prototype.advance=function(t){this.m_sweep.advance(t),P(this.m_sweep.c,this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_sweep.getTransform(this.m_xf,1)},i.prototype.getPosition=function(){return this.m_xf.p},i.prototype.setPosition=function(t){this.setTransform(t,this.m_sweep.a)},i.prototype.getAngle=function(){return this.m_sweep.a},i.prototype.setAngle=function(t){this.setTransform(this.m_xf.p,t)},i.prototype.getWorldCenter=function(){return this.m_sweep.c},i.prototype.getLocalCenter=function(){return this.m_sweep.localCenter},i.prototype.getLinearVelocity=function(){return this.m_linearVelocity},i.prototype.getLinearVelocityFromWorldPoint=function(t){var e=m.sub(t,this.m_sweep.c);return m.add(this.m_linearVelocity,m.crossNumVec2(this.m_angularVelocity,e))},i.prototype.getLinearVelocityFromLocalPoint=function(t){return this.getLinearVelocityFromWorldPoint(this.getWorldPoint(t))},i.prototype.setLinearVelocity=function(t){this.m_type!=cr&&(m.dot(t,t)>0&&this.setAwake(!0),this.m_linearVelocity.setVec2(t))},i.prototype.getAngularVelocity=function(){return this.m_angularVelocity},i.prototype.setAngularVelocity=function(t){this.m_type!=cr&&(t*t>0&&this.setAwake(!0),this.m_angularVelocity=t)},i.prototype.getLinearDamping=function(){return this.m_linearDamping},i.prototype.setLinearDamping=function(t){this.m_linearDamping=t},i.prototype.getAngularDamping=function(){return this.m_angularDamping},i.prototype.setAngularDamping=function(t){this.m_angularDamping=t},i.prototype.getGravityScale=function(){return this.m_gravityScale},i.prototype.setGravityScale=function(t){this.m_gravityScale=t},i.prototype.getMass=function(){return this.m_mass},i.prototype.getInertia=function(){return this.m_I+this.m_mass*m.dot(this.m_sweep.localCenter,this.m_sweep.localCenter)},i.prototype.getMassData=function(t){t.mass=this.m_mass,t.I=this.getInertia(),P(t.center,this.m_sweep.localCenter)},i.prototype.resetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,J(this.m_sweep.localCenter),this.isStatic()||this.isKinematic()){P(this.m_sweep.c0,this.m_xf.p),P(this.m_sweep.c,this.m_xf.p),this.m_sweep.a0=this.m_sweep.a;return}J(vs);for(var t=this.m_fixtureList;t;t=t.m_next)if(t.m_density!=0){var e={mass:0,center:q(0,0),I:0};t.getMassData(e),this.m_mass+=e.mass,ti(vs,e.mass,e.center),this.m_I+=e.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,$(vs,this.m_invMass,vs)):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&this.m_fixedRotationFlag==!1?(this.m_I-=this.m_mass*N(vs,vs),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0),P(Nn,this.m_sweep.c),this.m_sweep.setLocalCenter(vs,this.m_xf),st(On,this.m_sweep.c,Nn),be(Un,this.m_angularVelocity,On),Ne(this.m_linearVelocity,Un)},i.prototype.setMassData=function(t){this.isWorldLocked()!=!0&&this.m_type==Ge&&(this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&this.m_fixedRotationFlag==!1&&(this.m_I=t.I-this.m_mass*N(t.center,t.center),this.m_invI=1/this.m_I),P(Nn,this.m_sweep.c),this.m_sweep.setLocalCenter(t.center,this.m_xf),st(On,this.m_sweep.c,Nn),be(Un,this.m_angularVelocity,On),Ne(this.m_linearVelocity,Un))},i.prototype.applyForce=function(t,e,s){s===void 0&&(s=!0),this.m_type==Ge&&(s&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_force.add(t),this.m_torque+=m.crossVec2Vec2(m.sub(e,this.m_sweep.c),t)))},i.prototype.applyForceToCenter=function(t,e){e===void 0&&(e=!0),this.m_type==Ge&&(e&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&this.m_force.add(t))},i.prototype.applyTorque=function(t,e){e===void 0&&(e=!0),this.m_type==Ge&&(e&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))},i.prototype.applyLinearImpulse=function(t,e,s){s===void 0&&(s=!0),this.m_type==Ge&&(s&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.addMul(this.m_invMass,t),this.m_angularVelocity+=this.m_invI*m.crossVec2Vec2(m.sub(e,this.m_sweep.c),t)))},i.prototype.applyAngularImpulse=function(t,e){e===void 0&&(e=!0),this.m_type==Ge&&(e&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},i.prototype.shouldCollide=function(t){if(this.m_type!=Ge&&t.m_type!=Ge)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&e.joint.m_collideConnected==!1)return!1;return!0},i.prototype._addFixture=function(t){if(this.isWorldLocked()==!0)return null;if(this.m_activeFlag){var e=this.m_world.m_broadPhase;t.createProxies(e,this.m_xf)}return t.m_next=this.m_fixtureList,this.m_fixtureList=t,t.m_density>0&&this.resetMassData(),this.m_world.m_newFixture=!0,t},i.prototype.createFixture=function(t,e){if(this.isWorldLocked()==!0)return null;var s=new Do(this,t,e);return this._addFixture(s),s},i.prototype.destroyFixture=function(t){if(this.isWorldLocked()!=!0){if(this.m_fixtureList===t)this.m_fixtureList=t.m_next;else for(var e=this.m_fixtureList;e!=null;){if(e.m_next===t){e.m_next=t.m_next;break}e=e.m_next}for(var s=this.m_contactList;s;){var r=s.contact;s=s.next;var n=r.getFixtureA(),o=r.getFixtureB();(t==n||t==o)&&this.m_world.destroyContact(r)}if(this.m_activeFlag){var a=this.m_world.m_broadPhase;t.destroyProxies(a)}t.m_body=null,t.m_next=null,this.m_world.publish("remove-fixture",t),this.resetMassData()}},i.prototype.getWorldPoint=function(t){return ii.mulVec2(this.m_xf,t)},i.prototype.getWorldVector=function(t){return T.mulVec2(this.m_xf.q,t)},i.prototype.getLocalPoint=function(t){return ii.mulTVec2(this.m_xf,t)},i.prototype.getLocalVector=function(t){return T.mulTVec2(this.m_xf.q,t)},i.STATIC="static",i.KINEMATIC="kinematic",i.DYNAMIC="dynamic",i}(),hh=function(){function i(){this.other=null,this.joint=null,this.prev=null,this.next=null}return i}(),re=function(){function i(t,e,s){this.m_type="unknown-joint",this.m_prev=null,this.m_next=null,this.m_edgeA=new hh,this.m_edgeB=new hh,this.m_islandFlag=!1,this.style={},this.appData={},e="bodyA"in t?t.bodyA:e,s="bodyB"in t?t.bodyB:s,this.m_bodyA=e,this.m_bodyB=s,this.m_collideConnected=!!t.collideConnected,this.m_userData=t.userData}return i.prototype.isActive=function(){return this.m_bodyA.isActive()&&this.m_bodyB.isActive()},i.prototype.getType=function(){return this.m_type},i.prototype.getBodyA=function(){return this.m_bodyA},i.prototype.getBodyB=function(){return this.m_bodyB},i.prototype.getNext=function(){return this.m_next},i.prototype.getUserData=function(){return this.m_userData},i.prototype.setUserData=function(t){this.m_userData=t},i.prototype.getCollideConnected=function(){return this.m_collideConnected},i.prototype.shiftOrigin=function(t){},i.prototype._resetAnchors=function(t){return this._reset(t)},i}(),Mt={gjkCalls:0,gjkIters:0,gjkMaxIters:0,toiTime:0,toiMaxTime:0,toiCalls:0,toiIters:0,toiMaxIters:0,toiRootIters:0,toiMaxRootIters:0,toString:function(i){i=typeof i=="string"?i:`
`;var t="";for(var e in this)typeof this[e]!="function"&&typeof this[e]!="object"&&(t+=e+": "+this[e]+i);return t}},af=function(){return Date.now()},lf=function(i){return Date.now()-i};const ch={now:af,diff:lf};var hf=Math.max,Hn=q(0,0),Kn=q(0,0),xe=q(0,0),Yn=q(0,0),ia=q(0,0),cf=q(0,0),uf=q(0,0);Mt.gjkCalls=0;Mt.gjkIters=0;Mt.gjkMaxIters=0;var El=function(){function i(){this.proxyA=new Rs,this.proxyB=new Rs,this.transformA=ii.identity(),this.transformB=ii.identity(),this.useRadii=!1}return i.prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.transformA.setIdentity(),this.transformB.setIdentity(),this.useRadii=!1},i}(),Sl=function(){function i(){this.pointA=q(0,0),this.pointB=q(0,0),this.distance=0,this.iterations=0}return i.prototype.recycle=function(){J(this.pointA),J(this.pointB),this.distance=0,this.iterations=0},i}(),Pl=function(){function i(){this.metric=0,this.indexA=[],this.indexB=[],this.count=0}return i.prototype.recycle=function(){this.metric=0,this.indexA.length=0,this.indexB.length=0,this.count=0},i}(),Ys=function(i,t,e){++Mt.gjkCalls;var s=e.proxyA,r=e.proxyB,n=e.transformA,o=e.transformB;We.recycle(),We.readCache(t,s,n,r,o);for(var a=We.m_v,l=K.maxDistanceIterations,c=[],h=[],d=0,u=0;u<l;){d=We.m_count;for(var f=0;f<d;++f)c[f]=a[f].indexA,h[f]=a[f].indexB;if(We.solve(),We.m_count===3)break;var y=We.getSearchDirection();if(Ds(y)<Fe*Fe)break;var v=a[We.m_count];v.indexA=s.getSupport(dr(Hn,n.q,$(Hn,-1,y))),it(v.wA,n,s.getVertex(v.indexA)),v.indexB=r.getSupport(dr(Hn,o.q,y)),it(v.wB,o,r.getVertex(v.indexB)),st(v.w,v.wB,v.wA),++u,++Mt.gjkIters;for(var g=!1,f=0;f<d;++f)if(v.indexA===c[f]&&v.indexB===h[f]){g=!0;break}if(g)break;++We.m_count}if(Mt.gjkMaxIters=hf(Mt.gjkMaxIters,u),We.getWitnessPoints(i.pointA,i.pointB),i.distance=od(i.pointA,i.pointB),i.iterations=u,We.writeCache(t),e.useRadii){var A=s.m_radius,B=r.m_radius;if(i.distance>A+B&&i.distance>Fe)i.distance-=A+B,st(Kn,i.pointB,i.pointA),ei(Kn),ti(i.pointA,A,Kn),nn(i.pointB,B,Kn);else{var F=st(Hn,i.pointA,i.pointB);P(i.pointA,F),P(i.pointB,F),i.distance=0}}},Rs=function(){function i(){this.m_vertices=[],this.m_count=0,this.m_radius=0}return i.prototype.recycle=function(){this.m_vertices.length=0,this.m_count=0,this.m_radius=0},i.prototype.getVertexCount=function(){return this.m_count},i.prototype.getVertex=function(t){return this.m_vertices[t]},i.prototype.getSupport=function(t){for(var e=-1,s=-1/0,r=0;r<this.m_count;++r){var n=N(this.m_vertices[r],t);n>s&&(e=r,s=n)}return e},i.prototype.getSupportVertex=function(t){return this.m_vertices[this.getSupport(t)]},i.prototype.set=function(t,e){t.computeDistanceProxy(this,e)},i.prototype.setVertices=function(t,e,s){this.m_vertices=t,this.m_count=e,this.m_radius=s},i}(),sa=function(){function i(){this.wA=q(0,0),this.indexA=0,this.wB=q(0,0),this.indexB=0,this.w=q(0,0),this.a=0}return i.prototype.recycle=function(){this.indexA=0,this.indexB=0,J(this.wA),J(this.wB),J(this.w),this.a=0},i.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,P(this.wA,t.wA),P(this.wB,t.wB),P(this.w,t.w),this.a=t.a},i}(),Gn=q(0,0),Gr=q(0,0),mf=function(){function i(){this.m_v1=new sa,this.m_v2=new sa,this.m_v3=new sa,this.m_v=[this.m_v1,this.m_v2,this.m_v3]}return i.prototype.recycle=function(){this.m_v1.recycle(),this.m_v2.recycle(),this.m_v3.recycle(),this.m_count=0},i.prototype.toString=function(){return this.m_count===3?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y,this.m_v3.a,this.m_v3.wA.x,this.m_v3.wA.y,this.m_v3.wB.x,this.m_v3.wB.y].toString():this.m_count===2?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y].toString():this.m_count===1?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y].toString():"+"+this.m_count},i.prototype.readCache=function(t,e,s,r,n){this.m_count=t.count;for(var o=0;o<this.m_count;++o){var a=this.m_v[o];a.indexA=t.indexA[o],a.indexB=t.indexB[o];var l=e.getVertex(a.indexA),c=r.getVertex(a.indexB);it(a.wA,s,l),it(a.wB,n,c),st(a.w,a.wB,a.wA),a.a=0}if(this.m_count>1){var h=t.metric,d=this.getMetric();(d<.5*h||2*h<d||d<Fe)&&(this.m_count=0)}if(this.m_count===0){var a=this.m_v[0];a.indexA=0,a.indexB=0;var l=e.getVertex(0),c=r.getVertex(0);it(a.wA,s,l),it(a.wB,n,c),st(a.w,a.wB,a.wA),a.a=1,this.m_count=1}},i.prototype.writeCache=function(t){t.metric=this.getMetric(),t.count=this.m_count;for(var e=0;e<this.m_count;++e)t.indexA[e]=this.m_v[e].indexA,t.indexB[e]=this.m_v[e].indexB},i.prototype.getSearchDirection=function(){var t=this.m_v1,e=this.m_v2;switch(this.m_v3,this.m_count){case 1:return Qt(Gn,-t.w.x,-t.w.y);case 2:{st(xe,e.w,t.w);var s=-lt(xe,t.w);return s>0?Qt(Gn,-xe.y,xe.x):Qt(Gn,xe.y,-xe.x)}default:return J(Gn)}},i.prototype.getClosestPoint=function(){var t=this.m_v1,e=this.m_v2;switch(this.m_v3,this.m_count){case 0:return J(Gr);case 1:return P(Gr,t.w);case 2:return Bt(Gr,t.a,t.w,e.a,e.w);case 3:return J(Gr);default:return J(Gr)}},i.prototype.getWitnessPoints=function(t,e){var s=this.m_v1,r=this.m_v2,n=this.m_v3;switch(this.m_count){case 0:break;case 1:P(t,s.wA),P(e,s.wB);break;case 2:Bt(t,s.a,s.wA,r.a,r.wA),Bt(e,s.a,s.wB,r.a,r.wB);break;case 3:ui(t,s.a,s.wA,r.a,r.wA,n.a,n.wA),P(e,t);break}},i.prototype.getMetric=function(){switch(this.m_count){case 0:return 0;case 1:return 0;case 2:return od(this.m_v1.w,this.m_v2.w);case 3:return lt(st(cf,this.m_v2.w,this.m_v1.w),st(uf,this.m_v3.w,this.m_v1.w));default:return 0}},i.prototype.solve=function(){switch(this.m_count){case 1:break;case 2:this.solve2();break;case 3:this.solve3();break}},i.prototype.solve2=function(){var t=this.m_v1.w,e=this.m_v2.w;st(xe,e,t);var s=-N(t,xe);if(s<=0){this.m_v1.a=1,this.m_count=1;return}var r=N(e,xe);if(r<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.set(this.m_v2);return}var n=1/(r+s);this.m_v1.a=r*n,this.m_v2.a=s*n,this.m_count=2},i.prototype.solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,s=this.m_v3.w;st(xe,e,t);var r=N(t,xe),n=N(e,xe),o=n,a=-r;st(Yn,s,t);var l=N(t,Yn),c=N(s,Yn),h=c,d=-l;st(ia,s,e);var u=N(e,ia),f=N(s,ia),y=f,v=-u,g=lt(xe,Yn),A=g*lt(e,s),B=g*lt(s,t),F=g*lt(t,e);if(a<=0&&d<=0){this.m_v1.a=1,this.m_count=1;return}if(o>0&&a>0&&F<=0){var E=1/(o+a);this.m_v1.a=o*E,this.m_v2.a=a*E,this.m_count=2;return}if(h>0&&d>0&&B<=0){var k=1/(h+d);this.m_v1.a=h*k,this.m_v3.a=d*k,this.m_count=2,this.m_v2.set(this.m_v3);return}if(o<=0&&v<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.set(this.m_v2);return}if(h<=0&&y<=0){this.m_v3.a=1,this.m_count=1,this.m_v1.set(this.m_v3);return}if(y>0&&v>0&&A<=0){var w=1/(y+v);this.m_v2.a=y*w,this.m_v3.a=v*w,this.m_count=2,this.m_v1.set(this.m_v3);return}var b=1/(A+B+F);this.m_v1.a=A*b,this.m_v2.a=B*b,this.m_v3.a=F*b,this.m_count=3},i}(),We=new mf,gs=new El,uh=new Pl,ra=new Sl,Dl=function(i,t,e,s,r,n){return gs.recycle(),gs.proxyA.set(i,t),gs.proxyB.set(e,s),Po(gs.transformA,r),Po(gs.transformB,n),gs.useRadii=!0,ra.recycle(),uh.recycle(),Ys(ra,uh,gs),ra.distance<10*Fe};Ys.testOverlap=Dl;Ys.Input=El;Ys.Output=Sl;Ys.Proxy=Rs;Ys.Cache=Pl;(function(){function i(){this.proxyA=new Rs,this.proxyB=new Rs,this.transformA=ii.identity(),this.transformB=ii.identity(),this.translationB=m.zero()}return i.prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.transformA.setIdentity(),this.transformB.setIdentity(),J(this.translationB)},i})();var df=Math.abs,Wn=Math.max,ud=function(){function i(){this.proxyA=new Rs,this.proxyB=new Rs,this.sweepA=new zr,this.sweepB=new zr}return i.prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.sweepA.recycle(),this.sweepB.recycle(),this.tMax=-1},i}(),Oe;(function(i){i[i.e_unset=-1]="e_unset",i[i.e_unknown=0]="e_unknown",i[i.e_failed=1]="e_failed",i[i.e_overlapped=2]="e_overlapped",i[i.e_touching=3]="e_touching",i[i.e_separated=4]="e_separated"})(Oe||(Oe={}));var md=function(){function i(){this.state=Oe.e_unset,this.t=-1}return i.prototype.recycle=function(){this.state=Oe.e_unset,this.t=-1},i}();Mt.toiTime=0;Mt.toiMaxTime=0;Mt.toiCalls=0;Mt.toiIters=0;Mt.toiMaxIters=0;Mt.toiRootIters=0;Mt.toiMaxRootIters=0;var Js=new El,na=new Sl,oa=new Pl,ue=Hs(0,0,0),me=Hs(0,0,0),Wr=q(0,0),oi=q(0,0),Te=q(0,0),ce=q(0,0),Jn=q(0,0),Xn=q(0,0),Qn=q(0,0),Zn=q(0,0),Vl=function(i,t){var e=ch.now();++Mt.toiCalls,i.state=Oe.e_unknown,i.t=t.tMax;var s=t.proxyA,r=t.proxyB,n=t.sweepA,o=t.sweepB;n.normalize(),o.normalize();var a=t.tMax,l=s.m_radius+r.m_radius,c=Wn(K.linearSlop,l-3*K.linearSlop),h=.25*K.linearSlop,d=0,u=K.maxTOIIterations,f=0;for(oa.recycle(),Js.proxyA.setVertices(s.m_vertices,s.m_count,s.m_radius),Js.proxyB.setVertices(r.m_vertices,r.m_count,r.m_radius),Js.useRadii=!1;;){if(n.getTransform(ue,d),o.getTransform(me,d),Po(Js.transformA,ue),Po(Js.transformB,me),Ys(na,oa,Js),na.distance<=0){i.state=Oe.e_overlapped,i.t=0;break}if(na.distance<c+h){i.state=Oe.e_touching,i.t=d;break}Jr.initialize(oa,s,n,r,o,d);for(var y=!1,v=a,g=0;;){var A=Jr.findMinSeparation(v);if(A>c+h){i.state=Oe.e_separated,i.t=a,y=!0;break}if(A>c-h){d=v;break}var B=Jr.evaluate(d);if(B<c-h){i.state=Oe.e_failed,i.t=d,y=!0;break}if(B<=c+h){i.state=Oe.e_touching,i.t=d,y=!0;break}for(var F=0,E=d,k=v;;){var w=void 0;F&1?w=E+(c-B)*(k-E)/(A-B):w=.5*(E+k),++F,++Mt.toiRootIters;var b=Jr.evaluate(w);if(df(b-c)<h){v=w;break}if(b>c?(E=w,B=b):(k=w,A=b),F===50)break}if(Mt.toiMaxRootIters=Wn(Mt.toiMaxRootIters,F),++g,g===K.maxPolygonVertices)break}if(++f,++Mt.toiIters,y)break;if(f===u){i.state=Oe.e_failed,i.t=d;break}}Mt.toiMaxIters=Wn(Mt.toiMaxIters,f);var M=ch.diff(e);Mt.toiMaxTime=Wn(Mt.toiMaxTime,M),Mt.toiTime+=M,Jr.recycle()},mi;(function(i){i[i.e_unset=-1]="e_unset",i[i.e_points=1]="e_points",i[i.e_faceA=2]="e_faceA",i[i.e_faceB=3]="e_faceB"})(mi||(mi={}));var pf=function(){function i(){this.m_proxyA=null,this.m_proxyB=null,this.m_sweepA=null,this.m_sweepB=null,this.m_type=mi.e_unset,this.m_localPoint=q(0,0),this.m_axis=q(0,0),this.indexA=-1,this.indexB=-1}return i.prototype.recycle=function(){this.m_proxyA=null,this.m_proxyB=null,this.m_sweepA=null,this.m_sweepB=null,this.m_type=mi.e_unset,J(this.m_localPoint),J(this.m_axis),this.indexA=-1,this.indexB=-1},i.prototype.initialize=function(t,e,s,r,n,o){var a=t.count;if(this.m_proxyA=e,this.m_proxyB=r,this.m_sweepA=s,this.m_sweepB=n,this.m_sweepA.getTransform(ue,o),this.m_sweepB.getTransform(me,o),a===1){this.m_type=mi.e_points;var l=this.m_proxyA.getVertex(t.indexA[0]),c=this.m_proxyB.getVertex(t.indexB[0]);it(oi,ue,l),it(Te,me,c),st(this.m_axis,Te,oi);var h=Qp(this.m_axis);return h}else if(t.indexA[0]===t.indexA[1]){this.m_type=mi.e_faceB;var d=r.getVertex(t.indexB[0]),u=r.getVertex(t.indexB[1]);Ps(this.m_axis,st(Wr,u,d),1),ei(this.m_axis),Ue(ce,me.q,this.m_axis),Bt(this.m_localPoint,.5,d,.5,u),it(Te,me,this.m_localPoint);var f=e.getVertex(t.indexA[0]),y=ii.mulVec2(ue,f),h=N(y,ce)-N(Te,ce);return h<0&&(An(this.m_axis),h=-h),h}else{this.m_type=mi.e_faceA;var v=this.m_proxyA.getVertex(t.indexA[0]),g=this.m_proxyA.getVertex(t.indexA[1]);Ps(this.m_axis,st(Wr,g,v),1),ei(this.m_axis),Ue(ce,ue.q,this.m_axis),Bt(this.m_localPoint,.5,v,.5,g),it(oi,ue,this.m_localPoint);var A=this.m_proxyB.getVertex(t.indexB[0]);it(Te,me,A);var h=N(Te,ce)-N(oi,ce);return h<0&&(An(this.m_axis),h=-h),h}},i.prototype.compute=function(t,e){switch(this.m_sweepA.getTransform(ue,e),this.m_sweepB.getTransform(me,e),this.m_type){case mi.e_points:{t&&(dr(Jn,ue.q,this.m_axis),dr(Xn,me.q,$(Wr,-1,this.m_axis)),this.indexA=this.m_proxyA.getSupport(Jn),this.indexB=this.m_proxyB.getSupport(Xn)),P(Qn,this.m_proxyA.getVertex(this.indexA)),P(Zn,this.m_proxyB.getVertex(this.indexB)),it(oi,ue,Qn),it(Te,me,Zn);var s=N(Te,this.m_axis)-N(oi,this.m_axis);return s}case mi.e_faceA:{Ue(ce,ue.q,this.m_axis),it(oi,ue,this.m_localPoint),t&&(dr(Xn,me.q,$(Wr,-1,ce)),this.indexA=-1,this.indexB=this.m_proxyB.getSupport(Xn)),P(Zn,this.m_proxyB.getVertex(this.indexB)),it(Te,me,Zn);var s=N(Te,ce)-N(oi,ce);return s}case mi.e_faceB:{Ue(ce,me.q,this.m_axis),it(Te,me,this.m_localPoint),t&&(dr(Jn,ue.q,$(Wr,-1,ce)),this.indexB=-1,this.indexA=this.m_proxyA.getSupport(Jn)),P(Qn,this.m_proxyA.getVertex(this.indexA)),it(oi,ue,Qn);var s=N(oi,ce)-N(Te,ce);return s}default:return t&&(this.indexA=-1,this.indexB=-1),0}},i.prototype.findMinSeparation=function(t){return this.compute(!0,t)},i.prototype.evaluate=function(t){return this.compute(!1,t)},i}(),Jr=new pf;Vl.Input=ud;Vl.Output=md;var mh=Math.abs,dh=Math.sqrt,$n=Math.min,Il=function(){function i(){this.dt=0,this.inv_dt=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1,this.blockSolve=!0,this.inv_dt0=0,this.dtRatio=1}return i.prototype.reset=function(t){this.dt>0&&(this.inv_dt0=this.inv_dt),this.dt=t,this.inv_dt=t==0?0:1/t,this.dtRatio=t*this.inv_dt0},i}(),Xs=new Il,Mi=q(0,0),$t=q(0,0),to=q(0,0),Qs=new ud,aa=new md,ph=new zr,fh=new zr,yh=new zr,ff=function(){function i(t){this.contact=t,this.normals=[],this.tangents=[]}return i.prototype.recycle=function(){this.normals.length=0,this.tangents.length=0},Object.defineProperty(i.prototype,"normalImpulses",{get:function(){var t=this.contact,e=this.normals;e.length=0;for(var s=0;s<t.v_points.length;++s)e.push(t.v_points[s].normalImpulse);return e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"tangentImpulses",{get:function(){var t=this.contact,e=this.tangents;e.length=0;for(var s=0;s<t.v_points.length;++s)e.push(t.v_points[s].tangentImpulse);return e},enumerable:!1,configurable:!0}),i}(),dd=function(){function i(t){this.m_world=t,this.m_stack=[],this.m_bodies=[],this.m_contacts=[],this.m_joints=[]}return i.prototype.clear=function(){this.m_stack.length=0,this.m_bodies.length=0,this.m_contacts.length=0,this.m_joints.length=0},i.prototype.addBody=function(t){this.m_bodies.push(t)},i.prototype.addContact=function(t){this.m_contacts.push(t)},i.prototype.addJoint=function(t){this.m_joints.push(t)},i.prototype.solveWorld=function(t){for(var e=this.m_world,s=e.m_bodyList;s;s=s.m_next)s.m_islandFlag=!1;for(var r=e.m_contactList;r;r=r.m_next)r.m_islandFlag=!1;for(var n=e.m_jointList;n;n=n.m_next)n.m_islandFlag=!1;for(var o=this.m_stack,a=e.m_bodyList;a;a=a.m_next)if(!a.m_islandFlag&&!(a.isAwake()==!1||a.isActive()==!1)&&!a.isStatic()){for(this.clear(),o.push(a),a.m_islandFlag=!0;o.length>0;){var s=o.pop();if(this.addBody(s),s.m_awakeFlag=!0,!s.isStatic()){for(var l=s.m_contactList;l;l=l.next){var c=l.contact;if(!c.m_islandFlag&&!(c.isEnabled()==!1||c.isTouching()==!1)){var h=c.m_fixtureA.m_isSensor,d=c.m_fixtureB.m_isSensor;if(!(h||d)){this.addContact(c),c.m_islandFlag=!0;var u=l.other;u.m_islandFlag||(o.push(u),u.m_islandFlag=!0)}}}for(var f=s.m_jointList;f;f=f.next)if(f.joint.m_islandFlag!=!0){var u=f.other;u.isActive()!=!1&&(this.addJoint(f.joint),f.joint.m_islandFlag=!0,!u.m_islandFlag&&(o.push(u),u.m_islandFlag=!0))}}}this.solveIsland(t);for(var y=0;y<this.m_bodies.length;++y){var s=this.m_bodies[y];s.isStatic()&&(s.m_islandFlag=!1)}}},i.prototype.solveIsland=function(t){for(var e=this.m_world,s=e.m_gravity,r=e.m_allowSleep,n=t.dt,o=0;o<this.m_bodies.length;++o){var a=this.m_bodies[o];P(Mi,a.m_sweep.c);var l=a.m_sweep.a;P($t,a.m_linearVelocity);var c=a.m_angularVelocity;P(a.m_sweep.c0,a.m_sweep.c),a.m_sweep.a0=a.m_sweep.a,a.isDynamic()&&(ti($t,n*a.m_gravityScale,s),ti($t,n*a.m_invMass,a.m_force),c+=n*a.m_invI*a.m_torque,$($t,1/(1+n*a.m_linearDamping),$t),c*=1/(1+n*a.m_angularDamping)),P(a.c_position.c,Mi),a.c_position.a=l,P(a.c_velocity.v,$t),a.c_velocity.w=c}for(var o=0;o<this.m_contacts.length;++o){var h=this.m_contacts[o];h.initConstraint(t)}for(var o=0;o<this.m_contacts.length;++o){var h=this.m_contacts[o];h.initVelocityConstraint(t)}if(t.warmStarting)for(var o=0;o<this.m_contacts.length;++o){var h=this.m_contacts[o];h.warmStartConstraint(t)}for(var o=0;o<this.m_joints.length;++o){var d=this.m_joints[o];d.initVelocityConstraints(t)}for(var o=0;o<t.velocityIterations;++o){for(var u=0;u<this.m_joints.length;++u){var d=this.m_joints[u];d.solveVelocityConstraints(t)}for(var u=0;u<this.m_contacts.length;++u){var h=this.m_contacts[u];h.solveVelocityConstraint(t)}}for(var o=0;o<this.m_contacts.length;++o){var h=this.m_contacts[o];h.storeConstraintImpulses(t)}for(var o=0;o<this.m_bodies.length;++o){var a=this.m_bodies[o];P(Mi,a.c_position.c);var l=a.c_position.a;P($t,a.c_velocity.v);var c=a.c_velocity.w;$(to,n,$t);var f=Ds(to);if(f>K.maxTranslationSquared){var y=K.maxTranslation/dh(f);$l($t,y)}var v=n*c;if(v*v>K.maxRotationSquared){var y=K.maxRotation/mh(v);c*=y}ti(Mi,n,$t),l+=n*c,P(a.c_position.c,Mi),a.c_position.a=l,P(a.c_velocity.v,$t),a.c_velocity.w=c}for(var g=!1,o=0;o<t.positionIterations;++o){for(var A=0,u=0;u<this.m_contacts.length;++u){var h=this.m_contacts[u],B=h.solvePositionConstraint(t);A=$n(A,B)}for(var F=A>=-3*K.linearSlop,E=!0,u=0;u<this.m_joints.length;++u){var d=this.m_joints[u],k=d.solvePositionConstraints(t);E=E&&k}if(F&&E){g=!0;break}}for(var o=0;o<this.m_bodies.length;++o){var a=this.m_bodies[o];P(a.m_sweep.c,a.c_position.c),a.m_sweep.a=a.c_position.a,P(a.m_linearVelocity,a.c_velocity.v),a.m_angularVelocity=a.c_velocity.w,a.synchronizeTransform()}if(this.postSolveIsland(),r){for(var w=1/0,b=K.linearSleepToleranceSqr,M=K.angularSleepToleranceSqr,o=0;o<this.m_bodies.length;++o){var a=this.m_bodies[o];a.isStatic()||(a.m_autoSleepFlag==!1||a.m_angularVelocity*a.m_angularVelocity>M||Ds(a.m_linearVelocity)>b?(a.m_sleepTime=0,w=0):(a.m_sleepTime+=n,w=$n(w,a.m_sleepTime)))}if(w>=K.timeToSleep&&g)for(var o=0;o<this.m_bodies.length;++o){var a=this.m_bodies[o];a.setAwake(!1)}}},i.prototype.solveWorldTOI=function(t){var e=this.m_world;if(e.m_stepComplete){for(var s=e.m_bodyList;s;s=s.m_next)s.m_islandFlag=!1,s.m_sweep.alpha0=0;for(var r=e.m_contactList;r;r=r.m_next)r.m_toiFlag=!1,r.m_islandFlag=!1,r.m_toiCount=0,r.m_toi=1}for(;;){for(var n=null,o=1,a=e.m_contactList;a;a=a.m_next)if(a.isEnabled()!=!1&&!(a.m_toiCount>K.maxSubSteps)){var l=1;if(a.m_toiFlag)l=a.m_toi;else{var c=a.getFixtureA(),h=a.getFixtureB();if(c.isSensor()||h.isSensor())continue;var d=c.getBody(),u=h.getBody(),f=d.isAwake()&&!d.isStatic(),y=u.isAwake()&&!u.isStatic();if(f==!1&&y==!1)continue;var v=d.isBullet()||!d.isDynamic(),g=u.isBullet()||!u.isDynamic();if(v==!1&&g==!1)continue;var A=d.m_sweep.alpha0;d.m_sweep.alpha0<u.m_sweep.alpha0?(A=u.m_sweep.alpha0,d.m_sweep.advance(A)):u.m_sweep.alpha0<d.m_sweep.alpha0&&(A=d.m_sweep.alpha0,u.m_sweep.advance(A));var B=a.getChildIndexA(),F=a.getChildIndexB();d.m_sweep,u.m_sweep,Qs.proxyA.set(c.getShape(),B),Qs.proxyB.set(h.getShape(),F),Qs.sweepA.set(d.m_sweep),Qs.sweepB.set(u.m_sweep),Qs.tMax=1,Vl(aa,Qs);var E=aa.t;aa.state==Oe.e_touching?l=$n(A+(1-A)*E,1):l=1,a.m_toi=l,a.m_toiFlag=!0}l<o&&(n=a,o=l)}if(n==null||1-10*Fe<o){e.m_stepComplete=!0;break}var k=n.getFixtureA(),w=n.getFixtureB(),b=k.getBody(),M=w.getBody();if(fh.set(b.m_sweep),yh.set(M.m_sweep),b.advance(o),M.advance(o),n.update(e),n.m_toiFlag=!1,++n.m_toiCount,n.isEnabled()==!1||n.isTouching()==!1){n.setEnabled(!1),b.m_sweep.set(fh),M.m_sweep.set(yh),b.synchronizeTransform(),M.synchronizeTransform();continue}b.setAwake(!0),M.setAwake(!0),this.clear(),this.addBody(b),this.addBody(M),this.addContact(n),b.m_islandFlag=!0,M.m_islandFlag=!0,n.m_islandFlag=!0;for(var V=[b,M],L=0;L<V.length;++L){var z=V[L];if(z.isDynamic())for(var O=z.m_contactList;O;O=O.next){var H=O.contact;if(!H.m_islandFlag){var Y=O.other;if(!(Y.isDynamic()&&!z.isBullet()&&!Y.isBullet())){var tt=H.m_fixtureA.m_isSensor,G=H.m_fixtureB.m_isSensor;if(!(tt||G)){if(ph.set(Y.m_sweep),Y.m_islandFlag==!1&&Y.advance(o),H.update(e),H.isEnabled()==!1||H.isTouching()==!1){Y.m_sweep.set(ph),Y.synchronizeTransform();continue}H.m_islandFlag=!0,this.addContact(H),!Y.m_islandFlag&&(Y.m_islandFlag=!0,Y.isStatic()||Y.setAwake(!0),this.addBody(Y))}}}}}Xs.reset((1-o)*t.dt),Xs.dtRatio=1,Xs.positionIterations=20,Xs.velocityIterations=t.velocityIterations,Xs.warmStarting=!1,this.solveIslandTOI(Xs,b,M);for(var L=0;L<this.m_bodies.length;++L){var z=this.m_bodies[L];if(z.m_islandFlag=!1,!!z.isDynamic()){z.synchronizeFixtures();for(var O=z.m_contactList;O;O=O.next)O.contact.m_toiFlag=!1,O.contact.m_islandFlag=!1}}if(e.findNewContacts(),e.m_subStepping){e.m_stepComplete=!1;break}}},i.prototype.solveIslandTOI=function(t,e,s){for(var h=0;h<this.m_bodies.length;++h){var r=this.m_bodies[h];P(r.c_position.c,r.m_sweep.c),r.c_position.a=r.m_sweep.a,P(r.c_velocity.v,r.m_linearVelocity),r.c_velocity.w=r.m_angularVelocity}for(var h=0;h<this.m_contacts.length;++h){var n=this.m_contacts[h];n.initConstraint(t)}for(var h=0;h<t.positionIterations;++h){for(var o=0,a=0;a<this.m_contacts.length;++a){var n=this.m_contacts[a],l=n.solvePositionConstraintTOI(t,e,s);o=$n(o,l)}var c=o>=-1.5*K.linearSlop;if(c)break}var h;P(e.m_sweep.c0,e.c_position.c),e.m_sweep.a0=e.c_position.a,P(s.m_sweep.c0,s.c_position.c),s.m_sweep.a0=s.c_position.a;for(var h=0;h<this.m_contacts.length;++h){var n=this.m_contacts[h];n.initVelocityConstraint(t)}for(var h=0;h<t.velocityIterations;++h)for(var a=0;a<this.m_contacts.length;++a){var n=this.m_contacts[a];n.solveVelocityConstraint(t)}for(var d=t.dt,h=0;h<this.m_bodies.length;++h){var r=this.m_bodies[h];P(Mi,r.c_position.c);var u=r.c_position.a;P($t,r.c_velocity.v);var f=r.c_velocity.w;$(to,d,$t);var y=Ds(to);if(y>K.maxTranslationSquared){var v=K.maxTranslation/dh(y);$l($t,v)}var g=d*f;if(g*g>K.maxRotationSquared){var v=K.maxRotation/mh(g);f*=v}ti(Mi,d,$t),u+=d*f,P(r.c_position.c,Mi),r.c_position.a=u,P(r.c_velocity.v,$t),r.c_velocity.w=f,P(r.m_sweep.c,Mi),r.m_sweep.a=u,P(r.m_linearVelocity,$t),r.m_angularVelocity=f,r.synchronizeTransform()}this.postSolveIsland()},i.prototype.postSolveIsland=function(){for(var t=0;t<this.m_contacts.length;++t){var e=this.m_contacts[t];this.m_world.postSolve(e,e.m_impulse)}},i}();dd.TimeStep=Il;var si=function(){function i(t,e,s,r){typeof t=="object"&&t!==null?(this.ex=m.clone(t),this.ey=m.clone(e)):typeof t=="number"?(this.ex=m.neo(t,s),this.ey=m.neo(e,r)):(this.ex=m.zero(),this.ey=m.zero())}return i.prototype.toString=function(){return JSON.stringify(this)},i.isValid=function(t){return t===null||typeof t>"u"?!1:m.isValid(t.ex)&&m.isValid(t.ey)},i.assert=function(t){},i.prototype.set=function(t,e,s,r){typeof t=="number"&&typeof e=="number"&&typeof s=="number"&&typeof r=="number"?(this.ex.setNum(t,s),this.ey.setNum(e,r)):typeof t=="object"&&typeof e=="object"?(this.ex.setVec2(t),this.ey.setVec2(e)):typeof t=="object"&&(this.ex.setVec2(t.ex),this.ey.setVec2(t.ey))},i.prototype.setIdentity=function(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1},i.prototype.setZero=function(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0},i.prototype.getInverse=function(){var t=this.ex.x,e=this.ey.x,s=this.ex.y,r=this.ey.y,n=t*r-e*s;n!==0&&(n=1/n);var o=new i;return o.ex.x=n*r,o.ey.x=-n*e,o.ex.y=-n*s,o.ey.y=n*t,o},i.prototype.solve=function(t){var e=this.ex.x,s=this.ey.x,r=this.ex.y,n=this.ey.y,o=e*n-s*r;o!==0&&(o=1/o);var a=m.zero();return a.x=o*(n*t.x-s*t.y),a.y=o*(e*t.y-r*t.x),a},i.mul=function(t,e){if(e&&"x"in e&&"y"in e){var s=t.ex.x*e.x+t.ey.x*e.y,r=t.ex.y*e.x+t.ey.y*e.y;return m.neo(s,r)}else if(e&&"ex"in e&&"ey"in e){var n=t.ex.x*e.ex.x+t.ey.x*e.ex.y,o=t.ex.x*e.ey.x+t.ey.x*e.ey.y,a=t.ex.y*e.ex.x+t.ey.y*e.ex.y,l=t.ex.y*e.ey.x+t.ey.y*e.ey.y;return new i(n,o,a,l)}},i.mulVec2=function(t,e){var s=t.ex.x*e.x+t.ey.x*e.y,r=t.ex.y*e.x+t.ey.y*e.y;return m.neo(s,r)},i.mulMat22=function(t,e){var s=t.ex.x*e.ex.x+t.ey.x*e.ex.y,r=t.ex.x*e.ey.x+t.ey.x*e.ey.y,n=t.ex.y*e.ex.x+t.ey.y*e.ex.y,o=t.ex.y*e.ey.x+t.ey.y*e.ey.y;return new i(s,r,n,o)},i.mulT=function(t,e){if(e&&"x"in e&&"y"in e)return m.neo(m.dot(e,t.ex),m.dot(e,t.ey));if(e&&"ex"in e&&"ey"in e){var s=m.neo(m.dot(t.ex,e.ex),m.dot(t.ey,e.ex)),r=m.neo(m.dot(t.ex,e.ey),m.dot(t.ey,e.ey));return new i(s,r)}},i.mulTVec2=function(t,e){return m.neo(m.dot(e,t.ex),m.dot(e,t.ey))},i.mulTMat22=function(t,e){var s=m.neo(m.dot(t.ex,e.ex),m.dot(t.ey,e.ex)),r=m.neo(m.dot(t.ex,e.ey),m.dot(t.ey,e.ey));return new i(s,r)},i.abs=function(t){return new i(m.abs(t.ex),m.abs(t.ey))},i.add=function(t,e){return new i(m.add(t.ex,e.ex),m.add(t.ey,e.ey))},i}(),yf=Math.sqrt,la=q(0,0),ha=q(0,0),Xr=q(0,0),Fi=q(0,0),Ei=q(0,0),ca=q(0,0),eo=q(0,0),Ki=q(0,0),Ft;(function(i){i[i.e_unset=-1]="e_unset",i[i.e_circles=0]="e_circles",i[i.e_faceA=1]="e_faceA",i[i.e_faceB=2]="e_faceB"})(Ft||(Ft={}));var mt;(function(i){i[i.e_unset=-1]="e_unset",i[i.e_vertex=0]="e_vertex",i[i.e_face=1]="e_face"})(mt||(mt={}));var Ss;(function(i){i[i.nullState=0]="nullState",i[i.addState=1]="addState",i[i.persistState=2]="persistState",i[i.removeState=3]="removeState"})(Ss||(Ss={}));var Pe=function(){function i(){this.v=q(0,0),this.id=new fd}return i.prototype.set=function(t){P(this.v,t.v),this.id.set(t.id)},i.prototype.recycle=function(){J(this.v),this.id.recycle()},i}(),pd=function(){function i(){this.localNormal=q(0,0),this.localPoint=q(0,0),this.points=[new _h,new _h],this.pointCount=0}return i.prototype.set=function(t){this.type=t.type,P(this.localNormal,t.localNormal),P(this.localPoint,t.localPoint),this.pointCount=t.pointCount,this.points[0].set(t.points[0]),this.points[1].set(t.points[1])},i.prototype.recycle=function(){this.type=Ft.e_unset,J(this.localNormal),J(this.localPoint),this.pointCount=0,this.points[0].recycle(),this.points[1].recycle()},i.prototype.getWorldManifold=function(t,e,s,r,n){if(this.pointCount==0)return t;t=t||new yd,t.pointCount=this.pointCount;var o=t.normal,a=t.points,l=t.separations;switch(this.type){case Ft.e_circles:{Qt(o,1,0);var c=this.points[0];it(la,e,this.localPoint),it(ha,r,c.localPoint),st(ca,ha,la);var h=Ds(ca);if(h>Fe*Fe){var d=yf(h);$(o,1/d,ca)}Bt(Fi,1,la,s,o),Bt(Ei,1,ha,-n,o),Bt(a[0],.5,Fi,.5,Ei),l[0]=N(st(Xr,Ei,Fi),o);break}case Ft.e_faceA:{Ue(o,e.q,this.localNormal),it(eo,e,this.localPoint);for(var u=0;u<this.pointCount;++u){var c=this.points[u];it(Ki,r,c.localPoint),Bt(Fi,1,Ki,s-N(st(Xr,Ki,eo),o),o),Bt(Ei,1,Ki,-n,o),Bt(a[u],.5,Fi,.5,Ei),l[u]=N(st(Xr,Ei,Fi),o)}break}case Ft.e_faceB:{Ue(o,r.q,this.localNormal),it(eo,r,this.localPoint);for(var u=0;u<this.pointCount;++u){var c=this.points[u];it(Ki,e,c.localPoint),Bt(Ei,1,Ki,n-N(st(Xr,Ki,eo),o),o),Bt(Fi,1,Ki,-s,o),Bt(a[u],.5,Fi,.5,Ei),l[u]=N(st(Xr,Fi,Ei),o)}An(o);break}}return t},i.clipSegmentToLine=xn,i.ClipVertex=Pe,i.getPointStates=_f,i.PointState=Ss,i}(),_h=function(){function i(){this.localPoint=q(0,0),this.normalImpulse=0,this.tangentImpulse=0,this.id=new fd}return i.prototype.set=function(t){P(this.localPoint,t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.set(t.id)},i.prototype.recycle=function(){J(this.localPoint),this.normalImpulse=0,this.tangentImpulse=0,this.id.recycle()},i}(),fd=function(){function i(){this.key=-1,this.indexA=-1,this.indexB=-1,this.typeA=mt.e_unset,this.typeB=mt.e_unset}return i.prototype.setFeatures=function(t,e,s,r){this.indexA=t,this.indexB=s,this.typeA=e,this.typeB=r,this.key=this.indexA+this.indexB*4+this.typeA*16+this.typeB*64},i.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.typeA=t.typeA,this.typeB=t.typeB,this.key=this.indexA+this.indexB*4+this.typeA*16+this.typeB*64},i.prototype.swapFeatures=function(){var t=this.indexA,e=this.indexB,s=this.typeA,r=this.typeB;this.indexA=e,this.indexB=t,this.typeA=r,this.typeB=s,this.key=this.indexA+this.indexB*4+this.typeA*16+this.typeB*64},i.prototype.recycle=function(){this.indexA=0,this.indexB=0,this.typeA=mt.e_unset,this.typeB=mt.e_unset,this.key=-1},i}(),yd=function(){function i(){this.normal=q(0,0),this.points=[q(0,0),q(0,0)],this.separations=[0,0],this.pointCount=0}return i.prototype.recycle=function(){J(this.normal),J(this.points[0]),J(this.points[1]),this.separations[0]=0,this.separations[1]=0,this.pointCount=0},i}();function _f(i,t,e,s){for(var r=0;r<e.pointCount;++r){var n=e.points[r].id;i[r]=Ss.removeState;for(var o=0;o<s.pointCount;++o)if(s.points[o].id.key===n.key){i[r]=Ss.persistState;break}}for(var r=0;r<s.pointCount;++r){var n=s.points[r].id;t[r]=Ss.addState;for(var o=0;o<e.pointCount;++o)if(e.points[o].id.key===n.key){t[r]=Ss.persistState;break}}}function xn(i,t,e,s,r){var n=0,o=N(e,t[0].v)-s,a=N(e,t[1].v)-s;if(o<=0&&i[n++].set(t[0]),a<=0&&i[n++].set(t[1]),o*a<0){var l=o/(o-a);Bt(i[n].v,1-l,t[0].v,l,t[1].v),i[n].id.setFeatures(r,mt.e_vertex,t[0].id.indexB,mt.e_face),++n}return n}var vf=Math.sqrt,gf=Math.max,Af=Math.min,vh=new hn({create:function(){return new vi},release:function(i){i.recycle()}}),Zs=new pd,io=new yd,gh=function(){function i(t){this.prev=null,this.next=null,this.other=null,this.contact=t}return i.prototype.recycle=function(){this.prev=null,this.next=null,this.other=null},i}();function Ah(i,t){return vf(i*t)}function xh(i,t){return i>t?i:t}var As=[],wh=function(){function i(){this.rA=q(0,0),this.rB=q(0,0),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}return i.prototype.recycle=function(){J(this.rA),J(this.rB),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0},i}(),Si=q(0,0),St=q(0,0),Pi=q(0,0),Pt=q(0,0),Yi=q(0,0),xs=Hs(0,0,0),ws=Hs(0,0,0),so=q(0,0),ro=q(0,0),$s=q(0,0),no=q(0,0),ua=q(0,0),ma=q(0,0),qt=q(0,0),vt=q(0,0),Qr=q(0,0),Le=q(0,0),tr=q(0,0),er=q(0,0),we=q(0,0),Di=q(0,0),wt=q(0,0),Re=q(0,0),jt=q(0,0),Tt=q(0,0),ai=q(0,0),vi=function(){function i(){this.m_nodeA=new gh(this),this.m_nodeB=new gh(this),this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=-1,this.m_indexB=-1,this.m_evaluateFcn=null,this.m_manifold=new pd,this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_impulse=new ff(this),this.v_points=[new wh,new wh],this.v_normal=q(0,0),this.v_normalMass=new si,this.v_K=new si,this.v_pointCount=0,this.v_tangentSpeed=0,this.v_friction=0,this.v_restitution=0,this.v_invMassA=0,this.v_invMassB=0,this.v_invIA=0,this.v_invIB=0,this.p_localPoints=[q(0,0),q(0,0)],this.p_localNormal=q(0,0),this.p_localPoint=q(0,0),this.p_localCenterA=q(0,0),this.p_localCenterB=q(0,0),this.p_type=Ft.e_unset,this.p_radiusA=0,this.p_radiusB=0,this.p_pointCount=0,this.p_invMassA=0,this.p_invMassB=0,this.p_invIA=0,this.p_invIB=0}return i.prototype.initialize=function(t,e,s,r,n){this.m_fixtureA=t,this.m_fixtureB=s,this.m_indexA=e,this.m_indexB=r,this.m_evaluateFcn=n,this.m_friction=Ah(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=xh(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},i.prototype.recycle=function(){this.m_nodeA.recycle(),this.m_nodeB.recycle(),this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=-1,this.m_indexB=-1,this.m_evaluateFcn=null,this.m_manifold.recycle(),this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_impulse.recycle();for(var t=0,e=this.v_points;t<e.length;t++){var s=e[t];s.recycle()}J(this.v_normal),this.v_normalMass.setZero(),this.v_K.setZero(),this.v_pointCount=0,this.v_tangentSpeed=0,this.v_friction=0,this.v_restitution=0,this.v_invMassA=0,this.v_invMassB=0,this.v_invIA=0,this.v_invIB=0;for(var r=0,n=this.p_localPoints;r<n.length;r++){var o=n[r];J(o)}J(this.p_localNormal),J(this.p_localPoint),J(this.p_localCenterA),J(this.p_localCenterB),this.p_type=Ft.e_unset,this.p_radiusA=0,this.p_radiusB=0,this.p_pointCount=0,this.p_invMassA=0,this.p_invMassB=0,this.p_invIA=0,this.p_invIB=0},i.prototype.initConstraint=function(t){var e=this.m_fixtureA,s=this.m_fixtureB;if(!(e===null||s===null)){var r=e.m_body,n=s.m_body;if(!(r===null||n===null)){var o=e.m_shape,a=s.m_shape;if(!(o===null||a===null)){var l=this.m_manifold,c=l.pointCount;this.v_invMassA=r.m_invMass,this.v_invMassB=n.m_invMass,this.v_invIA=r.m_invI,this.v_invIB=n.m_invI,this.v_friction=this.m_friction,this.v_restitution=this.m_restitution,this.v_tangentSpeed=this.m_tangentSpeed,this.v_pointCount=c,this.v_K.setZero(),this.v_normalMass.setZero(),this.p_invMassA=r.m_invMass,this.p_invMassB=n.m_invMass,this.p_invIA=r.m_invI,this.p_invIB=n.m_invI,P(this.p_localCenterA,r.m_sweep.localCenter),P(this.p_localCenterB,n.m_sweep.localCenter),this.p_radiusA=o.m_radius,this.p_radiusB=a.m_radius,this.p_type=l.type,P(this.p_localNormal,l.localNormal),P(this.p_localPoint,l.localPoint),this.p_pointCount=c;for(var h=0;h<K.maxManifoldPoints;++h)this.v_points[h].recycle(),J(this.p_localPoints[h]);for(var h=0;h<c;++h){var d=l.points[h],u=this.v_points[h];t.warmStarting&&(u.normalImpulse=t.dtRatio*d.normalImpulse,u.tangentImpulse=t.dtRatio*d.tangentImpulse),P(this.p_localPoints[h],d.localPoint)}}}}},i.prototype.getManifold=function(){return this.m_manifold},i.prototype.getWorldManifold=function(t){var e=this.m_fixtureA,s=this.m_fixtureB;if(!(e===null||s===null)){var r=e.m_body,n=s.m_body;if(!(r===null||n===null)){var o=e.m_shape,a=s.m_shape;if(!(o===null||a===null))return this.m_manifold.getWorldManifold(t,r.getTransform(),o.m_radius,n.getTransform(),a.m_radius)}}},i.prototype.setEnabled=function(t){this.m_enabledFlag=!!t},i.prototype.isEnabled=function(){return this.m_enabledFlag},i.prototype.isTouching=function(){return this.m_touchingFlag},i.prototype.getNext=function(){return this.m_next},i.prototype.getFixtureA=function(){return this.m_fixtureA},i.prototype.getFixtureB=function(){return this.m_fixtureB},i.prototype.getChildIndexA=function(){return this.m_indexA},i.prototype.getChildIndexB=function(){return this.m_indexB},i.prototype.flagForFiltering=function(){this.m_filterFlag=!0},i.prototype.setFriction=function(t){this.m_friction=t},i.prototype.getFriction=function(){return this.m_friction},i.prototype.resetFriction=function(){var t=this.m_fixtureA,e=this.m_fixtureB;t===null||e===null||(this.m_friction=Ah(t.m_friction,e.m_friction))},i.prototype.setRestitution=function(t){this.m_restitution=t},i.prototype.getRestitution=function(){return this.m_restitution},i.prototype.resetRestitution=function(){var t=this.m_fixtureA,e=this.m_fixtureB;t===null||e===null||(this.m_restitution=xh(t.m_restitution,e.m_restitution))},i.prototype.setTangentSpeed=function(t){this.m_tangentSpeed=t},i.prototype.getTangentSpeed=function(){return this.m_tangentSpeed},i.prototype.evaluate=function(t,e,s){var r=this.m_fixtureA,n=this.m_fixtureB;r===null||n===null||this.m_evaluateFcn(t,e,r,this.m_indexA,s,n,this.m_indexB)},i.prototype.update=function(t){var e=this.m_fixtureA,s=this.m_fixtureB;if(!(e===null||s===null)){var r=e.m_body,n=s.m_body;if(!(r===null||n===null)){var o=e.m_shape,a=s.m_shape;if(!(o===null||a===null)){this.m_enabledFlag=!0;var l=!1,c=this.m_touchingFlag,h=e.m_isSensor,d=s.m_isSensor,u=h||d,f=r.m_xf,y=n.m_xf;if(u)l=Dl(o,this.m_indexA,a,this.m_indexB,f,y),this.m_manifold.pointCount=0;else{Zs.recycle(),Zs.set(this.m_manifold),this.m_manifold.recycle(),this.evaluate(this.m_manifold,f,y),l=this.m_manifold.pointCount>0;for(var v=0;v<this.m_manifold.pointCount;++v){var g=this.m_manifold.points[v];g.normalImpulse=0,g.tangentImpulse=0;for(var A=0;A<Zs.pointCount;++A){var B=Zs.points[A];if(B.id.key===g.id.key){g.normalImpulse=B.normalImpulse,g.tangentImpulse=B.tangentImpulse;break}}}l!==c&&(r.setAwake(!0),n.setAwake(!0))}this.m_touchingFlag=l;var F=typeof t=="object"&&t!==null;!c&&l&&F&&t.beginContact(this),c&&!l&&F&&t.endContact(this),!u&&l&&F&&Zs&&t.preSolve(this,Zs)}}}},i.prototype.solvePositionConstraint=function(t){return this._solvePositionConstraint(t,null,null)},i.prototype.solvePositionConstraintTOI=function(t,e,s){return this._solvePositionConstraint(t,e,s)},i.prototype._solvePositionConstraint=function(t,e,s){var r=e!==null&&s!==null,n=0,o=this.m_fixtureA,a=this.m_fixtureB;if(o===null||a===null)return n;var l=o.m_body,c=a.m_body;if(l===null||c===null)return n;l.c_velocity,c.c_velocity;var h=l.c_position,d=c.c_position,u=this.p_localCenterA,f=this.p_localCenterB,y=0,v=0;(!r||l===e||l===s)&&(y=this.p_invMassA,v=this.p_invIA);var g=0,A=0;(!r||c===e||c===s)&&(g=this.p_invMassB,A=this.p_invIB),P(Si,h.c);var B=h.a;P(Pi,d.c);for(var F=d.a,E=0;E<this.p_pointCount;++E){zn(xs,u,Si,B),zn(ws,f,Pi,F);var k=void 0;switch(this.p_type){case Ft.e_circles:{it(so,xs,this.p_localPoint),it(ro,ws,this.p_localPoints[0]),st(vt,ro,so),ei(vt),Bt(Qr,.5,so,.5,ro),k=N(ro,vt)-N(so,vt)-this.p_radiusA-this.p_radiusB;break}case Ft.e_faceA:{Ue(vt,xs.q,this.p_localNormal),it(no,xs,this.p_localPoint),it($s,ws,this.p_localPoints[E]),k=N($s,vt)-N(no,vt)-this.p_radiusA-this.p_radiusB,P(Qr,$s);break}case Ft.e_faceB:{Ue(vt,ws.q,this.p_localNormal),it(no,ws,this.p_localPoint),it($s,xs,this.p_localPoints[E]),k=N($s,vt)-N(no,vt)-this.p_radiusA-this.p_radiusB,P(Qr,$s),An(vt);break}default:return n}st(ua,Qr,Si),st(ma,Qr,Pi),n=Af(n,k);var w=r?K.toiBaugarte:K.baumgarte,b=K.linearSlop,M=K.maxLinearCorrection,V=se(w*(k+b),-M,0),L=lt(ua,vt),z=lt(ma,vt),O=y+g+v*L*L+A*z*z,H=O>0?-V/O:0;$(qt,H,vt),nn(Si,y,qt),B-=v*lt(ua,qt),ti(Pi,g,qt),F+=A*lt(ma,qt)}return P(h.c,Si),h.a=B,P(d.c,Pi),d.a=F,n},i.prototype.initVelocityConstraint=function(t){var e=this.m_fixtureA,s=this.m_fixtureB;if(!(e===null||s===null)){var r=e.m_body,n=s.m_body;if(!(r===null||n===null)){var o=r.c_velocity,a=n.c_velocity,l=r.c_position,c=n.c_position,h=this.p_radiusA,d=this.p_radiusB,u=this.m_manifold,f=this.v_invMassA,y=this.v_invMassB,v=this.v_invIA,g=this.v_invIB,A=this.p_localCenterA,B=this.p_localCenterB;P(Si,l.c);var F=l.a;P(St,o.v);var E=o.w;P(Pi,c.c);var k=c.a;P(Pt,a.v);var w=a.w;zn(xs,A,Si,F),zn(ws,B,Pi,k),io.recycle(),u.getWorldManifold(io,xs,h,ws,d),P(this.v_normal,io.normal);for(var b=0;b<this.v_pointCount;++b){var M=this.v_points[b],V=io.points[b];st(M.rA,V,Si),st(M.rB,V,Pi);var L=lt(M.rA,this.v_normal),z=lt(M.rB,this.v_normal),O=f+y+v*L*L+g*z*z;M.normalMass=O>0?1/O:0,Ps(Yi,this.v_normal,1);var H=lt(M.rA,Yi),Y=lt(M.rB,Yi),tt=f+y+v*H*H+g*Y*Y;M.tangentMass=tt>0?1/tt:0,M.velocityBias=0;var G=0;G+=N(this.v_normal,Pt),G+=N(this.v_normal,be(ai,w,M.rB)),G-=N(this.v_normal,St),G-=N(this.v_normal,be(ai,E,M.rA)),G<-K.velocityThreshold&&(M.velocityBias=-this.v_restitution*G)}if(this.v_pointCount==2&&t.blockSolve){var Z=this.v_points[0],ot=this.v_points[1],W=lt(Z.rA,this.v_normal),ct=lt(Z.rB,this.v_normal),ft=lt(ot.rA,this.v_normal),X=lt(ot.rB,this.v_normal),Zt=f+y+v*W*W+g*ct*ct,he=f+y+v*ft*ft+g*X*X,ve=f+y+v*W*ft+g*ct*X,xi=1e3;if(Zt*Zt<xi*(Zt*he-ve*ve)){this.v_K.ex.setNum(Zt,ve),this.v_K.ey.setNum(ve,he);var Ui=this.v_K.ex.x,ps=this.v_K.ey.x,fs=this.v_K.ex.y,wi=this.v_K.ey.y,Gt=Ui*wi-ps*fs;Gt!==0&&(Gt=1/Gt),this.v_normalMass.ex.x=Gt*wi,this.v_normalMass.ey.x=-Gt*ps,this.v_normalMass.ex.y=-Gt*fs,this.v_normalMass.ey.y=Gt*Ui}else this.v_pointCount=1}P(l.c,Si),l.a=F,P(o.v,St),o.w=E,P(c.c,Pi),c.a=k,P(a.v,Pt),a.w=w}}},i.prototype.warmStartConstraint=function(t){var e=this.m_fixtureA,s=this.m_fixtureB;if(!(e===null||s===null)){var r=e.m_body,n=s.m_body;if(!(r===null||n===null)){var o=r.c_velocity,a=n.c_velocity;r.c_position,n.c_position;var l=this.v_invMassA,c=this.v_invIA,h=this.v_invMassB,d=this.v_invIB;P(St,o.v);var u=o.w;P(Pt,a.v);var f=a.w;P(vt,this.v_normal),Ps(Yi,vt,1);for(var y=0;y<this.v_pointCount;++y){var v=this.v_points[y];Bt(qt,v.normalImpulse,vt,v.tangentImpulse,Yi),u-=c*lt(v.rA,qt),nn(St,l,qt),f+=d*lt(v.rB,qt),ti(Pt,h,qt)}P(o.v,St),o.w=u,P(a.v,Pt),a.w=f}}},i.prototype.storeConstraintImpulses=function(t){for(var e=this.m_manifold,s=0;s<this.v_pointCount;++s)e.points[s].normalImpulse=this.v_points[s].normalImpulse,e.points[s].tangentImpulse=this.v_points[s].tangentImpulse},i.prototype.solveVelocityConstraint=function(t){var e=this.m_fixtureA,s=this.m_fixtureB;if(!(e===null||s===null)){var r=e.m_body,n=s.m_body;if(!(r===null||n===null)){var o=r.c_velocity;r.c_position;var a=n.c_velocity;n.c_position;var l=this.v_invMassA,c=this.v_invIA,h=this.v_invMassB,d=this.v_invIB;P(St,o.v);var u=o.w;P(Pt,a.v);var f=a.w;P(vt,this.v_normal),Ps(Yi,vt,1);for(var y=this.v_friction,v=0;v<this.v_pointCount;++v){var g=this.v_points[v];J(Le),Ne(Le,Pt),Ne(Le,be(ai,f,g.rB)),Ii(Le,St),Ii(Le,be(ai,u,g.rA));var A=N(Le,Yi)-this.v_tangentSpeed,B=g.tangentMass*-A,F=y*g.normalImpulse,E=se(g.tangentImpulse+B,-F,F);B=E-g.tangentImpulse,g.tangentImpulse=E,$(qt,B,Yi),nn(St,l,qt),u-=c*lt(g.rA,qt),ti(Pt,h,qt),f+=d*lt(g.rB,qt)}if(this.v_pointCount==1||t.blockSolve==!1)for(var k=0;k<this.v_pointCount;++k){var g=this.v_points[k];J(Le),Ne(Le,Pt),Ne(Le,be(ai,f,g.rB)),Ii(Le,St),Ii(Le,be(ai,u,g.rA));var w=N(Le,vt),B=-g.normalMass*(w-g.velocityBias),E=gf(g.normalImpulse+B,0);B=E-g.normalImpulse,g.normalImpulse=E,$(qt,B,vt),nn(St,l,qt),u-=c*lt(g.rA,qt),ti(Pt,h,qt),f+=d*lt(g.rB,qt)}else{var b=this.v_points[0],M=this.v_points[1];Qt(Di,b.normalImpulse,M.normalImpulse),J(tr),Ne(tr,Pt),Ne(tr,be(ai,f,b.rB)),Ii(tr,St),Ii(tr,be(ai,u,b.rA)),J(er),Ne(er,Pt),Ne(er,be(ai,f,M.rB)),Ii(er,St),Ii(er,be(ai,u,M.rA));var V=N(tr,vt),L=N(er,vt);for(Qt(we,V-b.velocityBias,L-M.velocityBias),we.x-=this.v_K.ex.x*Di.x+this.v_K.ey.x*Di.y,we.y-=this.v_K.ex.y*Di.x+this.v_K.ey.y*Di.y;;){if(J(wt),wt.x=-(this.v_normalMass.ex.x*we.x+this.v_normalMass.ey.x*we.y),wt.y=-(this.v_normalMass.ex.y*we.x+this.v_normalMass.ey.y*we.y),wt.x>=0&&wt.y>=0){st(Re,wt,Di),$(jt,Re.x,vt),$(Tt,Re.y,vt),ui(St,-l,jt,-l,Tt,1,St),u-=c*(lt(b.rA,jt)+lt(M.rA,Tt)),ui(Pt,h,jt,h,Tt,1,Pt),f+=d*(lt(b.rB,jt)+lt(M.rB,Tt)),b.normalImpulse=wt.x,M.normalImpulse=wt.y;break}if(wt.x=-b.normalMass*we.x,wt.y=0,V=0,L=this.v_K.ex.y*wt.x+we.y,wt.x>=0&&L>=0){st(Re,wt,Di),$(jt,Re.x,vt),$(Tt,Re.y,vt),ui(St,-l,jt,-l,Tt,1,St),u-=c*(lt(b.rA,jt)+lt(M.rA,Tt)),ui(Pt,h,jt,h,Tt,1,Pt),f+=d*(lt(b.rB,jt)+lt(M.rB,Tt)),b.normalImpulse=wt.x,M.normalImpulse=wt.y;break}if(wt.x=0,wt.y=-M.normalMass*we.y,V=this.v_K.ey.x*wt.y+we.x,L=0,wt.y>=0&&V>=0){st(Re,wt,Di),$(jt,Re.x,vt),$(Tt,Re.y,vt),ui(St,-l,jt,-l,Tt,1,St),u-=c*(lt(b.rA,jt)+lt(M.rA,Tt)),ui(Pt,h,jt,h,Tt,1,Pt),f+=d*(lt(b.rB,jt)+lt(M.rB,Tt)),b.normalImpulse=wt.x,M.normalImpulse=wt.y;break}if(wt.x=0,wt.y=0,V=we.x,L=we.y,V>=0&&L>=0){st(Re,wt,Di),$(jt,Re.x,vt),$(Tt,Re.y,vt),ui(St,-l,jt,-l,Tt,1,St),u-=c*(lt(b.rA,jt)+lt(M.rA,Tt)),ui(Pt,h,jt,h,Tt,1,Pt),f+=d*(lt(b.rB,jt)+lt(M.rB,Tt)),b.normalImpulse=wt.x,M.normalImpulse=wt.y;break}break}}P(o.v,St),o.w=u,P(a.v,Pt),a.w=f}}},i.addType=function(t,e,s){As[t]=As[t]||{},As[t][e]=s},i.create=function(t,e,s,r){var n=t.m_shape.m_type,o=s.m_shape.m_type,a=vh.allocate(),l;if(l=As[n]&&As[n][o])a.initialize(t,e,s,r,l);else if(l=As[o]&&As[o][n])a.initialize(s,r,t,e,l);else return null;t=a.m_fixtureA,s=a.m_fixtureB,e=a.getChildIndexA(),r=a.getChildIndexB();var c=t.m_body,h=s.m_body;return a.m_nodeA.contact=a,a.m_nodeA.other=h,a.m_nodeA.prev=null,a.m_nodeA.next=c.m_contactList,c.m_contactList!=null&&(c.m_contactList.prev=a.m_nodeA),c.m_contactList=a.m_nodeA,a.m_nodeB.contact=a,a.m_nodeB.other=c,a.m_nodeB.prev=null,a.m_nodeB.next=h.m_contactList,h.m_contactList!=null&&(h.m_contactList.prev=a.m_nodeB),h.m_contactList=a.m_nodeB,t.isSensor()==!1&&s.isSensor()==!1&&(c.setAwake(!0),h.setAwake(!0)),a},i.destroy=function(t,e){var s=t.m_fixtureA,r=t.m_fixtureB;if(!(s===null||r===null)){var n=s.m_body,o=r.m_body;n===null||o===null||(t.isTouching()&&e.endContact(t),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==n.m_contactList&&(n.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==o.m_contactList&&(o.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&!s.m_isSensor&&!r.m_isSensor&&(n.setAwake(!0),o.setAwake(!0)),vh.release(t))}},i}(),xf={gravity:m.zero(),allowSleep:!0,warmStarting:!0,continuousPhysics:!0,subStepping:!1,blockSolve:!0,velocityIterations:8,positionIterations:3},Pn=function(){function i(t){if(!(this instanceof i))return new i(t);this.s_step=new Il,t?m.isValid(t)&&(t={gravity:t}):t={},t=Ve(t,xf),this.m_solver=new dd(this),this.m_broadPhase=new Wp,this.m_contactList=null,this.m_contactCount=0,this.m_bodyList=null,this.m_bodyCount=0,this.m_jointList=null,this.m_jointCount=0,this.m_stepComplete=!0,this.m_allowSleep=t.allowSleep,this.m_gravity=m.clone(t.gravity),this.m_clearForces=!0,this.m_newFixture=!1,this.m_locked=!1,this.m_warmStarting=t.warmStarting,this.m_continuousPhysics=t.continuousPhysics,this.m_subStepping=t.subStepping,this.m_blockSolve=t.blockSolve,this.m_velocityIterations=t.velocityIterations,this.m_positionIterations=t.positionIterations,this.m_t=0}return i.prototype._serialize=function(){for(var t=[],e=[],s=this.getBodyList();s;s=s.getNext())t.push(s);for(var r=this.getJointList();r;r=r.getNext())typeof r._serialize=="function"&&e.push(r);return{gravity:this.m_gravity,bodies:t,joints:e}},i._deserialize=function(t,e,s){if(!t)return new i;var r=new i(t.gravity);if(t.bodies)for(var n=t.bodies.length-1;n>=0;n-=1)r._addBody(s(_t,t.bodies[n],r));if(t.joints)for(var n=t.joints.length-1;n>=0;n--)r.createJoint(s(re,t.joints[n],r));return r},i.prototype.getBodyList=function(){return this.m_bodyList},i.prototype.getJointList=function(){return this.m_jointList},i.prototype.getContactList=function(){return this.m_contactList},i.prototype.getBodyCount=function(){return this.m_bodyCount},i.prototype.getJointCount=function(){return this.m_jointCount},i.prototype.getContactCount=function(){return this.m_contactCount},i.prototype.setGravity=function(t){this.m_gravity.set(t)},i.prototype.getGravity=function(){return this.m_gravity},i.prototype.isLocked=function(){return this.m_locked},i.prototype.setAllowSleeping=function(t){if(t!=this.m_allowSleep&&(this.m_allowSleep=t,this.m_allowSleep==!1))for(var e=this.m_bodyList;e;e=e.m_next)e.setAwake(!0)},i.prototype.getAllowSleeping=function(){return this.m_allowSleep},i.prototype.setWarmStarting=function(t){this.m_warmStarting=t},i.prototype.getWarmStarting=function(){return this.m_warmStarting},i.prototype.setContinuousPhysics=function(t){this.m_continuousPhysics=t},i.prototype.getContinuousPhysics=function(){return this.m_continuousPhysics},i.prototype.setSubStepping=function(t){this.m_subStepping=t},i.prototype.getSubStepping=function(){return this.m_subStepping},i.prototype.setAutoClearForces=function(t){this.m_clearForces=t},i.prototype.getAutoClearForces=function(){return this.m_clearForces},i.prototype.clearForces=function(){for(var t=this.m_bodyList;t;t=t.getNext())t.m_force.setZero(),t.m_torque=0},i.prototype.queryAABB=function(t,e){var s=this.m_broadPhase;this.m_broadPhase.query(t,function(r){var n=s.getUserData(r);return e(n.fixture)})},i.prototype.rayCast=function(t,e,s){var r=this.m_broadPhase;this.m_broadPhase.rayCast({maxFraction:1,p1:t,p2:e},function(n,o){var a=r.getUserData(o),l=a.fixture,c=a.childIndex,h={},d=l.rayCast(h,n,c);if(d){var u=h.fraction,f=m.add(m.mulNumVec2(1-u,n.p1),m.mulNumVec2(u,n.p2));return s(l,f,h.normal,u)}return n.maxFraction})},i.prototype.getProxyCount=function(){return this.m_broadPhase.getProxyCount()},i.prototype.getTreeHeight=function(){return this.m_broadPhase.getTreeHeight()},i.prototype.getTreeBalance=function(){return this.m_broadPhase.getTreeBalance()},i.prototype.getTreeQuality=function(){return this.m_broadPhase.getTreeQuality()},i.prototype.shiftOrigin=function(t){if(!this.m_locked){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.sub(t),e.m_sweep.c0.sub(t),e.m_sweep.c.sub(t);for(var s=this.m_jointList;s;s=s.m_next)s.shiftOrigin(t);this.m_broadPhase.shiftOrigin(t)}},i.prototype._addBody=function(t){this.isLocked()||(t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount)},i.prototype.createBody=function(t,e){if(this.isLocked())return null;var s={};t&&(m.isValid(t)?s={position:t,angle:e}:typeof t=="object"&&(s=t));var r=new _t(this,s);return this._addBody(r),r},i.prototype.createDynamicBody=function(t,e){var s={};return t&&(m.isValid(t)?s={position:t,angle:e}:typeof t=="object"&&(s=t)),s.type="dynamic",this.createBody(s)},i.prototype.createKinematicBody=function(t,e){var s={};return t&&(m.isValid(t)?s={position:t,angle:e}:typeof t=="object"&&(s=t)),s.type="kinematic",this.createBody(s)},i.prototype.destroyBody=function(t){if(!this.isLocked()){if(t.m_destroyed)return!1;for(var e=t.m_jointList;e;){var s=e;e=e.next,this.publish("remove-joint",s.joint),this.destroyJoint(s.joint),t.m_jointList=e}t.m_jointList=null;for(var r=t.m_contactList;r;){var n=r;r=r.next,this.destroyContact(n.contact),t.m_contactList=r}t.m_contactList=null;for(var o=t.m_fixtureList;o;){var a=o;o=o.m_next,this.publish("remove-fixture",a),a.destroyProxies(this.m_broadPhase),t.m_fixtureList=o}return t.m_fixtureList=null,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),t.m_destroyed=!0,--this.m_bodyCount,this.publish("remove-body",t),!0}},i.prototype.createJoint=function(t){if(this.isLocked())return null;if(t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB,t.m_collideConnected==!1)for(var e=t.m_bodyB.getContactList();e;e=e.next)e.other==t.m_bodyA&&e.contact.flagForFiltering();return t},i.prototype.destroyJoint=function(t){if(!this.isLocked()){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var e=t.m_bodyA,s=t.m_bodyB;if(e.setAwake(!0),s.setAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==s.m_jointList&&(s.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,--this.m_jointCount,t.m_collideConnected==!1)for(var r=s.getContactList();r;)r.other==e&&r.contact.flagForFiltering(),r=r.next;this.publish("remove-joint",t)}},i.prototype.step=function(t,e,s){if(this.publish("pre-step",t),(e|0)!==e&&(e=0),e=e||this.m_velocityIterations,s=s||this.m_positionIterations,this.m_newFixture&&(this.findNewContacts(),this.m_newFixture=!1),this.m_locked=!0,this.s_step.reset(t),this.s_step.velocityIterations=e,this.s_step.positionIterations=s,this.s_step.warmStarting=this.m_warmStarting,this.s_step.blockSolve=this.m_blockSolve,this.updateContacts(),this.m_stepComplete&&t>0){this.m_solver.solveWorld(this.s_step);for(var r=this.m_bodyList;r;r=r.getNext())r.m_islandFlag!=!1&&(r.isStatic()||r.synchronizeFixtures());this.findNewContacts()}this.m_continuousPhysics&&t>0&&this.m_solver.solveWorldTOI(this.s_step),this.m_clearForces&&this.clearForces(),this.m_locked=!1,this.publish("post-step",t)},i.prototype.findNewContacts=function(){var t=this;this.m_broadPhase.updatePairs(function(e,s){return t.createContact(e,s)})},i.prototype.createContact=function(t,e){var s=t.fixture,r=e.fixture,n=t.childIndex,o=e.childIndex,a=s.getBody(),l=r.getBody();if(a!=l){for(var c=l.getContactList();c;){if(c.other==a){var h=c.contact.getFixtureA(),d=c.contact.getFixtureB(),u=c.contact.getChildIndexA(),f=c.contact.getChildIndexB();if(h==s&&d==r&&u==n&&f==o||h==r&&d==s&&u==o&&f==n)return}c=c.next}if(l.shouldCollide(a)!=!1&&r.shouldCollide(s)!=!1){var y=vi.create(s,n,r,o);y!=null&&(y.m_prev=null,this.m_contactList!=null&&(y.m_next=this.m_contactList,this.m_contactList.m_prev=y),this.m_contactList=y,++this.m_contactCount)}}},i.prototype.updateContacts=function(){for(var t,e=this.m_contactList;t=e;){e=t.getNext();var s=t.getFixtureA(),r=t.getFixtureB(),n=t.getChildIndexA(),o=t.getChildIndexB(),a=s.getBody(),l=r.getBody();if(t.m_filterFlag){if(l.shouldCollide(a)==!1){this.destroyContact(t);continue}if(r.shouldCollide(s)==!1){this.destroyContact(t);continue}t.m_filterFlag=!1}var c=a.isAwake()&&!a.isStatic(),h=l.isAwake()&&!l.isStatic();if(!(c==!1&&h==!1)){var d=s.m_proxies[n].proxyId,u=r.m_proxies[o].proxyId,f=this.m_broadPhase.testOverlap(d,u);if(f==!1){this.destroyContact(t);continue}t.update(this)}}},i.prototype.destroyContact=function(t){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_contactList&&(this.m_contactList=t.m_next),vi.destroy(t,this),--this.m_contactCount},i.prototype.on=function(t,e){return typeof t!="string"||typeof e!="function"?this:(this._listeners||(this._listeners={}),this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e),this)},i.prototype.off=function(t,e){if(typeof t!="string"||typeof e!="function")return this;var s=this._listeners&&this._listeners[t];if(!s||!s.length)return this;var r=s.indexOf(e);return r>=0&&s.splice(r,1),this},i.prototype.publish=function(t,e,s,r){var n=this._listeners&&this._listeners[t];if(!n||!n.length)return 0;for(var o=0;o<n.length;o++)n[o].call(this,e,s,r);return n.length},i.prototype.beginContact=function(t){this.publish("begin-contact",t)},i.prototype.endContact=function(t){this.publish("end-contact",t)},i.prototype.preSolve=function(t,e){this.publish("pre-solve",t,e)},i.prototype.postSolve=function(t,e){this.publish("post-solve",t,e)},i}(),pt=function(){function i(t,e,s){if(!(this instanceof i))return new i(t,e,s);typeof t>"u"?(this.x=0,this.y=0,this.z=0):typeof t=="object"?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=e,this.z=s)}return i.prototype._serialize=function(){return{x:this.x,y:this.y,z:this.z}},i._deserialize=function(t){var e=Object.create(i.prototype);return e.x=t.x,e.y=t.y,e.z=t.z,e},i.neo=function(t,e,s){var r=Object.create(i.prototype);return r.x=t,r.y=e,r.z=s,r},i.zero=function(){var t=Object.create(i.prototype);return t.x=0,t.y=0,t.z=0,t},i.clone=function(t){return i.neo(t.x,t.y,t.z)},i.prototype.toString=function(){return JSON.stringify(this)},i.isValid=function(t){return t===null||typeof t>"u"?!1:Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)},i.assert=function(t){},i.prototype.setZero=function(){return this.x=0,this.y=0,this.z=0,this},i.prototype.set=function(t,e,s){return this.x=t,this.y=e,this.z=s,this},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.prototype.mul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.areEqual=function(t,e){return t===e||typeof t=="object"&&t!==null&&typeof e=="object"&&e!==null&&t.x===e.x&&t.y===e.y&&t.z===e.z},i.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},i.cross=function(t,e){return new i(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)},i.add=function(t,e){return new i(t.x+e.x,t.y+e.y,t.z+e.z)},i.sub=function(t,e){return new i(t.x-e.x,t.y-e.y,t.z-e.z)},i.mul=function(t,e){return new i(e*t.x,e*t.y,e*t.z)},i.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},i.neg=function(t){return new i(-t.x,-t.y,-t.z)},i}(),bh=q(0,0),Bh=q(0,0),Ri=function(i){oe(t,i);function t(e,s){var r=this;return r instanceof t?(r=i.call(this)||this,r.m_type=t.TYPE,r.m_radius=K.polygonRadius,r.m_vertex1=e?m.clone(e):m.zero(),r.m_vertex2=s?m.clone(s):m.zero(),r.m_vertex0=m.zero(),r.m_vertex3=m.zero(),r.m_hasVertex0=!1,r.m_hasVertex3=!1,r):new t(e,s)}return t.prototype._serialize=function(){return{type:this.m_type,vertex1:this.m_vertex1,vertex2:this.m_vertex2,vertex0:this.m_vertex0,vertex3:this.m_vertex3,hasVertex0:this.m_hasVertex0,hasVertex3:this.m_hasVertex3}},t._deserialize=function(e){var s=new t(e.vertex1,e.vertex2);return s.m_hasVertex0&&s.setPrevVertex(e.vertex0),s.m_hasVertex3&&s.setNextVertex(e.vertex3),s},t.prototype._reset=function(){},t.prototype.getRadius=function(){return this.m_radius},t.prototype.getType=function(){return this.m_type},t.prototype.setNext=function(e){return this.setNextVertex(e)},t.prototype.setNextVertex=function(e){return e?(this.m_vertex3.setVec2(e),this.m_hasVertex3=!0):(this.m_vertex3.setZero(),this.m_hasVertex3=!1),this},t.prototype.getNextVertex=function(){return this.m_vertex3},t.prototype.setPrev=function(e){return this.setPrevVertex(e)},t.prototype.setPrevVertex=function(e){return e?(this.m_vertex0.setVec2(e),this.m_hasVertex0=!0):(this.m_vertex0.setZero(),this.m_hasVertex0=!1),this},t.prototype.getPrevVertex=function(){return this.m_vertex0},t.prototype._set=function(e,s){return this.m_vertex1.setVec2(e),this.m_vertex2.setVec2(s),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},t.prototype._clone=function(){var e=new t;return e.m_type=this.m_type,e.m_radius=this.m_radius,e.m_vertex1.setVec2(this.m_vertex1),e.m_vertex2.setVec2(this.m_vertex2),e.m_vertex0.setVec2(this.m_vertex0),e.m_vertex3.setVec2(this.m_vertex3),e.m_hasVertex0=this.m_hasVertex0,e.m_hasVertex3=this.m_hasVertex3,e},t.prototype.getChildCount=function(){return 1},t.prototype.testPoint=function(e,s){return!1},t.prototype.rayCast=function(e,s,r,n){var o=T.mulTVec2(r.q,m.sub(s.p1,r.p)),a=T.mulTVec2(r.q,m.sub(s.p2,r.p)),l=m.sub(a,o),c=this.m_vertex1,h=this.m_vertex2,d=m.sub(h,c),u=m.neo(d.y,-d.x);u.normalize();var f=m.dot(u,m.sub(c,o)),y=m.dot(u,l);if(y==0)return!1;var v=f/y;if(v<0||s.maxFraction<v)return!1;var g=m.add(o,m.mulNumVec2(v,l)),A=m.sub(h,c),B=m.dot(A,A);if(B==0)return!1;var F=m.dot(m.sub(g,c),A)/B;return F<0||1<F?!1:(e.fraction=v,f>0?e.normal=T.mulVec2(r.q,u).neg():e.normal=T.mulVec2(r.q,u),!0)},t.prototype.computeAABB=function(e,s,r){it(bh,s,this.m_vertex1),it(Bh,s,this.m_vertex2),Wt.combinePoints(e,bh,Bh),Wt.extend(e,this.m_radius)},t.prototype.computeMass=function(e,s){e.mass=0,Bt(e.center,.5,this.m_vertex1,.5,this.m_vertex2),e.I=0},t.prototype.computeDistanceProxy=function(e){e.m_vertices[0]=this.m_vertex1,e.m_vertices[1]=this.m_vertex2,e.m_vertices.length=2,e.m_count=2,e.m_radius=this.m_radius},t.TYPE="edge",t}(Ks),Ch=q(0,0),kh=q(0,0),wn=function(i){oe(t,i);function t(e,s){var r=this;return r instanceof t?(r=i.call(this)||this,r.m_type=t.TYPE,r.m_radius=K.polygonRadius,r.m_vertices=[],r.m_count=0,r.m_prevVertex=null,r.m_nextVertex=null,r.m_hasPrevVertex=!1,r.m_hasNextVertex=!1,r.m_isLoop=!!s,e&&e.length&&(s?r._createLoop(e):r._createChain(e)),r):new t(e,s)}return t.prototype._serialize=function(){var e={type:this.m_type,vertices:this.m_isLoop?this.m_vertices.slice(0,this.m_vertices.length-1):this.m_vertices,isLoop:this.m_isLoop,hasPrevVertex:this.m_hasPrevVertex,hasNextVertex:this.m_hasNextVertex,prevVertex:null,nextVertex:null};return this.m_prevVertex&&(e.prevVertex=this.m_prevVertex),this.m_nextVertex&&(e.nextVertex=this.m_nextVertex),e},t._deserialize=function(e,s,r){var n=[];if(e.vertices)for(var o=0;o<e.vertices.length;o++)n.push(r(m,e.vertices[o]));var a=new t(n,e.isLoop);return e.prevVertex&&a.setPrevVertex(e.prevVertex),e.nextVertex&&a.setNextVertex(e.nextVertex),a},t.prototype.getType=function(){return this.m_type},t.prototype.getRadius=function(){return this.m_radius},t.prototype._createLoop=function(e){if(!(e.length<3)){for(var s=1;s<e.length;++s)e[s-1],e[s];this.m_vertices=[],this.m_count=e.length+1;for(var s=0;s<e.length;++s)this.m_vertices[s]=m.clone(e[s]);return this.m_vertices[e.length]=m.clone(e[0]),this.m_prevVertex=this.m_vertices[this.m_count-2],this.m_nextVertex=this.m_vertices[1],this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this}},t.prototype._createChain=function(e){for(var s=1;s<e.length;++s)e[s-1],e[s];this.m_vertices=[],this.m_count=e.length;for(var s=0;s<e.length;++s)this.m_vertices[s]=m.clone(e[s]);return this.m_prevVertex=null,this.m_nextVertex=null,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this},t.prototype._reset=function(){this.m_isLoop?this._createLoop(this.m_vertices.slice(0,this.m_vertices.length-1)):this._createChain(this.m_vertices)},t.prototype.setPrevVertex=function(e){this.m_prevVertex=e,this.m_hasPrevVertex=!0},t.prototype.getPrevVertex=function(){return this.m_prevVertex},t.prototype.setNextVertex=function(e){this.m_nextVertex=e,this.m_hasNextVertex=!0},t.prototype.getNextVertex=function(){return this.m_nextVertex},t.prototype._clone=function(){var e=new t;return e._createChain(this.m_vertices),e.m_type=this.m_type,e.m_radius=this.m_radius,e.m_prevVertex=this.m_prevVertex,e.m_nextVertex=this.m_nextVertex,e.m_hasPrevVertex=this.m_hasPrevVertex,e.m_hasNextVertex=this.m_hasNextVertex,e},t.prototype.getChildCount=function(){return this.m_count-1},t.prototype.getChildEdge=function(e,s){e.m_type=Ri.TYPE,e.m_radius=this.m_radius,e.m_vertex1=this.m_vertices[s],e.m_vertex2=this.m_vertices[s+1],s>0?(e.m_vertex0=this.m_vertices[s-1],e.m_hasVertex0=!0):(e.m_vertex0=this.m_prevVertex,e.m_hasVertex0=this.m_hasPrevVertex),s<this.m_count-2?(e.m_vertex3=this.m_vertices[s+2],e.m_hasVertex3=!0):(e.m_vertex3=this.m_nextVertex,e.m_hasVertex3=this.m_hasNextVertex)},t.prototype.getVertex=function(e){return e<this.m_count?this.m_vertices[e]:this.m_vertices[0]},t.prototype.isLoop=function(){return this.m_isLoop},t.prototype.testPoint=function(e,s){return!1},t.prototype.rayCast=function(e,s,r,n){var o=new Ri(this.getVertex(n),this.getVertex(n+1));return o.rayCast(e,s,r,0)},t.prototype.computeAABB=function(e,s,r){it(Ch,s,this.getVertex(r)),it(kh,s,this.getVertex(r+1)),Wt.combinePoints(e,Ch,kh)},t.prototype.computeMass=function(e,s){e.mass=0,J(e.center),e.I=0},t.prototype.computeDistanceProxy=function(e,s){e.m_vertices[0]=this.getVertex(s),e.m_vertices[1]=this.getVertex(s+1),e.m_count=2,e.m_radius=this.m_radius},t.TYPE="chain",t}(Ks),Mh=Math.max,da=Math.min,Es=q(0,0),Fh=q(0,0),Zr=q(0,0),ir=q(0,0),bs=q(0,0),Gi=q(0,0),zi=function(i){oe(t,i);function t(e){var s=this;return s instanceof t?(s=i.call(this)||this,s.m_type=t.TYPE,s.m_radius=K.polygonRadius,s.m_centroid=m.zero(),s.m_vertices=[],s.m_normals=[],s.m_count=0,e&&e.length&&s._set(e),s):new t(e)}return t.prototype._serialize=function(){return{type:this.m_type,vertices:this.m_vertices}},t._deserialize=function(e,s,r){var n=[];if(e.vertices)for(var o=0;o<e.vertices.length;o++)n.push(r(m,e.vertices[o]));var a=new t(n);return a},t.prototype.getType=function(){return this.m_type},t.prototype.getRadius=function(){return this.m_radius},t.prototype._clone=function(){var e=new t;e.m_type=this.m_type,e.m_radius=this.m_radius,e.m_count=this.m_count,e.m_centroid.setVec2(this.m_centroid);for(var s=0;s<this.m_count;s++)e.m_vertices.push(this.m_vertices[s].clone());for(var s=0;s<this.m_normals.length;s++)e.m_normals.push(this.m_normals[s].clone());return e},t.prototype.getChildCount=function(){return 1},t.prototype._reset=function(){this._set(this.m_vertices)},t.prototype._set=function(e){if(e.length<3){this._setAsBox(1,1);return}for(var s=da(e.length,K.maxPolygonVertices),r=[],n=0;n<s;++n){for(var o=e[n],a=!0,l=0;l<r.length;++l)if(m.distanceSquared(o,r[l])<.25*K.linearSlopSquared){a=!1;break}a&&r.push(m.clone(o))}if(s=r.length,s<3){this._setAsBox(1,1);return}for(var c=0,h=r[0].x,n=1;n<s;++n){var d=r[n].x;(d>h||d===h&&r[n].y<r[c].y)&&(c=n,h=d)}for(var u=[],f=0,y=c;;){u[f]=y;for(var v=0,l=1;l<s;++l){if(v===y){v=l;continue}var g=m.sub(r[v],r[u[f]]),o=m.sub(r[l],r[u[f]]),A=m.crossVec2Vec2(g,o);A<0&&(v=l),A===0&&o.lengthSquared()>g.lengthSquared()&&(v=l)}if(++f,y=v,v===c)break}if(f<3){this._setAsBox(1,1);return}this.m_count=f,this.m_vertices=[];for(var n=0;n<f;++n)this.m_vertices[n]=r[u[n]];for(var n=0;n<f;++n){var B=n,F=n+1<f?n+1:0,E=m.sub(this.m_vertices[F],this.m_vertices[B]);this.m_normals[n]=m.crossVec2Num(E,1),this.m_normals[n].normalize()}this.m_centroid=wf(this.m_vertices,f)},t.prototype._setAsBox=function(e,s,r,n){if(this.m_vertices[0]=m.neo(e,-s),this.m_vertices[1]=m.neo(e,s),this.m_vertices[2]=m.neo(-e,s),this.m_vertices[3]=m.neo(-e,-s),this.m_normals[0]=m.neo(1,0),this.m_normals[1]=m.neo(0,1),this.m_normals[2]=m.neo(-1,0),this.m_normals[3]=m.neo(0,-1),this.m_count=4,r&&m.isValid(r)){n=n||0,P(this.m_centroid,r);var o=ii.identity();o.p.setVec2(r),o.q.setAngle(n);for(var a=0;a<this.m_count;++a)this.m_vertices[a]=ii.mulVec2(o,this.m_vertices[a]),this.m_normals[a]=T.mulVec2(o.q,this.m_normals[a])}},t.prototype.testPoint=function(e,s){for(var r=Fl(Es,e,s),n=0;n<this.m_count;++n){var o=N(this.m_normals[n],r)-N(this.m_normals[n],this.m_vertices[n]);if(o>0)return!1}return!0},t.prototype.rayCast=function(e,s,r,n){for(var o=T.mulTVec2(r.q,m.sub(s.p1,r.p)),a=T.mulTVec2(r.q,m.sub(s.p2,r.p)),l=m.sub(a,o),c=0,h=s.maxFraction,d=-1,u=0;u<this.m_count;++u){var f=m.dot(this.m_normals[u],m.sub(this.m_vertices[u],o)),y=m.dot(this.m_normals[u],l);if(y==0){if(f<0)return!1}else y<0&&f<c*y?(c=f/y,d=u):y>0&&f<h*y&&(h=f/y);if(h<c)return!1}return d>=0?(e.fraction=c,e.normal=T.mulVec2(r.q,this.m_normals[d]),!0):!1},t.prototype.computeAABB=function(e,s,r){for(var n=1/0,o=1/0,a=-1/0,l=-1/0,c=0;c<this.m_count;++c){var h=it(Es,s,this.m_vertices[c]);n=da(n,h.x),a=Mh(a,h.x),o=da(o,h.y),l=Mh(l,h.y)}Qt(e.lowerBound,n-this.m_radius,o-this.m_radius),Qt(e.upperBound,a+this.m_radius,l+this.m_radius)},t.prototype.computeMass=function(e,s){J(bs);var r=0,n=0;J(Gi);for(var o=0;o<this.m_count;++o)Ne(Gi,this.m_vertices[o]);$(Gi,1/this.m_count,Gi);for(var a=1/3,o=0;o<this.m_count;++o){st(Zr,this.m_vertices[o],Gi),o+1<this.m_count?st(ir,this.m_vertices[o+1],Gi):st(ir,this.m_vertices[0],Gi);var l=lt(Zr,ir),c=.5*l;r+=c,Bt(Es,c*a,Zr,c*a,ir),Ne(bs,Es);var h=Zr.x,d=Zr.y,u=ir.x,f=ir.y,y=h*h+u*h+u*u,v=d*d+f*d+f*f;n+=.25*a*l*(y+v)}e.mass=s*r,$(bs,1/r,bs),Xp(e.center,bs,Gi),e.I=s*n,e.I+=e.mass*(N(e.center,e.center)-N(bs,bs))},t.prototype.validate=function(){for(var e=0;e<this.m_count;++e){var s=e,r=e<this.m_count-1?s+1:0,n=this.m_vertices[s];st(Fh,this.m_vertices[r],n);for(var o=0;o<this.m_count;++o)if(!(o==s||o==r)){var a=lt(Fh,st(Es,this.m_vertices[o],n));if(a<0)return!1}}return!0},t.prototype.computeDistanceProxy=function(e){for(var s=0;s<this.m_count;++s)e.m_vertices[s]=this.m_vertices[s];e.m_vertices.length=this.m_count,e.m_count=this.m_count,e.m_radius=this.m_radius},t.TYPE="polygon",t}(Ks);function wf(i,t){for(var e=m.zero(),s=0,r=m.zero(),n,o=1/3,n=0;n<t;++n){var a=r,l=i[n],c=n+1<t?i[n+1]:i[0],h=m.sub(l,a),d=m.sub(c,a),u=m.crossVec2Vec2(h,d),f=.5*u;s+=f,ui(Es,1,a,1,l,1,c),ti(e,f*o,Es)}return e.mul(1/s),e}var bf=Math.sqrt,Bf=Math.PI,Eh=q(0,0),ms=function(i){oe(t,i);function t(e,s){var r=this;return r instanceof t?(r=i.call(this)||this,r.m_type=t.TYPE,r.m_p=m.zero(),r.m_radius=1,typeof e=="object"&&m.isValid(e)?(r.m_p.setVec2(e),typeof s=="number"&&(r.m_radius=s)):typeof e=="number"&&(r.m_radius=e),r):new t(e,s)}return t.prototype._serialize=function(){return{type:this.m_type,p:this.m_p,radius:this.m_radius}},t._deserialize=function(e){return new t(e.p,e.radius)},t.prototype._reset=function(){},t.prototype.getType=function(){return this.m_type},t.prototype.getRadius=function(){return this.m_radius},t.prototype.getCenter=function(){return this.m_p},t.prototype._clone=function(){var e=new t;return e.m_type=this.m_type,e.m_radius=this.m_radius,e.m_p=this.m_p.clone(),e},t.prototype.getChildCount=function(){return 1},t.prototype.testPoint=function(e,s){var r=it(Eh,e,this.m_p);return Vs(s,r)<=this.m_radius*this.m_radius},t.prototype.rayCast=function(e,s,r,n){var o=m.add(r.p,T.mulVec2(r.q,this.m_p)),a=m.sub(s.p1,o),l=m.dot(a,a)-this.m_radius*this.m_radius,c=m.sub(s.p2,s.p1),h=m.dot(a,c),d=m.dot(c,c),u=h*h-d*l;if(u<0||d<Fe)return!1;var f=-(h+bf(u));return 0<=f&&f<=s.maxFraction*d?(f/=d,e.fraction=f,e.normal=m.add(a,m.mulNumVec2(f,c)),e.normal.normalize(),!0):!1},t.prototype.computeAABB=function(e,s,r){var n=it(Eh,s,this.m_p);Qt(e.lowerBound,n.x-this.m_radius,n.y-this.m_radius),Qt(e.upperBound,n.x+this.m_radius,n.y+this.m_radius)},t.prototype.computeMass=function(e,s){e.mass=s*Bf*this.m_radius*this.m_radius,P(e.center,this.m_p),e.I=e.mass*(.5*this.m_radius*this.m_radius+Ds(this.m_p))},t.prototype.computeDistanceProxy=function(e){e.m_vertices[0]=this.m_p,e.m_vertices.length=1,e.m_count=1,e.m_radius=this.m_radius},t.TYPE="circle",t}(Ks),Cf=Math.abs,kf=Math.PI,Mf={frequencyHz:0,dampingRatio:0},Sh=function(i){oe(t,i);function t(e,s,r,n,o){var a=this;if(!(a instanceof t))return new t(e,s,r,n,o);if(r&&n&&"m_type"in n&&"x"in r&&"y"in r){var l=r;r=n,n=l}return e=Ve(e,Mf),a=i.call(this,e,s,r)||this,s=a.m_bodyA,r=a.m_bodyB,a.m_type=t.TYPE,a.m_localAnchorA=m.clone(n?s.getLocalPoint(n):e.localAnchorA||m.zero()),a.m_localAnchorB=m.clone(o?r.getLocalPoint(o):e.localAnchorB||m.zero()),a.m_length=Number.isFinite(e.length)?e.length:m.distance(s.getWorldPoint(a.m_localAnchorA),r.getWorldPoint(a.m_localAnchorB)),a.m_frequencyHz=e.frequencyHz,a.m_dampingRatio=e.dampingRatio,a.m_impulse=0,a.m_gamma=0,a.m_bias=0,a}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,length:this.m_length,impulse:this.m_impulse,gamma:this.m_gamma,bias:this.m_bias}},t._deserialize=function(e,s,r){e=ne({},e),e.bodyA=r(_t,e.bodyA,s),e.bodyB=r(_t,e.bodyB,s);var n=new t(e);return n},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),e.length>0?this.m_length=+e.length:e.length<0||(e.anchorA||e.anchorA||e.anchorA||e.anchorA)&&(this.m_length=m.distance(this.m_bodyA.getWorldPoint(this.m_localAnchorA),this.m_bodyB.getWorldPoint(this.m_localAnchorB))),Number.isFinite(e.frequencyHz)&&(this.m_frequencyHz=e.frequencyHz),Number.isFinite(e.dampingRatio)&&(this.m_dampingRatio=e.dampingRatio)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.setLength=function(e){this.m_length=e},t.prototype.getLength=function(){return this.m_length},t.prototype.setFrequency=function(e){this.m_frequencyHz=e},t.prototype.getFrequency=function(){return this.m_frequencyHz},t.prototype.setDampingRatio=function(e){this.m_dampingRatio=e},t.prototype.getDampingRatio=function(){return this.m_dampingRatio},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return m.mulNumVec2(this.m_impulse,this.m_u).mul(e)},t.prototype.getReactionTorque=function(e){return 0},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var s=this.m_bodyA.c_position.c,r=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_position.c,l=this.m_bodyB.c_position.a,c=this.m_bodyB.c_velocity.v,h=this.m_bodyB.c_velocity.w,d=T.neo(r),u=T.neo(l);this.m_rA=T.mulVec2(d,m.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=T.mulVec2(u,m.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_u=m.sub(m.add(a,this.m_rB),m.add(s,this.m_rA));var f=this.m_u.length();f>K.linearSlop?this.m_u.mul(1/f):this.m_u.setNum(0,0);var y=m.crossVec2Vec2(this.m_rA,this.m_u),v=m.crossVec2Vec2(this.m_rB,this.m_u),g=this.m_invMassA+this.m_invIA*y*y+this.m_invMassB+this.m_invIB*v*v;if(this.m_mass=g!=0?1/g:0,this.m_frequencyHz>0){var A=f-this.m_length,B=2*kf*this.m_frequencyHz,F=2*this.m_mass*this.m_dampingRatio*B,E=this.m_mass*B*B,k=e.dt;this.m_gamma=k*(F+k*E),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=A*k*E*this.m_gamma,g+=this.m_gamma,this.m_mass=g!=0?1/g:0}else this.m_gamma=0,this.m_bias=0;if(e.warmStarting){this.m_impulse*=e.dtRatio;var w=m.mulNumVec2(this.m_impulse,this.m_u);n.subMul(this.m_invMassA,w),o-=this.m_invIA*m.crossVec2Vec2(this.m_rA,w),c.addMul(this.m_invMassB,w),h+=this.m_invIB*m.crossVec2Vec2(this.m_rB,w)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(n),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.setVec2(c),this.m_bodyB.c_velocity.w=h},t.prototype.solveVelocityConstraints=function(e){var s=this.m_bodyA.c_velocity.v,r=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,a=m.add(s,m.crossNumVec2(r,this.m_rA)),l=m.add(n,m.crossNumVec2(o,this.m_rB)),c=m.dot(this.m_u,l)-m.dot(this.m_u,a),h=-this.m_mass*(c+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=h;var d=m.mulNumVec2(h,this.m_u);s.subMul(this.m_invMassA,d),r-=this.m_invIA*m.crossVec2Vec2(this.m_rA,d),n.addMul(this.m_invMassB,d),o+=this.m_invIB*m.crossVec2Vec2(this.m_rB,d),this.m_bodyA.c_velocity.v.setVec2(s),this.m_bodyA.c_velocity.w=r,this.m_bodyB.c_velocity.v.setVec2(n),this.m_bodyB.c_velocity.w=o},t.prototype.solvePositionConstraints=function(e){if(this.m_frequencyHz>0)return!0;var s=this.m_bodyA.c_position.c,r=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,a=T.neo(r),l=T.neo(o),c=T.mulSub(a,this.m_localAnchorA,this.m_localCenterA),h=T.mulSub(l,this.m_localAnchorB,this.m_localCenterB),d=m.sub(m.add(n,h),m.add(s,c)),u=d.normalize(),f=se(u-this.m_length,-K.maxLinearCorrection,K.maxLinearCorrection),y=-this.m_mass*f,v=m.mulNumVec2(y,d);return s.subMul(this.m_invMassA,v),r-=this.m_invIA*m.crossVec2Vec2(c,v),n.addMul(this.m_invMassB,v),o+=this.m_invIB*m.crossVec2Vec2(h,v),this.m_bodyA.c_position.c.setVec2(s),this.m_bodyA.c_position.a=r,this.m_bodyB.c_position.c.setVec2(n),this.m_bodyB.c_position.a=o,Cf(f)<K.linearSlop},t.TYPE="distance-joint",t}(re),Ff={maxForce:0,maxTorque:0},Ph=function(i){oe(t,i);function t(e,s,r,n){var o=this;return o instanceof t?(e=Ve(e,Ff),o=i.call(this,e,s,r)||this,s=o.m_bodyA,r=o.m_bodyB,o.m_type=t.TYPE,o.m_localAnchorA=m.clone(n?s.getLocalPoint(n):e.localAnchorA||m.zero()),o.m_localAnchorB=m.clone(n?r.getLocalPoint(n):e.localAnchorB||m.zero()),o.m_linearImpulse=m.zero(),o.m_angularImpulse=0,o.m_maxForce=e.maxForce,o.m_maxTorque=e.maxTorque,o):new t(e,s,r,n)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB}},t._deserialize=function(e,s,r){e=ne({},e),e.bodyA=r(_t,e.bodyA,s),e.bodyB=r(_t,e.bodyB,s);var n=new t(e);return n},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),Number.isFinite(e.maxForce)&&(this.m_maxForce=e.maxForce),Number.isFinite(e.maxTorque)&&(this.m_maxTorque=e.maxTorque)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.setMaxForce=function(e){this.m_maxForce=e},t.prototype.getMaxForce=function(){return this.m_maxForce},t.prototype.setMaxTorque=function(e){this.m_maxTorque=e},t.prototype.getMaxTorque=function(){return this.m_maxTorque},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return m.mulNumVec2(e,this.m_linearImpulse)},t.prototype.getReactionTorque=function(e){return e*this.m_angularImpulse},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var s=this.m_bodyA.c_position.a,r=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,c=T.neo(s),h=T.neo(o);this.m_rA=T.mulVec2(c,m.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=T.mulVec2(h,m.sub(this.m_localAnchorB,this.m_localCenterB));var d=this.m_invMassA,u=this.m_invMassB,f=this.m_invIA,y=this.m_invIB,v=new si;if(v.ex.x=d+u+f*this.m_rA.y*this.m_rA.y+y*this.m_rB.y*this.m_rB.y,v.ex.y=-f*this.m_rA.x*this.m_rA.y-y*this.m_rB.x*this.m_rB.y,v.ey.x=v.ex.y,v.ey.y=d+u+f*this.m_rA.x*this.m_rA.x+y*this.m_rB.x*this.m_rB.x,this.m_linearMass=v.getInverse(),this.m_angularMass=f+y,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),e.warmStarting){this.m_linearImpulse.mul(e.dtRatio),this.m_angularImpulse*=e.dtRatio;var g=m.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);r.subMul(d,g),n-=f*(m.crossVec2Vec2(this.m_rA,g)+this.m_angularImpulse),a.addMul(u,g),l+=y*(m.crossVec2Vec2(this.m_rB,g)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=l},t.prototype.solveVelocityConstraints=function(e){var s=this.m_bodyA.c_velocity.v,r=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,a=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,h=this.m_invIB,d=e.dt;{var u=o-r,f=-this.m_angularMass*u,y=this.m_angularImpulse,v=d*this.m_maxTorque;this.m_angularImpulse=se(this.m_angularImpulse+f,-v,v),f=this.m_angularImpulse-y,r-=c*f,o+=h*f}{var u=m.sub(m.add(n,m.crossNumVec2(o,this.m_rB)),m.add(s,m.crossNumVec2(r,this.m_rA))),f=m.neg(si.mulVec2(this.m_linearMass,u)),y=this.m_linearImpulse;this.m_linearImpulse.add(f);var v=d*this.m_maxForce;this.m_linearImpulse.lengthSquared()>v*v&&(this.m_linearImpulse.normalize(),this.m_linearImpulse.mul(v)),f=m.sub(this.m_linearImpulse,y),s.subMul(a,f),r-=c*m.crossVec2Vec2(this.m_rA,f),n.addMul(l,f),o+=h*m.crossVec2Vec2(this.m_rB,f)}this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=r,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=o},t.prototype.solvePositionConstraints=function(e){return!0},t.TYPE="friction-joint",t}(re),$i=function(){function i(t,e,s){typeof t=="object"&&t!==null?(this.ex=pt.clone(t),this.ey=pt.clone(e),this.ez=pt.clone(s)):(this.ex=pt.zero(),this.ey=pt.zero(),this.ez=pt.zero())}return i.prototype.toString=function(){return JSON.stringify(this)},i.isValid=function(t){return t===null||typeof t>"u"?!1:pt.isValid(t.ex)&&pt.isValid(t.ey)&&pt.isValid(t.ez)},i.assert=function(t){},i.prototype.setZero=function(){return this.ex.setZero(),this.ey.setZero(),this.ez.setZero(),this},i.prototype.solve33=function(t){var e=this.ey.y*this.ez.z-this.ey.z*this.ez.y,s=this.ey.z*this.ez.x-this.ey.x*this.ez.z,r=this.ey.x*this.ez.y-this.ey.y*this.ez.x,n=this.ex.x*e+this.ex.y*s+this.ex.z*r;n!==0&&(n=1/n);var o=new pt;return e=this.ey.y*this.ez.z-this.ey.z*this.ez.y,s=this.ey.z*this.ez.x-this.ey.x*this.ez.z,r=this.ey.x*this.ez.y-this.ey.y*this.ez.x,o.x=n*(t.x*e+t.y*s+t.z*r),e=t.y*this.ez.z-t.z*this.ez.y,s=t.z*this.ez.x-t.x*this.ez.z,r=t.x*this.ez.y-t.y*this.ez.x,o.y=n*(this.ex.x*e+this.ex.y*s+this.ex.z*r),e=this.ey.y*t.z-this.ey.z*t.y,s=this.ey.z*t.x-this.ey.x*t.z,r=this.ey.x*t.y-this.ey.y*t.x,o.z=n*(this.ex.x*e+this.ex.y*s+this.ex.z*r),o},i.prototype.solve22=function(t){var e=this.ex.x,s=this.ey.x,r=this.ex.y,n=this.ey.y,o=e*n-s*r;o!==0&&(o=1/o);var a=m.zero();return a.x=o*(n*t.x-s*t.y),a.y=o*(e*t.y-r*t.x),a},i.prototype.getInverse22=function(t){var e=this.ex.x,s=this.ey.x,r=this.ex.y,n=this.ey.y,o=e*n-s*r;o!==0&&(o=1/o),t.ex.x=o*n,t.ey.x=-o*s,t.ex.z=0,t.ex.y=-o*r,t.ey.y=o*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},i.prototype.getSymInverse33=function(t){var e=pt.dot(this.ex,pt.cross(this.ey,this.ez));e!==0&&(e=1/e);var s=this.ex.x,r=this.ey.x,n=this.ez.x,o=this.ey.y,a=this.ez.y,l=this.ez.z;t.ex.x=e*(o*l-a*a),t.ex.y=e*(n*a-r*l),t.ex.z=e*(r*a-n*o),t.ey.x=t.ex.y,t.ey.y=e*(s*l-n*n),t.ey.z=e*(n*r-s*a),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(s*o-r*r)},i.mul=function(t,e){if(e&&"z"in e&&"y"in e&&"x"in e){var s=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,r=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,n=t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z;return new pt(s,r,n)}else if(e&&"y"in e&&"x"in e){var s=t.ex.x*e.x+t.ey.x*e.y,r=t.ex.y*e.x+t.ey.y*e.y;return m.neo(s,r)}},i.mulVec3=function(t,e){var s=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,r=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,n=t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z;return new pt(s,r,n)},i.mulVec2=function(t,e){var s=t.ex.x*e.x+t.ey.x*e.y,r=t.ex.y*e.x+t.ey.y*e.y;return m.neo(s,r)},i.add=function(t,e){return new i(pt.add(t.ex,e.ex),pt.add(t.ey,e.ey),pt.add(t.ez,e.ez))},i}(),Dh=Math.abs,Yt;(function(i){i[i.inactiveLimit=0]="inactiveLimit",i[i.atLowerLimit=1]="atLowerLimit",i[i.atUpperLimit=2]="atUpperLimit",i[i.equalLimits=3]="equalLimits"})(Yt||(Yt={}));var sr={lowerAngle:0,upperAngle:0,maxMotorTorque:0,motorSpeed:0,enableLimit:!1,enableMotor:!1},Zi=function(i){oe(t,i);function t(e,s,r,n){var o=this,a,l,c,h,d,u;return o instanceof t?(e=e??{},o=i.call(this,e,s,r)||this,s=o.m_bodyA,r=o.m_bodyB,o.m_mass=new $i,o.m_limitState=Yt.inactiveLimit,o.m_type=t.TYPE,m.isValid(n)?o.m_localAnchorA=s.getLocalPoint(n):m.isValid(e.localAnchorA)?o.m_localAnchorA=m.clone(e.localAnchorA):o.m_localAnchorA=m.zero(),m.isValid(n)?o.m_localAnchorB=r.getLocalPoint(n):m.isValid(e.localAnchorB)?o.m_localAnchorB=m.clone(e.localAnchorB):o.m_localAnchorB=m.zero(),Number.isFinite(e.referenceAngle)?o.m_referenceAngle=e.referenceAngle:o.m_referenceAngle=r.getAngle()-s.getAngle(),o.m_impulse=new pt,o.m_motorImpulse=0,o.m_lowerAngle=(a=e.lowerAngle)!==null&&a!==void 0?a:sr.lowerAngle,o.m_upperAngle=(l=e.upperAngle)!==null&&l!==void 0?l:sr.upperAngle,o.m_maxMotorTorque=(c=e.maxMotorTorque)!==null&&c!==void 0?c:sr.maxMotorTorque,o.m_motorSpeed=(h=e.motorSpeed)!==null&&h!==void 0?h:sr.motorSpeed,o.m_enableLimit=(d=e.enableLimit)!==null&&d!==void 0?d:sr.enableLimit,o.m_enableMotor=(u=e.enableMotor)!==null&&u!==void 0?u:sr.enableMotor,o):new t(e,s,r,n)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerAngle:this.m_lowerAngle,upperAngle:this.m_upperAngle,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},t._deserialize=function(e,s,r){e=ne({},e),e.bodyA=r(_t,e.bodyA,s),e.bodyB=r(_t,e.bodyB,s);var n=new t(e);return n},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),Number.isFinite(e.referenceAngle)&&(this.m_referenceAngle=e.referenceAngle),e.enableLimit!==void 0&&(this.m_enableLimit=e.enableLimit),Number.isFinite(e.lowerAngle)&&(this.m_lowerAngle=e.lowerAngle),Number.isFinite(e.upperAngle)&&(this.m_upperAngle=e.upperAngle),Number.isFinite(e.maxMotorTorque)&&(this.m_maxMotorTorque=e.maxMotorTorque),Number.isFinite(e.motorSpeed)&&(this.m_motorSpeed=e.motorSpeed),e.enableMotor!==void 0&&(this.m_enableMotor=e.enableMotor)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.getReferenceAngle=function(){return this.m_referenceAngle},t.prototype.getJointAngle=function(){var e=this.m_bodyA,s=this.m_bodyB;return s.m_sweep.a-e.m_sweep.a-this.m_referenceAngle},t.prototype.getJointSpeed=function(){var e=this.m_bodyA,s=this.m_bodyB;return s.m_angularVelocity-e.m_angularVelocity},t.prototype.isMotorEnabled=function(){return this.m_enableMotor},t.prototype.enableMotor=function(e){e!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=e)},t.prototype.getMotorTorque=function(e){return e*this.m_motorImpulse},t.prototype.setMotorSpeed=function(e){e!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=e)},t.prototype.getMotorSpeed=function(){return this.m_motorSpeed},t.prototype.setMaxMotorTorque=function(e){e!=this.m_maxMotorTorque&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=e)},t.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},t.prototype.isLimitEnabled=function(){return this.m_enableLimit},t.prototype.enableLimit=function(e){e!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=e,this.m_impulse.z=0)},t.prototype.getLowerLimit=function(){return this.m_lowerAngle},t.prototype.getUpperLimit=function(){return this.m_upperAngle},t.prototype.setLimits=function(e,s){(e!=this.m_lowerAngle||s!=this.m_upperAngle)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=e,this.m_upperAngle=s)},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return m.neo(this.m_impulse.x,this.m_impulse.y).mul(e)},t.prototype.getReactionTorque=function(e){return e*this.m_impulse.z},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var s=this.m_bodyA.c_position.a,r=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,c=T.neo(s),h=T.neo(o);this.m_rA=T.mulVec2(c,m.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=T.mulVec2(h,m.sub(this.m_localAnchorB,this.m_localCenterB));var d=this.m_invMassA,u=this.m_invMassB,f=this.m_invIA,y=this.m_invIB,v=f+y===0;if(this.m_mass.ex.x=d+u+this.m_rA.y*this.m_rA.y*f+this.m_rB.y*this.m_rB.y*y,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*f-this.m_rB.y*this.m_rB.x*y,this.m_mass.ez.x=-this.m_rA.y*f-this.m_rB.y*y,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=d+u+this.m_rA.x*this.m_rA.x*f+this.m_rB.x*this.m_rB.x*y,this.m_mass.ez.y=this.m_rA.x*f+this.m_rB.x*y,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=f+y,this.m_motorMass=f+y,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(this.m_enableMotor==!1||v)&&(this.m_motorImpulse=0),this.m_enableLimit&&v==!1){var g=o-s-this.m_referenceAngle;Dh(this.m_upperAngle-this.m_lowerAngle)<2*K.angularSlop?this.m_limitState=Yt.equalLimits:g<=this.m_lowerAngle?(this.m_limitState!=Yt.atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=Yt.atLowerLimit):g>=this.m_upperAngle?(this.m_limitState!=Yt.atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=Yt.atUpperLimit):(this.m_limitState=Yt.inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=Yt.inactiveLimit;if(e.warmStarting){this.m_impulse.mul(e.dtRatio),this.m_motorImpulse*=e.dtRatio;var A=m.neo(this.m_impulse.x,this.m_impulse.y);r.subMul(d,A),n-=f*(m.crossVec2Vec2(this.m_rA,A)+this.m_motorImpulse+this.m_impulse.z),a.addMul(u,A),l+=y*(m.crossVec2Vec2(this.m_rB,A)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=l},t.prototype.solveVelocityConstraints=function(e){var s=this.m_bodyA.c_velocity.v,r=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,a=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,h=this.m_invIB,d=c+h===0;if(this.m_enableMotor&&this.m_limitState!=Yt.equalLimits&&d==!1){var u=o-r-this.m_motorSpeed,f=-this.m_motorMass*u,y=this.m_motorImpulse,v=e.dt*this.m_maxMotorTorque;this.m_motorImpulse=se(this.m_motorImpulse+f,-v,v),f=this.m_motorImpulse-y,r-=c*f,o+=h*f}if(this.m_enableLimit&&this.m_limitState!=Yt.inactiveLimit&&d==!1){var g=m.zero();g.addCombine(1,n,1,m.crossNumVec2(o,this.m_rB)),g.subCombine(1,s,1,m.crossNumVec2(r,this.m_rA));var A=o-r,u=new pt(g.x,g.y,A),f=pt.neg(this.m_mass.solve33(u));if(this.m_limitState==Yt.equalLimits)this.m_impulse.add(f);else if(this.m_limitState==Yt.atLowerLimit){var B=this.m_impulse.z+f.z;if(B<0){var F=m.combine(-1,g,this.m_impulse.z,m.neo(this.m_mass.ez.x,this.m_mass.ez.y)),E=this.m_mass.solve22(F);f.x=E.x,f.y=E.y,f.z=-this.m_impulse.z,this.m_impulse.x+=E.x,this.m_impulse.y+=E.y,this.m_impulse.z=0}else this.m_impulse.add(f)}else if(this.m_limitState==Yt.atUpperLimit){var B=this.m_impulse.z+f.z;if(B>0){var F=m.combine(-1,g,this.m_impulse.z,m.neo(this.m_mass.ez.x,this.m_mass.ez.y)),E=this.m_mass.solve22(F);f.x=E.x,f.y=E.y,f.z=-this.m_impulse.z,this.m_impulse.x+=E.x,this.m_impulse.y+=E.y,this.m_impulse.z=0}else this.m_impulse.add(f)}var k=m.neo(f.x,f.y);s.subMul(a,k),r-=c*(m.crossVec2Vec2(this.m_rA,k)+f.z),n.addMul(l,k),o+=h*(m.crossVec2Vec2(this.m_rB,k)+f.z)}else{var u=m.zero();u.addCombine(1,n,1,m.crossNumVec2(o,this.m_rB)),u.subCombine(1,s,1,m.crossNumVec2(r,this.m_rA));var f=this.m_mass.solve22(m.neg(u));this.m_impulse.x+=f.x,this.m_impulse.y+=f.y,s.subMul(a,f),r-=c*m.crossVec2Vec2(this.m_rA,f),n.addMul(l,f),o+=h*m.crossVec2Vec2(this.m_rB,f)}this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=r,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=o},t.prototype.solvePositionConstraints=function(e){var s=this.m_bodyA.c_position.c,r=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,a=T.neo(r),l=T.neo(o),c=0,h=0,d=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&this.m_limitState!=Yt.inactiveLimit&&d==!1){var u=o-r-this.m_referenceAngle,f=0;if(this.m_limitState==Yt.equalLimits){var y=se(u-this.m_lowerAngle,-K.maxAngularCorrection,K.maxAngularCorrection);f=-this.m_motorMass*y,c=Dh(y)}else if(this.m_limitState==Yt.atLowerLimit){var y=u-this.m_lowerAngle;c=-y,y=se(y+K.angularSlop,-K.maxAngularCorrection,0),f=-this.m_motorMass*y}else if(this.m_limitState==Yt.atUpperLimit){var y=u-this.m_upperAngle;c=y,y=se(y-K.angularSlop,0,K.maxAngularCorrection),f=-this.m_motorMass*y}r-=this.m_invIA*f,o+=this.m_invIB*f}{a.setAngle(r),l.setAngle(o);var v=T.mulVec2(a,m.sub(this.m_localAnchorA,this.m_localCenterA)),g=T.mulVec2(l,m.sub(this.m_localAnchorB,this.m_localCenterB)),y=m.zero();y.addCombine(1,n,1,g),y.subCombine(1,s,1,v),h=y.length();var A=this.m_invMassA,B=this.m_invMassB,F=this.m_invIA,E=this.m_invIB,k=new si;k.ex.x=A+B+F*v.y*v.y+E*g.y*g.y,k.ex.y=-F*v.x*v.y-E*g.x*g.y,k.ey.x=k.ex.y,k.ey.y=A+B+F*v.x*v.x+E*g.x*g.x;var w=m.neg(k.solve(y));s.subMul(A,w),r-=F*m.crossVec2Vec2(v,w),n.addMul(B,w),o+=E*m.crossVec2Vec2(g,w)}return this.m_bodyA.c_position.c.setVec2(s),this.m_bodyA.c_position.a=r,this.m_bodyB.c_position.c.setVec2(n),this.m_bodyB.c_position.a=o,h<=K.linearSlop&&c<=K.angularSlop},t.TYPE="revolute-joint",t}(re),$r=Math.abs,Vh=Math.max,Ef=Math.min,de;(function(i){i[i.inactiveLimit=0]="inactiveLimit",i[i.atLowerLimit=1]="atLowerLimit",i[i.atUpperLimit=2]="atUpperLimit",i[i.equalLimits=3]="equalLimits"})(de||(de={}));var Sf={enableLimit:!1,lowerTranslation:0,upperTranslation:0,enableMotor:!1,maxMotorForce:0,motorSpeed:0},Ih=function(i){oe(t,i);function t(e,s,r,n,o){var a=this;return a instanceof t?(e=Ve(e,Sf),a=i.call(this,e,s,r)||this,s=a.m_bodyA,r=a.m_bodyB,a.m_type=t.TYPE,a.m_localAnchorA=m.clone(n?s.getLocalPoint(n):e.localAnchorA||m.zero()),a.m_localAnchorB=m.clone(n?r.getLocalPoint(n):e.localAnchorB||m.zero()),a.m_localXAxisA=m.clone(o?s.getLocalVector(o):e.localAxisA||m.neo(1,0)),a.m_localXAxisA.normalize(),a.m_localYAxisA=m.crossNumVec2(1,a.m_localXAxisA),a.m_referenceAngle=Number.isFinite(e.referenceAngle)?e.referenceAngle:r.getAngle()-s.getAngle(),a.m_impulse=new pt,a.m_motorMass=0,a.m_motorImpulse=0,a.m_lowerTranslation=e.lowerTranslation,a.m_upperTranslation=e.upperTranslation,a.m_maxMotorForce=e.maxMotorForce,a.m_motorSpeed=e.motorSpeed,a.m_enableLimit=e.enableLimit,a.m_enableMotor=e.enableMotor,a.m_limitState=de.inactiveLimit,a.m_axis=m.zero(),a.m_perp=m.zero(),a.m_K=new $i,a):new t(e,s,r,n,o)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerTranslation:this.m_lowerTranslation,upperTranslation:this.m_upperTranslation,maxMotorForce:this.m_maxMotorForce,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA,referenceAngle:this.m_referenceAngle}},t._deserialize=function(e,s,r){e=ne({},e),e.bodyA=r(_t,e.bodyA,s),e.bodyB=r(_t,e.bodyB,s),e.localAxisA=m.clone(e.localAxisA);var n=new t(e);return n},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),e.localAxisA&&(this.m_localXAxisA.setVec2(e.localAxisA),this.m_localYAxisA.setVec2(m.crossNumVec2(1,e.localAxisA))),Number.isFinite(e.referenceAngle)&&(this.m_referenceAngle=e.referenceAngle),typeof e.enableLimit<"u"&&(this.m_enableLimit=!!e.enableLimit),Number.isFinite(e.lowerTranslation)&&(this.m_lowerTranslation=e.lowerTranslation),Number.isFinite(e.upperTranslation)&&(this.m_upperTranslation=e.upperTranslation),typeof e.enableMotor<"u"&&(this.m_enableMotor=!!e.enableMotor),Number.isFinite(e.maxMotorForce)&&(this.m_maxMotorForce=e.maxMotorForce),Number.isFinite(e.motorSpeed)&&(this.m_motorSpeed=e.motorSpeed)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.getLocalAxisA=function(){return this.m_localXAxisA},t.prototype.getReferenceAngle=function(){return this.m_referenceAngle},t.prototype.getJointTranslation=function(){var e=this.m_bodyA.getWorldPoint(this.m_localAnchorA),s=this.m_bodyB.getWorldPoint(this.m_localAnchorB),r=m.sub(s,e),n=this.m_bodyA.getWorldVector(this.m_localXAxisA),o=m.dot(r,n);return o},t.prototype.getJointSpeed=function(){var e=this.m_bodyA,s=this.m_bodyB,r=T.mulVec2(e.m_xf.q,m.sub(this.m_localAnchorA,e.m_sweep.localCenter)),n=T.mulVec2(s.m_xf.q,m.sub(this.m_localAnchorB,s.m_sweep.localCenter)),o=m.add(e.m_sweep.c,r),a=m.add(s.m_sweep.c,n),l=m.sub(a,o),c=T.mulVec2(e.m_xf.q,this.m_localXAxisA),h=e.m_linearVelocity,d=s.m_linearVelocity,u=e.m_angularVelocity,f=s.m_angularVelocity,y=m.dot(l,m.crossNumVec2(u,c))+m.dot(c,m.sub(m.addCrossNumVec2(d,f,n),m.addCrossNumVec2(h,u,r)));return y},t.prototype.isLimitEnabled=function(){return this.m_enableLimit},t.prototype.enableLimit=function(e){e!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=e,this.m_impulse.z=0)},t.prototype.getLowerLimit=function(){return this.m_lowerTranslation},t.prototype.getUpperLimit=function(){return this.m_upperTranslation},t.prototype.setLimits=function(e,s){(e!=this.m_lowerTranslation||s!=this.m_upperTranslation)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=s,this.m_impulse.z=0)},t.prototype.isMotorEnabled=function(){return this.m_enableMotor},t.prototype.enableMotor=function(e){e!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=e)},t.prototype.setMotorSpeed=function(e){e!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=e)},t.prototype.setMaxMotorForce=function(e){e!=this.m_maxMotorForce&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorForce=e)},t.prototype.getMaxMotorForce=function(){return this.m_maxMotorForce},t.prototype.getMotorSpeed=function(){return this.m_motorSpeed},t.prototype.getMotorForce=function(e){return e*this.m_motorImpulse},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return m.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis).mul(e)},t.prototype.getReactionTorque=function(e){return e*this.m_impulse.y},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var s=this.m_bodyA.c_position.c,r=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_position.c,l=this.m_bodyB.c_position.a,c=this.m_bodyB.c_velocity.v,h=this.m_bodyB.c_velocity.w,d=T.neo(r),u=T.neo(l),f=T.mulVec2(d,m.sub(this.m_localAnchorA,this.m_localCenterA)),y=T.mulVec2(u,m.sub(this.m_localAnchorB,this.m_localCenterB)),v=m.zero();v.addCombine(1,a,1,y),v.subCombine(1,s,1,f);var g=this.m_invMassA,A=this.m_invMassB,B=this.m_invIA,F=this.m_invIB;this.m_axis=T.mulVec2(d,this.m_localXAxisA),this.m_a1=m.crossVec2Vec2(m.add(v,f),this.m_axis),this.m_a2=m.crossVec2Vec2(y,this.m_axis),this.m_motorMass=g+A+B*this.m_a1*this.m_a1+F*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass);{this.m_perp=T.mulVec2(d,this.m_localYAxisA),this.m_s1=m.crossVec2Vec2(m.add(v,f),this.m_perp),this.m_s2=m.crossVec2Vec2(y,this.m_perp),m.crossVec2Vec2(f,this.m_perp);var E=g+A+B*this.m_s1*this.m_s1+F*this.m_s2*this.m_s2,k=B*this.m_s1+F*this.m_s2,w=B*this.m_s1*this.m_a1+F*this.m_s2*this.m_a2,b=B+F;b==0&&(b=1);var M=B*this.m_a1+F*this.m_a2,V=g+A+B*this.m_a1*this.m_a1+F*this.m_a2*this.m_a2;this.m_K.ex.set(E,k,w),this.m_K.ey.set(k,b,M),this.m_K.ez.set(w,M,V)}if(this.m_enableLimit){var L=m.dot(this.m_axis,v);$r(this.m_upperTranslation-this.m_lowerTranslation)<2*K.linearSlop?this.m_limitState=de.equalLimits:L<=this.m_lowerTranslation?this.m_limitState!=de.atLowerLimit&&(this.m_limitState=de.atLowerLimit,this.m_impulse.z=0):L>=this.m_upperTranslation?this.m_limitState!=de.atUpperLimit&&(this.m_limitState=de.atUpperLimit,this.m_impulse.z=0):(this.m_limitState=de.inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=de.inactiveLimit,this.m_impulse.z=0;if(this.m_enableMotor==!1&&(this.m_motorImpulse=0),e.warmStarting){this.m_impulse.mul(e.dtRatio),this.m_motorImpulse*=e.dtRatio;var z=m.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis),O=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,H=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;n.subMul(g,z),o-=B*O,c.addMul(A,z),h+=F*H}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(n),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.setVec2(c),this.m_bodyB.c_velocity.w=h},t.prototype.solveVelocityConstraints=function(e){var s=this.m_bodyA.c_velocity.v,r=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,a=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,h=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!=de.equalLimits){var d=m.dot(this.m_axis,m.sub(n,s))+this.m_a2*o-this.m_a1*r,u=this.m_motorMass*(this.m_motorSpeed-d),f=this.m_motorImpulse,y=e.dt*this.m_maxMotorForce;this.m_motorImpulse=se(this.m_motorImpulse+u,-y,y),u=this.m_motorImpulse-f;var v=m.mulNumVec2(u,this.m_axis),g=u*this.m_a1,A=u*this.m_a2;s.subMul(a,v),r-=c*g,n.addMul(l,v),o+=h*A}var B=m.zero();if(B.x+=m.dot(this.m_perp,n)+this.m_s2*o,B.x-=m.dot(this.m_perp,s)+this.m_s1*r,B.y=o-r,this.m_enableLimit&&this.m_limitState!=de.inactiveLimit){var F=0;F+=m.dot(this.m_axis,n)+this.m_a2*o,F-=m.dot(this.m_axis,s)+this.m_a1*r;var d=new pt(B.x,B.y,F),E=pt.clone(this.m_impulse),k=this.m_K.solve33(pt.neg(d));this.m_impulse.add(k),this.m_limitState==de.atLowerLimit?this.m_impulse.z=Vh(this.m_impulse.z,0):this.m_limitState==de.atUpperLimit&&(this.m_impulse.z=Ef(this.m_impulse.z,0));var w=m.combine(-1,B,-(this.m_impulse.z-E.z),m.neo(this.m_K.ez.x,this.m_K.ez.y)),b=m.add(this.m_K.solve22(w),m.neo(E.x,E.y));this.m_impulse.x=b.x,this.m_impulse.y=b.y,k=pt.sub(this.m_impulse,E);var v=m.combine(k.x,this.m_perp,k.z,this.m_axis),g=k.x*this.m_s1+k.y+k.z*this.m_a1,A=k.x*this.m_s2+k.y+k.z*this.m_a2;s.subMul(a,v),r-=c*g,n.addMul(l,v),o+=h*A}else{var k=this.m_K.solve22(m.neg(B));this.m_impulse.x+=k.x,this.m_impulse.y+=k.y;var v=m.mulNumVec2(k.x,this.m_perp),g=k.x*this.m_s1+k.y,A=k.x*this.m_s2+k.y;s.subMul(a,v),r-=c*g,n.addMul(l,v),o+=h*A}this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=r,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=o},t.prototype.solvePositionConstraints=function(e){var s=this.m_bodyA.c_position.c,r=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,a=T.neo(r),l=T.neo(o),c=this.m_invMassA,h=this.m_invMassB,d=this.m_invIA,u=this.m_invIB,f=T.mulVec2(a,m.sub(this.m_localAnchorA,this.m_localCenterA)),y=T.mulVec2(l,m.sub(this.m_localAnchorB,this.m_localCenterB)),v=m.sub(m.add(n,y),m.add(s,f)),g=T.mulVec2(a,this.m_localXAxisA),A=m.crossVec2Vec2(m.add(v,f),g),B=m.crossVec2Vec2(y,g),F=T.mulVec2(a,this.m_localYAxisA),E=m.crossVec2Vec2(m.add(v,f),F),k=m.crossVec2Vec2(y,F),w=new pt,b=m.zero();b.x=m.dot(F,v),b.y=o-r-this.m_referenceAngle;var M=$r(b.x),V=$r(b.y),L=K.linearSlop,z=K.maxLinearCorrection,O=!1,H=0;if(this.m_enableLimit){var Y=m.dot(g,v);$r(this.m_upperTranslation-this.m_lowerTranslation)<2*L?(H=se(Y,-z,z),M=Vh(M,$r(Y)),O=!0):Y<=this.m_lowerTranslation?(H=se(Y-this.m_lowerTranslation+L,-z,0),M=Math.max(M,this.m_lowerTranslation-Y),O=!0):Y>=this.m_upperTranslation&&(H=se(Y-this.m_upperTranslation-L,0,z),M=Math.max(M,Y-this.m_upperTranslation),O=!0)}if(O){var tt=c+h+d*E*E+u*k*k,G=d*E+u*k,Z=d*E*A+u*k*B,ot=d+u;ot==0&&(ot=1);var W=d*A+u*B,ct=c+h+d*A*A+u*B*B,ft=new $i;ft.ex.set(tt,G,Z),ft.ey.set(G,ot,W),ft.ez.set(Z,W,ct);var X=new pt;X.x=b.x,X.y=b.y,X.z=H,w=ft.solve33(pt.neg(X))}else{var tt=c+h+d*E*E+u*k*k,G=d*E+u*k,ot=d+u;ot==0&&(ot=1);var ft=new si;ft.ex.setNum(tt,G),ft.ey.setNum(G,ot);var Zt=ft.solve(m.neg(b));w.x=Zt.x,w.y=Zt.y,w.z=0}var he=m.combine(w.x,F,w.z,g),ve=w.x*E+w.y+w.z*A,xi=w.x*k+w.y+w.z*B;return s.subMul(c,he),r-=d*ve,n.addMul(h,he),o+=u*xi,this.m_bodyA.c_position.c=s,this.m_bodyA.c_position.a=r,this.m_bodyB.c_position.c=n,this.m_bodyB.c_position.a=o,M<=K.linearSlop&&V<=K.angularSlop},t.TYPE="prismatic-joint",t}(re),Pf={ratio:1},qh=function(i){oe(t,i);function t(e,s,r,n,o,a){var l=this;if(!(l instanceof t))return new t(e,s,r,n,o,a);e=Ve(e,Pf),l=i.call(this,e,s,r)||this,s=l.m_bodyA,r=l.m_bodyB,l.m_type=t.TYPE,l.m_joint1=n||e.joint1,l.m_joint2=o||e.joint2,l.m_ratio=Number.isFinite(a)?a:e.ratio,l.m_type1=l.m_joint1.getType(),l.m_type2=l.m_joint2.getType();var c,h;l.m_bodyC=l.m_joint1.getBodyA(),l.m_bodyA=l.m_joint1.getBodyB();var d=l.m_bodyA.m_xf,u=l.m_bodyA.m_sweep.a,f=l.m_bodyC.m_xf,y=l.m_bodyC.m_sweep.a;if(l.m_type1===Zi.TYPE){var v=l.m_joint1;l.m_localAnchorC=v.m_localAnchorA,l.m_localAnchorA=v.m_localAnchorB,l.m_referenceAngleA=v.m_referenceAngle,l.m_localAxisC=m.zero(),c=u-y-l.m_referenceAngleA}else{var g=l.m_joint1;l.m_localAnchorC=g.m_localAnchorA,l.m_localAnchorA=g.m_localAnchorB,l.m_referenceAngleA=g.m_referenceAngle,l.m_localAxisC=g.m_localXAxisA;var A=l.m_localAnchorC,B=T.mulTVec2(f.q,m.add(T.mulVec2(d.q,l.m_localAnchorA),m.sub(d.p,f.p)));c=m.dot(B,l.m_localAxisC)-m.dot(A,l.m_localAxisC)}l.m_bodyD=l.m_joint2.getBodyA(),l.m_bodyB=l.m_joint2.getBodyB();var F=l.m_bodyB.m_xf,E=l.m_bodyB.m_sweep.a,k=l.m_bodyD.m_xf,w=l.m_bodyD.m_sweep.a;if(l.m_type2===Zi.TYPE){var v=l.m_joint2;l.m_localAnchorD=v.m_localAnchorA,l.m_localAnchorB=v.m_localAnchorB,l.m_referenceAngleB=v.m_referenceAngle,l.m_localAxisD=m.zero(),h=E-w-l.m_referenceAngleB}else{var g=l.m_joint2;l.m_localAnchorD=g.m_localAnchorA,l.m_localAnchorB=g.m_localAnchorB,l.m_referenceAngleB=g.m_referenceAngle,l.m_localAxisD=g.m_localXAxisA;var b=l.m_localAnchorD,M=T.mulTVec2(k.q,m.add(T.mulVec2(F.q,l.m_localAnchorB),m.sub(F.p,k.p)));h=m.dot(M,l.m_localAxisD)-m.dot(b,l.m_localAxisD)}return l.m_constant=c+l.m_ratio*h,l.m_impulse=0,l}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,joint1:this.m_joint1,joint2:this.m_joint2,ratio:this.m_ratio}},t._deserialize=function(e,s,r){e=ne({},e),e.bodyA=r(_t,e.bodyA,s),e.bodyB=r(_t,e.bodyB,s),e.joint1=r(re,e.joint1,s),e.joint2=r(re,e.joint2,s);var n=new t(e);return n},t.prototype._reset=function(e){Number.isFinite(e.ratio)&&(this.m_ratio=e.ratio)},t.prototype.getJoint1=function(){return this.m_joint1},t.prototype.getJoint2=function(){return this.m_joint2},t.prototype.setRatio=function(e){this.m_ratio=e},t.prototype.getRatio=function(){return this.m_ratio},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return m.mulNumVec2(this.m_impulse,this.m_JvAC).mul(e)},t.prototype.getReactionTorque=function(e){var s=this.m_impulse*this.m_JwA;return e*s},t.prototype.initVelocityConstraints=function(e){this.m_lcA=this.m_bodyA.m_sweep.localCenter,this.m_lcB=this.m_bodyB.m_sweep.localCenter,this.m_lcC=this.m_bodyC.m_sweep.localCenter,this.m_lcD=this.m_bodyD.m_sweep.localCenter,this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var s=this.m_bodyA.c_position.a,r=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,c=this.m_bodyC.c_position.a,h=this.m_bodyC.c_velocity.v,d=this.m_bodyC.c_velocity.w,u=this.m_bodyD.c_position.a,f=this.m_bodyD.c_velocity.v,y=this.m_bodyD.c_velocity.w,v=T.neo(s),g=T.neo(o),A=T.neo(c),B=T.neo(u);if(this.m_mass=0,this.m_type1==Zi.TYPE)this.m_JvAC=m.zero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var F=T.mulVec2(A,this.m_localAxisC),E=T.mulSub(A,this.m_localAnchorC,this.m_lcC),k=T.mulSub(v,this.m_localAnchorA,this.m_lcA);this.m_JvAC=F,this.m_JwC=m.crossVec2Vec2(E,F),this.m_JwA=m.crossVec2Vec2(k,F),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_type2==Zi.TYPE)this.m_JvBD=m.zero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var F=T.mulVec2(B,this.m_localAxisD),w=T.mulSub(B,this.m_localAnchorD,this.m_lcD),b=T.mulSub(g,this.m_localAnchorB,this.m_lcB);this.m_JvBD=m.mulNumVec2(this.m_ratio,F),this.m_JwD=this.m_ratio*m.crossVec2Vec2(w,F),this.m_JwB=this.m_ratio*m.crossVec2Vec2(b,F),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,e.warmStarting?(r.addMul(this.m_mA*this.m_impulse,this.m_JvAC),n+=this.m_iA*this.m_impulse*this.m_JwA,a.addMul(this.m_mB*this.m_impulse,this.m_JvBD),l+=this.m_iB*this.m_impulse*this.m_JwB,h.subMul(this.m_mC*this.m_impulse,this.m_JvAC),d-=this.m_iC*this.m_impulse*this.m_JwC,f.subMul(this.m_mD*this.m_impulse,this.m_JvBD),y-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,this.m_bodyA.c_velocity.v.setVec2(r),this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v.setVec2(a),this.m_bodyB.c_velocity.w=l,this.m_bodyC.c_velocity.v.setVec2(h),this.m_bodyC.c_velocity.w=d,this.m_bodyD.c_velocity.v.setVec2(f),this.m_bodyD.c_velocity.w=y},t.prototype.solveVelocityConstraints=function(e){var s=this.m_bodyA.c_velocity.v,r=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,a=this.m_bodyC.c_velocity.v,l=this.m_bodyC.c_velocity.w,c=this.m_bodyD.c_velocity.v,h=this.m_bodyD.c_velocity.w,d=m.dot(this.m_JvAC,s)-m.dot(this.m_JvAC,a)+m.dot(this.m_JvBD,n)-m.dot(this.m_JvBD,c);d+=this.m_JwA*r-this.m_JwC*l+(this.m_JwB*o-this.m_JwD*h);var u=-this.m_mass*d;this.m_impulse+=u,s.addMul(this.m_mA*u,this.m_JvAC),r+=this.m_iA*u*this.m_JwA,n.addMul(this.m_mB*u,this.m_JvBD),o+=this.m_iB*u*this.m_JwB,a.subMul(this.m_mC*u,this.m_JvAC),l-=this.m_iC*u*this.m_JwC,c.subMul(this.m_mD*u,this.m_JvBD),h-=this.m_iD*u*this.m_JwD,this.m_bodyA.c_velocity.v.setVec2(s),this.m_bodyA.c_velocity.w=r,this.m_bodyB.c_velocity.v.setVec2(n),this.m_bodyB.c_velocity.w=o,this.m_bodyC.c_velocity.v.setVec2(a),this.m_bodyC.c_velocity.w=l,this.m_bodyD.c_velocity.v.setVec2(c),this.m_bodyD.c_velocity.w=h},t.prototype.solvePositionConstraints=function(e){var s=this.m_bodyA.c_position.c,r=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,a=this.m_bodyC.c_position.c,l=this.m_bodyC.c_position.a,c=this.m_bodyD.c_position.c,h=this.m_bodyD.c_position.a,d=T.neo(r),u=T.neo(o),f=T.neo(l),y=T.neo(h),v=0,g,A,B,F,E,k,w,b,M=0;if(this.m_type1==Zi.TYPE)B=m.zero(),E=1,w=1,M+=this.m_iA+this.m_iC,g=r-l-this.m_referenceAngleA;else{var V=T.mulVec2(f,this.m_localAxisC),L=T.mulSub(f,this.m_localAnchorC,this.m_lcC),z=T.mulSub(d,this.m_localAnchorA,this.m_lcA);B=V,w=m.crossVec2Vec2(L,V),E=m.crossVec2Vec2(z,V),M+=this.m_mC+this.m_mA+this.m_iC*w*w+this.m_iA*E*E;var O=m.sub(this.m_localAnchorC,this.m_lcC),H=T.mulTVec2(f,m.add(z,m.sub(s,a)));g=m.dot(m.sub(H,O),this.m_localAxisC)}if(this.m_type2==Zi.TYPE)F=m.zero(),k=this.m_ratio,b=this.m_ratio,M+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),A=o-h-this.m_referenceAngleB;else{var V=T.mulVec2(y,this.m_localAxisD),Y=T.mulSub(y,this.m_localAnchorD,this.m_lcD),tt=T.mulSub(u,this.m_localAnchorB,this.m_lcB);F=m.mulNumVec2(this.m_ratio,V),b=this.m_ratio*m.crossVec2Vec2(Y,V),k=this.m_ratio*m.crossVec2Vec2(tt,V),M+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*b*b+this.m_iB*k*k;var G=m.sub(this.m_localAnchorD,this.m_lcD),Z=T.mulTVec2(y,m.add(tt,m.sub(n,c)));A=m.dot(Z,this.m_localAxisD)-m.dot(G,this.m_localAxisD)}var ot=g+this.m_ratio*A-this.m_constant,W=0;return M>0&&(W=-ot/M),s.addMul(this.m_mA*W,B),r+=this.m_iA*W*E,n.addMul(this.m_mB*W,F),o+=this.m_iB*W*k,a.subMul(this.m_mC*W,B),l-=this.m_iC*W*w,c.subMul(this.m_mD*W,F),h-=this.m_iD*W*b,this.m_bodyA.c_position.c.setVec2(s),this.m_bodyA.c_position.a=r,this.m_bodyB.c_position.c.setVec2(n),this.m_bodyB.c_position.a=o,this.m_bodyC.c_position.c.setVec2(a),this.m_bodyC.c_position.a=l,this.m_bodyD.c_position.c.setVec2(c),this.m_bodyD.c_position.a=h,v<K.linearSlop},t.TYPE="gear-joint",t}(re),Df={maxForce:1,maxTorque:1,correctionFactor:.3},jh=function(i){oe(t,i);function t(e,s,r){var n=this;return n instanceof t?(e=Ve(e,Df),n=i.call(this,e,s,r)||this,s=n.m_bodyA,r=n.m_bodyB,n.m_type=t.TYPE,n.m_linearOffset=m.isValid(e.linearOffset)?m.clone(e.linearOffset):s.getLocalPoint(r.getPosition()),n.m_angularOffset=Number.isFinite(e.angularOffset)?e.angularOffset:r.getAngle()-s.getAngle(),n.m_linearImpulse=m.zero(),n.m_angularImpulse=0,n.m_maxForce=e.maxForce,n.m_maxTorque=e.maxTorque,n.m_correctionFactor=e.correctionFactor,n):new t(e,s,r)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,correctionFactor:this.m_correctionFactor,linearOffset:this.m_linearOffset,angularOffset:this.m_angularOffset}},t._deserialize=function(e,s,r){e=ne({},e),e.bodyA=r(_t,e.bodyA,s),e.bodyB=r(_t,e.bodyB,s);var n=new t(e);return n},t.prototype._reset=function(e){Number.isFinite(e.angularOffset)&&(this.m_angularOffset=e.angularOffset),Number.isFinite(e.maxForce)&&(this.m_maxForce=e.maxForce),Number.isFinite(e.maxTorque)&&(this.m_maxTorque=e.maxTorque),Number.isFinite(e.correctionFactor)&&(this.m_correctionFactor=e.correctionFactor),m.isValid(e.linearOffset)&&this.m_linearOffset.set(e.linearOffset)},t.prototype.setMaxForce=function(e){this.m_maxForce=e},t.prototype.getMaxForce=function(){return this.m_maxForce},t.prototype.setMaxTorque=function(e){this.m_maxTorque=e},t.prototype.getMaxTorque=function(){return this.m_maxTorque},t.prototype.setCorrectionFactor=function(e){this.m_correctionFactor=e},t.prototype.getCorrectionFactor=function(){return this.m_correctionFactor},t.prototype.setLinearOffset=function(e){(e.x!=this.m_linearOffset.x||e.y!=this.m_linearOffset.y)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_linearOffset.set(e))},t.prototype.getLinearOffset=function(){return this.m_linearOffset},t.prototype.setAngularOffset=function(e){e!=this.m_angularOffset&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_angularOffset=e)},t.prototype.getAngularOffset=function(){return this.m_angularOffset},t.prototype.getAnchorA=function(){return this.m_bodyA.getPosition()},t.prototype.getAnchorB=function(){return this.m_bodyB.getPosition()},t.prototype.getReactionForce=function(e){return m.mulNumVec2(e,this.m_linearImpulse)},t.prototype.getReactionTorque=function(e){return e*this.m_angularImpulse},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var s=this.m_bodyA.c_position.c,r=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_position.c,l=this.m_bodyB.c_position.a,c=this.m_bodyB.c_velocity.v,h=this.m_bodyB.c_velocity.w,d=T.neo(r),u=T.neo(l);this.m_rA=T.mulVec2(d,m.sub(this.m_linearOffset,this.m_localCenterA)),this.m_rB=T.mulVec2(u,m.neg(this.m_localCenterB));var f=this.m_invMassA,y=this.m_invMassB,v=this.m_invIA,g=this.m_invIB,A=new si;if(A.ex.x=f+y+v*this.m_rA.y*this.m_rA.y+g*this.m_rB.y*this.m_rB.y,A.ex.y=-v*this.m_rA.x*this.m_rA.y-g*this.m_rB.x*this.m_rB.y,A.ey.x=A.ex.y,A.ey.y=f+y+v*this.m_rA.x*this.m_rA.x+g*this.m_rB.x*this.m_rB.x,this.m_linearMass=A.getInverse(),this.m_angularMass=v+g,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),this.m_linearError=m.zero(),this.m_linearError.addCombine(1,a,1,this.m_rB),this.m_linearError.subCombine(1,s,1,this.m_rA),this.m_angularError=l-r-this.m_angularOffset,e.warmStarting){this.m_linearImpulse.mul(e.dtRatio),this.m_angularImpulse*=e.dtRatio;var B=m.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);n.subMul(f,B),o-=v*(m.crossVec2Vec2(this.m_rA,B)+this.m_angularImpulse),c.addMul(y,B),h+=g*(m.crossVec2Vec2(this.m_rB,B)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=n,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=c,this.m_bodyB.c_velocity.w=h},t.prototype.solveVelocityConstraints=function(e){var s=this.m_bodyA.c_velocity.v,r=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,a=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,h=this.m_invIB,d=e.dt,u=e.inv_dt;{var f=o-r+u*this.m_correctionFactor*this.m_angularError,y=-this.m_angularMass*f,v=this.m_angularImpulse,g=d*this.m_maxTorque;this.m_angularImpulse=se(this.m_angularImpulse+y,-g,g),y=this.m_angularImpulse-v,r-=c*y,o+=h*y}{var f=m.zero();f.addCombine(1,n,1,m.crossNumVec2(o,this.m_rB)),f.subCombine(1,s,1,m.crossNumVec2(r,this.m_rA)),f.addMul(u*this.m_correctionFactor,this.m_linearError);var y=m.neg(si.mulVec2(this.m_linearMass,f)),v=m.clone(this.m_linearImpulse);this.m_linearImpulse.add(y);var g=d*this.m_maxForce;this.m_linearImpulse.clamp(g),y=m.sub(this.m_linearImpulse,v),s.subMul(a,y),r-=c*m.crossVec2Vec2(this.m_rA,y),n.addMul(l,y),o+=h*m.crossVec2Vec2(this.m_rB,y)}this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=r,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=o},t.prototype.solvePositionConstraints=function(e){return!0},t.TYPE="motor-joint",t}(re),Vf=Math.PI,If={maxForce:0,frequencyHz:5,dampingRatio:.7},Th=function(i){oe(t,i);function t(e,s,r,n){var o=this;return o instanceof t?(e=Ve(e,If),o=i.call(this,e,s,r)||this,s=o.m_bodyA,r=o.m_bodyB,o.m_type=t.TYPE,m.isValid(n)?o.m_targetA=m.clone(n):m.isValid(e.target)?o.m_targetA=m.clone(e.target):o.m_targetA=m.zero(),o.m_localAnchorB=ii.mulTVec2(r.getTransform(),o.m_targetA),o.m_maxForce=e.maxForce,o.m_impulse=m.zero(),o.m_frequencyHz=e.frequencyHz,o.m_dampingRatio=e.dampingRatio,o.m_beta=0,o.m_gamma=0,o.m_rB=m.zero(),o.m_localCenterB=m.zero(),o.m_invMassB=0,o.m_invIB=0,o.m_mass=new si,o.m_C=m.zero(),o):new t(e,s,r,n)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,target:this.m_targetA,maxForce:this.m_maxForce,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,_localAnchorB:this.m_localAnchorB}},t._deserialize=function(e,s,r){e=ne({},e),e.bodyA=r(_t,e.bodyA,s),e.bodyB=r(_t,e.bodyB,s),e.target=m.clone(e.target);var n=new t(e);return e._localAnchorB&&(n.m_localAnchorB=e._localAnchorB),n},t.prototype._reset=function(e){Number.isFinite(e.maxForce)&&(this.m_maxForce=e.maxForce),Number.isFinite(e.frequencyHz)&&(this.m_frequencyHz=e.frequencyHz),Number.isFinite(e.dampingRatio)&&(this.m_dampingRatio=e.dampingRatio)},t.prototype.setTarget=function(e){m.areEqual(e,this.m_targetA)||(this.m_bodyB.setAwake(!0),this.m_targetA.set(e))},t.prototype.getTarget=function(){return this.m_targetA},t.prototype.setMaxForce=function(e){this.m_maxForce=e},t.prototype.getMaxForce=function(){return this.m_maxForce},t.prototype.setFrequency=function(e){this.m_frequencyHz=e},t.prototype.getFrequency=function(){return this.m_frequencyHz},t.prototype.setDampingRatio=function(e){this.m_dampingRatio=e},t.prototype.getDampingRatio=function(){return this.m_dampingRatio},t.prototype.getAnchorA=function(){return m.clone(this.m_targetA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return m.mulNumVec2(e,this.m_impulse)},t.prototype.getReactionTorque=function(e){return e*0},t.prototype.shiftOrigin=function(e){this.m_targetA.sub(e)},t.prototype.initVelocityConstraints=function(e){this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var s=this.m_bodyB.c_position,r=this.m_bodyB.c_velocity,n=s.c,o=s.a,a=r.v,l=r.w,c=T.neo(o),h=this.m_bodyB.getMass(),d=2*Vf*this.m_frequencyHz,u=2*h*this.m_dampingRatio*d,f=h*(d*d),y=e.dt;this.m_gamma=y*(u+y*f),this.m_gamma!=0&&(this.m_gamma=1/this.m_gamma),this.m_beta=y*f*this.m_gamma,this.m_rB=T.mulVec2(c,m.sub(this.m_localAnchorB,this.m_localCenterB));var v=new si;v.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,v.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,v.ey.x=v.ex.y,v.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass=v.getInverse(),this.m_C.setVec2(n),this.m_C.addCombine(1,this.m_rB,-1,this.m_targetA),this.m_C.mul(this.m_beta),l*=.98,e.warmStarting?(this.m_impulse.mul(e.dtRatio),a.addMul(this.m_invMassB,this.m_impulse),l+=this.m_invIB*m.crossVec2Vec2(this.m_rB,this.m_impulse)):this.m_impulse.setZero(),r.v.setVec2(a),r.w=l},t.prototype.solveVelocityConstraints=function(e){var s=this.m_bodyB.c_velocity,r=m.clone(s.v),n=s.w,o=m.crossNumVec2(n,this.m_rB);o.add(r),o.addCombine(1,this.m_C,this.m_gamma,this.m_impulse),o.neg();var a=si.mulVec2(this.m_mass,o),l=m.clone(this.m_impulse);this.m_impulse.add(a);var c=e.dt*this.m_maxForce;this.m_impulse.clamp(c),a=m.sub(this.m_impulse,l),r.addMul(this.m_invMassB,a),n+=this.m_invIB*m.crossVec2Vec2(this.m_rB,a),s.v.setVec2(r),s.w=n},t.prototype.solvePositionConstraints=function(e){return!0},t.TYPE="mouse-joint",t}(re),qf=Math.abs,jf={collideConnected:!0},Lh=function(i){oe(t,i);function t(e,s,r,n,o,a,l,c){var h=this;return h instanceof t?(e=Ve(e,jf),h=i.call(this,e,s,r)||this,s=h.m_bodyA,r=h.m_bodyB,h.m_type=t.TYPE,h.m_groundAnchorA=m.clone(n||e.groundAnchorA||m.neo(-1,1)),h.m_groundAnchorB=m.clone(o||e.groundAnchorB||m.neo(1,1)),h.m_localAnchorA=m.clone(a?s.getLocalPoint(a):e.localAnchorA||m.neo(-1,0)),h.m_localAnchorB=m.clone(l?r.getLocalPoint(l):e.localAnchorB||m.neo(1,0)),h.m_lengthA=Number.isFinite(e.lengthA)?e.lengthA:m.distance(a,n),h.m_lengthB=Number.isFinite(e.lengthB)?e.lengthB:m.distance(l,o),h.m_ratio=Number.isFinite(c)?c:e.ratio,h.m_constant=h.m_lengthA+h.m_ratio*h.m_lengthB,h.m_impulse=0,h):new t(e,s,r,n,o,a,l,c)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,groundAnchorA:this.m_groundAnchorA,groundAnchorB:this.m_groundAnchorB,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,lengthA:this.m_lengthA,lengthB:this.m_lengthB,ratio:this.m_ratio}},t._deserialize=function(e,s,r){e=ne({},e),e.bodyA=r(_t,e.bodyA,s),e.bodyB=r(_t,e.bodyB,s);var n=new t(e);return n},t.prototype._reset=function(e){m.isValid(e.groundAnchorA)&&this.m_groundAnchorA.set(e.groundAnchorA),m.isValid(e.groundAnchorB)&&this.m_groundAnchorB.set(e.groundAnchorB),m.isValid(e.localAnchorA)?this.m_localAnchorA.set(e.localAnchorA):m.isValid(e.anchorA)&&this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(e.anchorA)),m.isValid(e.localAnchorB)?this.m_localAnchorB.set(e.localAnchorB):m.isValid(e.anchorB)&&this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(e.anchorB)),Number.isFinite(e.lengthA)&&(this.m_lengthA=e.lengthA),Number.isFinite(e.lengthB)&&(this.m_lengthB=e.lengthB),Number.isFinite(e.ratio)&&(this.m_ratio=e.ratio)},t.prototype.getGroundAnchorA=function(){return this.m_groundAnchorA},t.prototype.getGroundAnchorB=function(){return this.m_groundAnchorB},t.prototype.getLengthA=function(){return this.m_lengthA},t.prototype.getLengthB=function(){return this.m_lengthB},t.prototype.getRatio=function(){return this.m_ratio},t.prototype.getCurrentLengthA=function(){var e=this.m_bodyA.getWorldPoint(this.m_localAnchorA),s=this.m_groundAnchorA;return m.distance(e,s)},t.prototype.getCurrentLengthB=function(){var e=this.m_bodyB.getWorldPoint(this.m_localAnchorB),s=this.m_groundAnchorB;return m.distance(e,s)},t.prototype.shiftOrigin=function(e){this.m_groundAnchorA.sub(e),this.m_groundAnchorB.sub(e)},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return m.mulNumVec2(this.m_impulse,this.m_uB).mul(e)},t.prototype.getReactionTorque=function(e){return 0},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var s=this.m_bodyA.c_position.c,r=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_position.c,l=this.m_bodyB.c_position.a,c=this.m_bodyB.c_velocity.v,h=this.m_bodyB.c_velocity.w,d=T.neo(r),u=T.neo(l);this.m_rA=T.mulVec2(d,m.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=T.mulVec2(u,m.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_uA=m.sub(m.add(s,this.m_rA),this.m_groundAnchorA),this.m_uB=m.sub(m.add(a,this.m_rB),this.m_groundAnchorB);var f=this.m_uA.length(),y=this.m_uB.length();f>10*K.linearSlop?this.m_uA.mul(1/f):this.m_uA.setZero(),y>10*K.linearSlop?this.m_uB.mul(1/y):this.m_uB.setZero();var v=m.crossVec2Vec2(this.m_rA,this.m_uA),g=m.crossVec2Vec2(this.m_rB,this.m_uB),A=this.m_invMassA+this.m_invIA*v*v,B=this.m_invMassB+this.m_invIB*g*g;if(this.m_mass=A+this.m_ratio*this.m_ratio*B,this.m_mass>0&&(this.m_mass=1/this.m_mass),e.warmStarting){this.m_impulse*=e.dtRatio;var F=m.mulNumVec2(-this.m_impulse,this.m_uA),E=m.mulNumVec2(-this.m_ratio*this.m_impulse,this.m_uB);n.addMul(this.m_invMassA,F),o+=this.m_invIA*m.crossVec2Vec2(this.m_rA,F),c.addMul(this.m_invMassB,E),h+=this.m_invIB*m.crossVec2Vec2(this.m_rB,E)}else this.m_impulse=0;this.m_bodyA.c_velocity.v=n,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=c,this.m_bodyB.c_velocity.w=h},t.prototype.solveVelocityConstraints=function(e){var s=this.m_bodyA.c_velocity.v,r=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,a=m.add(s,m.crossNumVec2(r,this.m_rA)),l=m.add(n,m.crossNumVec2(o,this.m_rB)),c=-m.dot(this.m_uA,a)-this.m_ratio*m.dot(this.m_uB,l),h=-this.m_mass*c;this.m_impulse+=h;var d=m.mulNumVec2(-h,this.m_uA),u=m.mulNumVec2(-this.m_ratio*h,this.m_uB);s.addMul(this.m_invMassA,d),r+=this.m_invIA*m.crossVec2Vec2(this.m_rA,d),n.addMul(this.m_invMassB,u),o+=this.m_invIB*m.crossVec2Vec2(this.m_rB,u),this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=r,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=o},t.prototype.solvePositionConstraints=function(e){var s=this.m_bodyA.c_position.c,r=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,a=T.neo(r),l=T.neo(o),c=T.mulVec2(a,m.sub(this.m_localAnchorA,this.m_localCenterA)),h=T.mulVec2(l,m.sub(this.m_localAnchorB,this.m_localCenterB)),d=m.sub(m.add(s,this.m_rA),this.m_groundAnchorA),u=m.sub(m.add(n,this.m_rB),this.m_groundAnchorB),f=d.length(),y=u.length();f>10*K.linearSlop?d.mul(1/f):d.setZero(),y>10*K.linearSlop?u.mul(1/y):u.setZero();var v=m.crossVec2Vec2(c,d),g=m.crossVec2Vec2(h,u),A=this.m_invMassA+this.m_invIA*v*v,B=this.m_invMassB+this.m_invIB*g*g,F=A+this.m_ratio*this.m_ratio*B;F>0&&(F=1/F);var E=this.m_constant-f-this.m_ratio*y,k=qf(E),w=-F*E,b=m.mulNumVec2(-w,d),M=m.mulNumVec2(-this.m_ratio*w,u);return s.addMul(this.m_invMassA,b),r+=this.m_invIA*m.crossVec2Vec2(c,b),n.addMul(this.m_invMassB,M),o+=this.m_invIB*m.crossVec2Vec2(h,M),this.m_bodyA.c_position.c=s,this.m_bodyA.c_position.a=r,this.m_bodyB.c_position.c=n,this.m_bodyB.c_position.a=o,k<K.linearSlop},t.TYPE="pulley-joint",t}(re),Tf=Math.min,cn;(function(i){i[i.inactiveLimit=0]="inactiveLimit",i[i.atLowerLimit=1]="atLowerLimit",i[i.atUpperLimit=2]="atUpperLimit",i[i.equalLimits=3]="equalLimits"})(cn||(cn={}));var Lf={maxLength:0},Rh=function(i){oe(t,i);function t(e,s,r,n){var o=this;return o instanceof t?(e=Ve(e,Lf),o=i.call(this,e,s,r)||this,s=o.m_bodyA,r=o.m_bodyB,o.m_type=t.TYPE,o.m_localAnchorA=m.clone(n?s.getLocalPoint(n):e.localAnchorA||m.neo(-1,0)),o.m_localAnchorB=m.clone(n?r.getLocalPoint(n):e.localAnchorB||m.neo(1,0)),o.m_maxLength=e.maxLength,o.m_mass=0,o.m_impulse=0,o.m_length=0,o.m_state=cn.inactiveLimit,o):new t(e,s,r,n)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,maxLength:this.m_maxLength}},t._deserialize=function(e,s,r){e=ne({},e),e.bodyA=r(_t,e.bodyA,s),e.bodyB=r(_t,e.bodyB,s);var n=new t(e);return n},t.prototype._reset=function(e){Number.isFinite(e.maxLength)&&(this.m_maxLength=e.maxLength)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.setMaxLength=function(e){this.m_maxLength=e},t.prototype.getMaxLength=function(){return this.m_maxLength},t.prototype.getLimitState=function(){return this.m_state},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return m.mulNumVec2(this.m_impulse,this.m_u).mul(e)},t.prototype.getReactionTorque=function(e){return 0},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var s=this.m_bodyA.c_position.c,r=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_position.c,l=this.m_bodyB.c_position.a,c=this.m_bodyB.c_velocity.v,h=this.m_bodyB.c_velocity.w,d=T.neo(r),u=T.neo(l);this.m_rA=T.mulSub(d,this.m_localAnchorA,this.m_localCenterA),this.m_rB=T.mulSub(u,this.m_localAnchorB,this.m_localCenterB),this.m_u=m.zero(),this.m_u.addCombine(1,a,1,this.m_rB),this.m_u.subCombine(1,s,1,this.m_rA),this.m_length=this.m_u.length();var f=this.m_length-this.m_maxLength;if(f>0?this.m_state=cn.atUpperLimit:this.m_state=cn.inactiveLimit,this.m_length>K.linearSlop)this.m_u.mul(1/this.m_length);else{this.m_u.setZero(),this.m_mass=0,this.m_impulse=0;return}var y=m.crossVec2Vec2(this.m_rA,this.m_u),v=m.crossVec2Vec2(this.m_rB,this.m_u),g=this.m_invMassA+this.m_invIA*y*y+this.m_invMassB+this.m_invIB*v*v;if(this.m_mass=g!=0?1/g:0,e.warmStarting){this.m_impulse*=e.dtRatio;var A=m.mulNumVec2(this.m_impulse,this.m_u);n.subMul(this.m_invMassA,A),o-=this.m_invIA*m.crossVec2Vec2(this.m_rA,A),c.addMul(this.m_invMassB,A),h+=this.m_invIB*m.crossVec2Vec2(this.m_rB,A)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(n),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.setVec2(c),this.m_bodyB.c_velocity.w=h},t.prototype.solveVelocityConstraints=function(e){var s=this.m_bodyA.c_velocity.v,r=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,a=m.addCrossNumVec2(s,r,this.m_rA),l=m.addCrossNumVec2(n,o,this.m_rB),c=this.m_length-this.m_maxLength,h=m.dot(this.m_u,m.sub(l,a));c<0&&(h+=e.inv_dt*c);var d=-this.m_mass*h,u=this.m_impulse;this.m_impulse=Tf(0,this.m_impulse+d),d=this.m_impulse-u;var f=m.mulNumVec2(d,this.m_u);s.subMul(this.m_invMassA,f),r-=this.m_invIA*m.crossVec2Vec2(this.m_rA,f),n.addMul(this.m_invMassB,f),o+=this.m_invIB*m.crossVec2Vec2(this.m_rB,f),this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=r,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=o},t.prototype.solvePositionConstraints=function(e){var s=this.m_bodyA.c_position.c,r=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,a=T.neo(r),l=T.neo(o),c=T.mulSub(a,this.m_localAnchorA,this.m_localCenterA),h=T.mulSub(l,this.m_localAnchorB,this.m_localCenterB),d=m.zero();d.addCombine(1,n,1,h),d.subCombine(1,s,1,c);var u=d.normalize(),f=u-this.m_maxLength;f=se(f,0,K.maxLinearCorrection);var y=-this.m_mass*f,v=m.mulNumVec2(y,d);return s.subMul(this.m_invMassA,v),r-=this.m_invIA*m.crossVec2Vec2(c,v),n.addMul(this.m_invMassB,v),o+=this.m_invIB*m.crossVec2Vec2(h,v),this.m_bodyA.c_position.c.setVec2(s),this.m_bodyA.c_position.a=r,this.m_bodyB.c_position.c.setVec2(n),this.m_bodyB.c_position.a=o,u-this.m_maxLength<K.linearSlop},t.TYPE="rope-joint",t}(re),Rf=Math.abs,zf=Math.PI,Nf={frequencyHz:0,dampingRatio:0},zh=function(i){oe(t,i);function t(e,s,r,n){var o=this;return o instanceof t?(e=Ve(e,Nf),o=i.call(this,e,s,r)||this,s=o.m_bodyA,r=o.m_bodyB,o.m_type=t.TYPE,o.m_localAnchorA=m.clone(n?s.getLocalPoint(n):e.localAnchorA||m.zero()),o.m_localAnchorB=m.clone(n?r.getLocalPoint(n):e.localAnchorB||m.zero()),o.m_referenceAngle=Number.isFinite(e.referenceAngle)?e.referenceAngle:r.getAngle()-s.getAngle(),o.m_frequencyHz=e.frequencyHz,o.m_dampingRatio=e.dampingRatio,o.m_impulse=new pt,o.m_bias=0,o.m_gamma=0,o.m_rA,o.m_rB,o.m_localCenterA,o.m_localCenterB,o.m_invMassA,o.m_invMassB,o.m_invIA,o.m_invIB,o.m_mass=new $i,o):new t(e,s,r,n)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},t._deserialize=function(e,s,r){e=ne({},e),e.bodyA=r(_t,e.bodyA,s),e.bodyB=r(_t,e.bodyB,s);var n=new t(e);return n},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),Number.isFinite(e.frequencyHz)&&(this.m_frequencyHz=e.frequencyHz),Number.isFinite(e.dampingRatio)&&(this.m_dampingRatio=e.dampingRatio)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.getReferenceAngle=function(){return this.m_referenceAngle},t.prototype.setFrequency=function(e){this.m_frequencyHz=e},t.prototype.getFrequency=function(){return this.m_frequencyHz},t.prototype.setDampingRatio=function(e){this.m_dampingRatio=e},t.prototype.getDampingRatio=function(){return this.m_dampingRatio},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return m.neo(this.m_impulse.x,this.m_impulse.y).mul(e)},t.prototype.getReactionTorque=function(e){return e*this.m_impulse.z},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var s=this.m_bodyA.c_position.a,r=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,c=T.neo(s),h=T.neo(o);this.m_rA=T.mulVec2(c,m.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=T.mulVec2(h,m.sub(this.m_localAnchorB,this.m_localCenterB));var d=this.m_invMassA,u=this.m_invMassB,f=this.m_invIA,y=this.m_invIB,v=new $i;if(v.ex.x=d+u+this.m_rA.y*this.m_rA.y*f+this.m_rB.y*this.m_rB.y*y,v.ey.x=-this.m_rA.y*this.m_rA.x*f-this.m_rB.y*this.m_rB.x*y,v.ez.x=-this.m_rA.y*f-this.m_rB.y*y,v.ex.y=v.ey.x,v.ey.y=d+u+this.m_rA.x*this.m_rA.x*f+this.m_rB.x*this.m_rB.x*y,v.ez.y=this.m_rA.x*f+this.m_rB.x*y,v.ex.z=v.ez.x,v.ey.z=v.ez.y,v.ez.z=f+y,this.m_frequencyHz>0){v.getInverse22(this.m_mass);var g=f+y,A=g>0?1/g:0,B=o-s-this.m_referenceAngle,F=2*zf*this.m_frequencyHz,E=2*A*this.m_dampingRatio*F,k=A*F*F,w=e.dt;this.m_gamma=w*(E+w*k),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=B*w*k*this.m_gamma,g+=this.m_gamma,this.m_mass.ez.z=g!=0?1/g:0}else v.ez.z==0?(v.getInverse22(this.m_mass),this.m_gamma=0,this.m_bias=0):(v.getSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0);if(e.warmStarting){this.m_impulse.mul(e.dtRatio);var b=m.neo(this.m_impulse.x,this.m_impulse.y);r.subMul(d,b),n-=f*(m.crossVec2Vec2(this.m_rA,b)+this.m_impulse.z),a.addMul(u,b),l+=y*(m.crossVec2Vec2(this.m_rB,b)+this.m_impulse.z)}else this.m_impulse.setZero();this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=l},t.prototype.solveVelocityConstraints=function(e){var s=this.m_bodyA.c_velocity.v,r=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,a=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,h=this.m_invIB;if(this.m_frequencyHz>0){var d=o-r,u=-this.m_mass.ez.z*(d+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=u,r-=c*u,o+=h*u;var f=m.zero();f.addCombine(1,n,1,m.crossNumVec2(o,this.m_rB)),f.subCombine(1,s,1,m.crossNumVec2(r,this.m_rA));var y=m.neg($i.mulVec2(this.m_mass,f));this.m_impulse.x+=y.x,this.m_impulse.y+=y.y;var v=m.clone(y);s.subMul(a,v),r-=c*m.crossVec2Vec2(this.m_rA,v),n.addMul(l,v),o+=h*m.crossVec2Vec2(this.m_rB,v)}else{var f=m.zero();f.addCombine(1,n,1,m.crossNumVec2(o,this.m_rB)),f.subCombine(1,s,1,m.crossNumVec2(r,this.m_rA));var d=o-r,g=new pt(f.x,f.y,d),A=pt.neg($i.mulVec3(this.m_mass,g));this.m_impulse.add(A);var v=m.neo(A.x,A.y);s.subMul(a,v),r-=c*(m.crossVec2Vec2(this.m_rA,v)+A.z),n.addMul(l,v),o+=h*(m.crossVec2Vec2(this.m_rB,v)+A.z)}this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=r,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=o},t.prototype.solvePositionConstraints=function(e){var s=this.m_bodyA.c_position.c,r=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,a=T.neo(r),l=T.neo(o),c=this.m_invMassA,h=this.m_invMassB,d=this.m_invIA,u=this.m_invIB,f=T.mulVec2(a,m.sub(this.m_localAnchorA,this.m_localCenterA)),y=T.mulVec2(l,m.sub(this.m_localAnchorB,this.m_localCenterB)),v,g,A=new $i;if(A.ex.x=c+h+f.y*f.y*d+y.y*y.y*u,A.ey.x=-f.y*f.x*d-y.y*y.x*u,A.ez.x=-f.y*d-y.y*u,A.ex.y=A.ey.x,A.ey.y=c+h+f.x*f.x*d+y.x*y.x*u,A.ez.y=f.x*d+y.x*u,A.ex.z=A.ez.x,A.ey.z=A.ez.y,A.ez.z=d+u,this.m_frequencyHz>0){var B=m.zero();B.addCombine(1,n,1,y),B.subCombine(1,s,1,f),v=B.length(),g=0;var F=m.neg(A.solve22(B));s.subMul(c,F),r-=d*m.crossVec2Vec2(f,F),n.addMul(h,F),o+=u*m.crossVec2Vec2(y,F)}else{var B=m.zero();B.addCombine(1,n,1,y),B.subCombine(1,s,1,f);var E=o-r-this.m_referenceAngle;v=B.length(),g=Rf(E);var k=new pt(B.x,B.y,E),w=new pt;if(A.ez.z>0)w=pt.neg(A.solve33(k));else{var b=m.neg(A.solve22(B));w.set(b.x,b.y,0)}var F=m.neo(w.x,w.y);s.subMul(c,F),r-=d*(m.crossVec2Vec2(f,F)+w.z),n.addMul(h,F),o+=u*(m.crossVec2Vec2(y,F)+w.z)}return this.m_bodyA.c_position.c=s,this.m_bodyA.c_position.a=r,this.m_bodyB.c_position.c=n,this.m_bodyB.c_position.a=o,v<=K.linearSlop&&g<=K.angularSlop},t.TYPE="weld-joint",t}(re),Of=Math.abs,Uf=Math.PI,Hf={enableMotor:!1,maxMotorTorque:0,motorSpeed:0,frequencyHz:2,dampingRatio:.7},Nh=function(i){oe(t,i);function t(e,s,r,n,o){var a=this;return a instanceof t?(e=Ve(e,Hf),a=i.call(this,e,s,r)||this,s=a.m_bodyA,r=a.m_bodyB,a.m_ax=m.zero(),a.m_ay=m.zero(),a.m_type=t.TYPE,a.m_localAnchorA=m.clone(n?s.getLocalPoint(n):e.localAnchorA||m.zero()),a.m_localAnchorB=m.clone(n?r.getLocalPoint(n):e.localAnchorB||m.zero()),m.isValid(o)?a.m_localXAxisA=s.getLocalVector(o):m.isValid(e.localAxisA)?a.m_localXAxisA=m.clone(e.localAxisA):m.isValid(e.localAxis)?a.m_localXAxisA=m.clone(e.localAxis):a.m_localXAxisA=m.neo(1,0),a.m_localYAxisA=m.crossNumVec2(1,a.m_localXAxisA),a.m_mass=0,a.m_impulse=0,a.m_motorMass=0,a.m_motorImpulse=0,a.m_springMass=0,a.m_springImpulse=0,a.m_maxMotorTorque=e.maxMotorTorque,a.m_motorSpeed=e.motorSpeed,a.m_enableMotor=e.enableMotor,a.m_frequencyHz=e.frequencyHz,a.m_dampingRatio=e.dampingRatio,a.m_bias=0,a.m_gamma=0,a):new t(e,s,r,n,o)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,enableMotor:this.m_enableMotor,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA}},t._deserialize=function(e,s,r){e=ne({},e),e.bodyA=r(_t,e.bodyA,s),e.bodyB=r(_t,e.bodyB,s);var n=new t(e);return n},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),e.localAxisA&&(this.m_localXAxisA.setVec2(e.localAxisA),this.m_localYAxisA.setVec2(m.crossNumVec2(1,e.localAxisA))),e.enableMotor!==void 0&&(this.m_enableMotor=e.enableMotor),Number.isFinite(e.maxMotorTorque)&&(this.m_maxMotorTorque=e.maxMotorTorque),Number.isFinite(e.motorSpeed)&&(this.m_motorSpeed=e.motorSpeed),Number.isFinite(e.frequencyHz)&&(this.m_frequencyHz=e.frequencyHz),Number.isFinite(e.dampingRatio)&&(this.m_dampingRatio=e.dampingRatio)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.getLocalAxisA=function(){return this.m_localXAxisA},t.prototype.getJointTranslation=function(){var e=this.m_bodyA,s=this.m_bodyB,r=e.getWorldPoint(this.m_localAnchorA),n=s.getWorldPoint(this.m_localAnchorB),o=m.sub(n,r),a=e.getWorldVector(this.m_localXAxisA),l=m.dot(o,a);return l},t.prototype.getJointSpeed=function(){var e=this.m_bodyA.m_angularVelocity,s=this.m_bodyB.m_angularVelocity;return s-e},t.prototype.isMotorEnabled=function(){return this.m_enableMotor},t.prototype.enableMotor=function(e){e!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=e)},t.prototype.setMotorSpeed=function(e){e!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=e)},t.prototype.getMotorSpeed=function(){return this.m_motorSpeed},t.prototype.setMaxMotorTorque=function(e){e!=this.m_maxMotorTorque&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=e)},t.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},t.prototype.getMotorTorque=function(e){return e*this.m_motorImpulse},t.prototype.setSpringFrequencyHz=function(e){this.m_frequencyHz=e},t.prototype.getSpringFrequencyHz=function(){return this.m_frequencyHz},t.prototype.setSpringDampingRatio=function(e){this.m_dampingRatio=e},t.prototype.getSpringDampingRatio=function(){return this.m_dampingRatio},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return m.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax).mul(e)},t.prototype.getReactionTorque=function(e){return e*this.m_motorImpulse},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var s=this.m_invMassA,r=this.m_invMassB,n=this.m_invIA,o=this.m_invIB,a=this.m_bodyA.c_position.c,l=this.m_bodyA.c_position.a,c=this.m_bodyA.c_velocity.v,h=this.m_bodyA.c_velocity.w,d=this.m_bodyB.c_position.c,u=this.m_bodyB.c_position.a,f=this.m_bodyB.c_velocity.v,y=this.m_bodyB.c_velocity.w,v=T.neo(l),g=T.neo(u),A=T.mulVec2(v,m.sub(this.m_localAnchorA,this.m_localCenterA)),B=T.mulVec2(g,m.sub(this.m_localAnchorB,this.m_localCenterB)),F=m.zero();if(F.addCombine(1,d,1,B),F.subCombine(1,a,1,A),this.m_ay=T.mulVec2(v,this.m_localYAxisA),this.m_sAy=m.crossVec2Vec2(m.add(F,A),this.m_ay),this.m_sBy=m.crossVec2Vec2(B,this.m_ay),this.m_mass=s+r+n*this.m_sAy*this.m_sAy+o*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){this.m_ax=T.mulVec2(v,this.m_localXAxisA),this.m_sAx=m.crossVec2Vec2(m.add(F,A),this.m_ax),this.m_sBx=m.crossVec2Vec2(B,this.m_ax);var E=s+r+n*this.m_sAx*this.m_sAx+o*this.m_sBx*this.m_sBx;if(E>0){this.m_springMass=1/E;var k=m.dot(F,this.m_ax),w=2*Uf*this.m_frequencyHz,b=2*this.m_springMass*this.m_dampingRatio*w,M=this.m_springMass*w*w,V=e.dt;this.m_gamma=V*(b+V*M),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=k*V*M*this.m_gamma,this.m_springMass=E+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=n+o,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),e.warmStarting){this.m_impulse*=e.dtRatio,this.m_springImpulse*=e.dtRatio,this.m_motorImpulse*=e.dtRatio;var L=m.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax),z=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,O=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;c.subMul(this.m_invMassA,L),h-=this.m_invIA*z,f.addMul(this.m_invMassB,L),y+=this.m_invIB*O}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(c),this.m_bodyA.c_velocity.w=h,this.m_bodyB.c_velocity.v.setVec2(f),this.m_bodyB.c_velocity.w=y},t.prototype.solveVelocityConstraints=function(e){var s=this.m_invMassA,r=this.m_invMassB,n=this.m_invIA,o=this.m_invIB,a=this.m_bodyA.c_velocity.v,l=this.m_bodyA.c_velocity.w,c=this.m_bodyB.c_velocity.v,h=this.m_bodyB.c_velocity.w;{var d=m.dot(this.m_ax,c)-m.dot(this.m_ax,a)+this.m_sBx*h-this.m_sAx*l,u=-this.m_springMass*(d+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=u;var f=m.mulNumVec2(u,this.m_ax),y=u*this.m_sAx,v=u*this.m_sBx;a.subMul(s,f),l-=n*y,c.addMul(r,f),h+=o*v}{var d=h-l-this.m_motorSpeed,u=-this.m_motorMass*d,g=this.m_motorImpulse,A=e.dt*this.m_maxMotorTorque;this.m_motorImpulse=se(this.m_motorImpulse+u,-A,A),u=this.m_motorImpulse-g,l-=n*u,h+=o*u}{var d=m.dot(this.m_ay,c)-m.dot(this.m_ay,a)+this.m_sBy*h-this.m_sAy*l,u=-this.m_mass*d;this.m_impulse+=u;var f=m.mulNumVec2(u,this.m_ay),y=u*this.m_sAy,v=u*this.m_sBy;a.subMul(s,f),l-=n*y,c.addMul(r,f),h+=o*v}this.m_bodyA.c_velocity.v.setVec2(a),this.m_bodyA.c_velocity.w=l,this.m_bodyB.c_velocity.v.setVec2(c),this.m_bodyB.c_velocity.w=h},t.prototype.solvePositionConstraints=function(e){var s=this.m_bodyA.c_position.c,r=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,a=T.neo(r),l=T.neo(o),c=T.mulVec2(a,m.sub(this.m_localAnchorA,this.m_localCenterA)),h=T.mulVec2(l,m.sub(this.m_localAnchorB,this.m_localCenterB)),d=m.zero();d.addCombine(1,n,1,h),d.subCombine(1,s,1,c);var u=T.mulVec2(a,this.m_localYAxisA),f=m.crossVec2Vec2(m.add(d,c),u),y=m.crossVec2Vec2(h,u),v=m.dot(d,u),g=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy,A=g!=0?-v/g:0,B=m.mulNumVec2(A,u),F=A*f,E=A*y;return s.subMul(this.m_invMassA,B),r-=this.m_invIA*F,n.addMul(this.m_invMassB,B),o+=this.m_invIB*E,this.m_bodyA.c_position.c.setVec2(s),this.m_bodyA.c_position.a=r,this.m_bodyB.c_position.c.setVec2(n),this.m_bodyB.c_position.a=o,Of(v)<=K.linearSlop},t.TYPE="wheel-joint",t}(re),Lt,Kf=0,Oh={World:Pn,Body:_t,Joint:re,Fixture:Do,Shape:Ks},Uh={Vec2:m,Vec3:pt,World:Pn,Body:_t,Joint:re,Fixture:Do,Shape:Ks},Yf=(Lt={},Lt[_t.STATIC]=_t,Lt[_t.DYNAMIC]=_t,Lt[_t.KINEMATIC]=_t,Lt[wn.TYPE]=wn,Lt[zi.TYPE]=zi,Lt[Ri.TYPE]=Ri,Lt[ms.TYPE]=ms,Lt[Sh.TYPE]=Sh,Lt[Ph.TYPE]=Ph,Lt[qh.TYPE]=qh,Lt[jh.TYPE]=jh,Lt[Th.TYPE]=Th,Lt[Ih.TYPE]=Ih,Lt[Lh.TYPE]=Lh,Lt[Zi.TYPE]=Zi,Lt[Rh.TYPE]=Rh,Lt[zh.TYPE]=zh,Lt[Nh.TYPE]=Nh,Lt),Gf={rootClass:Pn,preSerialize:function(i){return i},postSerialize:function(i,t){return i},preDeserialize:function(i){return i},postDeserialize:function(i,t){return i}},ql=function(){function i(t){var e=this;this.toJson=function(s){var r=e.options.preSerialize,n=e.options.postSerialize,o=[],a=[s],l={};function c(y,v){if(y.__sid=y.__sid||++Kf,!l[y.__sid]){a.push(y);var g=o.length+a.length,A={refIndex:g,refType:v};l[y.__sid]=A}return l[y.__sid]}function h(y){y=r(y);var v=y._serialize();return v=n(v,y),v}function d(y,v){if(v===void 0&&(v=!1),typeof y!="object"||y===null)return y;if(typeof y._serialize=="function"){if(!v){for(var g in Oh)if(y instanceof Oh[g])return c(y,g)}y=h(y)}if(Array.isArray(y)){for(var A=[],B=0;B<y.length;B++)A[B]=d(y[B]);y=A}else{var A={};for(var B in y)y.hasOwnProperty(B)&&(A[B]=d(y[B]));y=A}return y}for(;a.length;){var u=a.shift(),f=d(u,!0);o.push(f)}return o},this.fromJson=function(s){var r=e.options.preDeserialize,n=e.options.postDeserialize,o=e.options.rootClass,a={};function l(d,u,f){(!d||!d._deserialize)&&(d=Yf[u.type]);var y=d&&d._deserialize;if(y){u=r(u);var v=d._deserialize,g=v(u,f,c);return g=n(g,u),g}}function c(d,u,f){var y=u.refIndex&&u.refType;if(!y)return l(d,u,f);var v=u;Uh[v.refType]&&(d=Uh[v.refType]);var g=v.refIndex;if(!a[g]){var A=s[g],B=l(d,A,f);a[g]=B}return a[g]}var h=l(o,s[0],null);return h},this.options=ne(ne({},Gf),t)}return i}(),_d=new ql({rootClass:Pn});ql.fromJson=_d.fromJson;ql.toJson=_d.toJson;(function(){function i(){this.width=80,this.height=60,this.x=0,this.y=-10,this.scaleY=-1,this.hz=60,this.speed=1,this.background="#222222",this.activeKeys={},this.step=function(t,e){},this.keydown=function(t,e){},this.keyup=function(t,e){}}return i.mount=function(t){throw new Error("Not implemented")},i.start=function(t){var e=i.mount();return e.start(t),e},i.prototype.color=function(t,e,s){return t=t*256|0,e=e*256|0,s=s*256|0,"rgb("+t+", "+e+", "+s+")"},i})();var Wf=function(i){oe(t,i);function t(e,s,r,n){var o=this;return o instanceof t?(o=i.call(this)||this,o._setAsBox(e,s,r,n),o):new t(e,s,r,n)}return t.TYPE="polygon",t}(zi);vi.addType(ms.TYPE,ms.TYPE,Jf);function Jf(i,t,e,s,r,n,o){Xf(i,e.getShape(),t,n.getShape(),r)}var Hh=q(0,0),Kh=q(0,0),Xf=function(i,t,e,s,r){i.pointCount=0,it(Hh,e,t.m_p),it(Kh,r,s.m_p);var n=Vs(Kh,Hh),o=t.m_radius,a=s.m_radius,l=o+a;n>l*l||(i.type=Ft.e_circles,P(i.localPoint,t.m_p),J(i.localNormal),i.pointCount=1,P(i.points[0].localPoint,s.m_p),i.points[0].id.setFeatures(0,mt.e_vertex,0,mt.e_vertex))};vi.addType(Ri.TYPE,ms.TYPE,Qf);vi.addType(wn.TYPE,ms.TYPE,Zf);function Qf(i,t,e,s,r,n,o){var a=e.getShape(),l=n.getShape();vd(i,a,t,l,r)}function Zf(i,t,e,s,r,n,o){var a=e.getShape(),l=new Ri;a.getChildEdge(l,s);var c=l,h=n.getShape();vd(i,c,t,h,r)}var Bs=q(0,0),pa=q(0,0),fa=q(0,0),Vi=q(0,0),Cs=q(0,0),rr=q(0,0),vd=function(i,t,e,s,r){i.pointCount=0,ad(Vi,r,e,s.m_p);var n=t.m_vertex1,o=t.m_vertex2;st(Bs,o,n);var a=N(Bs,o)-N(Bs,Vi),l=N(Bs,Vi)-N(Bs,n),c=t.m_radius+s.m_radius;if(l<=0){P(Cs,n);var h=Vs(Vi,n);if(h>c*c)return;if(t.m_hasVertex0){var d=t.m_vertex0,u=n;st(pa,u,d);var f=N(pa,u)-N(pa,Vi);if(f>0)return}i.type=Ft.e_circles,J(i.localNormal),P(i.localPoint,Cs),i.pointCount=1,P(i.points[0].localPoint,s.m_p),i.points[0].id.setFeatures(0,mt.e_vertex,0,mt.e_vertex);return}if(a<=0){P(Cs,o);var y=Vs(Vi,Cs);if(y>c*c)return;if(t.m_hasVertex3){var v=t.m_vertex3,g=o;st(fa,v,g);var A=N(fa,Vi)-N(fa,g);if(A>0)return}i.type=Ft.e_circles,J(i.localNormal),P(i.localPoint,Cs),i.pointCount=1,P(i.points[0].localPoint,s.m_p),i.points[0].id.setFeatures(1,mt.e_vertex,0,mt.e_vertex);return}var B=Ds(Bs);Bt(Cs,a/B,n,l/B,o);var F=Vs(Vi,Cs);F>c*c||(be(rr,1,Bs),N(rr,Vi)-N(rr,n)<0&&An(rr),ei(rr),i.type=Ft.e_faceA,P(i.localNormal,rr),P(i.localPoint,n),i.pointCount=1,P(i.points[0].localPoint,s.m_p),i.points[0].id.setFeatures(0,mt.e_face,0,mt.e_vertex))},oo=[new Pe,new Pe],ao=[new Pe,new Pe],ks=[new Pe,new Pe],lo=q(0,0),Yh=q(0,0),ya=q(0,0),_a=Hs(0,0,0),Ms=q(0,0),nr=q(0,0),ho=q(0,0),Gh=q(0,0),Wh=q(0,0),Wi=q(0,0),va=q(0,0),Jh=q(0,0);vi.addType(zi.TYPE,zi.TYPE,$f);function $f(i,t,e,s,r,n,o){ey(i,e.getShape(),t,n.getShape(),r)}function Xh(i,t,e,s,r){var n=i.m_count,o=e.m_count,a=i.m_normals,l=i.m_vertices,c=e.m_vertices;ld(_a,s,t);for(var h=0,d=-1/0,u=0;u<n;++u){Ue(ya,_a.q,a[u]),it(Yh,_a,l[u]);for(var f=1/0,y=0;y<o;++y){var v=N(ya,c[y])-N(ya,Yh);v<f&&(f=v)}f>d&&(d=f,h=u)}r.maxSeparation=d,r.bestIndex=h}function ty(i,t,e,s,r,n){var o=t.m_normals,a=r.m_count,l=r.m_vertices,c=r.m_normals;$p(Jh,n.q,e.q,o[s]);for(var h=0,d=1/0,u=0;u<a;++u){var f=N(Jh,c[u]);f<d&&(d=f,h=u)}var y=h,v=y+1<a?y+1:0;it(i[0].v,n,l[y]),i[0].id.setFeatures(s,mt.e_face,y,mt.e_vertex),it(i[1].v,n,l[v]),i[1].id.setFeatures(s,mt.e_face,v,mt.e_vertex)}var or={maxSeparation:0,bestIndex:0},ey=function(i,t,e,s,r){i.pointCount=0;var n=t.m_radius+s.m_radius;Xh(t,e,s,r,or);var o=or.bestIndex,a=or.maxSeparation;if(!(a>n)){Xh(s,r,t,e,or);var l=or.bestIndex,c=or.maxSeparation;if(!(c>n)){var h,d,u,f,y,v,g=.1*K.linearSlop;c>a+g?(h=s,d=t,u=r,f=e,y=l,i.type=Ft.e_faceB,v=!0):(h=t,d=s,u=e,f=r,y=o,i.type=Ft.e_faceA,v=!1),oo[0].recycle(),oo[1].recycle(),ty(oo,h,u,y,d,f);var A=h.m_count,B=h.m_vertices,F=y,E=y+1<A?y+1:0;P(Ms,B[F]),P(nr,B[E]),st(ho,nr,Ms),ei(ho),Ps(Gh,ho,1),Bt(Wh,.5,Ms,.5,nr),Ue(Wi,u.q,ho),Ps(va,Wi,1),it(Ms,u,Ms),it(nr,u,nr);var k=N(va,Ms),w=-N(Wi,Ms)+n,b=N(Wi,nr)+n;ao[0].recycle(),ao[1].recycle(),ks[0].recycle(),ks[1].recycle(),Qt(lo,-Wi.x,-Wi.y);var M=xn(ao,oo,lo,w,F);if(!(M<2)){Qt(lo,Wi.x,Wi.y);var V=xn(ks,ao,lo,b,E);if(!(V<2)){P(i.localNormal,Gh),P(i.localPoint,Wh);for(var L=0,z=0;z<ks.length;++z){var O=N(va,ks[z].v)-k;if(O<=n){var H=i.points[L];Fl(H.localPoint,f,ks[z].v),H.id.set(ks[z].id),v&&H.id.swapFeatures(),++L}}i.pointCount=L}}}}};vi.addType(zi.TYPE,ms.TYPE,iy);function iy(i,t,e,s,r,n,o){sy(i,e.getShape(),t,n.getShape(),r)}var Je=q(0,0),ga=q(0,0),sy=function(i,t,e,s,r){i.pointCount=0,ad(Je,r,e,s.m_p);for(var n=0,o=-1/0,a=t.m_radius+s.m_radius,l=t.m_count,c=t.m_vertices,h=t.m_normals,d=0;d<l;++d){var u=N(h[d],Je)-N(h[d],c[d]);if(u>a)return;u>o&&(o=u,n=d)}var f=n,y=f+1<l?f+1:0,v=c[f],g=c[y];if(o<Fe){i.pointCount=1,i.type=Ft.e_faceA,P(i.localNormal,h[n]),Bt(i.localPoint,.5,v,.5,g),P(i.points[0].localPoint,s.m_p),i.points[0].id.setFeatures(0,mt.e_vertex,0,mt.e_vertex);return}var A=N(Je,g)-N(Je,v)-N(v,g)+N(v,v),B=N(Je,v)-N(Je,g)-N(g,v)+N(g,g);if(A<=0){if(Vs(Je,v)>a*a)return;i.pointCount=1,i.type=Ft.e_faceA,st(i.localNormal,Je,v),ei(i.localNormal),P(i.localPoint,v),P(i.points[0].localPoint,s.m_p),i.points[0].id.setFeatures(0,mt.e_vertex,0,mt.e_vertex)}else if(B<=0){if(Vs(Je,g)>a*a)return;i.pointCount=1,i.type=Ft.e_faceA,st(i.localNormal,Je,g),ei(i.localNormal),P(i.localPoint,g),P(i.points[0].localPoint,s.m_p),i.points[0].id.setFeatures(0,mt.e_vertex,0,mt.e_vertex)}else{Bt(ga,.5,v,.5,g);var F=N(Je,h[f])-N(ga,h[f]);if(F>a)return;i.pointCount=1,i.type=Ft.e_faceA,P(i.localNormal,h[f]),P(i.localPoint,ga),P(i.points[0].localPoint,s.m_p),i.points[0].id.setFeatures(0,mt.e_vertex,0,mt.e_vertex)}},ry=Math.min;vi.addType(Ri.TYPE,zi.TYPE,ny);vi.addType(wn.TYPE,zi.TYPE,oy);function ny(i,t,e,s,r,n,o){Ad(i,e.getShape(),t,n.getShape(),r)}var Qh=new Ri;function oy(i,t,e,s,r,n,o){var a=e.getShape();a.getChildEdge(Qh,s),Ad(i,Qh,t,n.getShape(),r)}var ze;(function(i){i[i.e_unknown=-1]="e_unknown",i[i.e_edgeA=1]="e_edgeA",i[i.e_edgeB=2]="e_edgeB"})(ze||(ze={}));var Zh;(function(i){i[i.e_isolated=0]="e_isolated",i[i.e_concave=1]="e_concave",i[i.e_convex=2]="e_convex"})(Zh||(Zh={}));var gd=function(){function i(){}return i}(),ay=function(){function i(){this.vertices=[],this.normals=[],this.count=0;for(var t=0;t<K.maxPolygonVertices;t++)this.vertices.push(q(0,0)),this.normals.push(q(0,0))}return i}(),ly=function(){function i(){this.v1=q(0,0),this.v2=q(0,0),this.normal=q(0,0),this.sideNormal1=q(0,0),this.sideNormal2=q(0,0)}return i.prototype.recycle=function(){J(this.v1),J(this.v2),J(this.normal),J(this.sideNormal1),J(this.sideNormal2)},i}(),co=[new Pe,new Pe],Ji=[new Pe,new Pe],Xe=[new Pe,new Pe],li=new gd,le=new gd,Kt=new ay,nt=new ly,uo=q(0,0),tn=q(0,0),ar=q(0,0),en=q(0,0),sn=Hs(0,0,0),At=q(0,0),hi=q(0,0),et=q(0,0),ci=q(0,0),Rt=q(0,0),zt=q(0,0),$h=q(0,0),Xi=q(0,0),Ad=function(i,t,e,s,r){ld(sn,e,r),it(uo,sn,s.m_centroid);var n=t.m_vertex0,o=t.m_vertex1,a=t.m_vertex2,l=t.m_vertex3,c=t.m_hasVertex0,h=t.m_hasVertex3;st(ar,a,o),ei(ar),Qt(et,ar.y,-ar.x);var d=N(et,uo)-N(et,o),u=0,f=0,y=!1,v=!1;J(hi),J(ci),c&&(st(tn,o,n),ei(tn),Qt(hi,tn.y,-tn.x),y=lt(tn,ar)>=0,u=m.dot(hi,uo)-m.dot(hi,n)),h&&(st(en,l,a),ei(en),Qt(ci,en.y,-en.x),v=m.crossVec2Vec2(ar,en)>0,f=m.dot(ci,uo)-m.dot(ci,a));var g;J(At),J(Rt),J(zt),c&&h?y&&v?(g=u>=0||d>=0||f>=0,g?(P(At,et),P(Rt,hi),P(zt,ci)):($(At,-1,et),$(Rt,-1,et),$(zt,-1,et))):y?(g=u>=0||d>=0&&f>=0,g?(P(At,et),P(Rt,hi),P(zt,et)):($(At,-1,et),$(Rt,-1,ci),$(zt,-1,et))):v?(g=f>=0||u>=0&&d>=0,g?(P(At,et),P(Rt,et),P(zt,ci)):($(At,-1,et),$(Rt,-1,et),$(zt,-1,hi))):(g=u>=0&&d>=0&&f>=0,g?(P(At,et),P(Rt,et),P(zt,et)):($(At,-1,et),$(Rt,-1,ci),$(zt,-1,hi))):c?y?(g=u>=0||d>=0,g?(P(At,et),P(Rt,hi),$(zt,-1,et)):($(At,-1,et),P(Rt,et),$(zt,-1,et))):(g=u>=0&&d>=0,g?(P(At,et),P(Rt,et),$(zt,-1,et)):($(At,-1,et),P(Rt,et),$(zt,-1,hi))):h?v?(g=d>=0||f>=0,g?(P(At,et),$(Rt,-1,et),P(zt,ci)):($(At,-1,et),$(Rt,-1,et),P(zt,et))):(g=d>=0&&f>=0,g?(P(At,et),$(Rt,-1,et),P(zt,et)):($(At,-1,et),$(Rt,-1,ci),P(zt,et))):(g=d>=0,g?(P(At,et),$(Rt,-1,et),$(zt,-1,et)):($(At,-1,et),P(Rt,et),P(zt,et))),Kt.count=s.m_count;for(var A=0;A<s.m_count;++A)it(Kt.vertices[A],sn,s.m_vertices[A]),Ue(Kt.normals[A],sn.q,s.m_normals[A]);var B=s.m_radius+t.m_radius;i.pointCount=0;{li.type=ze.e_edgeA,li.index=g?0:1,li.separation=1/0;for(var A=0;A<Kt.count;++A){var F=Kt.vertices[A],E=N(At,F)-N(At,o);E<li.separation&&(li.separation=E)}}if(li.type!=ze.e_unknown&&!(li.separation>B)){{le.type=ze.e_unknown,le.index=-1,le.separation=-1/0,Qt($h,-At.y,At.x);for(var A=0;A<Kt.count;++A){$(Xi,-1,Kt.normals[A]);var k=N(Xi,Kt.vertices[A])-N(Xi,o),w=N(Xi,Kt.vertices[A])-N(Xi,a),E=ry(k,w);if(E>B){le.type=ze.e_edgeB,le.index=A,le.separation=E;break}if(N(Xi,$h)>=0){if(N(Xi,At)-N(zt,At)<-K.angularSlop)continue}else if(N(Xi,At)-N(Rt,At)<-K.angularSlop)continue;E>le.separation&&(le.type=ze.e_edgeB,le.index=A,le.separation=E)}}if(!(le.type!=ze.e_unknown&&le.separation>B)){var b=.98,M=.001,V;if(le.type==ze.e_unknown?V=li:le.separation>b*li.separation+M?V=le:V=li,Xe[0].recycle(),Xe[1].recycle(),V.type==ze.e_edgeA){i.type=Ft.e_faceA;for(var L=0,z=N(At,Kt.normals[0]),A=1;A<Kt.count;++A){var O=N(At,Kt.normals[A]);O<z&&(z=O,L=A)}var H=L,Y=H+1<Kt.count?H+1:0;P(Xe[0].v,Kt.vertices[H]),Xe[0].id.setFeatures(0,mt.e_face,H,mt.e_vertex),P(Xe[1].v,Kt.vertices[Y]),Xe[1].id.setFeatures(0,mt.e_face,Y,mt.e_vertex),g?(nt.i1=0,nt.i2=1,P(nt.v1,o),P(nt.v2,a),P(nt.normal,et)):(nt.i1=1,nt.i2=0,P(nt.v1,a),P(nt.v2,o),$(nt.normal,-1,et))}else i.type=Ft.e_faceB,P(Xe[0].v,o),Xe[0].id.setFeatures(0,mt.e_vertex,V.index,mt.e_face),P(Xe[1].v,a),Xe[1].id.setFeatures(0,mt.e_vertex,V.index,mt.e_face),nt.i1=V.index,nt.i2=nt.i1+1<Kt.count?nt.i1+1:0,P(nt.v1,Kt.vertices[nt.i1]),P(nt.v2,Kt.vertices[nt.i2]),P(nt.normal,Kt.normals[nt.i1]);Qt(nt.sideNormal1,nt.normal.y,-nt.normal.x),Qt(nt.sideNormal2,-nt.sideNormal1.x,-nt.sideNormal1.y),nt.sideOffset1=N(nt.sideNormal1,nt.v1),nt.sideOffset2=N(nt.sideNormal2,nt.v2),co[0].recycle(),co[1].recycle(),Ji[0].recycle(),Ji[1].recycle();var tt=xn(co,Xe,nt.sideNormal1,nt.sideOffset1,nt.i1);if(!(tt<K.maxManifoldPoints)){var G=xn(Ji,co,nt.sideNormal2,nt.sideOffset2,nt.i2);if(!(G<K.maxManifoldPoints)){V.type==ze.e_edgeA?(P(i.localNormal,nt.normal),P(i.localPoint,nt.v1)):(P(i.localNormal,s.m_normals[nt.i1]),P(i.localPoint,s.m_vertices[nt.i1]));for(var Z=0,A=0;A<K.maxManifoldPoints;++A){var ot=N(nt.normal,Ji[A].v)-N(nt.normal,nt.v1);if(ot<=B){var W=i.points[Z];V.type==ze.e_edgeA?(Fl(W.localPoint,sn,Ji[A].v),W.id.set(Ji[A].id)):(P(W.localPoint,Ji[A].v),W.id.set(Ji[A].id),W.id.swapFeatures()),++Z}}i.pointCount=Z}}}}};function Nr(i){return i*rt.lengthUnitsPerMeter}function bn(i){return i/rt.lengthUnitsPerMeter}function hy(i){const t=i.center();return new m(bn(t.x),bn(t.y))}function Bn(i){return new m(bn(i.x),bn(i.y))}function gi(i,t){return i.vec2(Nr(t.x),Nr(t.y))}function cy(i){let t=null;const e=xd(i);return e&&(t=e.world),t}function xd(i){let t=null,e=i.parent;for(;e;){if(e.c("kpWorld")){t=e;break}e=e.parent}return t}function Dn(i){return{color:i.color,opacity:i.opacity,outline:i.outline,shader:i.shader,uniform:i.uniform}}function Aa(i){let t=null;const e=i.get("*",{recursive:!0});for(const s of e)if(s.c("kpWorld")){t=s;break}return t}function uy(i,t,e){let s=null;return{id:"kpBody",require:["kpPos","kpRotate"],collisionIgnore:e??[],get body(){if(!s)throw new Error("kpBody is not initialized");return s},applyAngularImpulse(r,n=!0){this.body.applyAngularImpulse(r,n)},applyForce(r,n,o){this.body.applyForce(r,n,o)},applyForceToCenter(r,n){this.body.applyForceToCenter(r,n)},applyLinearImpulse(r,n,o){this.body.applyLinearImpulse(r,n,o)},applyTorque(r,n){this.body.applyTorque(r,n)},getAngularDamping(){return this.body.getAngularDamping()},getAngularVelocity(){return this.body.getAngularVelocity()},getContactList(){return this.body.getContactList()},getFixtureList(){return this.body.getFixtureList()},getGravityScale(){return this.body.getGravityScale()},getInertia(){return this.body.getInertia()},getJointList(){return this.body.getJointList()},getLinearDamping(){return this.body.getLinearDamping()},getLinearVelocity(){return this.body.getLinearVelocity()},getLinearVelocityFromLocalPoint(r){return this.body.getLinearVelocityFromLocalPoint(r)},getLinearVelocityFromWorldPoint(r){return this.body.getLinearVelocityFromWorldPoint(r)},getLocalCenter(){return this.body.getLocalCenter()},getLocalPoint(r){return this.body.getLocalPoint(r)},getLocalVector(r){return this.body.getLocalVector(r)},getMass(){return this.body.getMass()},getMassData(r){return this.body.getMassData(r)},getTransform(){return this.body.getTransform()},getBodyType(){return this.body.getType()},getWorldCenter(){return this.body.getWorldCenter()},getWorldPoint(r){return this.body.getWorldPoint(r)},getWorldVector(r){return this.body.getWorldVector(r)},isActive(){return this.body.isActive()},isAwake(){return this.body.isAwake()},isBullet(){return this.body.isBullet()},isDynamic(){return this.body.isDynamic()},isFixedRotation(){return this.body.isFixedRotation()},isKinematic(){return this.body.isKinematic()},isSleepingAllowed(){return this.body.isSleepingAllowed()},isStatic(){return this.body.isStatic()},isWorldLocked(){return this.body.isWorldLocked()},resetMassData(){this.body.resetMassData()},setActive(r){this.body.setActive(r)},setAngularDamping(r){this.body.setAngularDamping(r)},setAngularVelocity(r){this.body.setAngularVelocity(r)},setAwake(r){this.body.setAwake(r)},setBullet(r){this.body.setBullet(r)},setDynamic(){return this.body.setDynamic()},setFixedRotation(r){this.body.setFixedRotation(r)},setGravityScale(r){this.body.setGravityScale(r)},setKinematic(){return this.body.setKinematic()},setLinearDamping(r){this.body.setLinearDamping(r)},setLinearVelocity(r){this.body.setLinearVelocity(r)},setMassData(r){this.body.setMassData(r)},setSleepingAllowed(r){this.body.setSleepingAllowed(r)},setStatic(){return this.body.setStatic()},setTransform(r,n){this.setKPPosition(r),this.setKPAngle(n)},setType(r){this.body.setType(r)},isClicked(){return i.isMousePressed()&&this.isHovering()},isHovering(){return this.hasPoint(Bn(i.toWorld(i.mousePos())))},checkContact(r){for(let n=this.body.getContactList();n;n=n.next){const o=n.contact.getFixtureA().getBody().getUserData().gameObj,a=n.contact.getFixtureB().getBody().getUserData().gameObj;if(o===this&&a===r||a===this&&o===r)return n.contact}return null},isColliding(r){return this.checkContact(r)!==null},isOverlapping(r){var n;for(let o=this.body.getFixtureList();o;o=o.getNext())for(let a=(n=r.body)==null?void 0:n.getFixtureList();a;a=a.getNext()){const l=o.getShape(),c=a.getShape(),h=o.getBody(),d=a.getBody();if(Dl(l,-1,c,-1,h.getTransform(),d.getTransform()))return!0}return!1},onClick(r,n="left"){const o=i.onMousePress(n,()=>{this.isHovering()&&r()});return this.onDestroy(()=>o.cancel()),o},onHover(r){let n=!1;return this.onUpdate(()=>{n?n=this.isHovering():this.isHovering()&&(n=!0,r())})},onHoverUpdate(r){return this.onUpdate(()=>{this.isHovering()&&r()})},onHoverEnd(r){let n=!1;return this.onUpdate(()=>{n?this.isHovering()||(n=!1,r()):n=this.isHovering()})},onCollide(...r){let n=null,o=()=>{};r.length===2?(n=r[0],o=r[1]):o=r[0],this.body.getWorld().on("begin-contact",a=>{mo(this,a,n,o)})},onCollideUpdate(...r){const n=this.body.getWorld();let o=!1,a=null,l=null,c=null,h=()=>{};r.length===2?(c=r[0],h=r[1]):h=r[0],n.on("begin-contact",d=>{mo(this,d,c,u=>{o=!0,a=u,l=d,i.debug.log("handling begin contact")})}),n.on("end-contact",d=>{mo(this,d,c,()=>{o=!1,a=null,l=null,i.debug.log("handling end contact")})}),i.onFixedUpdate(()=>{!o||!a||!l||h(a,l)})},onCollideEnd(...r){let n=null,o=()=>{};r.length===2?(n=r[0],o=r[1]):o=r[0],this.body.getWorld().on("end-contact",a=>{mo(this,a,n,o)})},hasPoint(r){for(let n=this.body.getFixtureList();n;n=n.getNext())if(n.testPoint(r))return!0;return!1},addToDestroyList(){const r=xd(this);if(!r)throw new Error("kpBody requires to be a descendant of kpWorld");r.addToDestroyList(this)},add(){const r=cy(this);if(!r)throw new Error("kpBody requires to be a descendant of kpWorld");const n=(t==null?void 0:t.userData)??{};s=r.createBody({...t,position:Bn(this.pos),angle:i.deg2rad(this.angle),userData:{...n,gameObj:this}})},fixedUpdate(){this.setKPPosition(this.body.getPosition()),this.setKPAngle(this.body.getAngle())},destroy(){this.body.getWorld().destroyBody(this.body),s=null},get inspectColor(){return this.body?this.body.isDynamic()?{r:0,g:191,b:255}:this.body.isKinematic()?{r:238,g:130,b:238}:{r:255,g:255,b:255}:{r:0,g:0,b:0}}}}function mo(i,t,e,s){const r=t.getFixtureA().getBody().getUserData().gameObj,n=t.getFixtureB().getBody().getUserData().gameObj;let o=r;if(r===i)o=n;else if(n!==i)return;if(e===null){s(o,t);return}o!=null&&o.tags.includes(e)&&s(o,t)}function my(i,t){let e;return{id:"kpShape",get shape(){if(!e)throw new Error("kpBoxShape not initialized");return e},add(){e=new Wf(t.width/2,t.height/2,t==null?void 0:t.center,t==null?void 0:t.angle)},draw(){if(!t.draw)return;const s=Dn(this),r=Nr(t.width),n=Nr(t.height),o=i.vec2(gi(i,this.shape.m_centroid));i.drawRect({...s,width:r,height:n,pos:o,anchor:"center",fill:t.fill})},destroy(){e=null}}}function dy(i,t){let e=null;return{id:"kpShape",get shape(){if(!e)throw new Error("kpChainShape not initialized");return e},add(){e=new wn(t==null?void 0:t.vertices,t==null?void 0:t.loop)},draw(){if(!(t!=null&&t.draw))return;const s=Dn(this),r=this.shape.m_vertices,n=[];for(let o=0;o<r.length-1;o++)n.push(gi(i,r[o])),o===r.length-2&&n.push(gi(i,r[o+1]));t!=null&&t.loop&&n.push(n[0]),i.drawLines({...s,pts:n})},destroy(){e=null}}}function py(i,t){let e=null;return{id:"kpShape",get shape(){if(!e)throw new Error("kpCircleShape not initialized");return e},add(){e=new ms((t==null?void 0:t.position)??m.zero(),t==null?void 0:t.radius)},draw(){if(!(t!=null&&t.draw))return;const s=Dn(this);i.drawCircle({...s,pos:gi(i,this.shape.getCenter()),radius:Nr(this.shape.getRadius()),fill:t==null?void 0:t.fill})},destroy(){e=null}}}function fy(i,t){let e=null;return{id:"kpShape",get shape(){if(!e)throw new Error("kpEdgeShape not initialized");return e},add(){e=new Ri(t==null?void 0:t.v1,t==null?void 0:t.v2)},draw(){if(!(t!=null&&t.draw))return;const s=Dn(this),r=gi(i,this.shape.m_vertex1),n=gi(i,this.shape.m_vertex2);i.drawLine({...s,p1:r,p2:n})},destroy(){e=null}}}function yy(i){let t;return{id:"kpFixture",require:["kpShape"],get fixture(){if(!t)throw new Error("kpFixture is not initialized");return t},getDensity(){return this.fixture.getDensity()},getFriction(){return this.fixture.getFriction()},getRestitution(){return this.fixture.getRestitution()},isSensor(){return this.fixture.isSensor()},setDensity(e){return this.fixture.setDensity(e)},setFriction(e){return this.fixture.setFriction(e)},setRestitution(e){return this.fixture.setRestitution(e)},setSensor(e){return this.fixture.setSensor(e)},add(){let e=this;if(this.c("kpBody")||(e=this.parent),!e.c("kpBody"))throw new Error("A body is required");t=e.body.createFixture({...i,shape:this.shape}),this.fixture.shouldCollide=s=>{if(e.collisionIgnore.length===0)return!0;const n=s.getBody().getUserData().gameObj;return n.tags.length===0?!0:!e.collisionIgnore.some(o=>n.tags.includes(o))}},destroy(){this.fixture.getBody().destroyFixture(this.fixture),t=null}}}function _y(i,t){let e=null;return{id:"kpShape",get shape(){if(!e)throw new Error("kpPolygonShape not initialized");return e},add(){e=new zi(t==null?void 0:t.vertices)},draw(){if(!(t!=null&&t.draw))return;const s=Dn(this),r=this.shape.m_vertices.map(n=>gi(i,n));i.drawPolygon({...s,pts:r})},destroy(){e=null}}}function vy(i,...t){return{id:"kpPos",getKPPosition(){const e=this.c("kpBody");return e&&e.body?e.body.getPosition():Bn(this.pos)},setKPPosition(e){this.pos=gi(i,e);const s=this.c("kpBody");s&&s.body&&s.body.setPosition(e)},kpMove(...e){this.setKPPosition(xa(...e).mul(i.dt()))},kpMoveBy(...e){const s=xa(...e);this.setKPPosition(this.getKPPosition().add(s))},kpMoveTo(...e){const s=new m;let r=1;e.length>=1&&typeof e[0]!="number"&&(s.set(e[0].x,e[0].y),e.length===2&&typeof e[1]=="number"&&(r=e[1])),e.length>=2&&typeof e[0]=="number"&&typeof e[1]=="number"&&(s.set(e[0],e[1]),e.length>=3&&typeof e[2]=="number"&&(r=e[2]));const n=s.sub(this.getKPPosition());if(n.length()>r*i.dt()){this.setKPPosition(s);return}n.normalize(),this.kpMove(s.mul(r))},add(){this.use(i.pos()),this.pos=gi(i,xa(...t))}}}function xa(...i){return i.length===2?new m(i[0],i[1]):i.length===1?new m(i[0]):new m}function gy(i,t){const e=[];return{id:"kpWorld",world:new Pn(t),getAllowSleeping(){return this.world.getAllowSleeping()},getAutoClearForces(){return this.world.getAutoClearForces()},getBodyCount(){return this.world.getBodyCount()},getBodyList(){return this.world.getBodyList()},getContactCount(){return this.world.getContactCount()},getGravity(){return this.world.getGravity()},getJointCount(){return this.world.getJointCount()},getJointList(){return this.world.getJointList()},isLocked(){return this.world.isLocked()},rayCast(s,r,n){this.world.rayCast(s,r,(o,a,l,c)=>{const h=o.getBody().getUserData().gameObj;return n(h,a,l,c)})},setAllowSleeping(s){this.world.setAllowSleeping(s)},setAutoClearForces(s){this.world.setAutoClearForces(s)},setGravity(s){this.world.setGravity(s)},shiftOrigin(s){this.world.shiftOrigin(s)},onContactBegin(s){this.on("contactBegin",s)},onContactEnd(s){this.on("contactEnd",s)},onContactPreSolve(s){this.on("contactPreSolve",s)},onContactPostSolve(s){this.on("contactPostSolve",s)},addToDestroyList(s){e.push(s)},add(){this.world.on("begin-contact",s=>{const r=s.getFixtureA().getBody().getUserData(),n=s.getFixtureB().getBody().getUserData();r&&n&&this.trigger("contactBegin",r.gameObj,n.gameObj,s)}),this.world.on("end-contact",s=>{const r=s.getFixtureA().getBody().getUserData(),n=s.getFixtureB().getBody().getUserData();r&&n&&this.trigger("contactEnd",r.gameObj,n.gameObj,s)}),this.world.on("pre-solve",s=>{const r=s.getFixtureA().getBody().getUserData(),n=s.getFixtureB().getBody().getUserData();r&&n&&this.trigger("contactPreSolve",r.gameObj,n.gameObj,s)}),this.world.on("post-solve",s=>{const r=s.getFixtureA().getBody().getUserData(),n=s.getFixtureB().getBody().getUserData();r&&n&&this.trigger("contactPostSolve",r.gameObj,n.gameObj,s)})},fixedUpdate(){this.world.step(i.fixedDt())},update(){if(!this.world.isLocked())for(;e.length>0;){const s=e.pop();s&&s.destroy()}}}}function Ay(i,t=0){return{id:"kpRotate",getKPAngle(){const e=this.c("kpBody");return e&&e.body?e.body.getAngle():i.deg2rad(this.angle)},setKPAngle(e){this.angle=i.rad2deg(e);const s=this.c("kpBody");s&&s.body&&s.body.setAngle(e)},kpRotateBy(e){this.setKPAngle(this.getKPAngle()+e)},kpRotateTo(e){this.setKPAngle(e)},add(){this.use(i.rotate()),this.angle=i.rad2deg(t)}}}const xy=i=>t=>(rt.lengthUnitsPerMeter=i==null?void 0:i.lengthUnitsPerMeter,{kpPos(...e){return vy(t,...e)},kpRotate(e){return Ay(t,e)},kpWorld(e){return gy(t,e)},kpBody(e,s){return uy(t,e,s)},kpFixture(e){return yy(e)},kpBoxShape(e){return my(t,e)},kpChainShape(e){return dy(t,e)},kpCircleShape(e){return py(t,e)},kpEdgeShape(e){return fy(t,e)},kpPolygonShape(e){return _y(t,e)},onKPCollide(e,s,r,n){const o=n||Aa(t);if(!o)throw new Error("No pkWorld found");o.onContactBegin((a,l,c)=>{if(!a.tags.includes(e)&&!l.tags.includes(e)||!a.tags.includes(s)&&!l.tags.includes(s))return;let h=a,d=l;a.tags.includes(e)||(h=l,d=a),r(h,d,c)})},onKPCollideUpdate(e,s,r,n){const o=n||Aa(t);if(!o)throw new Error("No pkWorld found");let a=!1,l=null,c=null,h;o.onContactBegin((d,u,f)=>{!d.tags.includes(e)&&!u.tags.includes(e)||!d.tags.includes(s)&&!u.tags.includes(s)||(a=!0,h=f,l=d,c=u)}),o.onContactEnd((d,u)=>{!d.tags.includes(e)&&!u.tags.includes(e)||!d.tags.includes(s)&&!u.tags.includes(s)||(a=!1,h=void 0,l=null,c=null)}),t.onFixedUpdate(()=>{if(!a||!l||!c||!h)return;let d=l,u=c;l.tags.includes(e)||(d=c,u=l),r(d,u,h)})},onKPCollideEnd(e,s,r,n){const o=n||Aa(t);if(!o)throw new Error("No pkWorld found");o.onContactEnd((a,l,c)=>{if(!a.tags.includes(e)&&!l.tags.includes(e)||!a.tags.includes(s)&&!l.tags.includes(s))return;let h=a,d=l;a.tags.includes(e)||(h=l,d=a),r(h,d,c)})},kpCenter(){return hy(t)},kpMousePos(){return Bn(t.mousePos())},u2p:Nr,p2u:bn,k2pVec2:Bn,p2kVec2(e){return gi(t,e)}});function wy(){const i=$o.useRef(null),t=$o.useRef();return $o.useEffect(()=>{if(i.current!==null)return t.current||(t.current=Tp({global:!1,background:[20,20,20],plugins:[xy({lengthUnitsPerMeter:10})],debug:!0,debugKey:"d",logTime:30,canvas:i.current,width:400,height:300,letterbox:!0,focus:!1}),by(t.current)),()=>{var e;(e=t.current)==null||e.quit(),t.current=void 0}},[]),_.jsx("div",{className:"gettingStartedResultContainer",children:_.jsx("canvas",{id:"game",ref:i,width:400,height:300})})}function by(i){const t=i.add([i.kpWorld({gravity:new m(0,10)})]);t.paused=!0,t.add([i.kpPos(i.kpCenter()),i.kpRotate(Math.PI*.1),i.kpEdgeShape({v1:new m(-10,0),v2:new m(10,0),draw:!0}),i.kpBody({type:"static"}),i.kpFixture()]),t.add([i.kpPos(i.kpCenter().sub({x:i.rand(-10,10),y:i.rand(10,15)})),i.kpRotate(),i.kpCircleShape({radius:1,draw:!0}),i.kpBody({type:"dynamic"}),i.kpFixture({density:1,friction:.3}),i.offscreen({destroy:!0})]);const e=i.add([i.rect(i.width(),i.height()),i.color(0,0,0)]),s=i.add([i.pos(i.center()),i.text("Click to view result",{size:20}),i.color(200,200,200),i.anchor("center")]);i.onClick(()=>{e.hidden=!0,s.hidden=!0,t.paused=!1})}const ky={title:"Get started",description:"undefined"};function tc(i){const t={a:"a",code:"code",div:"div",em:"em",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",span:"span",strong:"strong",...ec(),...i.components};return _.jsxs(_.Fragment,{children:[_.jsx(t.header,{children:_.jsxs(t.h1,{id:"get-started",children:["Get started",_.jsx(t.a,{"aria-hidden":"true",tabIndex:"-1",href:"#get-started",children:_.jsx(t.div,{"data-autolink-icon":!0})})]})}),`
`,_.jsxs(t.h2,{id:"installation",children:["Installation",_.jsx(t.a,{"aria-hidden":"true",tabIndex:"-1",href:"#installation",children:_.jsx(t.div,{"data-autolink-icon":!0})})]}),`
`,_.jsx(t.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0","data-title":"npm","data-lang":"bash",children:_.jsx(t.code,{children:_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#F69D50"},children:"npm"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" i"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" kaplanck"})]})})}),`
`,_.jsxs(t.h2,{id:"example",children:["Example",_.jsx(t.a,{"aria-hidden":"true",tabIndex:"-1",href:"#example",children:_.jsx(t.div,{"data-autolink-icon":!0})})]}),`
`,_.jsx(t.p,{children:_.jsx(t.em,{children:"The following assumes you already have a KAPLAY project set up."})}),`
`,_.jsx(t.p,{children:'Lets create our own version of "Hello World" using KaPlanck.'}),`
`,_.jsx(t.p,{children:"Lets start by importing our dependencies and add a KAPLAY instance:"}),`
`,_.jsx(t.pre,{className:"shiki shiki-themes github-light github-dark-dimmed has-highlighted",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0","data-title":"example.ts","data-lang":"ts",children:_.jsxs(t.code,{"data-line-numbers":!0,children:[_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 1. Import modules."})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" KaPlanckPlugin "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "kaplanck"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" kaplay "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "kaplay"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" { Vec2 } "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "planck"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsx(t.span,{className:"line","data-empty-line":!0,children:" "}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 2. Create a new KAPLAY instance."})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"const"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" k"}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" ="}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" kaplay"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  global: "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"false"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:","})]}),`
`,_.jsxs(t.span,{className:"line highlighted",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  plugins: ["}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"KaPlanckPlugin"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"()], "})]}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"});"})})]})}),`
`,_.jsx(t.p,{children:"As shown, adding the plugin to KAPLAY is as easy as adding the highlighted line."}),`
`,_.jsx(t.p,{children:"Next, let us add a world container (a game object that holds our physics world):"}),`
`,_.jsx(t.pre,{className:"shiki shiki-themes github-light github-dark-dimmed has-focused",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0","data-title":"example.ts","data-lang":"ts",children:_.jsxs(t.code,{"data-line-numbers":!0,children:[_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 1. Import modules."})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" KaPlanckPlugin "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "kaplanck"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" kaplay "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "kaplay"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" { Vec2 } "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "planck"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsx(t.span,{className:"line","data-empty-line":!0,children:" "}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 2. Create a new KAPLAY instance."})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"const"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" k"}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" ="}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" kaplay"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  global: "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"false"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:","})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  plugins: ["}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"KaPlanckPlugin"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"()],"})]}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"});"})}),`
`,_.jsx(t.span,{className:"line","data-empty-line":!0,children:" "}),`
`,_.jsx(t.span,{className:"line focused",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 3. Add a world container with gravity set to x: 0 y: 10."})}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"const"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" worldContainer"}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" ="}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"add"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"([ "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpWorld"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({ "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    gravity: "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"new"}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" Vec2"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"0"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"10"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"), "})]}),`
`,_.jsx(t.span,{className:"line focused",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  }), "})}),`
`,_.jsx(t.span,{className:"line focused",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"]); "})})]})}),`
`,_.jsxs(t.p,{children:["Note that ",_.jsx(t.code,{children:"Vec2"})," is from ",_.jsx(t.strong,{children:"Planck"})," and not from KAPLAY."]}),`
`,_.jsx(t.p,{children:`Now that we have our world container set up, let's add a ground to it.\r
We can do this by creating a static body with an edge shape:`}),`
`,_.jsx(t.pre,{className:"shiki shiki-themes github-light github-dark-dimmed has-focused",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0","data-title":"example.ts","data-lang":"ts",children:_.jsxs(t.code,{"data-line-numbers":!0,children:[_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 1. Import modules."})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" KaPlanckPlugin "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "kaplanck"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" kaplay "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "kaplay"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" { Vec2 } "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "planck"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsx(t.span,{className:"line","data-empty-line":!0,children:" "}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 2. Create a new KAPLAY instance."})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"const"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" k"}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" ="}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" kaplay"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  global: "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"false"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:","})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  plugins: ["}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"KaPlanckPlugin"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"()],"})]}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"});"})}),`
`,_.jsx(t.span,{className:"line","data-empty-line":!0,children:" "}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 3. Add a world container with gravity set to x: 0 y: 10."})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"const"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" worldContainer"}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" ="}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"add"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(["})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpWorld"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    gravity: "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"new"}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" Vec2"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"0"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"10"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"),"})]}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  }),"})}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"]);"})}),`
`,_.jsx(t.span,{className:"line","data-empty-line":!0,children:" "}),`
`,_.jsx(t.span,{className:"line focused",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 4. Add ground by creating a static body with an edge shape."})}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"worldContainer."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"add"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"([ "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpPos"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpCenter"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"()), "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpRotate"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(Math."}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"PI"}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" *"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" 0.1"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"), "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpEdgeShape"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({ "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    v1: "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"new"}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" Vec2"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"-"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"10"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"0"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"), "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    v2: "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"new"}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" Vec2"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"10"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"0"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"), "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    draw: "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"true"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "})]}),`
`,_.jsx(t.span,{className:"line focused",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  }), "})}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpBody"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({ "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    type: "}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:'"static"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "})]}),`
`,_.jsx(t.span,{className:"line focused",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  }), "})}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpFixture"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(), "})]}),`
`,_.jsx(t.span,{className:"line focused",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"]); "})})]})}),`
`,_.jsxs(t.p,{children:["Again, note that here we are using ",_.jsx(t.code,{children:"kpPos"})," and ",_.jsx(t.code,{children:"kpRotate"})," instead of ",_.jsx(t.code,{children:"pos"})," and ",_.jsx(t.code,{children:"rotate"}),"."]}),`
`,_.jsx(t.p,{children:"Finally, let's add a simple ball to the world. We can do this by creating a dynamic body with a circle shape:"}),`
`,_.jsx(t.pre,{className:"shiki shiki-themes github-light github-dark-dimmed has-focused",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0","data-title":"example.ts","data-lang":"ts",children:_.jsxs(t.code,{"data-line-numbers":!0,children:[_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 1. Import modules."})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" KaPlanckPlugin "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "kaplanck"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" kaplay "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "kaplay"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" { Vec2 } "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "planck"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsx(t.span,{className:"line","data-empty-line":!0,children:" "}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 2. Create a new KAPLAY instance."})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"const"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" k"}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" ="}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" kaplay"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  global: "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"false"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:","})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  plugins: ["}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"KaPlanckPlugin"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"()],"})]}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"});"})}),`
`,_.jsx(t.span,{className:"line","data-empty-line":!0,children:" "}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 3. Add a world container with gravity set to x: 0 y: 10."})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"const"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" worldContainer"}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" ="}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"add"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(["})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpWorld"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    gravity: "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"new"}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" Vec2"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"0"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"10"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"),"})]}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  }),"})}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"]);"})}),`
`,_.jsx(t.span,{className:"line","data-empty-line":!0,children:" "}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 4. Add ground by creating a static body with an edge shape."})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"worldContainer."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"add"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(["})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpPos"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpCenter"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"()),"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpRotate"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(Math."}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"PI"}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" *"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" 0.1"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"),"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpEdgeShape"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    v1: "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"new"}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" Vec2"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"-"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"10"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"0"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"),"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    v2: "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"new"}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" Vec2"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"10"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"0"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"),"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    draw: "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"true"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:","})]}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  }),"})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpBody"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    type: "}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:'"static"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:","})]}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  }),"})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpFixture"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(),"})]}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"]);"})}),`
`,_.jsx(t.span,{className:"line","data-empty-line":!0,children:" "}),`
`,_.jsx(t.span,{className:"line focused",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 5. Add a ball by creating a dynamic body with a circle shape."})}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"worldContainer."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"add"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"([ "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpPos"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpCenter"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"()."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"sub"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({ x: k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"rand"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"-"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"10"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"10"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"), y: k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"rand"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"10"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"15"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:") })), "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpRotate"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(), "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpCircleShape"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({ "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    radius: "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"1"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    draw: "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"true"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "})]}),`
`,_.jsx(t.span,{className:"line focused",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  }), "})}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpBody"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({ type: "}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:'"dynamic"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" }), "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpFixture"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({ density: "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"1"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", friction: "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"0.3"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" }), "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"offscreen"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({ destroy: "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"true"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" }), "})]}),`
`,_.jsx(t.span,{className:"line focused",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"]); "})})]})}),`
`,_.jsx(t.p,{children:"The result of this is the following:"}),`
`,_.jsx(wy,{}),`
`,_.jsx(t.p,{children:"I know this is not the most complex example, but it demonstrates a basic setup using KAPLAY and Planck for creating a physics-based games."}),`
`,_.jsx(t.p,{children:"Well with that being said, hope this plugin helps you get started with building physics-based games or interactive applications!"}),`
`,_.jsx(t.p,{children:"If you have any questions or need further assistance, feel free to ask. Happy coding!"})]})}function My(i={}){const{wrapper:t}={...ec(),...i.components};return t?_.jsx(t,{...i,children:_.jsx(tc,{...i})}):tc(i)}export{My as default,ky as frontmatter};
