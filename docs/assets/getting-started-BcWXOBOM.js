var Cd=Object.defineProperty;var kd=(i,t,e)=>t in i?Cd(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var S=(i,t,e)=>kd(i,typeof t!="symbol"?t+"":t,e);import{r as ea,j as _,u as rc}from"./index-CLzoCpN7.js";var Md=Object.defineProperty,p=(i,t)=>Md(i,"name",{value:t,configurable:!0}),Fd=(()=>{for(var i=new Uint8Array(128),t=0;t<64;t++)i[t<26?t+65:t<52?t+71:t<62?t-4:t*4-205]=t;return e=>{for(var r=e.length,s=new Uint8Array((r-(e[r-1]=="=")-(e[r-2]=="="))*3/4|0),n=0,o=0;n<r;){var a=i[e.charCodeAt(n++)],l=i[e.charCodeAt(n++)],c=i[e.charCodeAt(n++)],h=i[e.charCodeAt(n++)];s[o++]=a<<2|l>>4,s[o++]=l<<4|c>>2,s[o++]=c<<6|h}return s}})(),yt,ut=(yt=class{constructor(t,e,r){S(this,"r",255);S(this,"g",255);S(this,"b",255);this.r=gi(t,0,255),this.g=gi(e,0,255),this.b=gi(r,0,255)}static fromArray(t){return new yt(t[0],t[1],t[2])}static fromHex(t){if(typeof t=="number")return new yt(t>>16&255,t>>8&255,t>>0&255);if(typeof t=="string"){let e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(!e)throw new Error("Invalid hex color format");return new yt(parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16))}else throw new Error("Invalid hex color format")}static fromHSL(t,e,r){if(e==0)return new yt(255*r,255*r,255*r);let s=p((h,d,m)=>(m<0&&(m+=1),m>1&&(m-=1),m<1/6?h+(d-h)*6*m:m<1/2?d:m<2/3?h+(d-h)*(2/3-m)*6:h),"hue2rgb"),n=r<.5?r*(1+e):r+e-r*e,o=2*r-n,a=s(o,n,t+1/3),l=s(o,n,t),c=s(o,n,t-1/3);return new yt(Math.round(a*255),Math.round(l*255),Math.round(c*255))}clone(){return new yt(this.r,this.g,this.b)}lighten(t){return new yt(this.r+t,this.g+t,this.b+t)}darken(t){return this.lighten(-t)}invert(){return new yt(255-this.r,255-this.g,255-this.b)}mult(t){return new yt(this.r*t.r/255,this.g*t.g/255,this.b*t.b/255)}lerp(t,e){return new yt(_e(this.r,t.r,e),_e(this.g,t.g,e),_e(this.b,t.b,e))}toHSL(){let t=this.r/255,e=this.g/255,r=this.b/255,s=Math.max(t,e,r),n=Math.min(t,e,r),o=(s+n)/2,a=o,l=o;if(s==n)o=a=0;else{let c=s-n;switch(a=l>.5?c/(2-s-n):c/(s+n),s){case t:o=(e-r)/c+(e<r?6:0);break;case e:o=(r-t)/c+2;break;case r:o=(t-e)/c+4;break}o/=6}return[o,a,l]}eq(t){return this.r===t.r&&this.g===t.g&&this.b===t.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}toArray(){return[this.r,this.g,this.b]}},p(yt,"Color"),S(yt,"RED",new yt(255,0,0)),S(yt,"GREEN",new yt(0,255,0)),S(yt,"BLUE",new yt(0,0,255)),S(yt,"YELLOW",new yt(255,255,0)),S(yt,"MAGENTA",new yt(255,0,255)),S(yt,"CYAN",new yt(0,255,255)),S(yt,"WHITE",new yt(255,255,255)),S(yt,"BLACK",new yt(0,0,0)),yt);function xt(...i){if(i.length===0)return new ut(255,255,255);if(i.length===1){if(i[0]instanceof ut)return i[0].clone();if(typeof i[0]=="string")return ut.fromHex(i[0]);if(Array.isArray(i[0])&&i[0].length===3)return ut.fromArray(i[0])}else if(i.length===2){if(i[0]instanceof ut)return i[0].clone()}else if(i.length===3||i.length===4)return new ut(i[0],i[1],i[2]);throw new Error("Invalid color arguments")}p(xt,"rgb");var Ed=p((i,t,e)=>ut.fromHSL(i,t,e),"hsl2rgb");function Ut(i){return i*Math.PI/180}p(Ut,"deg2rad");function lr(i){return i*180/Math.PI}p(lr,"rad2deg");function gi(i,t,e){return t>e?gi(i,e,t):Math.min(Math.max(i,t),e)}p(gi,"clamp");function _e(i,t,e){if(typeof i=="number"&&typeof t=="number")return i+(t-i)*e;if(i instanceof j&&t instanceof j||i instanceof ut&&t instanceof ut)return i.lerp(t,e);throw new Error(`Bad value for lerp(): ${i}, ${t}. Only number, Vec2 and Color is supported.`)}p(_e,"lerp");function ei(i,t,e,r,s){return r+(i-t)/(e-t)*(s-r)}p(ei,"map");function sc(i,t,e,r,s){return gi(ei(i,t,e,r,s),r,s)}p(sc,"mapc");var kt,j=(kt=class{constructor(t=0,e=t){S(this,"x",0);S(this,"y",0);this.x=t,this.y=e}static fromAngle(t){let e=Ut(t);return new kt(Math.cos(e),Math.sin(e))}static fromArray(t){return new kt(t[0],t[1])}clone(){return new kt(this.x,this.y)}add(...t){let e=P(...t);return new kt(this.x+e.x,this.y+e.y)}sub(...t){let e=P(...t);return new kt(this.x-e.x,this.y-e.y)}scale(...t){let e=P(...t);return new kt(this.x*e.x,this.y*e.y)}dist(...t){let e=P(...t);return this.sub(e).len()}sdist(...t){let e=P(...t);return this.sub(e).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let t=this.len();return t===0?new kt(0):this.scale(1/t)}normal(){return new kt(this.y,-this.x)}reflect(t){return this.sub(t.scale(2*this.dot(t)))}project(t){return t.scale(t.dot(this)/t.len())}reject(t){return this.sub(this.project(t))}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}angle(...t){let e=P(...t);return lr(Math.atan2(this.y-e.y,this.x-e.x))}angleBetween(...t){let e=P(...t);return lr(Math.atan2(this.cross(e),this.dot(e)))}lerp(t,e){return new kt(_e(this.x,t.x,e),_e(this.y,t.y,e))}slerp(t,e){let r=this.dot(t),s=this.cross(t),n=Math.atan2(s,r);return this.scale(Math.sin((1-e)*n)).add(t.scale(Math.sin(e*n))).scale(1/s)}isZero(){return this.x===0&&this.y===0}toFixed(t){return new kt(Number(this.x.toFixed(t)),Number(this.y.toFixed(t)))}transform(t){return t.multVec2(this)}eq(t){return this.x===t.x&&this.y===t.y}bbox(){return new Et(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}toArray(){return[this.x,this.y]}},p(kt,"Vec2"),S(kt,"LEFT",new kt(-1,0)),S(kt,"RIGHT",new kt(1,0)),S(kt,"UP",new kt(0,-1)),S(kt,"DOWN",new kt(0,1)),kt);function P(...i){if(i.length===1){if(i[0]instanceof j)return new j(i[0].x,i[0].y);if(Array.isArray(i[0])&&i[0].length===2)return new j(...i[0])}return new j(...i)}p(P,"vec2");var sr,Vt=(sr=class{constructor(t,e,r,s){S(this,"x",0);S(this,"y",0);S(this,"w",1);S(this,"h",1);this.x=t,this.y=e,this.w=r,this.h=s}scale(t){return new sr(this.x+this.w*t.x,this.y+this.h*t.y,this.w*t.w,this.h*t.h)}pos(){return new j(this.x,this.y)}clone(){return new sr(this.x,this.y,this.w,this.h)}eq(t){return this.x===t.x&&this.y===t.y&&this.w===t.w&&this.h===t.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}},p(sr,"Quad"),sr);function Nt(i,t,e,r){return new Vt(i,t,e,r)}p(Nt,"quad");var $e,Ao=($e=class{constructor(t,e,r,s){S(this,"a");S(this,"b");S(this,"c");S(this,"d");this.a=t,this.b=e,this.c=r,this.d=s}mul(t){return new $e(this.a*t.a+this.b*t.c,this.a*t.b+this.b*t.d,this.c*t.a+this.d*t.c,this.c*t.b+this.d*t.d)}transform(t){return P(this.a*t.x+this.b*t.y,this.c*t.x+this.d*t.y)}get inverse(){let t=this.det;return new $e(this.d/t,-this.b/t,-this.c/t,this.a/t)}get transpose(){return new $e(this.a,this.c,this.b,this.d)}get eigenvalues(){let t=this.trace/2,e=this.det,r=t+Math.sqrt(t*t-e),s=t-Math.sqrt(t*t-e);return[r,s]}eigenvectors(t,e){return this.c!=0?[[t-this.d,this.c],[e-this.d,this.c]]:this.b!=0?[[this.b,t-this.a],[this.b,e-this.a]]:Math.abs(this.transform(P(1,0)).x-t)<Number.EPSILON?[[1,0],[0,1]]:[[0,1],[1,0]]}get det(){return this.a*this.d-this.b*this.c}get trace(){return this.a+this.d}static rotation(t){let e=Math.cos(t),r=Math.sin(t);return new $e(e,r,-r,e)}static scale(t,e){return new $e(t,0,0,e)}},p($e,"Mat2"),$e),yi,on=(yi=class{constructor(t,e,r,s,n,o,a,l,c){S(this,"m11");S(this,"m12");S(this,"m13");S(this,"m21");S(this,"m22");S(this,"m23");S(this,"m31");S(this,"m32");S(this,"m33");this.m11=t,this.m12=e,this.m13=r,this.m21=s,this.m22=n,this.m23=o,this.m31=a,this.m32=l,this.m33=c}static fromMat2(t){return new yi(t.a,t.b,0,t.c,t.d,0,0,0,1)}toMat2(){return new Ao(this.m11,this.m12,this.m21,this.m22)}mul(t){return new yi(this.m11*t.m11+this.m12*t.m21+this.m13*t.m31,this.m11*t.m12+this.m12*t.m22+this.m13*t.m32,this.m11*t.m13+this.m12*t.m23+this.m13*t.m33,this.m21*t.m11+this.m22*t.m21+this.m23*t.m31,this.m21*t.m12+this.m22*t.m22+this.m23*t.m32,this.m21*t.m13+this.m22*t.m23+this.m23*t.m33,this.m31*t.m11+this.m32*t.m21+this.m33*t.m31,this.m31*t.m12+this.m32*t.m22+this.m33*t.m32,this.m31*t.m13+this.m32*t.m23+this.m33*t.m33)}get det(){return this.m11*this.m22*this.m33+this.m12*this.m23*this.m31+this.m13*this.m21*this.m32-this.m13*this.m22*this.m31-this.m12*this.m21*this.m33-this.m11*this.m23*this.m32}rotate(t){let e=Math.cos(t),r=Math.sin(t),s=this.m11,n=this.m12;return this.m11=e*this.m11+r*this.m21,this.m12=e*this.m12+r*this.m22,this.m21=e*this.m21-r*s,this.m22=e*this.m22-r*n,this}scale(t,e){return this.m11*=t,this.m12*=t,this.m21*=e,this.m22*=e,this}get inverse(){let t=this.det;return new yi((this.m22*this.m33-this.m23*this.m32)/t,(this.m13*this.m32-this.m12*this.m33)/t,(this.m12*this.m23-this.m13*this.m22)/t,(this.m23*this.m31-this.m21*this.m33)/t,(this.m11*this.m33-this.m13*this.m31)/t,(this.m13*this.m21-this.m11*this.m23)/t,(this.m21*this.m32-this.m22*this.m31)/t,(this.m12*this.m31-this.m11*this.m32)/t,(this.m11*this.m22-this.m12*this.m21)/t)}get transpose(){return new yi(this.m11,this.m21,this.m31,this.m12,this.m22,this.m32,this.m13,this.m23,this.m33)}},p(yi,"Mat3"),yi),pe,Ai=(pe=class{constructor(t){S(this,"m",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);t&&(this.m=t)}static translate(t){return new pe([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,0,1])}static scale(t){return new pe([t.x,0,0,0,0,t.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(t){t=Ut(-t);let e=Math.cos(t),r=Math.sin(t);return new pe([1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1])}static rotateY(t){t=Ut(-t);let e=Math.cos(t),r=Math.sin(t);return new pe([e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1])}static rotateZ(t){t=Ut(-t);let e=Math.cos(t),r=Math.sin(t);return new pe([e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1])}translate(t){return this.m[12]+=this.m[0]*t.x+this.m[4]*t.y,this.m[13]+=this.m[1]*t.x+this.m[5]*t.y,this.m[14]+=this.m[2]*t.x+this.m[6]*t.y,this.m[15]+=this.m[3]*t.x+this.m[7]*t.y,this}scale(t){return this.m[0]*=t.x,this.m[4]*=t.y,this.m[1]*=t.x,this.m[5]*=t.y,this.m[2]*=t.x,this.m[6]*=t.y,this.m[3]*=t.x,this.m[7]*=t.y,this}rotate(t){t=Ut(-t);let e=Math.cos(t),r=Math.sin(t),s=this.m[0],n=this.m[1],o=this.m[4],a=this.m[5];return this.m[0]=s*e+n*r,this.m[1]=-s*r+n*e,this.m[4]=o*e+a*r,this.m[5]=-o*r+a*e,this}mult(t){let e=[];for(let r=0;r<4;r++)for(let s=0;s<4;s++)e[r*4+s]=this.m[0*4+s]*t.m[r*4+0]+this.m[1*4+s]*t.m[r*4+1]+this.m[2*4+s]*t.m[r*4+2]+this.m[3*4+s]*t.m[r*4+3];return new pe(e)}multVec2(t){return new j(t.x*this.m[0]+t.y*this.m[4]+this.m[12],t.x*this.m[1]+t.y*this.m[5]+this.m[13])}getTranslation(){return new j(this.m[12],this.m[13])}getScale(){if(this.m[0]!=0||this.m[1]!=0){let t=this.m[0]*this.m[5]-this.m[1]*this.m[4],e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new j(e,t/e)}else if(this.m[4]!=0||this.m[5]!=0){let t=this.m[0]*this.m[5]-this.m[1]*this.m[4],e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new j(t/e,e)}else return new j(0,0)}getRotation(){if(this.m[0]!=0||this.m[1]!=0){let t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return lr(this.m[1]>0?Math.acos(this.m[0]/t):-Math.acos(this.m[0]/t))}else if(this.m[4]!=0||this.m[5]!=0){let t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return lr(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/t):-Math.acos(this.m[4]/t)))}else return 0}getSkew(){if(this.m[0]!=0||this.m[1]!=0){let t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new j(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(t*t),0)}else if(this.m[4]!=0||this.m[5]!=0){let t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new j(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(t*t))}else return new j(0,0)}invert(){let t=[],e=this.m[10]*this.m[15]-this.m[14]*this.m[11],r=this.m[9]*this.m[15]-this.m[13]*this.m[11],s=this.m[9]*this.m[14]-this.m[13]*this.m[10],n=this.m[8]*this.m[15]-this.m[12]*this.m[11],o=this.m[8]*this.m[14]-this.m[12]*this.m[10],a=this.m[8]*this.m[13]-this.m[12]*this.m[9],l=this.m[6]*this.m[15]-this.m[14]*this.m[7],c=this.m[5]*this.m[15]-this.m[13]*this.m[7],h=this.m[5]*this.m[14]-this.m[13]*this.m[6],d=this.m[4]*this.m[15]-this.m[12]*this.m[7],m=this.m[4]*this.m[14]-this.m[12]*this.m[6],f=this.m[5]*this.m[15]-this.m[13]*this.m[7],y=this.m[4]*this.m[13]-this.m[12]*this.m[5],v=this.m[6]*this.m[11]-this.m[10]*this.m[7],g=this.m[5]*this.m[11]-this.m[9]*this.m[7],A=this.m[5]*this.m[10]-this.m[9]*this.m[6],B=this.m[4]*this.m[11]-this.m[8]*this.m[7],F=this.m[4]*this.m[10]-this.m[8]*this.m[6],E=this.m[4]*this.m[9]-this.m[8]*this.m[5];t[0]=this.m[5]*e-this.m[6]*r+this.m[7]*s,t[4]=-(this.m[4]*e-this.m[6]*n+this.m[7]*o),t[8]=this.m[4]*r-this.m[5]*n+this.m[7]*a,t[12]=-(this.m[4]*s-this.m[5]*o+this.m[6]*a),t[1]=-(this.m[1]*e-this.m[2]*r+this.m[3]*s),t[5]=this.m[0]*e-this.m[2]*n+this.m[3]*o,t[9]=-(this.m[0]*r-this.m[1]*n+this.m[3]*a),t[13]=this.m[0]*s-this.m[1]*o+this.m[2]*a,t[2]=this.m[1]*l-this.m[2]*c+this.m[3]*h,t[6]=-(this.m[0]*l-this.m[2]*d+this.m[3]*m),t[10]=this.m[0]*f-this.m[1]*d+this.m[3]*y,t[14]=-(this.m[0]*h-this.m[1]*m+this.m[2]*y),t[3]=-(this.m[1]*v-this.m[2]*g+this.m[3]*A),t[7]=this.m[0]*v-this.m[2]*B+this.m[3]*F,t[11]=-(this.m[0]*g-this.m[1]*B+this.m[3]*E),t[15]=this.m[0]*A-this.m[1]*F+this.m[2]*E;let k=this.m[0]*t[0]+this.m[1]*t[4]+this.m[2]*t[8]+this.m[3]*t[12];for(let w=0;w<4;w++)for(let b=0;b<4;b++)t[w*4+b]*=1/k;return new pe(t)}clone(){return new pe([...this.m])}toString(){return this.m.toString()}},p(pe,"Mat4"),pe);function Ya(i,t,e,r=s=>-Math.cos(s)){return i+(r(e)+1)/2*(t-i)}p(Ya,"wave");var Sd=1103515245,Dd=12345,eh=2147483648,vs,nc=(vs=class{constructor(t){S(this,"seed");this.seed=t}gen(){return this.seed=(Sd*this.seed+Dd)%eh,this.seed/eh}genNumber(t,e){return t+this.gen()*(e-t)}genVec2(t,e){return new j(this.genNumber(t.x,e.x),this.genNumber(t.y,e.y))}genColor(t,e){return new ut(this.genNumber(t.r,e.r),this.genNumber(t.g,e.g),this.genNumber(t.b,e.b))}genAny(...t){if(t.length===0)return this.gen();if(t.length===1){if(typeof t[0]=="number")return this.genNumber(0,t[0]);if(t[0]instanceof j)return this.genVec2(P(0,0),t[0]);if(t[0]instanceof ut)return this.genColor(xt(0,0,0),t[0])}else if(t.length===2){if(typeof t[0]=="number"&&typeof t[1]=="number")return this.genNumber(t[0],t[1]);if(t[0]instanceof j&&t[1]instanceof j)return this.genVec2(t[0],t[1]);if(t[0]instanceof ut&&t[1]instanceof ut)return this.genColor(t[0],t[1])}throw new Error("More than 2 arguments not supported")}},p(vs,"RNG"),vs),Ba=new nc(Date.now());function oc(i){return i!=null&&(Ba.seed=i),Ba.seed}p(oc,"randSeed");function Gt(...i){return Ba.genAny(...i)}p(Gt,"rand");function Ga(...i){return Math.floor(Gt(...i.length>0?i:[2]))}p(Ga,"randi");function ac(i){return Gt()<=i}p(ac,"chance");function Xa(i){for(let t=i.length-1;t>0;t--){let e=Math.floor(Math.random()*(t+1));[i[t],i[e]]=[i[e],i[t]]}return i}p(Xa,"shuffle");function lc(i,t){return i.length<=t?i.slice():Xa(i.slice()).slice(0,t)}p(lc,"chooseMultiple");function hc(i){return i[Ga(i.length)]}p(hc,"choose");function Qa(i,t){return i.pos.x+i.width>t.pos.x&&i.pos.x<t.pos.x+t.width&&i.pos.y+i.height>t.pos.y&&i.pos.y<t.pos.y+t.height}p(Qa,"testRectRect");function cc(i,t){if(i.p1.x===i.p2.x&&i.p1.y===i.p2.y||t.p1.x===t.p2.x&&t.p1.y===t.p2.y)return null;let e=(t.p2.y-t.p1.y)*(i.p2.x-i.p1.x)-(t.p2.x-t.p1.x)*(i.p2.y-i.p1.y);if(e===0)return null;let r=((t.p2.x-t.p1.x)*(i.p1.y-t.p1.y)-(t.p2.y-t.p1.y)*(i.p1.x-t.p1.x))/e,s=((i.p2.x-i.p1.x)*(i.p1.y-t.p1.y)-(i.p2.y-i.p1.y)*(i.p1.x-t.p1.x))/e;return r<0||r>1||s<0||s>1?null:r}p(cc,"testLineLineT");function Io(i,t){let e=cc(i,t);return e?P(i.p1.x+e*(i.p2.x-i.p1.x),i.p1.y+e*(i.p2.y-i.p1.y)):null}p(Io,"testLineLine");function jo(i,t){let e=t.p2.sub(t.p1),r=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;if(e.x!=0){let n=(i.pos.x-t.p1.x)/e.x,o=(i.pos.x+i.width-t.p1.x)/e.x;r=Math.max(r,Math.min(n,o)),s=Math.min(s,Math.max(n,o))}if(e.y!=0){let n=(i.pos.y-t.p1.y)/e.y,o=(i.pos.y+i.height-t.p1.y)/e.y;r=Math.max(r,Math.min(n,o)),s=Math.min(s,Math.max(n,o))}return s>=r&&s>=0&&r<=1}p(jo,"testRectLine");function Mn(i,t){return t.x>i.pos.x&&t.x<i.pos.x+i.width&&t.y>i.pos.y&&t.y<i.pos.y+i.height}p(Mn,"testRectPoint");function Za(i,t){let e=Math.max(i.pos.x,Math.min(t.center.x,i.pos.x+i.width)),r=Math.max(i.pos.y,Math.min(t.center.y,i.pos.y+i.height));return P(e,r).sdist(t.center)<=t.radius*t.radius}p(Za,"testRectCircle");function $a(i,t){return tl(t,new ve(i.points()))}p($a,"testRectPolygon");function Lo(i,t){let e=t.sub(i.p1),r=i.p2.sub(i.p1);if(Math.abs(e.cross(r))>Number.EPSILON)return!1;let s=e.dot(r)/r.dot(r);return s>=0&&s<=1}p(Lo,"testLinePoint");function Js(i,t){let e=i.p2.sub(i.p1),r=e.dot(e),s=i.p1.sub(t.center),n=2*e.dot(s),o=s.dot(s)-t.radius*t.radius,a=n*n-4*r*o;if(r<=Number.EPSILON||a<0)return!1;if(a==0){let l=-n/(2*r);if(l>=0&&l<=1)return!0}else{let l=(-n+Math.sqrt(a))/(2*r),c=(-n-Math.sqrt(a))/(2*r);if(l>=0&&l<=1||c>=0&&c<=1)return!0}return Fn(t,i.p1)}p(Js,"testLineCircle");function To(i,t){if(Ni(t,i.p1)||Ni(t,i.p2))return!0;for(let e=0;e<t.pts.length;e++){let r=t.pts[e],s=t.pts[(e+1)%t.pts.length];if(Io(i,new Ve(r,s)))return!0}return!1}p(To,"testLinePolygon");function Fn(i,t){return i.center.sdist(t)<i.radius*i.radius}p(Fn,"testCirclePoint");function uc(i,t){return i.center.sdist(t.center)<(i.radius+t.radius)*(i.radius+t.radius)}p(uc,"testCircleCircle");function En(i,t){let e=t.pts[t.pts.length-1];for(let r of t.pts){if(Js(new Ve(e,r),i))return!0;e=r}return Fn(i,t.pts[0])?!0:Ni(t,i.center)}p(En,"testCirclePolygon");function tl(i,t){for(let e=0;e<i.pts.length;e++)if(To(new Ve(i.pts[e],i.pts[(e+1)%i.pts.length]),t))return!0;return!!(i.pts.some(e=>Ni(t,e))||t.pts.some(e=>Ni(i,e)))}p(tl,"testPolygonPolygon");function Ni(i,t){let e=!1,r=i.pts;for(let s=0,n=r.length-1;s<r.length;n=s++)r[s].y>t.y!=r[n].y>t.y&&t.x<(r[n].x-r[s].x)*(t.y-r[s].y)/(r[n].y-r[s].y)+r[s].x&&(e=!e);return e}p(Ni,"testPolygonPoint");function Ro(i,t){t=t.sub(i.center);let e=Ut(i.angle),r=Math.cos(e),s=Math.sin(e),n=t.x*r+t.y*s,o=-t.x*s+t.y*r;return n*n/(i.radiusX*i.radiusX)+o*o/(i.radiusY*i.radiusY)<1}p(Ro,"testEllipsePoint");function dn(i,t){let e=t.center.sub(i.center),r=Ut(i.angle),s=Math.cos(r),n=Math.sin(r),o=e.x*s+e.y*n,a=-e.x*n+e.y*s;return Ro(new Ji(P(),i.radiusX+t.radius,i.radiusY+t.radius,0),P(o,a))}p(dn,"testEllipseCircle");function el(i,t){let e=i.toMat2().inverse;return t=new Ve(e.transform(t.p1.sub(i.center)),e.transform(t.p2.sub(i.center))),Js(t,new Se(P(),1))}p(el,"testEllipseLine");function mc(i,t){if(i.radiusX===i.radiusY)return dn(t,new Se(i.center,i.radiusX));if(t.radiusX===t.radiusY)return dn(i,new Se(t.center,t.radiusX));let e=new on(1/i.radiusX**2,0,0,0,1/i.radiusY**2,0,0,0,-1),r=new on(1/t.radiusX**2,0,0,0,1/t.radiusY**2,0,0,0,-1),s=i.center.x,n=i.center.y,o=t.center.x,a=t.center.y,l=Ut(i.angle),c=Ut(t.angle),h=new on(Math.cos(l),-Math.sin(l),s,Math.sin(l),Math.cos(l),n,0,0,1),d=new on(Math.cos(c),-Math.sin(c),o,Math.sin(c),Math.cos(c),a,0,0,1),m=h.inverse,f=d.inverse,y=m.transpose.mul(e).mul(m),v=f.transpose.mul(r).mul(f),g=y.m11,A=y.m12,B=y.m13,F=y.m21,E=y.m22,k=y.m23,w=y.m31,b=y.m32,M=y.m33,V=v.m11,T=v.m12,z=v.m13,O=v.m21,J=v.m22,W=v.m23,tt=v.m31,K=v.m32,Z=v.m33,ot=g*E*M-g*k*b-A*F*M+A*k*w+B*F*b-B*E*w,Y=(g*E*Z-g*k*K-g*b*W+g*M*J-A*F*Z+A*k*tt+A*w*W-A*M*O+B*F*K-B*E*tt-B*w*J+B*b*O+F*b*z-F*M*T-E*w*z+E*M*V+k*w*T-k*b*V)/ot,ct=(g*J*Z-g*W*K-A*O*Z+A*W*tt+B*O*K-B*J*tt-F*T*Z+F*z*K+E*V*Z-E*z*tt-k*V*K+k*T*tt+w*T*W-w*z*J-b*V*W+b*z*O+M*V*J-M*T*O)/ot,ft=(V*J*Z-V*W*K-T*O*Z+T*W*tt+z*O*K-z*J*tt)/ot;if(Y>=0){let X=-3*ct+Y**2,Zt=3*Y*ft+ct*Y**2-4*ct**2,he=-27*ft**2+18*ft*Y*ct+Y**2*ct**2-4*Y**3*ft-4*ct**3;return!(X>0&&Zt<0&&he>0)}else{let X=-3*ct+Y**2,Zt=-27*ft**2+18*ft*Y*ct+Y**2*ct**2-4*Y**3*ft-4*ct**3;return!(X>0&&Zt>0)}}p(mc,"testEllipseEllipse");function il(i,t){return zo(i,new ve(t.points()))}p(il,"testEllipseRect");function zo(i,t){let e=i.toMat2().inverse;return t=new ve(t.pts.map(r=>e.transform(r.sub(i.center)))),En(new Se(P(),1),t)}p(zo,"testEllipsePolygon");function dc(i,t){return i.x===t.x&&i.y===t.y}p(dc,"testPointPoint");function pc(i,t){return t instanceof j?dc(t,i.pt):t instanceof Se?Fn(t,i.pt):t instanceof Ve?Lo(t,i.pt):t instanceof Et?Mn(t,i.pt):t instanceof ve?Ni(t,i.pt):t instanceof Ji?Ro(t,i.pt):!1}p(pc,"testPointShape");function fc(i,t){return t instanceof j?Lo(i,t):t instanceof Se?Js(i,t):t instanceof Ve?Io(i,t)!=null:t instanceof Et?jo(t,i):t instanceof ve?To(i,t):t instanceof Ji?el(t,i):!1}p(fc,"testLineShape");function yc(i,t){return t instanceof j?Fn(i,t):t instanceof Se?uc(i,t):t instanceof Ve?Js(t,i):t instanceof Et?Za(t,i):t instanceof ve?En(i,t):t instanceof Ji?dn(t,i):!1}p(yc,"testCircleShape");function _c(i,t){return t instanceof j?Mn(i,t):t instanceof Se?Za(i,t):t instanceof Ve?jo(i,t):t instanceof Et?Qa(i,t):t instanceof ve?$a(i,t):t instanceof Ji?il(t,i):!1}p(_c,"testRectShape");function vc(i,t){return t instanceof j?Ni(i,t):t instanceof Se?En(t,i):t instanceof Ve?To(t,i):t instanceof Et?$a(t,i):t instanceof ve?tl(t,i):t instanceof Ji?zo(t,i):!1}p(vc,"testPolygonShape");function gc(i,t){return t instanceof j?Ro(i,t):t instanceof Se?dn(i,t):t instanceof Ve?el(i,t):t instanceof Et?il(i,t):t instanceof ve?zo(i,t):t instanceof Ji?mc(t,i):!1}p(gc,"testEllipseShape");function rl(i,t,e){let r=i,s=e.p1,n=e.p2,o=t,a=n.sub(s),l=o.cross(a);if(Math.abs(l)<Number.EPSILON)return null;let c=s.sub(r),h=c.cross(a)/l;if(h<=0||h>=1)return null;let d=c.cross(o)/l;if(d<=0||d>=1)return null;let m=a.normal().unit();return t.dot(m)>0&&(m.x*=-1,m.y*=-1),{point:r.add(o.scale(h)),normal:m,fraction:h}}p(rl,"raycastLine");function Ac(i,t,e){let r=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY,n;if(i.x!=0){let o=(e.pos.x-i.x)/t.x,a=(e.pos.x+e.width-i.x)/t.x;n=P(-Math.sign(t.x),0),r=Math.max(r,Math.min(o,a)),s=Math.min(s,Math.max(o,a))}if(i.y!=0){let o=(e.pos.y-i.y)/t.y,a=(e.pos.y+e.height-i.y)/t.y;Math.min(o,a)>r&&(n=P(0,-Math.sign(t.y))),r=Math.max(r,Math.min(o,a)),s=Math.min(s,Math.max(o,a))}return s>=r&&r>=0&&r<=1?{point:i.add(t.scale(r)),normal:n,fraction:r}:null}p(Ac,"raycastRect");function sl(i,t,e){let r=i,s=e.center,n=t,o=n.dot(n),a=r.sub(s),l=2*n.dot(a),c=a.dot(a)-e.radius*e.radius,h=l*l-4*o*c;if(o<=Number.EPSILON||h<0)return null;if(h==0){let d=-l/(2*o);if(d>=0&&d<=1){let m=r.add(n.scale(d));return{point:m,normal:m.sub(s),fraction:d}}}else{let d=(-l+Math.sqrt(h))/(2*o),m=(-l-Math.sqrt(h))/(2*o),f=null;if(d>=0&&d<=1&&(f=d),m>=0&&m<=1&&(f=Math.min(m,f??m)),f!=null){let y=r.add(n.scale(f));return{point:y,normal:y.sub(s).unit(),fraction:f}}}return null}p(sl,"raycastCircle");function xc(i,t,e){let r=e.pts,s=null,n=r[r.length-1];for(let o=0;o<r.length;o++){let a=r[o],l=rl(i,t,new Ve(n,a));l&&(!s||s.fraction>l.fraction)&&(s=l),n=a}return s}p(xc,"raycastPolygon");function wc(i,t,e){let r=e.toMat2(),s=r.inverse,n=s.transform(i.sub(e.center)),o=s.transform(t),a=sl(n,o,new Se(P(),1));if(a){let l=Ao.rotation(Ut(-e.angle)),c=Ao.scale(e.radiusX,e.radiusY).transform(a.point),h=r.transform(a.point).add(e.center),d=h.dist(i)/t.len();return{point:h,normal:l.transform(P(e.radiusY**2*c.x,e.radiusX**2*c.y)).unit(),fraction:d}}return a}p(wc,"raycastEllipse");function bc(i,t,e,r=64){let s=i,n=t.len(),o=t.scale(1/n),a=0,l=P(Math.floor(i.x),Math.floor(i.y)),c=P(o.x>0?1:-1,o.y>0?1:-1),h=P(Math.abs(1/o.x),Math.abs(1/o.y)),d=P(c.x>0?l.x+1-i.x:i.x-l.x,c.y>0?l.y+1-i.y:i.y-l.y),m=P(h.x<1/0?h.x*d.x:1/0,h.y<1/0?h.y*d.y:1/0),f=-1;for(;a<=r;){let y=e(l);if(y===!0)return{point:s.add(o.scale(a)),normal:P(f===0?-c.x:0,f===1?-c.y:0),fraction:a/n,gridPos:l};if(y)return y;m.x<m.y?(l.x+=c.x,a=m.x,m.x+=h.x,f=0):(l.y+=c.y,a=m.y,m.y+=h.y,f=1)}return null}p(bc,"raycastGrid");var nr,Pd=(nr=class{constructor(t){S(this,"pt");this.pt=t.clone()}transform(t){return new nr(t.multVec2(this.pt))}bbox(){return new Et(this.pt,0,0)}area(){return 0}clone(){return new nr(this.pt)}collides(t){return pc(this,t)}contains(t){return this.pt.eq(t)}raycast(t,e){return null}random(){return this.pt.clone()}},p(nr,"Point"),nr),or,Ve=(or=class{constructor(t,e){S(this,"p1");S(this,"p2");this.p1=t.clone(),this.p2=e.clone()}transform(t){return new or(t.multVec2(this.p1),t.multVec2(this.p2))}bbox(){return Et.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new or(this.p1,this.p2)}collides(t){return fc(this,t)}contains(t){return this.collides(t)}raycast(t,e){return rl(t,e,this)}random(){return this.p1.add(this.p2.sub(this.p1).scale(Gt(1)))}},p(or,"Line"),or),ar,Et=(ar=class{constructor(t,e,r){S(this,"pos");S(this,"width");S(this,"height");this.pos=t.clone(),this.width=e,this.height=r}static fromPoints(t,e){return new ar(t.clone(),e.x-t.x,e.y-t.y)}center(){return new j(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(t){return new ve(this.points().map(e=>t.multVec2(e)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new ar(this.pos.clone(),this.width,this.height)}distToPoint(t){return Math.sqrt(this.sdistToPoint(t))}sdistToPoint(t){let e=this.pos,r=this.pos.add(this.width,this.height),s=Math.max(e.x-t.x,0,t.x-r.x),n=Math.max(e.y-t.y,0,t.y-r.y);return s*s+n*n}collides(t){return _c(this,t)}contains(t){return this.collides(t)}raycast(t,e){return Ac(t,e,this)}random(){return this.pos.add(Gt(this.width),Gt(this.height))}},p(ar,"Rect"),ar),jr,Se=(jr=class{constructor(t,e){S(this,"center");S(this,"radius");this.center=t.clone(),this.radius=e}transform(t){return new Ji(this.center,this.radius,this.radius).transform(t)}bbox(){return Et.fromPoints(this.center.sub(P(this.radius)),this.center.add(P(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new jr(this.center,this.radius)}collides(t){return yc(this,t)}contains(t){return this.collides(t)}raycast(t,e){return sl(t,e,this)}random(){return this.center.add(j.fromAngle(Gt(360)).scale(Gt(this.radius)))}},p(jr,"Circle"),jr),ti,Ji=(ti=class{constructor(t,e,r,s=0){S(this,"center");S(this,"radiusX");S(this,"radiusY");S(this,"angle");this.center=t.clone(),this.radiusX=e,this.radiusY=r,this.angle=s}static fromMat2(t){let e=t.inverse,r=e.transpose.mul(e),[s,n]=r.eigenvalues,[o,a]=r.eigenvectors(s,n),[l,c]=[1/Math.sqrt(s),1/Math.sqrt(n)];return l>c?new ti(P(),l,c,lr(Math.atan2(-o[1],o[0]))):new ti(P(),c,l,lr(Math.atan2(-a[1],a[0])))}toMat2(){let t=Ut(this.angle),e=Math.cos(t),r=Math.sin(t);return new Ao(e*this.radiusX,-r*this.radiusY,r*this.radiusX,e*this.radiusY)}transform(t){if(this.angle==0&&t.getRotation()==0)return new ti(t.multVec2(this.center),t.m[0]*this.radiusX,t.m[5]*this.radiusY);{let e=this.toMat2(),r=t.getRotation(),s=t.getScale();e=on.fromMat2(e).scale(s.x,s.y).rotate(r).toMat2();let n=ti.fromMat2(e);return n.center=t.multVec2(this.center),n}}bbox(){if(this.angle==0)return Et.fromPoints(this.center.sub(P(this.radiusX,this.radiusY)),this.center.add(P(this.radiusX,this.radiusY)));{let t=Ut(this.angle),e=Math.cos(t),r=Math.sin(t),s=this.radiusX*e,n=this.radiusX*r,o=this.radiusY*r,a=this.radiusY*e,l=Math.sqrt(s*s+o*o),c=Math.sqrt(n*n+a*a);return Et.fromPoints(this.center.sub(P(l,c)),this.center.add(P(l,c)))}}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new ti(this.center,this.radiusX,this.radiusY,this.angle)}collides(t){return gc(this,t)}contains(t){t=t.sub(this.center);let e=Ut(this.angle),r=Math.cos(e),s=Math.sin(e),n=t.x*r+t.y*s,o=-t.x*s+t.y*r;return n*n/(this.radiusX*this.radiusX)+o*o/(this.radiusY*this.radiusY)<1}raycast(t,e){return wc(t,e,this)}random(){return this.center}},p(ti,"Ellipse"),ti);function Bc(i,t,e,r){let s=t.sub(i),n=r.sub(e),o=s.cross(n);return o<1e-5&&o>-1e-5||(o=e.sub(i).cross(n)/o,o<0||o>1)?null:i.add(s.scale(o))}p(Bc,"segmentLineIntersection");var _i,ve=(_i=class{constructor(t){S(this,"pts");if(t.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=t}transform(t){return new _i(this.pts.map(e=>t.multVec2(e)))}bbox(){let t=P(Number.MAX_VALUE),e=P(-Number.MAX_VALUE);for(let r of this.pts)t.x=Math.min(t.x,r.x),e.x=Math.max(e.x,r.x),t.y=Math.min(t.y,r.y),e.y=Math.max(e.y,r.y);return Et.fromPoints(t,e)}area(){let t=0,e=this.pts.length;for(let r=0;r<e;r++){let s=this.pts[r],n=this.pts[(r+1)%e];t+=s.x*n.y*.5,t-=n.x*s.y*.5}return Math.abs(t)}clone(){return new _i(this.pts.map(t=>t.clone()))}collides(t){return vc(this,t)}contains(t){return this.collides(t)}raycast(t,e){return xc(t,e,this)}random(){return P()}cut(t,e){new Ve(t,e);let r=[],s=[],n=e.sub(t),o=this.pts[this.pts.length-1],a=o.sub(t),l=n.cross(a)>0;return this.pts.forEach(c=>{a=c.sub(t);let h=n.cross(a)>0;if(l!=h){let d=Bc(o,c,t,e);r.push(d),s.push(d),l=h}(h?r:s).push(c),o=c}),[r.length?new _i(r):null,s.length?new _i(s):null]}},p(_i,"Polygon"),_i);function Cc(i,t,e,r){let s=r*r,n=1-r,o=n*n;return i.scale(o).add(t.scale(2*n*r)).add(e.scale(s))}p(Cc,"evaluateQuadratic");function kc(i,t,e,r){let s=1-r;return t.sub(i).scale(2*s).add(e.sub(t).scale(2*r))}p(kc,"evaluateQuadraticFirstDerivative");function Mc(i,t,e,r){return e.sub(t.scale(2)).add(i).scale(2)}p(Mc,"evaluateQuadraticSecondDerivative");function No(i,t,e,r,s){let n=s*s,o=n*s,a=1-s,l=a*a,c=l*a;return i.scale(c).add(t.scale(3*l*s)).add(e.scale(3*a*n)).add(r.scale(o))}p(No,"evaluateBezier");function Fc(i,t,e,r,s){let n=s*s,o=1-s,a=o*o;return t.sub(i).scale(3*a).add(e.sub(t).scale(6*o*s)).add(r.sub(e).scale(3*n))}p(Fc,"evaluateBezierFirstDerivative");function Ec(i,t,e,r,s){let n=1-s;return e.sub(t.scale(2)).add(i).scale(6*n).add(r.sub(e.scale(2)).add(t).scale(6*s))}p(Ec,"evaluateBezierSecondDerivative");function Sc(i,t,e,r,s){let n=.5*(((-s+2)*s-1)*s),o=.5*((3*s-5)*s*s+2),a=.5*(((-3*s+4)*s+1)*s),l=.5*((s-1)*s*s);return i.scale(n).add(t.scale(o)).add(e.scale(a)).add(r.scale(l))}p(Sc,"evaluateCatmullRom");function Dc(i,t,e,r,s){let n=.5*((-3*s+4)*s-1),o=.5*((9*s-10)*s),a=.5*((-9*s+8)*s+1),l=.5*((3*s-2)*s);return i.scale(n).add(t.scale(o)).add(e.scale(a)).add(r.scale(l))}p(Dc,"evaluateCatmullRomFirstDerivative");function Pc(i){let t=nl(i),e=t(1);return r=>{let s=r*e,n=t(s,!0);return i(n)}}p(Pc,"normalizedCurve");function nl(i,t=10,e=10){let r=[0],s=[0],n=1/(t-1)/e,o=0,a=i(0),l=0;for(let c=1;c<t;c++){for(let h=0;h<e;h++){l+=n;let d=i(l),m=d.dist(a);o+=m,a=d}r[c]=o,s[c]=l}return s[t-1]=1,(c,h=!1)=>{if(h){let d=c;if(d<=0)return 0;if(d>=o)return 1;let m=0;for(;r[m+1]<d;)m++;let f=s[m],y=s[m+1],v=r[m],g=r[m+1],A=(d-v)/(g-v);return f+(y-f)*A}else{if(c<=0)return 0;if(c>=1)return r[t-1];let d=0;for(;s[d+1]<c;)d++;let m=s[d],f=s[d+1],y=r[d],v=r[d+1],g=(c-m)/(f-m);return y+(v-y)*g}}}p(nl,"curveLengthApproximation");function Hs(i,t,e,r){let s=2*i+t-2*r+e,n=-3*i+3*r-2*t-e,o=t,a=i;return l=>{let c=l*l,h=c*l;return s*h+n*c+o*l+a}}p(Hs,"hermite");function ol(i,t,e,r,s,n=Hs){let o=n(t.x,(1-s)*(e.x-i.x),(1-s)*(r.x-t.x),e.x),a=n(t.y,(1-s)*(e.y-i.y),(1-s)*(r.y-t.y),e.y);return l=>new j(o(l),a(l))}p(ol,"cardinal");function pn(i,t,e,r,s=Hs){return ol(i,t,e,r,.5,s)}p(pn,"catmullRom");function Vc(i,t,e,r,s=Hs){return pn(r.add(i.sub(t).scale(6)),i,r,i.add(r.sub(e).scale(6)),s)}p(Vc,"bezier");function qc(i,t,e,r,s,n,o,a=Hs){let l=a(t.x,.5*(1-s)*(1+o)*(1+n)*(t.x-i.x)+.5*(1-s)*(1-o)*(1-n)*(e.x-t.x),.5*(1-s)*(1+o)*(1-n)*(e.x-t.x)+.5*(1-s)*(1-o)*(1+n)*(r.x-e.x),e.x),c=a(t.y,.5*(1-s)*(1+o)*(1+n)*(t.y-i.y)+.5*(1-s)*(1-o)*(1-n)*(e.y-t.y),.5*(1-s)*(1+o)*(1-n)*(e.y-t.y)+.5*(1-s)*(1-o)*(1+n)*(r.y-e.y),e.y);return h=>new j(l(h),c(h))}p(qc,"kochanekBartels");function Ic(i,t,e,r){let s=2*i+t-2*r+e,n=-3*i+3*r-2*t+e,o=t;return a=>{let l=a*a;return 3*s*l+2*n*a+o}}p(Ic,"hermiteFirstDerivative");function cs(i){return 0<=i&&i<=1}p(cs,"inZeroOneDomain");function yo(i,t){return Math.abs(i-t)<=Number.EPSILON}p(yo,"approximately");function us(i){return i<0?-Math.pow(-i,1/3):Math.pow(i,1/3)}p(us,"cubeRoot");function jc(i,t,e,r){let s=3*i-6*t+3*e,n=-3*i+3*t,o=i,a=-i+3*t-3*e+r;if(yo(a,0)){if(yo(s,0))return yo(n,0)?[]:[-o/n].filter(cs);let g=Math.sqrt(n*n-4*s*o),A=2*s;return[(g-n)/A,(-n-g)/A].filter(cs)}s/=a,n/=a,o/=a;let l=(3*n-s*s)/3,c=l/3,h=(2*s*s*s-9*s*n+27*o)/27,d=h/2,m=d*d+c*c*c;if(m<0){let g=-l/3,A=g*g*g,B=Math.sqrt(A),F=-h/(2*B),E=F<-1?-1:F>1?1:F,k=Math.acos(E),w=2*us(B),b=w*Math.cos(k/3)-s/3,M=w*Math.cos((k+2*Math.PI)/3)-s/3,V=w*Math.cos((k+4*Math.PI)/3)-s/3;return[b,M,V].filter(cs)}if(m===0){let g=d<0?us(-d):-us(d),A=2*g-s/3,B=-g-s/3;return[A,B].filter(cs)}let f=Math.sqrt(m),y=us(f-d),v=us(f+d);return[y-v-s/3].filter(cs)}p(jc,"getCubicRoots");function Lc(i,t,e,r,s){let n=jc(i.x-s,t.x-s,e.x-s,r.x-s);return n.length>0?No(i,t,e,r,n[0]).y:NaN}p(Lc,"cubicBezierYforX");function Tc(i){if(!i||i.length==0)throw new Error("Need at least one point for easingLinear.");let t=i.length;return e=>{if(e<=0||i.length==1||e<=i[0].x)return i[0].y;for(let r=0;r<t;r++)if(i[r].x>=e)return ei(e,i[r-1].x,i[r].x,i[r-1].y,i[r].y);return i[i.length-1].y}}p(Tc,"easingLinear");function Rc(i,t){return e=>Lc(P(0,0),i,t,P(1,1),e)}p(Rc,"easingCubicBezier");function zc(i,t="jump-end"){let e=1/i,r=t=="jump-start"||t=="jump-both",s=t=="jump-end"||t=="jump-both",n=1/(i+(s?1:0)),o=r?n:0;return a=>{let l=Math.floor(a/e);return o+l*n}}p(zc,"easingSteps");function Nc(i,t){let e=Number.MAX_VALUE,r={normal:P(0),distance:0};for(let s of[i,t])for(let n=0;n<s.pts.length;n++){let o=s.pts[n],a=s.pts[(n+1)%s.pts.length].sub(o).normal().unit(),l=Number.MAX_VALUE,c=-Number.MAX_VALUE;for(let f=0;f<i.pts.length;f++){let y=i.pts[f].dot(a);l=Math.min(l,y),c=Math.max(c,y)}let h=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(let f=0;f<t.pts.length;f++){let y=t.pts[f].dot(a);h=Math.min(h,y),d=Math.max(d,y)}let m=Math.min(c,d)-Math.max(l,h);if(m<0)return null;if(m<Math.abs(e)){let f=d-l,y=h-c;e=Math.abs(f)<Math.abs(y)?f:y,r.normal=a,r.distance=e}}return r}p(Nc,"sat");function al(i,t,e){return(t.x-i.x)*(e.y-i.y)-(t.y-i.y)*(e.x-i.x)>=0}p(al,"isOrientedCcw");function Oc(i){let t=0,e=i[i.length-1];for(let r=0;r<i.length;r++)t+=(i[r].x-e.x)*(i[r].y+e.y),e=i[r];return t<0}p(Oc,"isOrientedCcwPolygon");function _o(i,t,e,r){let s=r.x-e.x,n=r.y-e.y,o=s*(i.y-e.y)-n*(i.x-e.x),a=s*(t.y-e.y)-n*(t.x-e.x);return o*a>=0}p(_o,"onSameSide");function Uc(i,t,e,r){return _o(i,t,e,r)&&_o(i,e,t,r)&&_o(i,r,t,e)}p(Uc,"pointInTriangle");function Jc(i,t,e,r){for(let s of i)if(s!==t&&s!==e&&s!==r&&Uc(s,t,e,r))return!0;return!1}p(Jc,"someInTriangle");function Hc(i,t,e,r){return al(i,t,e)&&!Jc(r,i,t,e)}p(Hc,"isEar");function ll(i){if(i.length<3)return[];if(i.length==3)return[i];let t=[],e=[],r=0;for(let d=0;d<i.length;d++){let m=i[r],f=i[d];(f.x<m.x||f.x==m.x&&f.y<m.y)&&(r=r),t[d]=d+1,e[d]=d-1}t[t.length-1]=0,e[0]=e.length-1,Oc(i)||([t,e]=[e,t]);let s=[];for(let d=0;d<i.length;++d)al(i[e[d]],i[d],i[t[d]])||s.push(i[d]);let n=[],o=i.length,a=1,l=0,c,h;for(;o>3;){c=t[a],h=e[a];let d=i[h],m=i[a],f=i[c];if(Hc(d,m,f,s))n.push([d,m,f]),t[h]=c,e[c]=h,s.splice(s.indexOf(m),1),--o,l=0;else if(++l>o)return[];a=c}return c=t[a],h=e[a],n.push([i[h],i[a],i[c]]),n}p(ll,"triangulate");function Wc(i){if(i.length<3)return!1;let t=i.length-2,e=i.length-1,r=0,s=i[e].sub(i[t]),n=i[r].sub(i[e]),o=s.cross(n);for(;r+1<i.length;)if(t=e,e=r,r++,s=i[e].sub(i[t]),n=i[r].sub(i[e]),s.cross(n)*o<0)return!1;return!0}p(Wc,"isConvex");var Vd=p(i=>i[0]instanceof ut,"arrayIsColor"),qd=p(i=>i[0]instanceof j,"arrayIsVec2"),Id=p(i=>typeof i[0]=="number","arrayIsNumber"),gs,Kc=(gs=class{constructor(t=(e,r)=>e<r){S(this,"_items");S(this,"_compareFn");this._compareFn=t,this._items=[]}insert(t){this._items.push(t),this.moveUp(this._items.length-1)}remove(){if(this._items.length===0)return null;let t=this._items[0],e=this._items.pop();return this._items.length!==0&&(this._items[0]=e,this.moveDown(0)),t}clear(){this._items.splice(0,this._items.length)}moveUp(t){for(;t>0;){let e=Math.floor((t-1)/2);if(!this._compareFn(this._items[t],this._items[e])&&this._items[t]>=this._items[e])break;this.swap(t,e),t=e}}moveDown(t){for(;t<Math.floor(this._items.length/2);){let e=2*t+1;if(e<this._items.length-1&&!this._compareFn(this._items[e],this._items[e+1])&&++e,this._compareFn(this._items[t],this._items[e]))break;this.swap(t,e),t=e}}swap(t,e){[this._items[t],this._items[e]]=[this._items[e],this._items[t]]}get length(){return this._items.length}},p(gs,"BinaryHeap"),gs);function Yc(i){let t=window.atob(i),e=t.length,r=new Uint8Array(e);for(let s=0;s<e;s++)r[s]=t.charCodeAt(s);return r.buffer}p(Yc,"base64ToArrayBuffer");function Gc(i){return Yc(i.split(",")[1])}p(Gc,"dataURLToArrayBuffer");function Oo(i,t){let e=document.createElement("a");e.href=t,e.download=i,e.click()}p(Oo,"download");function hl(i,t){Oo(i,"data:text/plain;charset=utf-8,"+t)}p(hl,"downloadText");function Xc(i,t){hl(i,JSON.stringify(t))}p(Xc,"downloadJSON");function Ca(i,t){let e=URL.createObjectURL(t);Oo(i,e),URL.revokeObjectURL(e)}p(Ca,"downloadBlob");var Qc=p(i=>i.match(/^data:\w+\/\w+;base64,.+/),"isDataURL"),jd=p(i=>i.split(".").slice(0,-1).join("."),"getFileName");function Uo(i,t){if(i===t)return!0;let e=typeof i,r=typeof t;if(e!==r)return!1;if(e==="object"&&r==="object"&&i!==null&&t!==null){if(Array.isArray(i)!==Array.isArray(t))return!1;let s=Object.keys(i),n=Object.keys(t);if(s.length!==n.length)return!1;for(let o of s){let a=i[o],l=t[o];if(!Uo(a,l))return!1}return!0}return!1}p(Uo,"deepEq");var As,Zc=(As=class extends Map{constructor(){super(...arguments);S(this,"lastID",0)}push(e){let r=this.lastID;return this.set(r,e),this.lastID++,r}pushd(e){let r=this.push(e);return()=>this.delete(r)}},p(As,"Registry"),As),Lr,Or=(Lr=class{constructor(t){S(this,"paused",!1);S(this,"cancel");this.cancel=t}static join(t){let e=new Lr(()=>t.forEach(r=>r.cancel()));return Object.defineProperty(e,"paused",{get:p(()=>t[0].paused,"get"),set:p(r=>t.forEach(s=>s.paused=r),"set")}),e.paused=!1,e}static replace(t,e){return t.cancel=()=>e.cancel(),e.paused=t.paused,Object.defineProperty(t,"paused",{get:p(()=>e.paused,"get"),set:p(r=>e.paused=r,"set")}),t}},p(Lr,"KEventController"),Lr),xs,Ce=(xs=class{constructor(){S(this,"handlers",new Zc)}add(t){let e=this.handlers.pushd((...s)=>{r.paused||t(...s)}),r=new Or(e);return r}addOnce(t){let e=this.add((...r)=>{e.cancel(),t(...r)});return e}next(){return new Promise(t=>this.addOnce(t))}trigger(...t){this.handlers.forEach(e=>e(...t))}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},p(xs,"KEvent"),xs),ws,fn=(ws=class{constructor(){S(this,"handlers",{});S(this,"registers",{})}on(t,e){return this.handlers[t]||(this.handlers[t]=new Ce),this.handlers[t].add(e)}onOnce(t,e){let r=this.on(t,(...s)=>{r.cancel(),e(...s)});return r}next(t){return new Promise(e=>{this.onOnce(t,(...r)=>e(r[0]))})}trigger(t,...e){this.handlers[t]&&this.handlers[t].trigger(...e)}remove(t){delete this.handlers[t]}clear(){this.handlers={}}numListeners(t){var e;return((e=this.handlers[t])==null?void 0:e.numListeners())??0}},p(ws,"KEventHandler"),ws),Ld=p(i=>i instanceof Error?i.message:String(i),"getErrorMessage");function xo(i,t){return Number(i.toFixed(t))}p(xo,"toFixed");function Ot(i,t){return(...e)=>{let r=e.length;if(r===i.length)return i(...e);if(r===t.length)return t(...e)}}p(Ot,"overload2");var Td=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function $c(i){if(typeof i!="string")throw new TypeError("string cannot be undefined or null");let t=[],e=0,r=0;for(;e<i.length;){if(r+=tu(e+r,i),au(i[e+r])&&r++,su(i[e+r])&&r++,nu(i[e+r])&&r++,lu(i[e+r])){r++;continue}t.push(i.substring(e,e+r)),e+=r,r=0}return t}p($c,"runes");function tu(i,t){let e=t[i];if(!eu(e)||i===t.length-1)return 1;let r=e+t[i+1],s=t.substring(i+2,i+5);return ka(r)&&ka(s)?4:iu(r)&&ou(s)?t.slice(i).indexOf(String.fromCodePoint(917631))+2:ru(s)?4:2}p(tu,"nextUnits");function eu(i){return i&&fr(i[0].charCodeAt(0),55296,56319)}p(eu,"isFirstOfSurrogatePair");function ka(i){return fr(Jo(i),127462,127487)}p(ka,"isRegionalIndicator");function iu(i){return fr(Jo(i),127988,127988)}p(iu,"isSubdivisionFlag");function ru(i){return fr(Jo(i),127995,127999)}p(ru,"isFitzpatrickModifier");function su(i){return typeof i=="string"&&fr(i.charCodeAt(0),65024,65039)}p(su,"isVariationSelector");function nu(i){return typeof i=="string"&&fr(i.charCodeAt(0),8400,8447)}p(nu,"isDiacriticalMark");function ou(i){let t=i.codePointAt(0);return typeof i=="string"&&typeof t=="number"&&fr(t,917504,917631)}p(ou,"isSupplementarySpecialpurposePlane");function au(i){return typeof i=="string"&&Td.includes(i.charCodeAt(0))}p(au,"isGrapheme");function lu(i){return typeof i=="string"&&i.charCodeAt(0)===8205}p(lu,"isZeroWidthJoiner");function Jo(i){let t=i.charCodeAt(0)-55296,e=i.charCodeAt(1)-56320;return(t<<10)+e+65536}p(Jo,"codePointFromSurrogatePair");function fr(i,t,e){return i>=t&&i<=e}p(fr,"betweenInclusive");var je=p((i,t)=>Array.isArray(i)?i==null?void 0:i.includes(t):i===t,"isEqOrIncludes"),li=p((i,t)=>Array.isArray(t)?t.some(e=>i.has(e)):i.has(t),"setHasOrIncludes"),Rn=p((i,t,e)=>{var r;i.has(t)?(r=i.get(t))==null||r.push(e):i.set(t,[e])},"mapAddOrPush"),Rd=(()=>{let i=0;return()=>i++})(),zd={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},Nd=p(()=>Sr.lastInputDevice,"getLastInputDeviceType"),Od=p(()=>{let i=Sr.buttons;for(let t in i){let e=i[t].keyboard&&[i[t].keyboard].flat(),r=i[t].keyboardCode&&[i[t].keyboardCode].flat(),s=i[t].gamepad&&[i[t].gamepad].flat(),n=i[t].mouse&&[i[t].mouse].flat();e&&e.forEach(o=>{Rn(Sr.buttonsByKey,o,t)}),r&&r.forEach(o=>{Rn(Sr.buttonsByKeyCode,o,t)}),s&&s.forEach(o=>{Rn(Sr.buttonsByGamepad,o,t)}),n&&n.forEach(o=>{Rn(Sr.buttonsByMouse,o,t)})}},"parseButtonBindings"),bs,ln=(bs=class{constructor(){S(this,"pressed",new Set([]));S(this,"pressedRepeat",new Set([]));S(this,"released",new Set([]));S(this,"down",new Set([]))}update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(t){this.pressed.add(t),this.pressedRepeat.add(t),this.down.add(t)}pressRepeat(t){this.pressedRepeat.add(t)}release(t){this.down.delete(t),this.pressed.delete(t),this.released.add(t)}},p(bs,"ButtonState"),bs),Bs,Ud=(Bs=class{constructor(){S(this,"buttonState",new ln);S(this,"stickState",new Map)}},p(Bs,"GamepadState"),Bs),Cs,Jd=(Cs=class{constructor(){S(this,"dts",[]);S(this,"timer",0);S(this,"fps",0)}tick(t){this.dts.push(t),this.timer+=t,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((e,r)=>e+r)/this.dts.length)),this.dts=[])}},p(Cs,"FPSCounter"),Cs),Sr,ih=zd,Hd=p(i=>{let t=i.buttons??{};return{canvas:i.canvas,buttons:t,buttonsByKey:new Map,buttonsByMouse:new Map,buttonsByGamepad:new Map,buttonsByKeyCode:new Map,loopID:null,stopped:!1,dt:0,fixedDt:1/50,restDt:0,time:0,realTime:0,fpsCounter:new Jd,timeScale:1,skipTime:!1,isHidden:!1,numFrames:0,mousePos:new j(0),mouseDeltaPos:new j(0),keyState:new ln,mouseState:new ln,mergedGamepadState:new Ud,gamepadStates:new Map,lastInputDevice:null,buttonState:new ln,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:i.canvas.offsetWidth,lastHeight:i.canvas.offsetHeight,events:new fn}},"initAppState"),Wd=p(i=>{if(!i.canvas)throw new Error("Please provide a canvas");let t=Hd(i);Sr=t,Od();function e(){return t.dt*t.timeScale}p(e,"dt");function r(){return t.fixedDt*t.timeScale}p(r,"fixedDt");function s(){return t.restDt*t.timeScale}p(s,"restDt");function n(){return t.isHidden}p(n,"isHidden");function o(){return t.time}p(o,"time");function a(){return t.fpsCounter.fps}p(a,"fps");function l(){return t.numFrames}p(l,"numFrames");function c(){return t.canvas.toDataURL()}p(c,"screenshot");function h(C){t.canvas.style.cursor=C}p(h,"setCursor");function d(){return t.canvas.style.cursor}p(d,"getCursor");function m(C){if(C)try{let q=t.canvas.requestPointerLock();q.catch&&q.catch(R=>console.error(R))}catch(q){console.error(q)}else document.exitPointerLock()}p(m,"setCursorLocked");function f(){return!!document.pointerLockElement}p(f,"isCursorLocked");function y(C){C.requestFullscreen?C.requestFullscreen():C.webkitRequestFullscreen&&C.webkitRequestFullscreen()}p(y,"enterFullscreen");function v(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}p(v,"exitFullscreen");function g(C=!0){C?y(t.canvas):v()}p(g,"setFullscreen");function A(){return document.fullscreenElement===t.canvas||document.webkitFullscreenElement===t.canvas}p(A,"isFullscreen");function B(){t.stopped=!0;let C=Object.entries(Ae),q=Object.entries(ta),R=Object.entries(Tn);for(let[U,at]of C)t.canvas.removeEventListener(U,at);for(let[U,at]of q)document.removeEventListener(U,at);for(let[U,at]of R)window.removeEventListener(U,at);th.disconnect()}p(B,"quit");function F(C,q){t.loopID!==null&&cancelAnimationFrame(t.loopID);let R=0,U=0,at=p(Ct=>{if(t.stopped)return;if(document.visibilityState!=="visible"){t.loopID=requestAnimationFrame(at);return}let ee=Ct/1e3,qt=Math.min(ee-t.realTime,.25),Mi=i.maxFPS?1/i.maxFPS:0;if(t.realTime=ee,U+=qt,U>Mi){if(!t.skipTime){for(R+=U,t.dt=t.fixedDt,t.restDt=0;R>t.fixedDt;)R-=t.fixedDt,R<t.fixedDt&&(t.restDt=R),C();t.restDt=R,t.dt=U,t.time+=e(),t.fpsCounter.tick(t.dt)}U=0,t.skipTime=!1,t.numFrames++,q(Ys,Yl)}t.loopID=requestAnimationFrame(at)},"frame");at(0)}p(F,"run");function E(){return"ontouchstart"in window||navigator.maxTouchPoints>0}p(E,"isTouchscreen");function k(){return t.mousePos.clone()}p(k,"mousePos");function w(){return t.mouseDeltaPos.clone()}p(w,"mouseDeltaPos");function b(C="left"){return t.mouseState.pressed.has(C)}p(b,"isMousePressed");function M(C="left"){return t.mouseState.down.has(C)}p(M,"isMouseDown");function V(C="left"){return t.mouseState.released.has(C)}p(V,"isMouseReleased");function T(){return t.isMouseMoved}p(T,"isMouseMoved");function z(C){return C===void 0?t.keyState.pressed.size>0:li(t.keyState.pressed,C)}p(z,"isKeyPressed");function O(C){return C===void 0?t.keyState.pressedRepeat.size>0:li(t.keyState.pressedRepeat,C)}p(O,"isKeyPressedRepeat");function J(C){return C===void 0?t.keyState.down.size>0:li(t.keyState.down,C)}p(J,"isKeyDown");function W(C){return C===void 0?t.keyState.released.size>0:li(t.keyState.released,C)}p(W,"isKeyReleased");function tt(C){return C===void 0?t.mergedGamepadState.buttonState.pressed.size>0:li(t.mergedGamepadState.buttonState.pressed,C)}p(tt,"isGamepadButtonPressed");function K(C){return C===void 0?t.mergedGamepadState.buttonState.down.size>0:li(t.mergedGamepadState.buttonState.down,C)}p(K,"isGamepadButtonDown");function Z(C){return C===void 0?t.mergedGamepadState.buttonState.released.size>0:li(t.mergedGamepadState.buttonState.released,C)}p(Z,"isGamepadButtonReleased");function ot(C){return C===void 0?t.buttonState.pressed.size>0:li(t.buttonState.pressed,C)}p(ot,"isButtonPressed");function Y(C){return C===void 0?t.buttonState.down.size>0:li(t.buttonState.down,C)}p(Y,"isButtonDown");function ct(C){return C===void 0?t.buttonState.released.size>0:li(t.buttonState.released,C)}p(ct,"isButtonReleased");function ft(C){var q;return(q=t.buttons)==null?void 0:q[C]}p(ft,"getButton");function X(C,q){t.buttons[C]={...t.buttons[C],...q}}p(X,"setButton");function Zt(C){t.buttonState.press(C),t.events.trigger("buttonPress",C)}p(Zt,"pressButton");function he(C){t.buttonState.release(C),t.events.trigger("buttonRelease",C)}p(he,"releaseButton");function ge(C){return t.events.on("resize",C)}p(ge,"onResize");let bi=Ot(C=>t.events.on("keyDown",C),(C,q)=>t.events.on("keyDown",R=>je(C,R)&&q(R))),Wi=Ot(C=>t.events.on("keyPress",q=>C(q)),(C,q)=>t.events.on("keyPress",R=>je(C,R)&&q(R))),yr=Ot(C=>t.events.on("keyPressRepeat",C),(C,q)=>t.events.on("keyPressRepeat",R=>je(C,R)&&q(R))),_r=Ot(C=>t.events.on("keyRelease",C),(C,q)=>t.events.on("keyRelease",R=>je(C,R)&&q(R))),Bi=Ot(C=>t.events.on("mouseDown",q=>C(q)),(C,q)=>t.events.on("mouseDown",R=>je(C,R)&&q(R))),Kt=Ot(C=>t.events.on("mousePress",q=>C(q)),(C,q)=>t.events.on("mousePress",R=>je(C,R)&&q(R))),In=Ot(C=>t.events.on("mouseRelease",q=>C(q)),(C,q)=>t.events.on("mouseRelease",R=>R===C&&q(R)));function vr(C){return t.events.on("mouseMove",()=>C(k(),w()))}p(vr,"onMouseMove");function Q(C){return t.events.on("charInput",C)}p(Q,"onCharInput");function ht(C){return t.events.on("touchStart",C)}p(ht,"onTouchStart");function dt(C){return t.events.on("touchMove",C)}p(dt,"onTouchMove");function bt(C){return t.events.on("touchEnd",C)}p(bt,"onTouchEnd");function Jt(C){return t.events.on("scroll",C)}p(Jt,"onScroll");function gt(C){return t.events.on("hide",C)}p(gt,"onHide");function ae(C){return t.events.on("show",C)}p(ae,"onShow");let Ki=Ot(C=>t.events.on("gamepadButtonPress",(q,R)=>C(q,R)),(C,q)=>t.events.on("gamepadButtonPress",(R,U)=>je(C,R)&&q(R,U))),Qo=Ot(C=>t.events.on("gamepadButtonDown",(q,R)=>C(q,R)),(C,q)=>t.events.on("gamepadButtonDown",(R,U)=>je(C,R)&&q(R,U))),Zo=Ot(C=>t.events.on("gamepadButtonRelease",(q,R)=>C(q,R)),(C,q)=>t.events.on("gamepadButtonRelease",(R,U)=>je(C,R)&&q(R,U)));function jn(C,q){return t.events.on("gamepadStick",(R,U,at)=>R===C&&q(U,at))}p(jn,"onGamepadStick");function Ln(C){t.events.on("gamepadConnect",C)}p(Ln,"onGamepadConnect");function Ws(C){t.events.on("gamepadDisconnect",C)}p(Ws,"onGamepadDisconnect");function Ke(C){return t.mergedGamepadState.stickState.get(C)||new j(0)}p(Ke,"getGamepadStick");function Ci(){return[...t.charInputted]}p(Ci,"charInputted");function Gr(){return[...t.gamepads]}p(Gr,"getGamepads");let Ie=Ot(C=>t.events.on("buttonPress",q=>C(q)),(C,q)=>t.events.on("buttonPress",R=>je(C,R)&&q(R))),Ks=Ot(C=>t.events.on("buttonDown",q=>C(q)),(C,q)=>t.events.on("buttonDown",R=>je(C,R)&&q(R))),ki=Ot(C=>t.events.on("buttonRelease",q=>C(q)),(C,q)=>t.events.on("buttonRelease",R=>je(C,R)&&q(R)));function Ys(){t.events.trigger("input"),t.keyState.down.forEach(C=>t.events.trigger("keyDown",C)),t.mouseState.down.forEach(C=>t.events.trigger("mouseDown",C)),t.buttonState.down.forEach(C=>{t.events.trigger("buttonDown",C)}),Xl()}p(Ys,"processInput");function Yl(){t.keyState.update(),t.mouseState.update(),t.buttonState.update(),t.mergedGamepadState.buttonState.update(),t.mergedGamepadState.stickState.forEach((C,q)=>{t.mergedGamepadState.stickState.set(q,new j(0))}),t.charInputted=[],t.isMouseMoved=!1,t.mouseDeltaPos=new j(0),t.gamepadStates.forEach(C=>{C.buttonState.update(),C.stickState.forEach((q,R)=>{C.stickState.set(R,new j(0))})})}p(Yl,"resetInput");function $o(C){let q={index:C.index,isPressed:p(R=>{var U;return((U=t.gamepadStates.get(C.index))==null?void 0:U.buttonState.pressed.has(R))||!1},"isPressed"),isDown:p(R=>{var U;return((U=t.gamepadStates.get(C.index))==null?void 0:U.buttonState.down.has(R))||!1},"isDown"),isReleased:p(R=>{var U;return((U=t.gamepadStates.get(C.index))==null?void 0:U.buttonState.released.has(R))||!1},"isReleased"),getStick:p(R=>{var U;return((U=t.gamepadStates.get(C.index))==null?void 0:U.stickState.get(R))||P()},"getStick")};return t.gamepads.push(q),t.gamepadStates.set(C.index,{buttonState:new ln,stickState:new Map([["left",new j(0)],["right",new j(0)]])}),q}p($o,"registerGamepad");function Gl(C){t.gamepads=t.gamepads.filter(q=>q.index!==C.index),t.gamepadStates.delete(C.index)}p(Gl,"removeGamepad");function Xl(){var C,q;for(let R of navigator.getGamepads())R&&!t.gamepadStates.has(R.index)&&$o(R);for(let R of t.gamepads){let U=navigator.getGamepads()[R.index];if(!U)continue;let at=(i.gamepads??{})[U.id]||ih[U.id]||ih.default,Ct=t.gamepadStates.get(R.index);if(Ct){for(let ee=0;ee<U.buttons.length;ee++){let qt=at.buttons[ee],Mi=U.buttons[ee],ai=t.buttonsByGamepad.has(qt);if(Mi.pressed){if(Ct.buttonState.down.has(qt)){t.events.trigger("gamepadButtonDown",qt,R);continue}t.lastInputDevice="gamepad",ai&&((C=t.buttonsByGamepad.get(qt))==null||C.forEach(Fi=>{t.buttonState.press(Fi),t.events.trigger("buttonPress",Fi)})),t.mergedGamepadState.buttonState.press(qt),Ct.buttonState.press(qt),t.events.trigger("gamepadButtonPress",qt,R)}else Ct.buttonState.down.has(qt)&&(ai&&((q=t.buttonsByGamepad.get(qt))==null||q.forEach(Fi=>{t.buttonState.release(Fi),t.events.trigger("buttonRelease",Fi)})),t.mergedGamepadState.buttonState.release(qt),Ct.buttonState.release(qt),t.events.trigger("gamepadButtonRelease",qt,R))}for(let ee in at.sticks){let qt=at.sticks[ee];if(!qt)continue;let Mi=new j(U.axes[qt.x],U.axes[qt.y]);Ct.stickState.set(ee,Mi),t.mergedGamepadState.stickState.set(ee,Mi),t.events.trigger("gamepadStick",ee,Mi,R)}}}}p(Xl,"processGamepad");let Ae={},ta={},Tn={},Ql=i.pixelDensity||1;Ae.mousemove=C=>{let q=new j(C.offsetX,C.offsetY),R=new j(C.movementX,C.movementY);if(A()){let U=t.canvas.width/Ql,at=t.canvas.height/Ql,Ct=window.innerWidth,ee=window.innerHeight,qt=Ct/ee,Mi=U/at;if(qt>Mi){let ai=ee/at,Fi=(Ct-U*ai)/2;q.x=ei(C.offsetX-Fi,0,U*ai,0,U),q.y=ei(C.offsetY,0,at*ai,0,at)}else{let ai=Ct/U,Fi=(ee-at*ai)/2;q.x=ei(C.offsetX,0,U*ai,0,U),q.y=ei(C.offsetY-Fi,0,at*ai,0,at)}}t.events.onOnce("input",()=>{t.isMouseMoved=!0,t.mousePos=q,t.mouseDeltaPos=R,t.events.trigger("mouseMove")})};let Zl=["left","middle","right","back","forward"];Ae.mousedown=C=>{t.events.onOnce("input",()=>{var R;let q=Zl[C.button];q&&(t.lastInputDevice="mouse",t.buttonsByMouse.has(q)&&((R=t.buttonsByMouse.get(q))==null||R.forEach(U=>{t.buttonState.press(U),t.events.trigger("buttonPress",U)})),t.mouseState.press(q),t.events.trigger("mousePress",q))})},Ae.mouseup=C=>{t.events.onOnce("input",()=>{var R;let q=Zl[C.button];q&&(t.buttonsByMouse.has(q)&&((R=t.buttonsByMouse.get(q))==null||R.forEach(U=>{t.buttonState.release(U),t.events.trigger("buttonRelease",U)})),t.mouseState.release(q),t.events.trigger("mouseRelease",q))})};let Bd=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),$l={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};Ae.keydown=C=>{Bd.has(C.key)&&C.preventDefault(),t.events.onOnce("input",()=>{var U,at;let q=$l[C.key]||C.key.toLowerCase(),R=C.code;if(q===void 0)throw new Error(`Unknown key: ${C.key}`);q.length===1?(t.events.trigger("charInput",q),t.charInputted.push(q)):q==="space"&&(t.events.trigger("charInput"," "),t.charInputted.push(" ")),C.repeat?(t.keyState.pressRepeat(q),t.events.trigger("keyPressRepeat",q)):(t.lastInputDevice="keyboard",t.buttonsByKey.has(q)&&((U=t.buttonsByKey.get(q))==null||U.forEach(Ct=>{t.buttonState.press(Ct),t.events.trigger("buttonPress",Ct)})),t.buttonsByKeyCode.has(R)&&((at=t.buttonsByKeyCode.get(R))==null||at.forEach(Ct=>{t.buttonState.press(Ct),t.events.trigger("buttonPress",Ct)})),t.keyState.press(q),t.events.trigger("keyPressRepeat",q),t.events.trigger("keyPress",q))})},Ae.keyup=C=>{t.events.onOnce("input",()=>{var U,at;let q=$l[C.key]||C.key.toLowerCase(),R=C.code;t.buttonsByKey.has(q)&&((U=t.buttonsByKey.get(q))==null||U.forEach(Ct=>{t.buttonState.release(Ct),t.events.trigger("buttonRelease",Ct)})),t.buttonsByKeyCode.has(R)&&((at=t.buttonsByKeyCode.get(R))==null||at.forEach(Ct=>{t.buttonState.release(Ct),t.events.trigger("buttonRelease",Ct)})),t.keyState.release(q),t.events.trigger("keyRelease",q)})},Ae.touchstart=C=>{C.preventDefault(),t.events.onOnce("input",()=>{var U;let q=[...C.changedTouches],R=t.canvas.getBoundingClientRect();i.touchToMouse!==!1&&(t.mousePos=new j(q[0].clientX-R.x,q[0].clientY-R.y),t.lastInputDevice="mouse",t.buttonsByMouse.has("left")&&((U=t.buttonsByMouse.get("left"))==null||U.forEach(at=>{t.buttonState.press(at),t.events.trigger("buttonPress",at)})),t.mouseState.press("left"),t.events.trigger("mousePress","left")),q.forEach(at=>{t.events.trigger("touchStart",new j(at.clientX-R.x,at.clientY-R.y),at)})})},Ae.touchmove=C=>{C.preventDefault(),t.events.onOnce("input",()=>{let q=[...C.changedTouches],R=t.canvas.getBoundingClientRect();if(i.touchToMouse!==!1){let U=t.mousePos;t.mousePos=new j(q[0].clientX-R.x,q[0].clientY-R.y),t.mouseDeltaPos=t.mousePos.sub(U),t.events.trigger("mouseMove")}q.forEach(U=>{t.events.trigger("touchMove",new j(U.clientX-R.x,U.clientY-R.y),U)})})},Ae.touchend=C=>{t.events.onOnce("input",()=>{var U;let q=[...C.changedTouches],R=t.canvas.getBoundingClientRect();i.touchToMouse!==!1&&(t.mousePos=new j(q[0].clientX-R.x,q[0].clientY-R.y),t.mouseDeltaPos=new j(0,0),t.buttonsByMouse.has("left")&&((U=t.buttonsByMouse.get("left"))==null||U.forEach(at=>{t.buttonState.release(at),t.events.trigger("buttonRelease",at)})),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),q.forEach(at=>{t.events.trigger("touchEnd",new j(at.clientX-R.x,at.clientY-R.y),at)})})},Ae.touchcancel=C=>{t.events.onOnce("input",()=>{let q=[...C.changedTouches],R=t.canvas.getBoundingClientRect();i.touchToMouse!==!1&&(t.mousePos=new j(q[0].clientX-R.x,q[0].clientY-R.y),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),q.forEach(U=>{t.events.trigger("touchEnd",new j(U.clientX-R.x,U.clientY-R.y),U)})})},Ae.wheel=C=>{C.preventDefault(),t.events.onOnce("input",()=>{t.events.trigger("scroll",new j(C.deltaX,C.deltaY))})},Ae.contextmenu=C=>C.preventDefault(),ta.visibilitychange=()=>{document.visibilityState==="visible"?(t.skipTime=!0,t.isHidden=!1,t.events.trigger("show")):(t.isHidden=!0,t.events.trigger("hide"))},Tn.gamepadconnected=C=>{let q=$o(C.gamepad);t.events.onOnce("input",()=>{t.events.trigger("gamepadConnect",q)})},Tn.gamepaddisconnected=C=>{let q=Gr().filter(R=>R.index===C.gamepad.index)[0];Gl(C.gamepad),t.events.onOnce("input",()=>{t.events.trigger("gamepadDisconnect",q)})};for(let[C,q]of Object.entries(Ae))t.canvas.addEventListener(C,q);for(let[C,q]of Object.entries(ta))document.addEventListener(C,q);for(let[C,q]of Object.entries(Tn))window.addEventListener(C,q);let th=new ResizeObserver(C=>{for(let q of C)if(q.target===t.canvas){if(t.lastWidth===t.canvas.offsetWidth&&t.lastHeight===t.canvas.offsetHeight)return;t.lastWidth=t.canvas.offsetWidth,t.lastHeight=t.canvas.offsetHeight,t.events.onOnce("input",()=>{t.events.trigger("resize")})}});return th.observe(t.canvas),{state:t,dt:e,fixedDt:r,restDt:s,time:o,run:F,canvas:t.canvas,fps:a,numFrames:l,quit:B,isHidden:n,setFullscreen:g,isFullscreen:A,setCursor:h,screenshot:c,getGamepads:Gr,getCursor:d,setCursorLocked:m,isCursorLocked:f,isTouchscreen:E,mousePos:k,mouseDeltaPos:w,isKeyDown:J,isKeyPressed:z,isKeyPressedRepeat:O,isKeyReleased:W,isMouseDown:M,isMousePressed:b,isMouseReleased:V,isMouseMoved:T,isGamepadButtonPressed:tt,isGamepadButtonDown:K,isGamepadButtonReleased:Z,getGamepadStick:Ke,isButtonPressed:ot,isButtonDown:Y,isButtonReleased:ct,setButton:X,getButton:ft,pressButton:Zt,releaseButton:he,charInputted:Ci,onResize:ge,onKeyDown:bi,onKeyPress:Wi,onKeyPressRepeat:yr,onKeyRelease:_r,onMouseDown:Bi,onMousePress:Kt,onMouseRelease:In,onMouseMove:vr,onCharInput:Q,onTouchStart:ht,onTouchMove:dt,onTouchEnd:bt,onScroll:Jt,onHide:gt,onShow:ae,onGamepadButtonDown:Qo,onGamepadButtonPress:Ki,onGamepadButtonRelease:Zo,onGamepadStick:jn,onGamepadConnect:Ln,onGamepadDisconnect:Ws,onButtonPress:Ie,onButtonDown:Ks,onButtonRelease:ki,getLastInputDeviceType:Nd,events:t.events}},"initApp");function Xt(){return x.app.dt()}p(Xt,"dt");function wo(){return x.app.fixedDt()}p(wo,"fixedDt");function bo(){return x.app.restDt()}p(bo,"restDt");var Kd=new j(-1,-1),Yd=new j(0,-1),Gd=new j(1,-1),Xd=new j(-1,0),Qd=new j(0,0),Zd=new j(1,0),$d=new j(-1,1),tp=new j(0,1),ep=new j(1,1);function Ur(i){switch(i){case"topleft":return Kd;case"top":return Yd;case"topright":return Gd;case"left":return Xd;case"center":return Qd;case"right":return Zd;case"botleft":return $d;case"bot":return tp;case"botright":return ep;default:return i}}p(Ur,"anchorPt");function hu(i){switch(i){case"left":return 0;case"center":return .5;case"right":return 1;default:return 0}}p(hu,"alignPt");function cu(i){return i.createBuffer(1,1,44100)}p(cu,"createEmptyAudioBuffer");var zn=2.5949095,rh=1.70158+1,sh=2*Math.PI/3,nh=2*Math.PI/4.5,vo={linear:p(i=>i,"linear"),easeInSine:p(i=>1-Math.cos(i*Math.PI/2),"easeInSine"),easeOutSine:p(i=>Math.sin(i*Math.PI/2),"easeOutSine"),easeInOutSine:p(i=>-(Math.cos(Math.PI*i)-1)/2,"easeInOutSine"),easeInQuad:p(i=>i*i,"easeInQuad"),easeOutQuad:p(i=>1-(1-i)*(1-i),"easeOutQuad"),easeInOutQuad:p(i=>i<.5?2*i*i:1-Math.pow(-2*i+2,2)/2,"easeInOutQuad"),easeInCubic:p(i=>i*i*i,"easeInCubic"),easeOutCubic:p(i=>1-Math.pow(1-i,3),"easeOutCubic"),easeInOutCubic:p(i=>i<.5?4*i*i*i:1-Math.pow(-2*i+2,3)/2,"easeInOutCubic"),easeInQuart:p(i=>i*i*i*i,"easeInQuart"),easeOutQuart:p(i=>1-Math.pow(1-i,4),"easeOutQuart"),easeInOutQuart:p(i=>i<.5?8*i*i*i*i:1-Math.pow(-2*i+2,4)/2,"easeInOutQuart"),easeInQuint:p(i=>i*i*i*i*i,"easeInQuint"),easeOutQuint:p(i=>1-Math.pow(1-i,5),"easeOutQuint"),easeInOutQuint:p(i=>i<.5?16*i*i*i*i*i:1-Math.pow(-2*i+2,5)/2,"easeInOutQuint"),easeInExpo:p(i=>i===0?0:Math.pow(2,10*i-10),"easeInExpo"),easeOutExpo:p(i=>i===1?1:1-Math.pow(2,-10*i),"easeOutExpo"),easeInOutExpo:p(i=>i===0?0:i===1?1:i<.5?Math.pow(2,20*i-10)/2:(2-Math.pow(2,-20*i+10))/2,"easeInOutExpo"),easeInCirc:p(i=>1-Math.sqrt(1-Math.pow(i,2)),"easeInCirc"),easeOutCirc:p(i=>Math.sqrt(1-Math.pow(i-1,2)),"easeOutCirc"),easeInOutCirc:p(i=>i<.5?(1-Math.sqrt(1-Math.pow(2*i,2)))/2:(Math.sqrt(1-Math.pow(-2*i+2,2))+1)/2,"easeInOutCirc"),easeInBack:p(i=>rh*i*i*i-1.70158*i*i,"easeInBack"),easeOutBack:p(i=>1+rh*Math.pow(i-1,3)+1.70158*Math.pow(i-1,2),"easeOutBack"),easeInOutBack:p(i=>i<.5?Math.pow(2*i,2)*((zn+1)*2*i-zn)/2:(Math.pow(2*i-2,2)*((zn+1)*(i*2-2)+zn)+2)/2,"easeInOutBack"),easeInElastic:p(i=>i===0?0:i===1?1:-Math.pow(2,10*i-10)*Math.sin((i*10-10.75)*sh),"easeInElastic"),easeOutElastic:p(i=>i===0?0:i===1?1:Math.pow(2,-10*i)*Math.sin((i*10-.75)*sh)+1,"easeOutElastic"),easeInOutElastic:p(i=>i===0?0:i===1?1:i<.5?-(Math.pow(2,20*i-10)*Math.sin((20*i-11.125)*nh))/2:Math.pow(2,-20*i+10)*Math.sin((20*i-11.125)*nh)/2+1,"easeInOutElastic"),easeInBounce:p(i=>1-vo.easeOutBounce(1-i),"easeInBounce"),easeOutBounce:p(i=>i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375,"easeOutBounce"),easeInOutBounce:p(i=>i<.5?(1-vo.easeOutBounce(1-2*i))/2:(1+vo.easeOutBounce(2*i-1))/2,"easeInOutBounce")},yn=vo;function uu(i,t,e){let r=[],s=t;for(r.push(s);s!==i;){if(s=e.get(s),s==null)return null;r.push(s)}return r.reverse()}p(uu,"buildPath");function mu(i,t,e){var o;let r=new Kc((a,l)=>a.cost<l.cost);r.insert({cost:0,node:t});let s=new Map;s.set(t,t);let n=new Map;for(n.set(t,0);r.length!==0;){let a=(o=r.remove())==null?void 0:o.node;if(a===e)break;let l=i.getNeighbours(a);for(let c of l){let h=(n.get(a)||0)+i.getCost(a,c)+i.getHeuristic(c,e);(!n.has(c)||h<n.get(c))&&(n.set(c,h),r.insert({cost:h,node:c}),s.set(c,a))}}return uu(t,e,s)}p(mu,"aStarSearch");var ks,ip=(ks=class{constructor(t,e,r){S(this,"a");S(this,"b");S(this,"polygon");this.a=t,this.b=e,this.polygon=new WeakRef(r)}isLeft(t,e){return(this.b.x-this.a.x)*(e-this.a.y)-(t-this.a.x)*(this.b.y-this.a.y)}get middle(){return this.a.add(this.b).scale(.5)}},p(ks,"NavEdge"),ks),Ms,rp=(Ms=class{constructor(t){S(this,"_edges");S(this,"_centroid");S(this,"_id");this._id=t}get id(){return this._id}set edges(t){this._edges=t;let e=0,r=0,s=0;for(let n of this._edges){n.polygon=new WeakRef(this);let o=n.a.x*n.b.y-n.a.y*n.b.x;e+=(n.a.x+n.b.x)*o,r+=(n.a.y+n.b.y)*o,s+=o}s/=2,this._centroid=P(e/(6*s),r/(6*s))}get edges(){return this._edges}get centroid(){return this._centroid}contains(t){let e=!1;for(let r of this.edges)r.b.y>t.y!=r.a.y>t.y&&t.x<(r.a.x-r.b.x)*(t.y-r.b.y)/(r.a.y-r.b.y)+r.b.x&&(e=!e);return e}},p(Ms,"NavPolygon"),Ms),Fs,sp=(Fs=class{constructor(){S(this,"_polygons");S(this,"_pointCache");S(this,"_edgeCache");this._polygons=[],this._pointCache={},this._edgeCache={}}_addPoint(t){let e=this._pointCache[`${t.x}_${t.y}`];return e||(e=t.clone(),this._pointCache[`${t.x}_${t.y}`]=e,e)}_addEdge(t){let e=`${t.a.x}_${t.a.y}-${t.b.x}_${t.b.y}`;return this._edgeCache[e]=t,t}_findEdge(t,e){let r=`${t.x}_${t.y}-${e.x}_${e.y}`;return this._edgeCache[r]}_findCommonEdge(t,e){for(let r of t.edges){let s=this._findEdge(r.b,r.a);if(s&&s.polygon.deref().id===e.id)return s}return null}addPolygon(t){let e=new rp(this._polygons.length),r=t.map((s,n)=>new ip(s,t[(n+1)%t.length],e));e.edges=r,this._polygons.push(e);for(let s of e.edges)this._addEdge(s);return e}addRect(t,e){let r=this._addPoint(t),s=this._addPoint(t.add(e.x,0)),n=this._addPoint(t.add(e)),o=this._addPoint(t.add(0,e.y));return this.addPolygon([r,s,n,o])}_getLocation(t){for(let e of this._polygons)if(e.contains(t))return e;return null}getNeighbours(t){let e=[];for(let r of this._polygons[t].edges){let s=this._findEdge(r.b,r.a);if(s){let n=s.polygon.deref();n&&e.push(n.id)}}return e}getCost(t,e){return 1}getHeuristic(t,e){let r=this._polygons[t],s=this._polygons[e],n=r.centroid.x-s.centroid.x,o=r.centroid.y-s.centroid.y;return Math.sqrt(n*n+o*o)}getPath(t,e){return t===void 0||e===void 0?[]:t===e?[t,e]:mu(this,t,e)}getWaypointPath(t,e,r){let s=(r==null?void 0:r.type)||"centroids",n=this._getLocation(t),o=this._getLocation(e);if(n===void 0||o===void 0)return[];let a=this.getPath(n.id,o.id);if(!a)return[];if(s==="edges"){let l=[];for(let c=1;c<a.length;c++){let h=this._polygons[a[c-1]],d=this._polygons[a[c]],m=this._findCommonEdge(h,d);l.push(m.middle.add(d.centroid.sub(m.middle).unit().scale(4)))}return[t,...l,e]}else return[t,...a.slice(1,-1).map(l=>this._polygons[l].centroid),e]}},p(Fs,"NavMesh"),Fs);function ys(i){let t=new Ai;return i.pos&&t.translate(i.pos),i.scale&&t.scale(i.scale),i.angle&&t.rotate(i.angle),i.parent?t.mult(i.parent.transform):t}p(ys,"calcTransform");function du(i){return new j(i.x/te()*2-1,-i.y/ie()*2+1)}p(du,"screen2ndc");function ds(i,t,e,r,s,n=1){r=Ut(r%360),s=Ut(s%360),s<=r&&(s+=Math.PI*2);let o=[],a=Math.ceil((s-r)/Ut(8)*n),l=(s-r)/a,c=P(Math.cos(r),Math.sin(r)),h=P(Math.cos(l),Math.sin(l));for(let d=0;d<=a;d++)o.push(i.add(t*c.x,e*c.y)),c=P(c.x*h.x-c.y*h.y,c.x*h.y+c.y*h.x);return o}p(ds,"getArcPts");function pu(...i){let t=xt(...i),e=i[3]??1;x.gfx.bgColor=t,x.gfx.bgAlpha=e,x.gfx.ggl.gl.clearColor(t.r/255,t.g/255,t.b/255,e)}p(pu,"setBackground");function fu(){var i,t;return((t=(i=x.gfx.bgColor)==null?void 0:i.clone)==null?void 0:t.call(i))??null}p(fu,"getBackground");function Pt(...i){if(i[0]===void 0)return;let t=P(...i);t.x===0&&t.y===0||x.gfx.transform.translate(t)}p(Pt,"pushTranslate");function ke(){x.gfx.transformStack.push(x.gfx.transform.clone())}p(ke,"pushTransform");function yu(i){x.gfx.transform=i.clone()}p(yu,"pushMatrix");function zs(...i){if(i[0]===void 0)return;let t=P(...i);t.x===1&&t.y===1||x.gfx.transform.scale(t)}p(zs,"pushScale");function zr(i){i&&x.gfx.transform.rotate(i)}p(zr,"pushRotate");function fe(){x.gfx.transformStack.length>0&&(x.gfx.transform=x.gfx.transformStack.pop())}p(fe,"popTransform");function Me(){x.gfx.renderer.flush()}p(Me,"flush");function te(){return x.gfx.width}p(te,"width");function ie(){return x.gfx.height}p(ie,"height");function cl(){return(x.gfx.viewport.width+x.gfx.viewport.height)/(x.gfx.width+x.gfx.height)}p(cl,"getViewportScale");function _u(i){return new j(i.x*x.gfx.viewport.width/x.gfx.width,i.y*x.gfx.viewport.height/x.gfx.height)}p(_u,"contentToView");function vu(i){return new j((i.x-x.gfx.viewport.x)*te()/x.gfx.viewport.width,(i.y-x.gfx.viewport.y)*ie()/x.gfx.viewport.height)}p(vu,"windowToContent");function ul(){return vu(x.app.mousePos())}p(ul,"mousePos");function _n(){return P(te()/2,ie()/2)}p(_n,"center");var gu=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",Ho="topleft",np="monospace",Bo="monospace",Ma="linear",ml=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],op=ml.reduce((i,t)=>i+t.size,0),Au=2048,ap=Au*4*op,lp=Au*6,hp=`
attribute vec2 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 0.0, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,cp=`
precision mediump float;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	return v_color * texture2D(u_tex, v_uv);
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,Fa=`
vec4 vert(vec2 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,Ea=`
vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,up=new Set(["id","require"]),mp=new Set(["add","fixedUpdate","update","draw","destroy","inspect","drawInspect"]),dp=200,pp=640,fp=65536,Es,yp=(Es=class{constructor(t,e,r){S(this,"textures",[]);S(this,"bigTextures",[]);S(this,"canvas");S(this,"c2d");S(this,"x",0);S(this,"y",0);S(this,"curHeight",0);S(this,"gfx");this.gfx=t,this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=r,this.textures=[ir.fromImage(t,this.canvas)],this.bigTextures=[];let s=this.canvas.getContext("2d");if(!s)throw new Error("Failed to get 2d context");this.c2d=s}add(t){if(t.width>this.canvas.width||t.height>this.canvas.height){let s=ir.fromImage(this.gfx,t);return this.bigTextures.push(s),[s,new Vt(0,0,1,1)]}this.x+t.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+t.height>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(ir.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let e=this.textures[this.textures.length-1],r=new j(this.x,this.y);return this.x+=t.width,t.height>this.curHeight&&(this.curHeight=t.height),t instanceof ImageData?this.c2d.putImageData(t,r.x,r.y):this.c2d.drawImage(t,r.x,r.y),e.update(this.canvas),[e,new Vt(r.x/this.canvas.width,r.y/this.canvas.height,t.width/this.canvas.width,t.height/this.canvas.height)]}free(){for(let t of this.textures)t.free();for(let t of this.bigTextures)t.free()}},p(Es,"TexPacker"),Es);function De(i){return typeof i!="string"||Qc(i)?i:x.assets.urlPrefix+i}p(De,"fixURL");var Tr,He=(Tr=class{constructor(t){S(this,"loaded",!1);S(this,"data",null);S(this,"error",null);S(this,"onLoadEvents",new Ce);S(this,"onErrorEvents",new Ce);S(this,"onFinishEvents",new Ce);t.then(e=>{this.loaded=!0,this.data=e,this.onLoadEvents.trigger(e)}).catch(e=>{if(this.error=e,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(e);else throw e}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(t){let e=new Tr(Promise.resolve(t));return e.data=t,e.loaded=!0,e}onLoad(t){return this.loaded&&this.data?t(this.data):this.onLoadEvents.add(t),this}onError(t){return this.loaded&&this.error?t(this.error):this.onErrorEvents.add(t),this}onFinish(t){return this.loaded?t():this.onFinishEvents.add(t),this}then(t){return this.onLoad(t)}catch(t){return this.onError(t)}finally(t){return this.onFinish(t)}},p(Tr,"Asset"),Tr),Ss,Xr=(Ss=class{constructor(){S(this,"assets",new Map);S(this,"lastUID",0)}add(t,e){let r=t??this.lastUID+++"",s=new He(e);return this.assets.set(r,s),s}addLoaded(t,e){let r=t??this.lastUID+++"",s=He.loaded(e);return this.assets.set(r,s),s}get(t){return this.assets.get(t)}progress(){if(this.assets.size===0)return 1;let t=0;return this.assets.forEach(e=>{e.loaded&&t++}),t/this.assets.size}},p(Ss,"AssetBucket"),Ss);function Wo(i){return fetch(i).then(t=>{if(!t.ok)throw new Error(`Failed to fetch "${i}"`);return t})}p(Wo,"fetchURL");function Sn(i){return Wo(i).then(t=>t.json())}p(Sn,"fetchJSON");function xu(i){return Wo(i).then(t=>t.text())}p(xu,"fetchText");function wu(i){return Wo(i).then(t=>t.arrayBuffer())}p(wu,"fetchArrayBuffer");function bu(i){return i!==void 0&&(x.assets.urlPrefix=i),x.assets.urlPrefix}p(bu,"loadRoot");function Bu(i,t){return x.assets.custom.add(i,Sn(De(t)))}p(Bu,"loadJSON");function Dn(i){let t=new Image;return t.crossOrigin="anonymous",t.src=i,new Promise((e,r)=>{t.onload=()=>e(t),t.onerror=()=>r(new Error(`Failed to load image from "${i}"`))})}p(Dn,"loadImg");function hr(){let i=[x.assets.sprites,x.assets.sounds,x.assets.shaders,x.assets.fonts,x.assets.bitmapFonts,x.assets.custom];return i.reduce((t,e)=>t+e.progress(),0)/i.length}p(hr,"loadProgress");function Cu(i){return x.assets.custom.get(i)??null}p(Cu,"getAsset");function Co(i){return x.assets.custom.add(null,i)}p(Co,"load");var _p=p(i=>({urlPrefix:"",sprites:new Xr,fonts:new Xr,bitmapFonts:new Xr,sounds:new Xr,shaders:new Xr,custom:new Xr,music:{},packer:new yp(i,2048,2048),loaded:!1}),"initAssets"),vp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==",vi,cr=(vi=class{constructor(t,e,r={},s=null){S(this,"tex");S(this,"frames",[new Vt(0,0,1,1)]);S(this,"anims",{});S(this,"slice9",null);this.tex=t,e&&(this.frames=e),this.anims=r,this.slice9=s}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(t,e={}){return typeof t=="string"?vi.fromURL(t,e):Promise.resolve(vi.fromImage(t,e))}static fromImage(t,e={}){let[r,s]=x.assets.packer.add(t),n=e.frames?e.frames.map(o=>new Vt(s.x+o.x*s.w,s.y+o.y*s.h,o.w*s.w,o.h*s.h)):pl(e.sliceX||1,e.sliceY||1,s.x,s.y,s.w,s.h);return new vi(r,n,e.anims,e.slice9)}static fromURL(t,e={}){return Dn(t).then(r=>vi.fromImage(r,e))}},p(vi,"SpriteData"),vi);function hn(i){if(typeof i=="string"){let t=dl(i);if(t)return t;if(hr()<1)return null;throw new Error(`Sprite not found: ${i}`)}else{if(i instanceof cr)return He.loaded(i);if(i instanceof He)return i;throw new Error(`Invalid sprite: ${i}`)}}p(hn,"resolveSprite");function dl(i){return x.assets.sprites.get(i)??null}p(dl,"getSprite");function _s(i,t,e={sliceX:1,sliceY:1,anims:{}}){return t=De(t),Array.isArray(t)?t.some(r=>typeof r=="string")?x.assets.sprites.add(i,Promise.all(t.map(r=>typeof r=="string"?Dn(r):Promise.resolve(r))).then(r=>Sa(r,e))):x.assets.sprites.addLoaded(i,Sa(t,e)):typeof t=="string"?x.assets.sprites.add(i,cr.from(t,e)):x.assets.sprites.addLoaded(i,cr.fromImage(t,e))}p(_s,"loadSprite");function pl(i=1,t=1,e=0,r=0,s=1,n=1){let o=[],a=s/i,l=n/t;for(let c=0;c<t;c++)for(let h=0;h<i;h++)o.push(new Vt(e+h*a,r+c*l,a,l));return o}p(pl,"slice");function Sa(i,t={}){let e=document.createElement("canvas"),r=i[0].width,s=i[0].height;e.width=r*i.length,e.height=s;let n=e.getContext("2d");if(!n)throw new Error("Failed to create canvas context");i.forEach((a,l)=>{a instanceof ImageData?n.putImageData(a,l*r,0):n.drawImage(a,l*r,0)});let o=n.getImageData(0,0,i.length*r,s);return cr.fromImage(o,{...t,sliceX:i.length,sliceY:1})}p(Sa,"createSpriteSheet");function ku(i="bean"){return _s(i,vp)}p(ku,"loadBean");function Mu(i,t,e){t=De(t),e=De(e),typeof t=="string"&&!e&&(e=jd(t)+".json");let r=typeof e=="string"?Sn(e):Promise.resolve(e);return x.assets.sprites.add(i,r.then(s=>{let n=s.meta.size,o=s.frames.map(l=>new Vt(l.frame.x/n.w,l.frame.y/n.h,l.frame.w/n.w,l.frame.h/n.h)),a={};for(let l of s.meta.frameTags)l.from===l.to?a[l.name]=l.from:a[l.name]={from:l.from,to:l.to,speed:10,loop:!0,pingpong:l.direction==="pingpong"};return cr.from(t,{frames:o,anims:a})}))}p(Mu,"loadAseprite");var Ds,go=(Ds=class{constructor(t,e={}){S(this,"fontface");S(this,"filter",Ma);S(this,"outline",null);S(this,"size",64);if(this.fontface=t,this.filter=e.filter??Ma,this.size=e.size??64,this.size>256)throw new Error("Max font size: 256");e.outline&&(this.outline={width:1,color:xt(0,0,0)},typeof e.outline=="number"?this.outline.width=e.outline:typeof e.outline=="object"&&(e.outline.width&&(this.outline.width=e.outline.width),e.outline.color&&(this.outline.color=e.outline.color)))}},p(Ds,"FontData"),Ds);function fl(i){if(!i)return fl(x.globalOpt.font??np);if(typeof i=="string"){let t=_l(i),e=yl(i);if(t)return t.data??t;if(e)return e.data??e;if(document.fonts.check(`64px ${i}`))return i;if(hr()<1)return null;throw new Error(`Font not found: ${i}`)}else if(i instanceof He)return i.data?i.data:i;return i}p(fl,"resolveFont");function yl(i){return x.assets.fonts.get(i)??null}p(yl,"getFont");function Fu(i,t,e={}){let r=De(t),s=new FontFace(i,typeof t=="string"?`url(${r})`:r);return document.fonts.add(s),x.assets.fonts.add(i,s.load().catch(n=>{throw new Error(`Failed to load font from "${r}": ${n}`)}).then(n=>new go(n,e)))}p(Fu,"loadFont");function Eu(i,t,e,r){let s=i.width/t,n={},o=r.split("").entries();for(let[a,l]of o)n[l]=new Vt(a%s*t,Math.floor(a/s)*e,t,e);return{tex:i,map:n,size:e}}p(Eu,"makeFont");function _l(i){return x.assets.bitmapFonts.get(i)??null}p(_l,"getBitmapFont");function Su(i,t,e,r,s={}){let n=De(t);return x.assets.bitmapFonts.add(i,Dn(n).then(o=>Eu(ir.fromImage(x.gfx.ggl,o,s),e,r,s.chars??gu)))}p(Su,"loadBitmapFont");function Du(i,t){return t=De(t),x.assets.sprites.add(i,new Promise(async e=>{let r=typeof t=="string"?await Sn(t):t,s=await Promise.all(r.frames.map(Dn)),n=document.createElement("canvas");n.width=r.width,n.height=r.height*r.frames.length;let o=n.getContext("2d");if(!o)throw new Error("Failed to create canvas context");s.forEach((l,c)=>{o.drawImage(l,0,c*r.height)});let a=await _s(null,n,{sliceY:r.frames.length,anims:r.anims});e(a)}))}p(Du,"loadPedit");var Ps,gp=(Ps=class{constructor(t,e,r,s){S(this,"ctx");S(this,"glProgram");this.ctx=t,t.onDestroy(()=>this.free());let n=t.gl,o=n.createShader(n.VERTEX_SHADER),a=n.createShader(n.FRAGMENT_SHADER);if(!o||!a)throw new Error("Failed to create shader");n.shaderSource(o,e),n.shaderSource(a,r),n.compileShader(o),n.compileShader(a);let l=n.createProgram();if(this.glProgram=l,n.attachShader(l,o),n.attachShader(l,a),s.forEach((c,h)=>n.bindAttribLocation(l,h,c)),n.linkProgram(l),!n.getProgramParameter(l,n.LINK_STATUS)){let c=n.getShaderInfoLog(o);if(c)throw new Error("VERTEX SHADER "+c);let h=n.getShaderInfoLog(a);if(h)throw new Error("FRAGMENT SHADER "+h)}n.deleteShader(o),n.deleteShader(a)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(t){let e=this.ctx.gl;for(let r in t){let s=t[r],n=e.getUniformLocation(this.glProgram,r);if(typeof s=="number")e.uniform1f(n,s);else if(s instanceof Ai)e.uniformMatrix4fv(n,!1,new Float32Array(s.m));else if(s instanceof ut)e.uniform3f(n,s.r,s.g,s.b);else if(s instanceof j)e.uniform2f(n,s.x,s.y);else if(Array.isArray(s))s[0],Id(s)?e.uniform1fv(n,s):qd(s)?e.uniform2fv(n,s.map(o=>[o.x,o.y]).flat()):Vd(s)&&e.uniform3fv(n,s.map(o=>[o.r,o.g,o.b]).flat());else throw new Error("Unsupported uniform data type")}}free(){this.ctx.gl.deleteProgram(this.glProgram)}},p(Ps,"Shader"),Ps);function Ko(i,t=Fa,e=Ea){let r=hp.replace("{{user}}",t??Fa),s=cp.replace("{{user}}",e??Ea);try{return new gp(i,r,s,ml.map(n=>n.name))}catch(n){let o=/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/,a=Ld(n).match(o);if(!(a!=null&&a.groups))throw n;let l=Number(a.groups.line)-14,c=a.groups.msg.trim(),h=a.groups.type.toLowerCase();throw new Error(`${h} shader line ${l}: ${c}`)}}p(Ko,"makeShader");function Pu(i){if(!i)return x.gfx.defShader;if(typeof i=="string"){let t=vl(i);if(t)return t.data??t;if(hr()<1)return null;throw new Error(`Shader not found: ${i}`)}else if(i instanceof He)return i.data?i.data:i;return i}p(Pu,"resolveShader");function vl(i){return x.assets.shaders.get(i)??null}p(vl,"getShader");function Vu(i,t,e){return x.assets.shaders.addLoaded(i,Ko(x.gfx.ggl,t,e))}p(Vu,"loadShader");function qu(i,t,e){t=De(t),e=De(e);let r=p(n=>n?xu(n):Promise.resolve(null),"resolveUrl"),s=Promise.all([r(t),r(e)]).then(([n,o])=>Ko(x.gfx.ggl,n,o));return x.assets.shaders.add(i,s)}p(qu,"loadShaderURL");var Ri,vn=(Ri=class{constructor(t){S(this,"buf");this.buf=t}static fromArrayBuffer(t){return new Promise((e,r)=>x.audio.ctx.decodeAudioData(t,e,r)).then(e=>new Ri(e))}static fromURL(t){return Qc(t)?Ri.fromArrayBuffer(Gc(t)):wu(t).then(e=>Ri.fromArrayBuffer(e))}},p(Ri,"SoundData"),Ri);function Iu(i){if(typeof i=="string"){let t=gl(i);if(t)return t;if(hr()<1)return null;throw new Error(`Sound not found: ${i}`)}else{if(i instanceof vn)return He.loaded(i);if(i instanceof He)return i;throw new Error(`Invalid sound: ${i}`)}}p(Iu,"resolveSound");function gl(i){return x.assets.sounds.get(i)??null}p(gl,"getSound");function ju(i,t){return t=De(t),x.assets.sounds.add(i,typeof t=="string"?vn.fromURL(t):vn.fromArrayBuffer(t))}p(ju,"loadSound");function Lu(i,t){let e=De(t),r=new Audio(e);return r.preload="auto",x.assets.music[i]=e}p(Lu,"loadMusic");function Al(i,t){return i=De(i),Co(typeof t=="string"?new Promise((e,r)=>{Sn(t).then(s=>{Al(i,s).then(e).catch(r)})}):cr.from(i).then(e=>{let r={};for(let s in t){let n=t[s],o=e.frames[0],a=2048*o.w,l=2048*o.h,c=n.frames?n.frames.map(d=>new Vt(o.x+(n.x+d.x)/a*o.w,o.y+(n.y+d.y)/l*o.h,d.w/a*o.w,d.h/l*o.h)):pl(n.sliceX||1,n.sliceY||1,o.x+n.x/a*o.w,o.y+n.y/l*o.h,n.width/a*o.w,n.height/l*o.h),h=new cr(e.tex,c,n.anims);x.assets.sprites.addLoaded(s,h),r[s]=h}return r}))}p(Al,"loadSpriteAtlas");function Hi(i,t,e=!1,r,s,n={}){let o=r??x.gfx.defTex,a=s??x.gfx.defShader,l=Pu(a);if(!l||l instanceof He)return;let c=x.gfx.fixed||e?x.gfx.transform:x.game.cam.transform.mult(x.gfx.transform),h=[];for(let d of i){let m=du(c.multVec2(d.pos));h.push(m.x,m.y,d.uv.x,d.uv.y,d.color.r/255,d.color.g/255,d.color.b/255,d.opacity)}x.gfx.renderer.push(x.gfx.ggl.gl.TRIANGLES,h,t,l,o,n)}p(Hi,"drawRaw");function zi(i){if(!i.pts)throw new Error('drawPolygon() requires property "pts".');let t=i.pts.length;if(!(t<3)){if(ke(),Pt(i.pos),zs(i.scale),zr(i.angle),Pt(i.offset),i.fill!==!1){let e=i.color??ut.WHITE,r=i.pts.map((n,o)=>({pos:new j(n.x,n.y),uv:i.uv?i.uv[o]:new j(0,0),color:i.colors&&i.colors[o]?i.colors[o].mult(e):e,opacity:i.opacity??1})),s;i.triangulate?s=ll(i.pts).map(n=>n.map(o=>i.pts.indexOf(o))).flat():s=[...Array(t-2).keys()].map(n=>[0,n+1,n+2]).flat(),Hi(r,i.indices??s,i.fixed,i.uv?i.tex:x.gfx.defTex,i.shader,i.uniform??void 0)}i.outline&&Yo({pts:[...i.pts,i.pts[0]],radius:i.radius,width:i.outline.width,color:i.outline.color,join:i.outline.join,uniform:i.uniform,fixed:i.fixed,opacity:i.opacity??i.outline.opacity}),fe()}}p(zi,"drawPolygon");function xl(i){if(i.radiusX===void 0||i.radiusY===void 0)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(i.radiusX===0||i.radiusY===0)return;let t=i.start??0,e=i.end??360,r=Ur(i.anchor??"center").scale(new j(-i.radiusX,-i.radiusY)),s=ds(r,i.radiusX,i.radiusY,t,e,i.resolution);s.unshift(r);let n=Object.assign({},i,{pts:s,radius:0,...i.gradient?{colors:[i.gradient[0],...Array(s.length-1).fill(i.gradient[1])]}:{}});if(e-t>=360&&i.outline){i.fill!==!1&&zi(Object.assign({},n,{outline:null})),zi(Object.assign({},n,{pts:s.slice(1),fill:!1}));return}zi(n)}p(xl,"drawEllipse");function Jr(i){if(typeof i.radius!="number")throw new Error('drawCircle() requires property "radius".');i.radius!==0&&xl(Object.assign({},i,{radiusX:i.radius,radiusY:i.radius,angle:0}))}p(Jr,"drawCircle");function ps(i){let{p1:t,p2:e}=i;if(!t||!e)throw new Error('drawLine() requires properties "p1" and "p2".');let r=i.width||1,s=e.sub(t).unit().normal().scale(r*.5),n=[t.sub(s),t.add(s),e.add(s),e.sub(s)].map(o=>({pos:new j(o.x,o.y),uv:new j(0),color:i.color??ut.WHITE,opacity:i.opacity??1}));Hi(n,[0,1,3,1,2,3],i.fixed,x.gfx.defTex,i.shader,i.uniform??void 0)}p(ps,"drawLine");function Tu(i){let t=i.pts,e=[],r=(i.width||1)*.5,s=t[0]===t[t.length-1]||t[0].eq(t[t.length-1]),n=i.pos||P(0,0),o;s?o=t[0].sub(t[t.length-2]):o=t[1].sub(t[0]);let a=o.len(),l=o.normal().scale(-r/a),c,h=t[0];if(!s)switch(i.cap){case"square":{let y=o.scale(-r/a);e.push(h.add(y).add(l)),e.push(h.add(y).sub(l));break}case"round":{let y=Math.max(r,10),v=Math.PI/y,g=l.scale(-1),A=Math.cos(v),B=Math.sin(v);for(let F=0;F<y;F++)e.push(h),e.push(h.sub(g)),g=P(g.x*A-g.y*B,g.x*B+g.y*A)}}for(let y=1;y<t.length;y++){if(h===t[y]||h.eq(t[y]))continue;c=h,h=t[y];let v=h.sub(c),g=v.len(),A=v.normal().scale(-r/g),B=o.cross(v);if(Math.abs(B)/(a*g)<.05){e.push(c.add(l)),e.push(c.sub(l)),o.dot(v)<0&&(e.push(c.sub(l)),e.push(c.add(l))),o=v,a=g,l=A;continue}let F=A.sub(l).cross(v)/B,E=l.add(o.scale(F));B>0?(e.push(c.add(E)),e.push(c.sub(l)),e.push(c.add(E)),e.push(c.sub(A))):(e.push(c.add(l)),e.push(c.sub(E)),e.push(c.add(A)),e.push(c.sub(E))),o=v,a=g,l=A}if(!s)switch(e.push(h.add(l)),e.push(h.sub(l)),i.cap){case"square":{let y=o.scale(r/a);e.push(h.add(y).add(l)),e.push(h.add(y).sub(l));break}case"round":{let y=Math.max(r,10),v=Math.PI/y,g=l.scale(1),A=Math.cos(v),B=Math.sin(v);for(let F=0;F<y;F++)g=P(g.x*A-g.y*B,g.x*B+g.y*A),e.push(h),e.push(h.sub(g))}}if(e.length<4)return;let d=e.map(y=>({pos:n.add(y),uv:P(),color:i.color||ut.WHITE,opacity:i.opacity??1})),m=[],f=0;for(let y=0;y<e.length-2;y+=2)m[f++]=y+1,m[f++]=y,m[f++]=y+2,m[f++]=y+2,m[f++]=y+3,m[f++]=y+1;s&&(m[f++]=e.length-1,m[f++]=e.length-2,m[f++]=0,m[f++]=0,m[f++]=1,m[f++]=e.length-1),Hi(d,m,i.fixed,x.gfx.defTex,i.shader,i.uniform??void 0)}p(Tu,"_drawLinesBevel");function Ru(i){let t=i.pts,e=[],r=(i.width||1)*.5,s=t[0]===t[t.length-1]||t[0].eq(t[t.length-1]),n=i.pos||P(0,0),o;s?o=t[0].sub(t[t.length-2]):o=t[1].sub(t[0]);let a=o.len(),l=o.normal().scale(-r/a),c,h=t[0];if(!s)switch(i.cap){case"square":{let y=o.scale(-r/a);e.push(h.add(y).add(l)),e.push(h.add(y).sub(l));break}case"round":{let y=Math.max(r,10),v=Math.PI/y,g=l.scale(-1),A=Math.cos(v),B=Math.sin(v);for(let F=0;F<y;F++)e.push(h),e.push(h.sub(g)),g=P(g.x*A-g.y*B,g.x*B+g.y*A)}}for(let y=1;y<t.length;y++){if(h===t[y]||h.eq(t[y]))continue;c=h,h=t[y];let v=h.sub(c),g=v.len(),A=v.normal().scale(-r/g),B=o.cross(v);if(Math.abs(B)/(a*g)<.05){e.push(c.add(l)),e.push(c.sub(l)),o.dot(v)<0&&(e.push(c.sub(l)),e.push(c.add(l))),o=v,a=g,l=A;continue}let F=A.sub(l).cross(v)/B,E=l.add(o.scale(F));if(B>0){let k=c.add(E),w=Math.max(r,10),b=Ut(l.angleBetween(A)/w),M=l,V=Math.cos(b),T=Math.sin(b);for(let z=0;z<w;z++)e.push(k),e.push(c.sub(M)),M=P(M.x*V-M.y*T,M.x*T+M.y*V)}else{let k=c.sub(E),w=Math.max(r,10),b=Ut(l.angleBetween(A)/w),M=l,V=Math.cos(b),T=Math.sin(b);for(let z=0;z<w;z++)e.push(c.add(M)),e.push(k),M=P(M.x*V-M.y*T,M.x*T+M.y*V)}o=v,a=g,l=A}if(!s)switch(e.push(h.add(l)),e.push(h.sub(l)),i.cap){case"square":{let y=o.scale(r/a);e.push(h.add(y).add(l)),e.push(h.add(y).sub(l));break}case"round":{let y=Math.max(r,10),v=Math.PI/y,g=l.scale(1),A=Math.cos(v),B=Math.sin(v);for(let F=0;F<y;F++)g=P(g.x*A-g.y*B,g.x*B+g.y*A),e.push(h),e.push(h.sub(g))}}if(e.length<4)return;let d=e.map(y=>({pos:n.add(y),uv:P(),color:i.color||ut.WHITE,opacity:i.opacity??1})),m=[],f=0;for(let y=0;y<e.length-2;y+=2)m[f++]=y+1,m[f++]=y,m[f++]=y+2,m[f++]=y+2,m[f++]=y+3,m[f++]=y+1;s&&(m[f++]=e.length-1,m[f++]=e.length-2,m[f++]=0,m[f++]=0,m[f++]=1,m[f++]=e.length-1),Hi(d,m,i.fixed,x.gfx.defTex,i.shader,i.uniform??void 0)}p(Ru,"_drawLinesRound");function zu(i){let t=i.pts,e=[],r=(i.width||1)*.5,s=t[0]===t[t.length-1]||t[0].eq(t[t.length-1]),n=i.pos||P(0,0),o;s?o=t[0].sub(t[t.length-2]):o=t[1].sub(t[0]);let a=o.len(),l=o.normal().scale(-r/a),c,h=t[0];if(!s)switch(i.cap){case"square":{let y=o.scale(-r/a);e.push(h.add(y).add(l)),e.push(h.add(y).sub(l));break}case"round":{let y=Math.max(r,10),v=Math.PI/y,g=l.scale(-1),A=Math.cos(v),B=Math.sin(v);for(let F=0;F<y;F++)e.push(h),e.push(h.sub(g)),g=P(g.x*A-g.y*B,g.x*B+g.y*A)}}for(let y=1;y<t.length;y++){if(h===t[y]||h.eq(t[y]))continue;c=h,h=t[y];let v=h.sub(c),g=v.len(),A=v.normal().scale(-r/g),B=o.cross(v);if(Math.abs(B)/(a*g)<.05){e.push(c.add(l)),e.push(c.sub(l)),o.dot(v)<0&&(e.push(c.sub(l)),e.push(c.add(l))),o=v,a=g,l=A;continue}let F=A.sub(l).cross(v)/B,E=l.add(o.scale(F));e.push(c.add(E)),e.push(c.sub(E)),o=v,a=g,l=A}if(!s)switch(e.push(h.add(l)),e.push(h.sub(l)),i.cap){case"square":{let y=o.scale(r/a);e.push(h.add(y).add(l)),e.push(h.add(y).sub(l));break}case"round":{let y=Math.max(r,10),v=Math.PI/y,g=l.scale(1),A=Math.cos(v),B=Math.sin(v);for(let F=0;F<y;F++)g=P(g.x*A-g.y*B,g.x*B+g.y*A),e.push(h),e.push(h.sub(g))}}if(e.length<4)return;let d=e.map(y=>({pos:n.add(y),uv:P(),color:i.color||ut.WHITE,opacity:i.opacity??1})),m=[],f=0;for(let y=0;y<e.length-2;y+=2)m[f++]=y+1,m[f++]=y,m[f++]=y+2,m[f++]=y+2,m[f++]=y+3,m[f++]=y+1;s&&(m[f++]=e.length-1,m[f++]=e.length-2,m[f++]=0,m[f++]=0,m[f++]=1,m[f++]=e.length-1),Hi(d,m,i.fixed,x.gfx.defTex,i.shader,i.uniform??void 0)}p(zu,"_drawLinesMiter");function Yo(i){let t=i.pts,e=i.width??1;if(!t)throw new Error('drawLines() requires property "pts".');if(!(t.length<2)){if(t.length>2)switch(i.join){case"bevel":return Tu(i);case"round":return Ru(i);case"miter":return zu(i)}if(i.radius&&t.length>=3){ps(Object.assign({},i,{p1:t[0],p2:t[1]}));for(let r=1;r<t.length-2;r++){let s=t[r],n=t[r+1];ps(Object.assign({},i,{p1:s,p2:n}))}ps(Object.assign({},i,{p1:t[t.length-2],p2:t[t.length-1]}))}else for(let r=0;r<t.length-1;r++)ps(Object.assign({},i,{p1:t[r],p2:t[r+1]})),i.join!=="none"&&Jr(Object.assign({},i,{pos:t[r],radius:e/2}))}}p(Yo,"drawLines");function wl(i,t){let e=t.segments??16,r=[];for(let s=0;s<=e;s++)r.push(i(s/e));Yo({pts:r,width:t.width||1,pos:t.pos,color:t.color,opacity:t.opacity})}p(wl,"drawCurve");function Nu(i){wl(t=>No(i.pt1,i.pt2,i.pt3,i.pt4,t),i)}p(Nu,"drawBezier");var Rr,ir=(Rr=class{constructor(t,e,r,s={}){S(this,"ctx");S(this,"src",null);S(this,"glTex");S(this,"width");S(this,"height");this.ctx=t;let n=t.gl,o=t.gl.createTexture();if(!o)throw new Error("Failed to create texture");this.glTex=o,t.onDestroy(()=>this.free()),this.width=e,this.height=r;let a={linear:n.LINEAR,nearest:n.NEAREST}[s.filter??t.opts.texFilter??"nearest"],l={repeat:n.REPEAT,clampToEdge:n.CLAMP_TO_EDGE}[s.wrap??"clampToEdge"];this.bind(),e&&r&&n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,r,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,a),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,a),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,l),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,l),this.unbind()}static fromImage(t,e,r={}){let s=new Rr(t,e.width,e.height,r);return s.update(e),s.src=e,s}update(t,e=0,r=0){let s=this.ctx.gl;this.bind(),s.texSubImage2D(s.TEXTURE_2D,0,e,r,s.RGBA,s.UNSIGNED_BYTE,t),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},p(Rr,"Texture"),Rr),Vs,ko=(Vs=class{constructor(t,e,r,s={}){S(this,"ctx");S(this,"tex");S(this,"glFramebuffer");S(this,"glRenderbuffer");this.ctx=t;let n=t.gl;t.onDestroy(()=>this.free()),this.tex=new ir(t,e,r,s);let o=n.createFramebuffer(),a=n.createRenderbuffer();if(!o||!a)throw new Error("Failed to create framebuffer");this.glFramebuffer=o,this.glRenderbuffer=a,this.bind(),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,e,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.tex.glTex,0),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let t=this.ctx.gl,e=new Uint8ClampedArray(this.width*this.height*4);this.bind(),t.readPixels(0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,e),this.unbind();let r=this.width*4,s=new Uint8Array(r);for(let n=0;n<(this.height/2|0);n++){let o=n*r,a=(this.height-n-1)*r;s.set(e.subarray(o,o+r)),e.copyWithin(o,a,a+r),e.set(s,a)}return new ImageData(e,this.width,this.height)}toDataURL(){let t=document.createElement("canvas"),e=t.getContext("2d");if(t.width=this.width,t.height=this.height,!e)throw new Error("Failed to get 2d context");return e.putImageData(this.toImageData(),0,0),t.toDataURL()}clear(){let t=this.ctx.gl;t.clear(t.COLOR_BUFFER_BIT)}draw(t){this.bind(),t(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let t=this.ctx.gl;t.deleteFramebuffer(this.glFramebuffer),t.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},p(Vs,"FrameBuffer"),Vs),qs,Ap=(qs=class{constructor(t,e,r,s){S(this,"ctx");S(this,"glVBuf");S(this,"glIBuf");S(this,"vqueue",[]);S(this,"iqueue",[]);S(this,"stride");S(this,"maxVertices");S(this,"maxIndices");S(this,"vertexFormat");S(this,"numDraws",0);S(this,"curPrimitive",null);S(this,"curTex",null);S(this,"curShader",null);S(this,"curUniform",{});let n=t.gl;this.vertexFormat=e,this.ctx=t,this.stride=e.reduce((a,l)=>a+l.size,0),this.maxVertices=r,this.maxIndices=s;let o=n.createBuffer();if(!o)throw new Error("Failed to create vertex buffer");this.glVBuf=o,t.pushArrayBuffer(this.glVBuf),n.bufferData(n.ARRAY_BUFFER,r*4,n.DYNAMIC_DRAW),t.popArrayBuffer(),this.glIBuf=n.createBuffer(),t.pushElementArrayBuffer(this.glIBuf),n.bufferData(n.ELEMENT_ARRAY_BUFFER,s*4,n.DYNAMIC_DRAW),t.popElementArrayBuffer()}push(t,e,r,s,n=null,o={}){(t!==this.curPrimitive||n!==this.curTex||s!==this.curShader||!Uo(this.curUniform,o)||this.vqueue.length+e.length*this.stride>this.maxVertices||this.iqueue.length+r.length>this.maxIndices)&&this.flush();let a=this.vqueue.length/this.stride;for(let l of e)this.vqueue.push(l);for(let l of r)this.iqueue.push(l+a);this.curPrimitive=t,this.curShader=s,this.curTex=n,this.curUniform=o}flush(){var e,r;if(!this.curPrimitive||!this.curShader||this.vqueue.length===0||this.iqueue.length===0)return;let t=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),t.bufferSubData(t.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),(e=this.curTex)==null||e.bind(),t.drawElements(this.curPrimitive,this.iqueue.length,t.UNSIGNED_SHORT,0),(r=this.curTex)==null||r.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let t=this.ctx.gl;t.deleteBuffer(this.glVBuf),t.deleteBuffer(this.glIBuf)}},p(qs,"BatchRenderer"),qs);function tr(i){let t=[],e=p(n=>{t.push(n),i(n)},"push"),r=p(()=>{t.pop(),i(s()??null)},"pop"),s=p(()=>t[t.length-1],"cur");return[e,r,s]}p(tr,"genStack");function Ou(i,t={}){let e=[];function r(k){e.push(k)}p(r,"onDestroy");function s(){e.forEach(w=>w());let k=i.getExtension("WEBGL_lose_context");k&&k.loseContext()}p(s,"destroy");let n=null;function o(k){if(Uo(k,n))return;n=k;let w=k.reduce((b,M)=>b+M.size,0);k.reduce((b,M,V)=>(i.vertexAttribPointer(V,M.size,i.FLOAT,!1,w*4,b),i.enableVertexAttribArray(V),b+M.size*4),0)}p(o,"setVertexFormat");let[a,l]=tr(k=>i.bindTexture(i.TEXTURE_2D,k)),[c,h]=tr(k=>i.bindBuffer(i.ARRAY_BUFFER,k)),[d,m]=tr(k=>i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,k)),[f,y]=tr(k=>i.bindFramebuffer(i.FRAMEBUFFER,k)),[v,g]=tr(k=>i.bindRenderbuffer(i.RENDERBUFFER,k)),[A,B]=tr(k=>{if(!k)return;let{x:w,y:b,w:M,h:V}=k;i.viewport(w,b,M,V)}),[F,E]=tr(k=>i.useProgram(k));return A({x:0,y:0,w:i.drawingBufferWidth,h:i.drawingBufferHeight}),{gl:i,opts:t,onDestroy:r,destroy:s,pushTexture2D:a,popTexture2D:l,pushArrayBuffer:c,popArrayBuffer:h,pushElementArrayBuffer:d,popElementArrayBuffer:m,pushFramebuffer:f,popFramebuffer:y,pushRenderbuffer:v,popRenderbuffer:g,pushViewport:A,popViewport:B,pushProgram:F,popProgram:E,setVertexFormat:o}}p(Ou,"initGfx");var ia={};function Da(i,t){t.pos&&(i.pos=i.pos.add(t.pos)),t.scale&&(i.scale=i.scale.scale(P(t.scale))),t.angle&&(i.angle+=t.angle),t.color&&i.ch.length===1&&(i.color=i.color.mult(t.color)),t.opacity!=null&&(i.opacity*=t.opacity)}p(Da,"applyCharTransform");function Mo(i){let t={},e="",r=[],s=String(i),n=p(o=>{r.length>0&&(t[e.length]=r.slice()),e+=o},"emit");for(;s!=="";){if(s[0]==="\\"){if(s.length===1)throw new Error("Styled text error: \\ at end of string");n(s[1]),s=s.slice(2);continue}if(s[0]==="["){let o=/^\[(\/)?(\w+?)\]/.exec(s);if(!o){n(s[0]),s=s.slice(1);continue}let[a,l,c]=o;if(l!==void 0){let h=r.pop();if(h!==c)throw h!==void 0?new Error(`Styled text error: mismatched tags. Expected [/${h}], got [/${c}]`):new Error(`Styled text error: stray end tag [/${c}]`)}else r.push(c);s=s.slice(a.length);continue}n(s[0]),s=s.slice(1)}if(r.length>0)throw new Error(`Styled text error: unclosed tags ${r}`);return{charStyleMap:t,text:e}}p(Mo,"compileStyledText");function ur(i){var B,F,E;if(i.text===void 0)throw new Error('formatText() requires property "text".');let t=fl(i.font);if(!i.text||i.text===""||t instanceof He||!t)return{width:0,height:0,chars:[],opt:i,renderedText:""};let{charStyleMap:e,text:r}=Mo(i.text+""),s=$c(r);if(t instanceof go||typeof t=="string"){let k=t instanceof go?t.fontface.family:t,w=t instanceof go?{outline:t.outline,filter:t.filter}:{outline:null,filter:Ma},b=ia[k]??{font:{tex:new ir(x.gfx.ggl,2048,2048,{filter:w.filter}),map:{},size:64},cursor:new j(0),outline:w.outline};ia[k]||(ia[k]=b),t=b.font;for(let M of s)if(!b.font.map[M]){let V=x.fontCacheC2d;if(!V)throw new Error("fontCacheC2d is not defined.");if(!x.fontCacheCanvas)throw new Error("fontCacheCanvas is not defined.");V.clearRect(0,0,x.fontCacheCanvas.width,x.fontCacheCanvas.height),V.font=`${t.size}px ${k}`,V.textBaseline="top",V.textAlign="left",V.fillStyle="#ffffff";let T=V.measureText(M),z=Math.ceil(T.width);if(!z)continue;let O=T.fontBoundingBoxAscent+T.fontBoundingBoxDescent;b.outline&&b.outline.width&&b.outline.color&&(V.lineJoin="round",V.lineWidth=b.outline.width*2,V.strokeStyle=b.outline.color.toHex(),V.strokeText(M,b.outline.width,b.outline.width),z+=b.outline.width*2,O+=b.outline.width*3),V.fillText(M,((B=b.outline)==null?void 0:B.width)??0,((F=b.outline)==null?void 0:F.width)??0);let J=V.getImageData(0,0,z,O);if(b.cursor.x+z>2048&&(b.cursor.x=0,b.cursor.y+=O,b.cursor.y>2048))throw new Error("Font atlas exceeds character limit");t.tex.update(J,b.cursor.x,b.cursor.y),t.map[M]=new Vt(b.cursor.x,b.cursor.y,z,O),b.cursor.x+=z}}let n=i.size||t.size,o=P(i.scale??1).scale(n/t.size),a=i.lineSpacing??0,l=i.letterSpacing??0,c=0,h=0,d=0,m=[],f=[],y=0,v=null,g=0;for(;y<s.length;){let k=s[y];if(k===`
`)d+=n+a,m.push({width:c-l,chars:f}),v=null,g=0,c=0,f=[];else{let w=t.map[k];if(w){let b=w.w*o.x;i.width&&c+b>i.width&&(d+=n+a,v!=null&&(y-=f.length-v,k=s[y],w=t.map[k],b=w.w*o.x,f=f.slice(0,v-1),c=g),v=null,g=0,m.push({width:c-l,chars:f}),c=0,f=[]),f.push({tex:t.tex,width:w.w,height:w.h,quad:new Vt(w.x/t.tex.width,w.y/t.tex.height,w.w/t.tex.width,w.h/t.tex.height),ch:k,pos:new j(c,d),opacity:i.opacity??1,color:i.color??ut.WHITE,scale:P(o),angle:0}),k===" "&&(v=f.length,g=c),c+=b,h=Math.max(h,c),c+=l}}y++}m.push({width:c-l,chars:f}),d+=n,i.width&&(h=i.width);let A=[];for(let k=0;k<m.length;k++){let w=(h-m[k].width)*hu(i.align??"left");for(let b of m[k].chars){let M=t.map[b.ch],V=A.length+k;if(b.pos=b.pos.add(w,0).add(M.w*o.x*.5,M.h*o.y*.5),i.transform){let T=typeof i.transform=="function"?i.transform(V,b.ch):i.transform;T&&Da(b,T)}if(e[V]){let T=e[V];for(let z of T){let O=(E=i.styles)==null?void 0:E[z],J=typeof O=="function"?O(V,b.ch):O;J&&Da(b,J)}}A.push(b)}}return{width:h,height:d,chars:A,opt:i,renderedText:r}}p(ur,"formatText");function Ns(i){if(i.width===void 0||i.height===void 0)throw new Error('drawUVQuad() requires property "width" and "height".');if(i.width<=0||i.height<=0)return;let t=i.width,e=i.height,r=Ur(i.anchor||Ho).scale(new j(t,e).scale(-.5)),s=i.quad||new Vt(0,0,1,1),n=i.color||xt(255,255,255),o=i.opacity??1,a=i.tex?.1/i.tex.width:0,l=i.tex?.1/i.tex.height:0,c=s.x+a,h=s.y+l,d=s.w-a*2,m=s.h-l*2;ke(),Pt(i.pos),zr(i.angle),zs(i.scale),Pt(r),Hi([{pos:new j(-t/2,e/2),uv:new j(i.flipX?c+d:c,i.flipY?h:h+m),color:n,opacity:o},{pos:new j(-t/2,-e/2),uv:new j(i.flipX?c+d:c,i.flipY?h+m:h),color:n,opacity:o},{pos:new j(t/2,-e/2),uv:new j(i.flipX?c:c+d,i.flipY?h+m:h),color:n,opacity:o},{pos:new j(t/2,e/2),uv:new j(i.flipX?c:c+d,i.flipY?h:h+m),color:n,opacity:o}],[0,1,3,1,2,3],i.fixed,i.tex,i.shader,i.uniform??void 0),fe()}p(Ns,"drawUVQuad");function mr(i){ke(),Pt(i.opt.pos),zr(i.opt.angle),Pt(Ur(i.opt.anchor??"topleft").add(1,1).scale(i.width,i.height).scale(-.5)),i.chars.forEach(t=>{Ns({tex:t.tex,width:t.width,height:t.height,pos:t.pos,scale:t.scale,angle:t.angle,color:t.color,opacity:t.opacity,quad:t.quad,anchor:"center",uniform:i.opt.uniform,shader:i.opt.shader,fixed:i.opt.fixed})}),fe()}p(mr,"drawFormattedText");function Fe(i){if(i.width===void 0||i.height===void 0)throw new Error('drawRect() requires property "width" and "height".');if(i.width<=0||i.height<=0)return;let t=i.width,e=i.height,r=Ur(i.anchor||Ho).add(1,1).scale(new j(t,e).scale(-.5)),s=[new j(0,0),new j(t,0),new j(t,e),new j(0,e)];if(i.radius){let n=Math.min(t,e)/2,o=Array.isArray(i.radius)?i.radius.map(a=>Math.min(n,a)):new Array(4).fill(Math.min(n,i.radius));s=[new j(o[0],0),...o[1]?ds(new j(t-o[1],o[1]),o[1],o[1],270,360):[P(t,0)],...o[2]?ds(new j(t-o[2],e-o[2]),o[2],o[2],0,90):[P(t,e)],...o[3]?ds(new j(o[3],e-o[3]),o[3],o[3],90,180):[P(0,e)],...o[0]?ds(new j(o[0],o[0]),o[0],o[0],180,270):[]]}zi(Object.assign({},i,{offset:r,pts:s,...i.gradient?{colors:i.horizontal?[i.gradient[0],i.gradient[1],i.gradient[1],i.gradient[0]]:[i.gradient[0],i.gradient[0],i.gradient[1],i.gradient[1]]}:{}}))}p(Fe,"drawRect");function Ti(i){Me();let t=x.gfx.width,e=x.gfx.height;x.gfx.width=x.gfx.viewport.width,x.gfx.height=x.gfx.viewport.height,i(),Me(),x.gfx.width=t,x.gfx.height=e}p(Ti,"drawUnscaled");function Pa(i,t){Ti(()=>{let e=P(8);ke(),Pt(i);let r=ur({text:t,font:Bo,size:16,pos:e,color:xt(255,255,255),fixed:!0}),s=r.width+e.x*2,n=r.height+e.x*2;i.x+s>=te()&&Pt(P(-s,0)),i.y+n>=ie()&&Pt(P(0,-n)),Fe({width:s,height:n,color:xt(0,0,0),radius:4,opacity:.8,fixed:!0}),mr(r),fe()})}p(Pa,"drawInspectText");function bl(i){if(!i.p1||!i.p2||!i.p3)throw new Error('drawTriangle() requires properties "p1", "p2" and "p3".');return zi(Object.assign({},i,{pts:[i.p1,i.p2,i.p3]}))}p(bl,"drawTriangle");function Uu(){if(x.debug.inspect){let i=null;for(let t of x.game.root.get("*",{recursive:!0}))if(t.c("area")&&t.isHovering()){i=t;break}if(x.game.root.drawInspect(),i){let t=[],e=i.inspect();for(let r in e)e[r]?t.push(`${e[r]}`):t.push(`${r}`);Pa(_u(ul()),t.join(`
`))}Pa(P(8),`FPS: ${x.debug.fps()}`)}x.debug.paused&&Ti(()=>{ke(),Pt(te(),0),Pt(-8,8);let i=32;Fe({width:i,height:i,anchor:"topright",color:xt(0,0,0),opacity:.8,radius:4,fixed:!0});for(let t=1;t<=2;t++)Fe({width:4,height:i*.6,anchor:"center",pos:P(-i/3*t,i*.5),color:xt(255,255,255),radius:2,fixed:!0});fe()}),x.debug.timeScale!==1&&Ti(()=>{ke(),Pt(te(),ie()),Pt(-8,-8);let i=8,t=ur({text:x.debug.timeScale.toFixed(1),font:Bo,size:16,color:xt(255,255,255),pos:P(-i),anchor:"botright",fixed:!0});Fe({width:t.width+i*2+i*4,height:t.height+i*2,anchor:"botright",color:xt(0,0,0),opacity:.8,radius:4,fixed:!0});for(let e=0;e<2;e++){let r=x.debug.timeScale<1;bl({p1:P(-t.width-i*(r?2:3.5),-i),p2:P(-t.width-i*(r?2:3.5),-i-t.height),p3:P(-t.width-i*(r?3.5:2),-i-t.height/2),pos:P(-e*i*1+(r?-i*.5:0),0),color:xt(255,255,255),fixed:!0})}mr(t),fe()}),x.debug.curRecording&&Ti(()=>{ke(),Pt(0,ie()),Pt(24,-24),Jr({radius:12,color:xt(255,0,0),opacity:Ya(0,1,x.app.time()*4),fixed:!0}),fe()}),x.debug.showLog&&x.game.logs.length>0&&Ti(()=>{ke(),Pt(0,ie()),Pt(8,-8);let i=8,t=[];for(let r of x.game.logs){let s="",n=r.msg instanceof Error?"error":"info";s+=`[time]${r.time.toFixed(2)}[/time]`,s+=" ",s+=`[${n}]${Fo(r.msg)}[/${n}]`,t.push(s)}x.game.logs=x.game.logs.filter(r=>x.app.time()-r.time<(x.globalOpt.logTime||4));let e=ur({text:t.join(`
`),font:Bo,pos:P(i,-i),anchor:"botleft",size:16,width:te()*.6,lineSpacing:i/2,fixed:!0,styles:{time:{color:xt(127,127,127)},info:{color:xt(255,255,255)},error:{color:xt(255,0,127)}}});Fe({width:e.width+i*2,height:e.height+i*2,anchor:"botleft",color:xt(0,0,0),radius:4,opacity:.8,fixed:!0}),mr(e),fe()})}p(Uu,"drawDebug");function Fo(i,t=!1){var e="",r;return t&&typeof i=="string"&&(i=JSON.stringify(i)),Array.isArray(i)&&(e=["[",i.map(s=>Fo(s,!0)).join(", "),"]"].join(""),i=e),typeof i=="object"&&i.toString===Object.prototype.toString&&(i.constructor!==Object&&(e+=i.constructor.name+" "),e+=["{",(r=Object.getOwnPropertyNames(i).map(s=>`${/^\w+$/.test(s)?s:JSON.stringify(s)}: ${Fo(i[s],!0)}`).join(", "))?` ${r} `:"","}"].join(""),i=e),String(i).replaceAll(new RegExp("(?<!\\\\)\\[","g"),"\\[")}p(Fo,"prettyDebug");function Ju(){let i=x.game.cam,t=j.fromAngle(Gt(0,360)).scale(i.shake);i.shake=_e(i.shake,0,5*Xt()),i.transform=new Ai().translate(_n()).scale(i.scale).rotate(i.angle).translate((i.pos??_n()).scale(-1).add(t)),x.game.root.draw(),Me()}p(Ju,"drawFrame");function Hu(){let i=hr();x.game.events.numListeners("loading")>0?x.game.events.trigger("loading",i):Ti(()=>{let t=te()/2,e=24,r=P(te()/2,ie()/2).sub(P(t/2,e/2));Fe({pos:P(0),width:te(),height:ie(),color:xt(0,0,0)}),Fe({pos:r,width:t,height:e,fill:!1,outline:{width:4}}),Fe({pos:r,width:t*i,height:e})})}p(Hu,"drawLoadScreen");function Bl(i,t,e){let r=x.gfx.ggl.gl;Me(),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST),r.stencilFunc(r.NEVER,1,255),r.stencilOp(r.REPLACE,r.REPLACE,r.REPLACE),t(),Me(),r.stencilFunc(e,1,255),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),i(),Me(),r.disable(r.STENCIL_TEST)}p(Bl,"drawStenciled");function Wu(i,t){let e=x.gfx.ggl.gl;Bl(i,t,e.EQUAL)}p(Wu,"drawMasked");function gn(i){if(!i.tex)throw new Error('drawTexture() requires property "tex".');let t=i.quad??new Vt(0,0,1,1),e=i.tex.width*t.w,r=i.tex.height*t.h,s=new j(1);if(i.tiled){let n=Ur(i.anchor||Ho).add(new j(1,1)).scale(.5).scale(i.width||e,i.height||r),o=(i.width||e)/e,a=(i.height||r)/r,l=Math.floor(o),c=Math.floor(a),h=o-l,d=a-c,m=(l+h?1:0)*(c+d?1:0),f=new Array(m*6),y=new Array(m*4),v=0,g=p((A,B,F,E,k)=>{f[v*6+0]=v*4+0,f[v*6+1]=v*4+1,f[v*6+2]=v*4+3,f[v*6+3]=v*4+1,f[v*6+4]=v*4+2,f[v*6+5]=v*4+3,y[v*4+0]={pos:new j(A-n.x,B-n.y),uv:new j(k.x,k.y),color:i.color||ut.WHITE,opacity:i.opacity||1},y[v*4+1]={pos:new j(A+F-n.x,B-n.y),uv:new j(k.x+k.w,k.y),color:i.color||ut.WHITE,opacity:i.opacity||1},y[v*4+2]={pos:new j(A+F-n.x,B+E-n.y),uv:new j(k.x+k.w,k.y+k.h),color:i.color||ut.WHITE,opacity:i.opacity||1},y[v*4+3]={pos:new j(A-n.x,B+E-n.y),uv:new j(k.x,k.y+k.h),color:i.color||ut.WHITE,opacity:i.opacity||1},v++},"addQuad");for(let A=0;A<c;A++){for(let B=0;B<l;B++)g(B*e,A*r,e,r,t);h&&g(l*e,A*r,e*h,r,new Vt(t.x,t.y,t.w*h,t.h))}if(d){for(let A=0;A<l;A++)g(A*e,c*r,e,r*d,new Vt(t.x,t.y,t.w,t.h*d));h&&g(l*e,c*r,e*h,r*d,new Vt(t.x,t.y,t.w*h,t.h*d))}Hi(y,f,i.fixed,i.tex,i.shader,i.uniform??void 0)}else i.width&&i.height?(s.x=i.width/e,s.y=i.height/r):i.width?(s.x=i.width/e,s.y=s.x):i.height&&(s.y=i.height/r,s.x=s.y),Ns(Object.assign({},i,{scale:s.scale(i.scale||new j(1)),tex:i.tex,quad:t,width:e,height:r}))}p(gn,"drawTexture");function Ku(i){if(!i.sprite)throw new Error('drawSprite() requires property "sprite"');let t=hn(i.sprite);if(!t||!t.data)return;let e=t.data.frames[i.frame??0];if(!e)throw new Error(`Frame not found: ${i.frame??0}`);gn(Object.assign({},i,{tex:t.data.tex,quad:e.scale(i.quad??new Vt(0,0,1,1))}))}p(Ku,"drawSprite");function Yu(i,t){let e=x.gfx.ggl.gl;Bl(i,t,e.NOTEQUAL)}p(Yu,"drawSubtracted");function Va(i){mr(ur(i))}p(Va,"drawText");var xp=p((i,t)=>{let e=Ko(t,Fa,Ea),r=i.pixelDensity??1,s=i.scale??1,{gl:n}=t,o=ir.fromImage(t,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),a=i.width&&i.height?new ko(t,i.width*r*s,i.height*r*s):new ko(t,n.drawingBufferWidth,n.drawingBufferHeight),l=null,c=1;i.background&&(typeof i.background=="string"?l=xt(i.background):(l=xt(...i.background),c=i.background[3]??1),n.clearColor(l.r/255,l.g/255,l.b/255,c??1)),n.enable(n.BLEND),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);let h=new Ap(t,ml,ap,lp),d=ir.fromImage(t,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{lastDrawCalls:0,ggl:t,defShader:e,defTex:o,frameBuffer:a,postShader:null,postShaderUniform:null,renderer:h,transform:new Ai,transformStack:[],bgTex:d,bgColor:l,bgAlpha:c,width:i.width??n.drawingBufferWidth/r/s,height:i.height??n.drawingBufferHeight/r/s,viewport:{x:0,y:0,width:n.drawingBufferWidth,height:n.drawingBufferHeight},fixed:!1}},"initAppGfx");function Cl(){let i=x.pixelDensity,t=x.gfx.ggl.gl.drawingBufferWidth/i,e=x.gfx.ggl.gl.drawingBufferHeight/i;if(x.globalOpt.letterbox){if(!x.globalOpt.width||!x.globalOpt.height)throw new Error("Letterboxing requires width and height defined.");let r=t/e,s=x.globalOpt.width/x.globalOpt.height;if(r>s){let n=e*s,o=(t-n)/2;x.gfx.viewport={x:o,y:0,width:n,height:e}}else{let n=t/s,o=(e-n)/2;x.gfx.viewport={x:0,y:o,width:t,height:n}}return}if(x.globalOpt.stretch&&(!x.globalOpt.width||!x.globalOpt.height))throw new Error("Stretching requires width and height defined.");x.gfx.viewport={x:0,y:0,width:t,height:e}}p(Cl,"updateViewport");function rr(i){return i.fixed?!0:i.parent?rr(i.parent):!1}p(rr,"isFixed");function dr(i){return{color:i.color,opacity:i.opacity,anchor:i.anchor,outline:i.outline,shader:i.shader,uniform:i.uniform}}p(dr,"getRenderProps");function Gu(i,t={}){return{id:"circle",radius:i,draw(){Jr(Object.assign(dr(this),{radius:this.radius,fill:t.fill}))},renderArea(){return new Et(new j(this.anchor?0:-this.radius),this.radius*2,this.radius*2)},inspect(){return`radius: ${Math.ceil(this.radius)}`}}}p(Gu,"circle");function kl(...i){return{id:"color",color:xt(...i),inspect(){return`color: ${this.color.toString()}`}}}p(kl,"color");function Xu(i){return{add(){this.canvas=i}}}p(Xu,"drawon");function Qu(i=1){let t,e=0,r=!1;return{require:["opacity"],add(){t=this.opacity,this.opacity=0},update(){r||(e+=Xt(),this.opacity=ei(e,0,i,0,t),e>=i&&(this.opacity=t,r=!0))}}}p(Qu,"fadeIn");function Zu(i="intersect"){return{id:"mask",mask:i}}p(Zu,"mask");function Ml(i){return{id:"opacity",opacity:i??1,fadeIn(t=1,e=x.k.easings.linear){return x.game.root.tween(0,this.opacity,t,r=>this.opacity=r,e)},fadeOut(t=1,e=x.k.easings.linear){return x.game.root.tween(this.opacity,0,t,r=>this.opacity=r,e)},inspect(){return`opacity: ${xo(this.opacity,1)}`}}}p(Ml,"opacity");function $u(i=1,t=xt(0,0,0),e=1,r="miter",s=10,n="butt"){return{id:"outline",outline:{width:i,color:t,opacity:e,join:r,miterLimit:s,cap:n},inspect(){return`outline: ${this.outline.width}px, ${this.outline.color}`}}}p($u,"outline");var Is,wp=(Is=class{constructor(){S(this,"pos",P(0));S(this,"vel",P(0));S(this,"acc",P(0));S(this,"angle",0);S(this,"angularVelocity",0);S(this,"damping",0);S(this,"t");S(this,"lt",null);S(this,"gc");this.t=0,this.gc=!0}get progress(){return this.lt?this.t/this.lt:this.t}},p(Is,"Particle"),Is);function tm(i,t){let e=t.lifetime,r=[],s=i.colors||[ut.WHITE],n=i.opacities||[1],o=i.quads||[new Vt(0,0,1,1)],a=i.scales||[1],l=i.lifeTime,c=t.direction,h=t.spread,d=i.speed||[0,0],m=i.angle||[0,0],f=i.angularVelocity||[0,0],y=i.acceleration||[P(0),P(0)],v=i.damping||[0,0],g=[],A=new Array(i.max),B=0,F=0;for(let w=0;w<i.max;w++){g[w*6+0]=w*4+0,g[w*6+1]=w*4+1,g[w*6+2]=w*4+3,g[w*6+3]=w*4+1,g[w*6+4]=w*4+2,g[w*6+5]=w*4+3;for(let b=0;b<4;b++)A[w*4+b]={pos:new j(0,0),uv:new j(0,0),color:xt(255,255,255),opacity:1};r[w]=new wp}let E=new Ce;function k(w=0){for(;w<i.max;){if(r[w].gc)return w;w++}return null}return p(k,"nextFree"),{id:"particles",emit(w){let b=0;for(let M=0;M<w;M++){if(b=k(b),b==null)return;let V=Gt(c-h,c+h),T=j.fromAngle(V).scale(Gt(d[0],d[1])),z=Gt(m[0],m[1]),O=Gt(f[0],f[1]),J=P(Gt(y[0].x,y[1].x),Gt(y[0].y,y[1].y)),W=Gt(v[0],v[1]),tt=l?Gt(l[0],l[1]):null,K=t.shape?t.shape.random():P(),Z=r[b];Z.lt=tt,Z.pos=K,Z.vel=T,Z.acc=J,Z.angle=z,Z.angularVelocity=O,Z.damping=W,Z.angularVelocity=O,Z.gc=!1}B+=w},update(){if(e!==void 0&&e<=0)return;let w=Xt();for(let b of r)if(!b.gc){if(b.t+=w,b.lt&&b.t>=b.lt){b.gc=!0,B--;continue}b.vel=b.vel.add(b.acc.scale(w)).scale(1-b.damping*w),b.pos=b.pos.add(b.vel.scale(w)),b.angle+=b.angularVelocity*w}for(e!==void 0&&(e-=w,e<=0&&E.trigger()),F+=w;B<i.max&&t.rate&&F>t.rate;)this.emit(1),B++,F-=t.rate},draw(){if(!(e!==void 0&&e<=0)){for(let w=0;w<r.length;w++){let b=r[w];if(b.gc)continue;let M=b.progress,V=Math.floor(b.progress*s.length),T=V<s.length-1?_e(s[V],s[V+1],ei(M,V/s.length,(V+1)/s.length,0,1)):s[V],z=Math.floor(b.progress*n.length),O=z<n.length-1?_e(n[z],n[z+1],ei(M,z/n.length,(z+1)/n.length,0,1)):n[z],J=Math.floor(b.progress*o.length),W=o[J],tt=Math.floor(b.progress*a.length),K=a[tt],Z=Math.cos(b.angle*Math.PI/180),ot=Math.sin(b.angle*Math.PI/180),Y=(i.texture?i.texture.width:10)*W.w/2,ct=(i.texture?i.texture.height:10)*W.h/2,ft=w*4,X=A[ft];X.pos.x=b.pos.x+-Y*K*Z- -ct*K*ot,X.pos.y=b.pos.y+-Y*K*ot+-ct*K*Z,X.uv.x=W.x,X.uv.y=W.y,X.color.r=T.r,X.color.g=T.g,X.color.b=T.b,X.opacity=O,X=A[ft+1],X.pos.x=b.pos.x+Y*K*Z- -ct*K*ot,X.pos.y=b.pos.y+Y*K*ot+-ct*K*Z,X.uv.x=W.x+W.w,X.uv.y=W.y,X.color.r=T.r,X.color.g=T.g,X.color.b=T.b,X.opacity=O,X=A[ft+2],X.pos.x=b.pos.x+Y*K*Z-ct*K*ot,X.pos.y=b.pos.y+Y*K*ot+ct*K*Z,X.uv.x=W.x+W.w,X.uv.y=W.y+W.h,X.color.r=T.r,X.color.g=T.g,X.color.b=T.b,X.opacity=O,X=A[ft+3],X.pos.x=b.pos.x+-Y*K*Z-ct*K*ot,X.pos.y=b.pos.y+-Y*K*ot+ct*K*Z,X.uv.x=W.x,X.uv.y=W.y+W.h,X.color.r=T.r,X.color.g=T.g,X.color.b=T.b,X.opacity=O}Hi(A,g,this.fixed,i.texture,this.shader,this.uniform)}},onEnd(w){return E.add(w)},inspect(){return`count: ${B}/${i.max}`}}}p(tm,"particles");function em(i,t={}){if(i.length<3)throw new Error(`Polygon's need more than two points, ${i.length} points provided`);return{id:"polygon",pts:i,colors:t.colors,uv:t.uv,tex:t.tex,radius:t.radius,draw(){zi(Object.assign(dr(this),{pts:this.pts,colors:this.colors,uv:this.uv,tex:this.tex,radius:this.radius,fill:t.fill,triangulate:t.triangulate}))},renderArea(){return new ve(this.pts)},inspect(){return`polygon: ${this.pts.map(e=>`[${e.x},${e.y}]`).join(",")}`}}}p(em,"polygon");function Fl(i,t,e){let r;return x.game.root.get("area").forEach(s=>{if(e&&e.some(o=>s.is(o)))return;let n=s.worldArea().raycast(i,t);n&&(r?n.fraction<r.fraction&&(r=n,r.object=s):(r=n,r.object=s))}),r}p(Fl,"raycast");function El(i,t,e={}){return{id:"rect",width:i,height:t,radius:e.radius||0,draw(){Fe(Object.assign(dr(this),{width:this.width,height:this.height,radius:this.radius,fill:e.fill}))},renderArea(){return new Et(P(0),this.width,this.height)},inspect(){return`rect: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)}h)`}}}p(El,"rect");function im(i,t){return{id:"shader",shader:i,...typeof t=="function"?{uniform:t(),update(){this.uniform=t()}}:{uniform:t},inspect(){return`shader: ${i}`}}}p(im,"shader");function rm(...i){return i.length>0&&(x.game.cam.pos=P(...i)),x.game.cam.pos?x.game.cam.pos.clone():_n()}p(rm,"camPos");function sm(...i){return i.length>0&&(x.game.cam.scale=P(...i)),x.game.cam.scale.clone()}p(sm,"camScale");function nm(i){return i!==void 0&&(x.game.cam.angle=i),x.game.cam.angle}p(nm,"camRot");function om(i=xt(255,255,255),t=1){let e=x.game.root.add([El(te(),ie()),kl(i),Ml(1),Tl()]),r=e.fadeOut(t);return r.onEnd(()=>Vl(e)),r}p(om,"camFlash");function am(){return x.game.cam.transform.clone()}p(am,"camTransform");function lm(i=12){x.game.cam.shake+=i}p(lm,"shake");function Eo(i){return x.game.cam.transform.multVec2(i)}p(Eo,"toScreen");function Sl(i){return x.game.cam.transform.invert().multVec2(i)}p(Sl,"toWorld");function hm(i,t){if(!t.tileWidth||!t.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let e=x.game.root.add([An(t.pos??P(0))]),r=i.length,s=0,n=null,o=null,a=null,l=null,c=p(w=>w.x+w.y*s,"tile2Hash"),h=p(w=>P(Math.floor(w%s),Math.floor(w/s)),"hash2Tile"),d=p(()=>{n=[];for(let w of e.children)m(w)},"createSpatialMap"),m=p(w=>{let b=c(w.tilePos);n[b]?n[b].push(w):n[b]=[w]},"insertIntoSpatialMap"),f=p(w=>{let b=c(w.tilePos);if(n[b]){let M=n[b].indexOf(w);M>=0&&n[b].splice(M,1)}},"removeFromSpatialMap"),y=p(()=>{let w=!1;for(let b of e.children){let M=e.pos2Tile(b.pos);(b.tilePos.x!=M.x||b.tilePos.y!=M.y)&&(w=!0,f(b),b.tilePos.x=M.x,b.tilePos.y=M.y,m(b))}w&&e.trigger("spatialMapChanged")},"updateSpatialMap"),v=p(()=>{let w=e.getSpatialMap(),b=e.numRows()*e.numColumns();o?o.length=b:o=new Array(b),o.fill(1,0,b);for(let M=0;M<w.length;M++){let V=w[M];if(V){let T=0;for(let z of V)if(z.isObstacle){T=1/0;break}else T+=z.cost;o[M]=T||1}}},"createCostMap"),g=p(()=>{let w=e.getSpatialMap(),b=e.numRows()*e.numColumns();a?a.length=b:a=new Array(b),a.fill(15,0,b);for(let M=0;M<w.length;M++){let V=w[M];if(V){let T=V.length,z=15;for(let O=0;O<T;O++)z|=V[O].edgeMask;a[M]=z}}},"createEdgeMap"),A=p(()=>{let w=e.numRows()*e.numColumns(),b=p((V,T)=>{let z=[];for(z.push(V);z.length>0;){let O=z.pop();E(O).forEach(J=>{l[J]<0&&(l[J]=T,z.push(J))})}},"traverse");l?l.length=w:l=new Array(w),l.fill(-1,0,w);let M=0;for(let V=0;V<o.length;V++){if(l[V]>=0){M++;continue}b(V,M),M++}},"createConnectivityMap"),B=p((w,b)=>o[b],"getCost"),F=p((w,b)=>{let M=h(w),V=h(b);return M.dist(V)},"getHeuristic"),E=p((w,b)=>{let M=[],V=Math.floor(w%s),T=V>0&&a[w]&1&&o[w-1]!==1/0,z=w>=s&&a[w]&2&&o[w-s]!==1/0,O=V<s-1&&a[w]&4&&o[w+1]!==1/0,J=w<s*r-s-1&&a[w]&8&&o[w+s]!==1/0;return b?(T&&(z&&M.push(w-s-1),M.push(w-1),J&&M.push(w+s-1)),z&&M.push(w-s),O&&(z&&M.push(w-s+1),M.push(w+1),J&&M.push(w+s+1)),J&&M.push(w+s)):(T&&M.push(w-1),z&&M.push(w-s),O&&M.push(w+1),J&&M.push(w+s)),M},"getNeighbours"),k={id:"level",tileWidth(){return t.tileWidth},tileHeight(){return t.tileHeight},spawn(w,...b){let M=P(...b),V=(()=>{if(typeof w=="string"){if(t.tiles[w]){if(typeof t.tiles[w]!="function")throw new Error("Level symbol def must be a function returning a component list");return t.tiles[w](M)}else if(t.wildcardTile)return t.wildcardTile(w,M)}else{if(Array.isArray(w))return w;throw new Error("Expected a symbol or a component list")}})();if(!V)return null;let T=!1,z=!1;for(let J of V)J.id==="tile"&&(z=!0),J.id==="pos"&&(T=!0);T||V.push(An(this.tile2Pos(M))),z||V.push(ql());let O=e.add(V);return T&&(O.tilePosOffset=O.pos.clone()),O.tilePos=M,O.transform=ys(O),n&&(m(O),this.trigger("spatialMapChanged"),this.trigger("navigationMapInvalid")),O},numColumns(){return s},numRows(){return r},levelWidth(){return s*this.tileWidth()},levelHeight(){return r*this.tileHeight()},tile2Pos(...w){return P(...w).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...w){let b=P(...w);return P(Math.floor(b.x/this.tileWidth()),Math.floor(b.y/this.tileHeight()))},getSpatialMap(){return n||d(),n},onSpatialMapChanged(w){return this.on("spatialMapChanged",w)},onNavigationMapInvalid(w){return this.on("navigationMapInvalid",w)},getAt(w){n||d();let b=c(w);return n[b]||[]},raycast(w,b){let M=this.toWorld(w),V=this.toWorld(w.add(b)).sub(M),T=1/this.tileWidth(),z=w.scale(T),O=bc(z,b,J=>{let W=this.getAt(J);if(W.some(K=>K.isObstacle))return!0;let tt=null;for(let K of W)if(K.is("area")){let Z=K.worldArea().raycast(M,V);Z&&(tt?Z.fraction<tt.fraction&&(tt=Z,tt.object=K):(tt=Z,tt.object=K))}return tt&&(tt.point=this.fromWorld(tt.point).scale(T)),tt||!1},64);return O&&(O.point=O.point.scale(this.tileWidth())),O},update(){n&&y()},invalidateNavigationMap(){o=null,a=null,l=null},onNavigationMapChanged(w){return this.on("navigationMapChanged",w)},getTilePath(w,b,M={}){var Z;if(o||v(),a||g(),l||A(),w.x<0||w.x>=s||w.y<0||w.y>=r||b.x<0||b.x>=s||b.y<0||b.y>=r)return null;let V=c(w),T=c(b);if(o[T]===1/0)return null;if(V===T)return[];if(l[V]!=-1&&l[V]!==l[T])return null;let z=new Kc((ot,Y)=>ot.cost<Y.cost);z.insert({cost:0,node:V});let O=new Map;O.set(V,V);let J=new Map;for(J.set(V,0);z.length!==0;){let ot=(Z=z.remove())==null?void 0:Z.node;if(ot===T)break;let Y=E(ot,M.allowDiagonals);for(let ct of Y){let ft=(J.get(ot)||0)+B(ot,ct)+F(ct,T);(!J.has(ct)||ft<J.get(ct))&&(J.set(ct,ft),z.insert({cost:ft,node:ct}),O.set(ct,ot))}}let W=[],tt=T,K=h(tt);for(W.push(K);tt!==V;){let ot=O.get(tt);if(ot===void 0)throw new Error("Bug in pathfinding algorithm");tt=ot;let Y=h(tt);W.push(Y)}return W.reverse()},getPath(w,b,M={}){let V=this.tileWidth(),T=this.tileHeight(),z=this.getTilePath(this.pos2Tile(w),this.pos2Tile(b),M);return z?[w,...z.slice(1,-1).map(O=>O.scale(V,T).add(V/2,T/2)),b]:null}};return e.use(k),e.onNavigationMapInvalid(()=>{e.invalidateNavigationMap(),e.trigger("navigationMapChanged")}),i.forEach((w,b)=>{let M=w.split("");s=Math.max(M.length,s),M.forEach((V,T)=>{e.spawn(V,P(T,b))})}),e}p(hm,"addLevel");function wi(i,t,e){return x.game.objEvents.registers[i]||(x.game.objEvents.registers[i]=new Zc),x.game.objEvents.on(i,(r,...s)=>{r.is(t)&&e(r,...s)})}p(wi,"on");var bp=Ot(i=>{let t=x.game.root.add([{fixedUpdate:i}]);return{get paused(){return t.paused},set paused(e){t.paused=e},cancel:p(()=>t.destroy(),"cancel")}},(i,t)=>wi("fixedUpdate",i,t)),Bp=Ot(i=>{let t=x.game.root.add([{update:i}]);return{get paused(){return t.paused},set paused(e){t.paused=e},cancel:p(()=>t.destroy(),"cancel")}},(i,t)=>wi("update",i,t)),Cp=Ot(i=>{let t=x.game.root.add([{draw:i}]);return{get paused(){return t.hidden},set paused(e){t.hidden=e},cancel:p(()=>t.destroy(),"cancel")}},(i,t)=>wi("draw",i,t)),cm=Ot(i=>x.game.events.on("add",i),(i,t)=>wi("add",i,t)),kp=Ot(i=>x.game.events.on("destroy",i),(i,t)=>wi("destroy",i,t));function um(i,t,e){return wi("collide",i,(r,s,n)=>s.is(t)&&e(r,s,n))}p(um,"onCollide");function mm(i,t,e){return wi("collideUpdate",i,(r,s,n)=>s.is(t)&&e(r,s,n))}p(mm,"onCollideUpdate");function dm(i,t,e){return wi("collideEnd",i,(r,s,n)=>s.is(t)&&e(r,s,n))}p(dm,"onCollideEnd");function Pn(i,t){x.game.root.get(i,{recursive:!0}).forEach(t),cm(i,t)}p(Pn,"forAllCurrentAndFuture");var Mp=Ot(i=>x.app.onMousePress(i),(i,t)=>{let e=[];return Pn(i,r=>{if(!r.area)throw new Error("onClick() requires the object to have area() component");e.push(r.onClick(()=>t(r)))}),Or.join(e)});function pm(i,t){let e=[];return Pn(i,r=>{if(!r.area)throw new Error("onHover() requires the object to have area() component");e.push(r.onHover(()=>t(r)))}),Or.join(e)}p(pm,"onHover");function fm(i,t){let e=[];return Pn(i,r=>{if(!r.area)throw new Error("onHoverUpdate() requires the object to have area() component");e.push(r.onHoverUpdate(()=>t(r)))}),Or.join(e)}p(fm,"onHoverUpdate");function ym(i,t){let e=[];return Pn(i,r=>{if(!r.area)throw new Error("onHoverEnd() requires the object to have area() component");e.push(r.onHoverEnd(()=>t(r)))}),Or.join(e)}p(ym,"onHoverEnd");function _m(i){x.game.events.on("loading",i)}p(_m,"onLoading");function vm(i){x.app.onResize(i)}p(vm,"onResize");function gm(i){x.game.events.on("error",i)}p(gm,"onError");function Go(i){x.assets.loaded?i():x.game.events.on("load",i)}p(Go,"onLoad");function Xo(i=[]){let t=new Map,e=[],r={},s=new fn,n=[],o=null,a=!1,l={id:Rd(),hidden:!1,transform:new Ai,children:[],parent:null,set paused(h){if(h!==a){a=h;for(let d of n)d.paused=h}},get paused(){return a},get tags(){let h=[];for(let[d,m]of t.entries())Object.keys(m).length==1&&h.push(d);return h},add(h){let d=Array.isArray(h)?Xo(h):h;if(d.parent)throw new Error("Cannot add a game obj that already has a parent.");return d.parent=this,d.transform=ys(d),this.children.push(d),d.trigger("add",d),x.game.events.trigger("add",d),d},readd(h){let d=this.children.indexOf(h);return d!==-1&&(this.children.splice(d,1),this.children.push(h)),h},remove(h){let d=this.children.indexOf(h);if(d!==-1){h.parent=null,this.children.splice(d,1);let m=p(f=>{f.trigger("destroy"),x.game.events.trigger("destroy",f),f.children.forEach(y=>m(y))},"trigger");m(h)}},removeAll(h){if(h)this.get(h).forEach(d=>this.remove(d));else for(let d of[...this.children])this.remove(d)},fixedUpdate(){this.paused||(this.children.forEach(h=>h.fixedUpdate()),this.trigger("fixedUpdate"))},update(){this.paused||(this.children.forEach(h=>h.update()),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&(Me(),this.canvas.bind());let h=x.gfx.fixed;this.fixed&&(x.gfx.fixed=!0),ke(),Pt(this.pos),zs(this.scale),zr(this.angle);let d=this.children.sort((m,f)=>{let y=m.layerIndex??x.game.defaultLayerIndex,v=f.layerIndex??x.game.defaultLayerIndex;return y-v||(m.z??0)-(f.z??0)});if(this.mask){let m={intersect:x.k.drawMasked,subtract:x.k.drawSubtracted}[this.mask];if(!m)throw new Error(`Invalid mask func: "${this.mask}"`);m(()=>{d.forEach(f=>f.draw())},()=>{this.trigger("draw")})}else this.trigger("draw"),d.forEach(m=>m.draw());fe(),x.gfx.fixed=h,this.canvas&&(Me(),this.canvas.unbind())},drawInspect(){this.hidden||(ke(),Pt(this.pos),zs(this.scale),zr(this.angle),this.children.forEach(h=>h.drawInspect()),this.trigger("drawInspect"),fe())},use(h){if(!h)return;if(typeof h=="string")return this.use({id:h});let d=[];h.id?(this.unuse(h.id),r[h.id]=[],d=r[h.id],t.set(h.id,h)):e.push(h);for(let f in h){if(up.has(f))continue;let y=Object.getOwnPropertyDescriptor(h,f);if(y)if(typeof y.value=="function"&&(h[f]=h[f].bind(this)),y.set&&Object.defineProperty(h,f,{set:y.set.bind(this)}),y.get&&Object.defineProperty(h,f,{get:y.get.bind(this)}),mp.has(f)){let v=f==="add"?()=>{var g;o=p(A=>d.push(A),"onCurCompCleanup"),(g=h[f])==null||g.call(h),o=null}:h[f];d.push(this.on(f,v).cancel)}else if(this[f]===void 0)Object.defineProperty(this,f,{get:p(()=>h[f],"get"),set:p(v=>h[f]=v,"set"),configurable:!0,enumerable:!0}),d.push(()=>delete this[f]);else throw new Error(`Duplicate component property: "${f}"`)}let m=p(()=>{if(h.require){for(let f of h.require)if(!this.c(f))throw new Error(`Component "${h.id}" requires component "${f}"`)}},"checkDeps");h.destroy&&d.push(h.destroy.bind(this)),this.exists()?(m(),h.add&&(o=p(f=>d.push(f),"onCurCompCleanup"),h.add.call(this),o=null)):h.require&&d.push(this.on("add",m).cancel)},unuse(h){if(t.has(h)){for(let d of t.values())if(d.require&&d.require.includes(h))throw new Error(`Can't unuse. Component "${d.id}" requires component "${h}"`);t.delete(h)}r[h]&&(r[h].forEach(d=>d()),delete r[h])},c(h){return t.get(h)??null},get(h,d={}){let m=d.recursive?this.children.flatMap(p(function f(y){return[y,...y.children.flatMap(f)]},"recurse")):this.children;if(m=m.filter(f=>h?f.is(h):!0),d.liveUpdate){let f=p(v=>d.recursive?this.isAncestorOf(v):v.parent===this,"isChild"),y=[];y.push(x.k.onAdd(v=>{f(v)&&v.is(h)&&m.push(v)})),y.push(x.k.onDestroy(v=>{if(f(v)&&v.is(h)){let g=m.findIndex(A=>A.id===v.id);g!==-1&&m.splice(g,1)}})),this.onDestroy(()=>{for(let v of y)v.cancel()})}return m},query(h){let d=h.hierarchy||"children",m=h.include,f=h.exclude,y=[];switch(d){case"children":y=this.children;break;case"siblings":y=this.parent?this.parent.children.filter(g=>g!==this):[];break;case"ancestors":let v=this.parent;for(;v;)y.push(v),v=v.parent;break;case"descendants":y=this.children.flatMap(p(function g(A){return[A,...A.children.flatMap(g)]},"recurse"));break}if(m&&((h.includeOp||"and")==="and"||!Array.isArray(h.include)?y=y.filter(v=>v.is(m)):y=y.filter(v=>h.include.some(g=>v.is(g)))),f&&((h.includeOp||"and")==="and"||!Array.isArray(h.include)?y=y.filter(v=>!v.is(f)):y=y.filter(v=>!h.exclude.some(g=>v.is(g)))),h.visible===!0&&(y=y.filter(v=>v.visible)),h.distance){if(!this.pos)throw Error("Can't do a distance query from an object without pos");let v=h.distanceOp||"near",g=h.distance*h.distance;v==="near"?y=y.filter(A=>A.pos&&this.pos.sdist(A.pos)<=g):y=y.filter(A=>A.pos&&this.pos.sdist(A.pos)>g)}return h.name&&(y=y.filter(v=>v.name===h.name)),y},isAncestorOf(h){return h.parent?h.parent===this||this.isAncestorOf(h.parent):!1},exists(){return x.game.root.isAncestorOf(this)},is(h){if(h==="*")return!0;if(Array.isArray(h)){for(let d of h)if(!this.c(d))return!1;return!0}else return this.c(h)!=null},on(h,d){let m=s.on(h,d.bind(this));return o&&o(()=>m.cancel()),m},trigger(h,...d){s.trigger(h,...d),x.game.objEvents.trigger(h,this,...d)},destroy(){this.parent&&this.parent.remove(this)},inspect(){var d;let h={};for(let[m,f]of t)h[m]=((d=f.inspect)==null?void 0:d.call(f))??null;for(let[m,f]of e.entries()){if(f.inspect){h[m]=f.inspect();continue}for(let[y,v]of Object.entries(f))typeof v!="function"&&(h[y]=`${y}: ${v}`)}return h},onAdd(h){return this.on("add",h)},onFixedUpdate(h){return this.on("fixedUpdate",h)},onUpdate(h){return this.on("update",h)},onDraw(h){return this.on("draw",h)},onDestroy(h){return this.on("destroy",h)},clearEvents(){s.clear()}},c=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick","onButtonPress","onButtonDown","onButtonRelease"];for(let h of c)l[h]=(...d)=>{var f,y;let m=(y=(f=x.app)[h])==null?void 0:y.call(f,...d);return n.push(m),l.onDestroy(()=>m.cancel()),l.on("sceneEnter",()=>{var g,A;n.splice(n.indexOf(m),1);let v=(A=(g=x.app)[h])==null?void 0:A.call(g,...d);Or.replace(m,v),n.push(m)}),m};for(let h of i)l.use(h);return l}p(Xo,"make");var Fp=p(()=>({events:new fn,objEvents:new fn,root:Xo([]),gravity:null,scenes:{},currentScene:null,layers:null,defaultLayerIndex:0,logs:[],cam:{pos:null,scale:new j(1),angle:0,shake:0,transform:new Ai}}),"initGame");function Am(i){x.game.gravity=i?(x.game.gravity||P(0,1)).unit().scale(i):null}p(Am,"setGravity");function xm(){return x.game.gravity?x.game.gravity.len():0}p(xm,"getGravity");function wm(i){x.game.gravity=i.unit().scale(x.game.gravity?x.game.gravity.len():1)}p(wm,"setGravityDirection");function cn(){return x.game.gravity?x.game.gravity.unit():P(0,1)}p(cn,"getGravityDirection");var Ep=Fd("//uUBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAATAAAeAAANDQ0NDRoaGhoaKCgoKCg1NTU1NTVDQ0NDQ1BQUFBQXl5eXl5ra2tra2t5eXl5eYaGhoaGlJSUlJShoaGhoaGvr6+vr7y8vLy8ysrKysrX19fX19fl5eXl5fLy8vLy//////8AAAA5TEFNRTMuMTAwAaoAAAAAAAAAABSAJAOPhgAAgAAAHgBaqIlmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uUBAAP8h1kPIABR4BEDGeQAEbkSb2RAACBFMEyMiAAASJw4xjgwAGyRvfIoZT2QKGV5YNw/tKID9+X93qXtBQUFBQ/e+EFKTQUT/dy3f5dK/3d04rkXHpufCClDAaH7jDMgFAQEGfPt+jI352U9vU4GLRpzkUDeeeTQggQe2ggF3d7/3j697DnhCH5iGf38//iNj9oy2Jk71oj+CBAABGNB4RJNMwgCABCB//8//l////1z6XEGd73az07sOkwZD9VYgjzjmQ6j4EMfZM86OJ7GUWwvFw3ZPcdVEtczf9RNf6xMyxLjZZgjMQ7KDkLSU8g2E12UDUWrf//////9LdtFdeeqKwSitW9SJL59VM5pyUGiBNiK0jIGO0j7p3pUpWpaeqi1nTvqP3b43mGmM6HeXFjIlRwiFiIDQRRAGgkDQhxMMv//+f1//6XM/PfMvysJa3993MjDjhaRkrV3cRPXjGptDDGTHtFKUeMHU0K5STvVfMtVX/UXHctt1Z1//uUBB0AgnZkQAAgRTBMzIgAACiqCdB9E1QRgAFuIuGmhjABPZRJRCHi4etY2gcEYRwFw5KFBMMRV/////z6kX2ppnJszEzKbkZKEumm+pBRUDBg9IsgXGXrazn1QhmGjBrLVjT5Xvir0HT7d//HSZh18IZdji2N5JZgbA3DwQAahogSDqUhQuNtpJmBTwAGMY2QP3c/dy4EKsAABoXEJEFmlf/c4TgYtwcAbwfD4gOOoS1QIH7jDnNzYVe1x4mNFyD2jMVaaykjV29ePMARwXcUOgAFr+UjhVz4jhwMDFxPKgYs3cDFpohVgAAYAIO7u8eAAjRNA7hBFAwN3ACDvu7nETkLMrnyIj8v/9fNwhF9vKRfm82P5zPPmLV/WKs9G3d16n/v3rubEN0zgs7RdWrHne9brdv5bI4EwEAM6lj7aVdTKtXQHgLdzCKQ2kcihe4FyMcD1r3nR4TWxuax5EOZJEs3DEQnjyqyB8cSfrI6GEcoJxiHBDEfrTOFYrO1//uUBCgAA406ym5hgAB1R1ktzDwACxDBZzj0gAFhGrA3HoACypAXH9HY4umZan4ZlZKldajczMzMzOTnzMvnb77f/1IuSzHIbnJLJdapWmwUAQBXqWPtqV1OyqVqXhB9abR90OyKEsM51pIJK/nXplbDPtKz2dH+oVWeZSm8z7nvAZ19bneqhk3qeBhrhZiLbCc8sRnXb520RnPFd61/AgSR4f8CVlfWpD/////+N6/jv8v4f/6Ln///06c8YYcQIaGmAJ9VhMHEZYc9Kn0TOOYKv2cibDoZieAaGy4Cd6AfGkxQQr+agomAw+dC7AkjOxklIZEpUgmHxXP7/znl/4qT9Z/8+T2a0WF9/lvpv39if/KZnV6Gp1vQRmN1rYDAADfLGQxVR2d49LQLXdImm5n40smwjQ4aIYKMeKCOEw0OBV5cHA8cFV8mB5LyIIeksHspy79/iTv9SH+v66f2Wn/i+Lt//x9y//5MohgAAXiTCVBil4RUZ7XUvPRCD9Uc//uUBAoAAro3Wzc9AABXRutm56AACrUhc6eYT0FWpC508wnoO35hs9j6x7PQOB0PF0JWIkYwigNPoXUBA0cKA6JwDB7lRKDm/93r/mb6iEqL5lv3Vq//6YgYd1AgECi4xACCYbHyukYAAF4kwlQYpeEVGe11Lz0Qg/VHDt+YbPY+sez0DgdDxdCViJGMIoDT6F1AQNHCgOicAwe5USg5v/d6/5m+ohKi+Zb91av/+mIGHdQIBAouMQAgmGx8rptmoLKSACTuBBUPFsH6RlCz+UhoKeVfJy/eqOspBG4PScFOnOxYJJcf/nVzmyfR42Zwxy//hfSUrPq1SzFnO7q/SzNUzst+GQpnZ/kLwzVZ9xJ2lVa02zUFlJABJ3AgqHi2D9IyhZ/KQ0FPKvk5fvVHWUgjcHpOCnTnYsEkuP/zq5zZPo8bM4Y5f/wvpKVn1apZiznd1fpZmqZ2W/DIUzs/yF4Zqs+4k7SqtaYkWgEGMgppYQlMVdKcos2bWFZbFIJp//uUBAsAAr0wWe1hAABXpgs9rCAACwS5azj0gAFgly1nHpAAVgWmZa3LaUWCcGh5HgOEYkViyQUjrX+G5FUr5Dla1ZhtXDf7ckpazXwzeusqq+zXwUePSw8NYzlZKWfbyzod4dCRItAIMZBTSwhKYq6U5RZs2sKy2KQTSrAtMy1uW0osE4NDyPAcIxIrFkgpHWv8NyKpXyHK1qzDauG/25JS1mvhm9dZVV9mvgo8elh4axnKyUs+3lnQ7w6EkIEIIZFKlBSAGwRMrEIEuM658s5gvyVtFDrQtgTY2YSPlAJcgwlXLmokM8sUQJYJOm3eaW04jWVsoghX+ZBt3SHFZOypVez//VONpL+du6U+4WLXBC79cuhAhBDIpUoKQA2CJlYhAlxnXPlnMF+StoodaFsCbGzCR8oBLkGEq5c1EhnliiBLBJ027zS2nEaytlEEK/zINu6Q4rJ2VKr2f/6pxtJfzt3Sn3Cxa4IXfrl6IGEh4icUSUDRZk/k88VFEmCy//uUBAkAAociWgZh4ABQ5EtAzDwAC6zBXBmXgAF1mCuDMvAART7WmhWQ9QwYJexoKJ+z1bcQqfEFmtDtXH8lUg2omFi2b/4+UhW/j+bHgwAM8SqMAQFxYj9wqAwhlftf//sSQMJDxE4okoGizJ/J54qKJMFkin2tNCsh6hgwS9jQUT9nq24hU+ILNaHauP5KpBtRMLFs3/x8pCt/H82PBgAZ4lUYAgLixH7hUBhDK/a///YmHznKbibgJd0lEi0TfuHXCfhZ0faHA6GL3GuUpLTgTwnd/upcFAbo+BGMfzKxWE9PNg+sbrEwwRLn6uFElWTc/zN8Yvf5V3xV29///8OO/f7j3cT0mgMTPP9uPEwIQ+c5TcTcBLukokWib9w64T8LOj7Q4HQxe41ylJacCeE7v91LgoDdHwIxj+ZWKwnp5sH1jdYmGCJc/Vwokqybn+ZvjF7/Ku+Ku3v///hx37/ce7iek0BiZ5/tx4mBCmI5QXQAgigG+j0P8fdg2Xjs//uUBAiAAqwlWwY94ABVhKtgx7wACoilZ7z0AAFUlOz3noAAii2PkO1AMBYBIssJqQ5PtEdSQ2WE3xIF22b19axY89F5QQmWCwxJrf51h5mt74jRvBahCxQkS0MgJxY15ITjX3sb+vlGI5QXQAgigG+j0P8fdg2Xjsii2PkO1AMBYBIssJqQ5PtEdSQ2WE3xIF22b19axY89F5QQmWCwxJrf51h5mt74jRvBahCxQkS0MgJxY15ITjX3sb+vlEBsAgCSkHfwmFY/MMKQyg4tjhHeuR2mpSZWstSwEQAw00wZaogwgZL3PPVWw9vuB51zUXf3Df/ytV917DjxQEGA+0mbu4YYg4TnkRcMGQsxH/Ioc1AbAIAkpB38JhWPzDCkMoOLY4R3rkdpqUmVrLUsBEAMNNMGWqIMIGS9zz1VsPb7gedc1F39w3/8rVfdew48UQIFwus29HKDIAW8tcsSGAOKXK/jHmF1AkIAAC8ZUaEFwTHUylbannoarv7HwxH8//uUBAwEAtAx18sMQuBVJisaYSJeCmhnX6eZLQFZJy208wmidE7zXIRk0ZLYCqc1eg1sKc3HZuweFNeSCHHGg+JyhTcd8RE3/+rJXIdH6UpI2qUdVtHGRCOewEOXGUfKG2/v+RIoA0MAAAByh2gABL0EpLTwNTz0qzjM2ER8SF2lsSRLESGiqG5JXMCauo+aTB1GQKTyJd6SDnG6Iv8rkaoYeRihQbVGzJSSQ4sOghQh7vhkf+T0agMeCYAcAABBO40gsg/gOpfIiHoQgldEIGLVK9EaTFmFH9jkkvLA41VT/4q0XDJLUopJkJmWHAqZyRAPJOvBUS+NYSLC4FFjoJkUfGP/La3XNJCMJPep5CkIaRQCSTuM4ikUepPHAnZLEErtHuqs1EWDizBAvsdVeWBxqqn9aiS9FK24Z0KUhvVkY7ZbylKV/SrKiK0yrKqFkPe3/sZ//8xt6t2dajIDpFMRf6tSU9FIlJJKChTJIgq2hhZlrTlNcpaB/Xv5rDOU//uUBA2AAoQl1lVgwARQxLrKrBgAjCyVTrmngAGFkqnXNPAAg4ANdH9PKxIijn/xmvyjW2ZISnLe5yUtyv2ufSTfVJUGyoFiU6s6Crgyd2PEyn5Ul/85kUElPRSJSSSgoUySIKtoYWZa05TXKWgf17+awzlIOADXR/TxLEiKOf/GZ/KNbZkhKct7nJS3K/a59JN9UlQbKgWJTqzoKuDJ3Y8TKflSX/zmRQSCs10kCQCFAcBJCZCbl2c0bF5RBELfoQBmp3G2m3m3lgZoN0/BmhutukeGPbe/GtGj9jtiXNZdfDjIwYiYvnePS27ebO75y/Edksl4SONB/PlBrg6dNh8h+pW2//lktFhYcFZrpIEgEKA4CSEyE3Ls5o2LyiCIW/QgDNTuNtNvNvLAzQbp+DNDdbdI8Me29+NaNH7HbEuay6+HGRgxExfO8elt282d3zl+I7JZLwkcaD+fKDXB06bD5D9Stt//LJaLCw4AhAEAACKEywIJz0PRwTBn6tS2//uUBAmAAmUjVNdhAABMpGqa7CAACWiNUay8pYEtEao1l5SwsvqET9LUv/TIpAROYdsSHIoHxzccjRUPRZmVQnHLH7FYdB9rF8Q11yOCAKeHZHyIhMO///lWz0JPcAQgCAABFCZYEE56Ho4Jgz9WpbWX1CJ+lqX/pkUgInMO2JDkUD45uORoqHoszKoTjlj9isOg+1i+Ia65HBAFPDsj5EQmHf//yrZ6EnuACgcjEAKT2Dfl0wUuCCDwOHgDLjMYs6OLViO840e/fHfBZmadNu+NYYNVT84fPkYRCJ/K5V3vsq0Gh0H0YgBP+moubbodw+IHr/kgAoHIxACk9g35dMFLggg8Dh4Ay4zGLOji1YjvONHv3x3wWZmnTbvjWGDVU/OHz5GEQifyuVd77KtBodB9GIAT/pqLm26HcPiB6/5KAE6OeESRRgDMViF4jCI2bT5fbThs6iKGQfPTVaYtXdjMROEbiIqKlZk1KJAzpcWEnNs6FapfKXq1jerLEhaS//uUBB+BAmUqVWsMKrhMpUqtYYVXCTSlTzWSgAE0lKp2sFAAqcgRPyRHxKsBPAQVtIgCdHPCJIowBmKxC8RhEbNp8vtpw2dRFDIPnpqtMWruxmInCNxEVFSsyalEgZ0uLCTm2dCtUvlL1axvVliQtJVOQIn5Ij4lWAngIK2kQCHQhVnhkMD1BlLGveBt13z8bjbsI+MtfqdjdaAQiJFeBGV0AQFB2Qr8QDBc8iiATM25R8+fqp/Izn9CHGC7CEg5BTqd6jM4IBoADCiIYSTWAeAwKIoGBRr+EfZ3bjcbhhdDLX6nY3WgEIiRXgRloICoOyFfiA4+RRAJmbco+fP1U/kZz+hDjBdhCQcgp1O9QZnAQAbiCQAm485bonLdZ5NLqAAAEaPfiGAJsDpfUrAhC8wIZFkkEsiX6UBGvscp3FQfN5VNjWCnQ6AGqvk/UqZBbG3rpCt0gR7qtiNBxOfSeTupa6fMjXaMuYTclIn9ZIVayP2pYMiVUajtVYufukCu//uUBDWABAw9Uu5p4AKDx9qdzLwAiiyjShmngAFFlGlDNPAAm9bW7Vct6q61jNa/e6f/0cL33T31CoACacjUkabckdbjkoAAQ2Pe5fJoCshU+EXmCMRGkCbpN6UCNfKFHfcVB8kSOgSgDsuTAAtXyfqVMgtjb10hW6QI91XCQyZP85jl1K90+ZGuz5Ewl0gGT+skKsGAr0weA/JVRqO1Vi5+6QK6b1tbtFct6q61jNa+26fG/RwvfdPeIpm6BswQctcoCeIAYEYf1mWXRGbxQSwlUiCoY91ytUSo4mqDAgHrhQ3Y/4l2ptfeDG/xHfQXlda18S59aW+rZz8/Gtf7vXU0aFeJUKxkREA+tA5tnJGCDlrlATxADAjD+syy6IzeKCWEqkQVDHuuVqiVHE1QYEA9cKG7H/Eu1Nr7wY3+I76C8rrWviXPrS31bOfn41r/d66mjQrxKhWMiIgH1oHNs5Iw4nNwugqcGVUIoOnFryq5YBVMFyLPEAM4rxNXgSVW//uUBA+AAtkszwZtgABapZngzbAACxyZTzmkgAljkynnNJABzA8PYTFvx2VIR78NqPytscLolrRXGbLUv3rfHNp37BGU77n4xv9NNmu7larWfrk294JgJMNJQ9k6Z//3mHE5uF0FTgyqhFB04teVXLAKpguRZ4gBnFeJq8CSq2YHh7CYt+OypCPfhtR+VtjhdEtaK4zZal+9b45tO/YIynfc/GN/pps13crVaz9cm3vBMBJhpKLJ0z//vAA/m9Y8//8wALImAAl3wUQQSnfKuPXkDS5Ql5I8JfOufQG0twDlAxToCFKYarEoVqWFNJ6nNVd9fnX5/O72D/GEfeJf1TBIwjlyh7XHDg+dW/e///9oGG0YAH83rHn//mABZEwAEu+CiCCU75Vx68gaXKEvJHhL51z6A2luAcoGKdAQpTDVYlCtSwppPU5qrvr86/P53ewf4wj7xL+qYJGEcuUPa44cHzq373///tAw2joy5iMKijE5A82dFg4+liKoGBQF//uUBAmAAqobToZt4ABVI2nQzbwAClBrX7j0gBFKDWv3HpACuAcKpXhYKYZtV8OtethxIYxrF3onBiRVg0Z5VNJHjodV8sWdI031RiPzue4vQ9IA5zgUawg6s0J1ixM4H0rkVfR6DLmIwqKMTkDzZ0WDj6WIqgYFAW4BwqleFgphm1Xw6162HEhjGsXeicGJFWDRnlU2I8dDqvlizpGm+qMR+dz3F6HpAHOcCjWEHVmhOsWJnA+lcir6PQCI3I43G43HIxGIwIABFJObxBmwXEYYlhzHKcYl4ccyEKlyI6ONNnSpVx1pORjqKXEvGgpRqN/VI1tIQnEAogesbyZtJhhEj7rQutav+WB4ClRCCI3I43G43HIxGIwIABFJObxBmwXEYYlhzHKcYl4ccyEKlyI6ONNnSpVx1pORjqKXEvGgpRqN/VI1tIQnEAogesbyZtJhhEj7rQutav+WB4ClRDWAElxIBP/fgA5BRsQaBJEcORBgUrqXzDOmyQ7B8Js0//uUBA+AAnIbz+9swABNA3nq7ZgACYxbKSxpgQEzi6UljTAh0ph0igLRRPKosl/+21oMFkUfTMlPbu5vLWMhsIpBoJlEBWacSYwqxs0adkSycpqwAugFfb4AMMU0BUCAJUc6VBAkwaXzDlPhDsnkNmmlMVAKAOiieBJHkv/22tBkzUfXZJ+37zy1jILgmkGjpRAVmnCVjCrGzRozkSydWoAAhAKsACEHAmDZAyOJvjXlQsCbLAhfALBGnDuUyMsKxSWoyN41Ma1yzl81ldaycS4FmOc/HeG0F0EouNMvOJY8wRknQ2MHFgo50O9wABCAVYAEIOBMGyBkcTfGvKhYE2WBC+AWCNOHcpkZYViktRkbxqY1rlnL5rK61k4lwLMc5+Od4vceyz2aZfD2t6Yf1T8VpbBUmvyf/6WSCIaFJmBQHBBPnChjBCJpALOEZzWEOoXAjEVcJwU6QNMnCQemw5lYr1wP4Yrd7Kh813KsJITdZtDZdO/Nb/EeIEOq6mn9//uUBCMMglwayou4eTBKg1lRdw8mCRxbKCzswxEuGGWdow2oj0ziXaKZIIhoUmYFAcEE+cKGMEImkAs4RnNYQ6hcCMRVwnBTpA0ycJB6bDmVivXA/hit3sqHzXcqwkhN1m0Nl0781v8R4gQ3qup/2PTcl2geDKLS0Dlz62OeezARhAXGxQHQWEYYrFAT3TZw4FCwS4JDTF8AkaliQVaJoBk2ZlkiTQ2GgZmiQ1TzBSo+AA7JnYoKkVD1ZLuX4AtuEAwAFeAsHNMiPlXBIxSunQZU2GQTJoCe6bOHAoWCXBIaYvkUWljkvhpGS5mWFUrqaky+ZUivDyLT+PkTH9Nf5Jc8MPCT5LS5agFKBGvwAEGuOYUBgViPhKwULrvceUN2EYE5cfjEPVa76oYHc8iajBh079LyeBx+8xsatjP5+f/v9moz085O0y92c1/TLeIQBc5iarAMAtQBhIDsHMLAswKiDlZBMLgFd7jyhuwXBjO4/GIeq131ERQsohipJqEF//uUBDuAAl4rSc1swABNpWkWriAAT6S1N7msABH4Fqa3NYACK3Y2lxKnyqWlj4I9evjntWStpWltoH3a1c9wPfBQe51tv4QIRW5JWpHY2wmAQCAA3Ez8JQ0wQP/M2RNaIDhCYutAAONBBkAlvb4j4+qi40CU4Bh3bhxXygTVd/7vSq0iY6iSWWXrsXQ29eVJCqUsoXWy7X/vdWvP1JZg/tBEovFId////7rne699onXkM9DUl/+GAZBQDf8JEQCKo//+ogQCRyuRRuRthMAgEABkJp6CMpiBP+aMybcYnwznWkEqoAuaC5GfvF8HZFWg/FXSa8blglIwmKgd/7XpVaYZFGTZZe5DuQPushJSpXIpuwbX/vdWvL6kswcmPQFF4Ef3////LXO917pQHTyGedqP//DAMgoD3/CREAiqP/2eqv////////3dk90KlpVV3eUWVjHLZSMUp5hxnpOcO1WpXVXu4ijKYTSd3IJ7Kzt6Wp7FWiGQUEGFRgdCgpRM//uUBB8P8lRjwIcAoABJLFgQ4BQASJmNAgAFHEkIsiAAAaegRMowxhYVZBMOCoAh7/////////79CTkvIITTqZkZjVGEMPHvEBE7IZXMpGVFYqsKyOYw5jjmOZkFDdkZLkW+9NjEIZxbiYixXO5QkcoRVQoYBgYPlK+XmRGbwXaEFZGvWIpZLWEizxltQ9uELQV7E73d3HESrONG7w3dTdpF6Skf/zNT3I6rIKxJy1oKCtGGjj5FDxcKB+HpYd/3//i3rZFOT0N05+QpgWZYZ3pi5biJNCj4fRQQwYK8p48BQUTWPDTbNjkPn8+1VXKvJ7dJ5Gb2mESWLjnHOYNH07r6//////////icK81KXqTXuvQEteLGdY0DKwrjQVTIMKbgE0b41Egi1KxtuNwUpf9X+bNqTUlXbDClWgIlS4wMVc1F0QZc3/N/yto/7eUShjGUstRgIUZXKUrFYwU5SgKOxgYE+krfVkf6St/VpnMaYwpwoCjoZwoCZwqFC4LH//uUBD+P4jNjPwAjN8I7THfwAEnqR8mAugCAcQkHsheEERr40LUwj//hIzL//9k/9rJZ9lks+yyVDL/////81YHZUMj//yZZLHIy7/5qwMHHIyZZL/sslQyNWt/I1DBQYRxPYaxS/////5kn///6on0VEVP/6on/7OVFVO5QwUGEOzyhgaoqKhQwMGCUjt////8qaLdr/qTiyzLxaJxpRTt6RBhIhDZMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq"),Sp=p(()=>(()=>{let i=new(window.AudioContext||window.webkitAudioContext),t=i.createGain();t.connect(i.destination);let e=new vn(cu(i));return i.decodeAudioData(Ep.buffer.slice(0)).then(r=>{e.buf=r}).catch(r=>{console.error("Failed to load burp: ",r)}),{ctx:i,masterNode:t,burpSnd:e}})(),"initAudio");function bm(i,t={}){let e=new Ce,r=new Audio(i);r.crossOrigin="anonymous",x.audio.ctx.createMediaElementSource(r).connect(x.audio.masterNode);function s(){x.debug.paused||x.app.isHidden()&&!x.globalOpt.backgroundAudio||x.audio.ctx.resume()}p(s,"resumeAudioCtx");function n(){s(),r.play()}return p(n,"play"),t.paused||n(),r.onended=()=>e.trigger(),{play(){n()},seek(o){r.currentTime=o},stop(){r.pause(),this.seek(0)},set loop(o){r.loop=o},get loop(){return r.loop},set paused(o){o?r.pause():n()},get paused(){return r.paused},time(){return r.currentTime},duration(){return r.duration},set volume(o){r.volume=gi(o,0,1)},get volume(){return r.volume},set speed(o){r.playbackRate=Math.max(o,0)},get speed(){return r.playbackRate},set detune(o){},get detune(){return 0},onEnd(o){return e.add(o)},then(o){return this.onEnd(o)}}}p(bm,"playMusic");function Bm(i,t={}){if(typeof i=="string"&&x.assets.music[i])return bm(x.assets.music[i],t);let e=x.audio.ctx,r=t.paused??!1,s=e.createBufferSource(),n=new Ce,o=e.createGain(),a=e.createStereoPanner(),l=t.seek??0,c=0,h=0,d=!1;s.loop=!!t.loop,s.detune.value=t.detune??0,s.playbackRate.value=t.speed??1,s.connect(a),s.onended=()=>{var g;y()>=(((g=s.buffer)==null?void 0:g.duration)??Number.POSITIVE_INFINITY)&&n.trigger()},a.pan.value=t.pan??0,a.connect(o),o.connect(x.audio.masterNode),o.gain.value=t.volume??1;let m=p(g=>{s.buffer=g.buf,r||(c=e.currentTime,s.start(0,l),d=!0)},"start"),f=Iu(i);f instanceof He&&f.onLoad(m);let y=p(()=>{if(!s.buffer)return 0;let g=r?h-c:e.currentTime-c,A=s.buffer.duration;return s.loop?g%A:Math.min(g,A)},"getTime"),v=p(g=>{let A=e.createBufferSource();return A.buffer=g.buffer,A.loop=g.loop,A.playbackRate.value=g.playbackRate.value,A.detune.value=g.detune.value,A.onended=g.onended,A.connect(a),A},"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(g){if(r!==g)if(r=g,g)d&&(s.stop(),d=!1),h=e.currentTime;else{s=v(s);let A=h-c;s.start(0,A),d=!0,c=e.currentTime-A,h=0}},get paused(){return r},play(g=0){this.seek(g),this.paused=!1},seek(g){var A;(A=s.buffer)!=null&&A.duration&&(g>s.buffer.duration||(r?(s=v(s),c=h-g):(s.stop(),s=v(s),c=e.currentTime-g,s.start(0,g),d=!0,h=0)))},set speed(g){s.playbackRate.value=g},get speed(){return s.playbackRate.value},set detune(g){s.detune.value=g},get detune(){return s.detune.value},set volume(g){o.gain.value=Math.max(g,0)},get volume(){return o.gain.value},set pan(g){a.pan.value=g},get pan(){return a.pan.value},set loop(g){s.loop=g},get loop(){return s.loop},duration(){var g;return((g=s.buffer)==null?void 0:g.duration)??0},time(){return y()%this.duration()},onEnd(g){return n.add(g)},then(g){return this.onEnd(g)}}}p(Bm,"play");function Dl(i){return x.k.play(x.audio.burpSnd,i)}p(Dl,"burp");function Cm(i){return i!==void 0&&(x.audio.masterNode.gain.value=i),x.audio.masterNode.gain.value}p(Cm,"volume");function Pl(){x.app.onHide(()=>{x.globalOpt.backgroundAudio||x.audio.ctx.suspend()}),x.app.onShow(()=>{!x.globalOpt.backgroundAudio&&!x.debug.paused&&x.audio.ctx.resume()}),x.app.onResize(()=>{if(x.app.isFullscreen())return;let i=x.globalOpt.width&&x.globalOpt.height;i&&!x.globalOpt.stretch&&!x.globalOpt.letterbox||(x.canvas.width=x.canvas.offsetWidth*x.pixelDensity,x.canvas.height=x.canvas.offsetHeight*x.pixelDensity,Cl(),i||(x.gfx.frameBuffer.free(),x.gfx.frameBuffer=new ko(x.gfx.ggl,x.gfx.ggl.gl.drawingBufferWidth,x.gfx.ggl.gl.drawingBufferHeight),x.gfx.width=x.gfx.ggl.gl.drawingBufferWidth/x.pixelDensity/x.gscale,x.gfx.height=x.gfx.ggl.gl.drawingBufferHeight/x.pixelDensity/x.gscale))}),x.globalOpt.debug!==!1&&(x.app.onKeyPress(x.globalOpt.debugKey??"f1",()=>x.debug.inspect=!x.debug.inspect),x.app.onKeyPress("f2",()=>x.debug.clearLog()),x.app.onKeyPress("f8",()=>x.debug.paused=!x.debug.paused),x.app.onKeyPress("f7",()=>{x.debug.timeScale=xo(gi(x.debug.timeScale-.2,0,2),1)}),x.app.onKeyPress("f9",()=>{x.debug.timeScale=xo(gi(x.debug.timeScale+.2,0,2),1)}),x.app.onKeyPress("f10",()=>x.debug.stepFrame())),x.globalOpt.burp&&x.app.onKeyPress("b",()=>Dl())}p(Pl,"initEvents");function km(i,t={}){let e=x.game.root.add([An(i),Ll()]),r=(t.speed||1)*5,s=t.scale||1;e.add([So(x.boomSprite),xn(0),Po("center"),Ia(r,s),...t.comps??[]]);let n=e.add([So(x.kaSprite),xn(0),Po("center"),Do(),...t.comps??[]]);return n.wait(.4/r,()=>n.use(Ia(r,s))),n.onDestroy(()=>e.destroy()),e}p(km,"addKaboom");var Dp=p(function(i,t){if(x.game.layers)throw Error("Layers can only be assigned once.");let e=i.indexOf(t);if(e==-1)throw Error("The default layer name should be present in the layers list.");x.game.layers=i,x.game.defaultLayerIndex=e},"layers");function Vl(i){i.destroy()}p(Vl,"destroy");function Mm(){return x.game.root}p(Mm,"getTreeRoot");function Fm(i,t){x.game.scenes[i]=t}p(Fm,"scene");function Em(i,...t){if(!x.game.scenes[i])throw new Error(`Scene not found: ${i}`);x.game.events.onOnce("frameEnd",()=>{x.game.events.trigger("sceneLeave",i),x.app.events.clear(),x.game.events.clear(),x.game.objEvents.clear(),[...x.game.root.children].forEach(e=>{!e.stay||e.scenesToStay&&!e.scenesToStay.includes(i)?x.game.root.remove(e):e.trigger("sceneEnter",i)}),x.game.root.clearEvents(),Pl(),x.game.cam={pos:null,scale:P(1),angle:0,shake:0,transform:new Ai},x.game.scenes[i](...t)}),x.game.currentScene=i}p(Em,"go");function Sm(i){return x.game.events.on("sceneLeave",i)}p(Sm,"onSceneLeave");function Dm(){return x.game.currentScene}p(Dm,"getSceneName");function So(i,t={}){let e=null,r=null,s=null,n=new Ce;if(!i)throw new Error("Please pass the resource name or data to sprite()");let o=p((l,c,h,d)=>{let m=P(1,1);return h&&d?(m.x=h/(l.width*c.w),m.y=d/(l.height*c.h)):h?(m.x=h/(l.width*c.w),m.y=m.x):d&&(m.y=d/(l.height*c.h),m.x=m.y),m},"calcTexScale"),a=p((l,c)=>{if(!c)return;let h=c.frames[0].clone();t.quad&&(h=h.scale(t.quad));let d=o(c.tex,h,t.width,t.height);l.width=c.tex.width*h.w*d.x,l.height=c.tex.height*h.h*d.y,t.anim&&l.play(t.anim),e=c,n.trigger(e)},"setSpriteData");return{id:"sprite",width:0,height:0,frame:t.frame||0,quad:t.quad||new Vt(0,0,1,1),animSpeed:t.animSpeed??1,flipX:t.flipX??!1,flipY:t.flipY??!1,get sprite(){return i.toString()},set sprite(l){let c=hn(l);c&&c.onLoad(h=>a(this,h))},get animFrame(){if(!e||!r||s===null)return this.frame;let l=e.anims[r.name];return typeof l=="number"?l:this.frame-Math.min(l.from,l.to)},draw(){if(!e)return;let l=e.frames[this.frame??0];if(!l)throw new Error(`Frame not found: ${this.frame??0}`);if(e.slice9){let{left:c,right:h,top:d,bottom:m}=e.slice9,f=e.tex.width*l.w,y=e.tex.height*l.h,v=this.width-c-h,g=this.height-d-m,A=c/f,B=h/f,F=1-A-B,E=d/y,k=m/y,w=1-E-k,b=[Nt(0,0,A,E),Nt(A,0,F,E),Nt(A+F,0,B,E),Nt(0,E,A,w),Nt(A,E,F,w),Nt(A+F,E,B,w),Nt(0,E+w,A,k),Nt(A,E+w,F,k),Nt(A+F,E+w,B,k),Nt(0,0,c,d),Nt(c,0,v,d),Nt(c+v,0,h,d),Nt(0,d,c,g),Nt(c,d,v,g),Nt(c+v,d,h,g),Nt(0,d+g,c,m),Nt(c,d+g,v,m),Nt(c+v,d+g,h,m)];for(let M=0;M<9;M++){let V=b[M],T=b[M+9];gn(Object.assign(dr(this),{pos:T.pos(),tex:e.tex,quad:l.scale(V),flipX:this.flipX,flipY:this.flipY,tiled:t.tiled,width:T.w,height:T.h}))}}else gn(Object.assign(dr(this),{tex:e.tex,quad:l.scale(this.quad??new Vt(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:t.tiled,width:this.width,height:this.height}))},add(){let l=hn(i);l?l.onLoad(c=>a(this,c)):Go(()=>a(this,hn(i).data))},update(){if(!e||!r||s===null)return;let l=e.anims[r.name];if(typeof l=="number"){this.frame=l;return}if(l.speed===0)throw new Error("Sprite anim speed cannot be 0");r.timer+=Xt()*this.animSpeed,r.timer>=1/r.speed&&(r.timer=0,this.frame+=s,(this.frame<Math.min(l.from,l.to)||this.frame>Math.max(l.from,l.to))&&(r.loop?r.pingpong?(this.frame-=s,s*=-1,this.frame+=s):this.frame=l.from:r.pingpong?s===Math.sign(l.to-l.from)?(this.frame=l.to,s*=-1,this.frame+=s):(this.frame=l.from,r.onEnd(),this.stop()):(this.frame=l.to,r.onEnd(),this.stop())))},play(l,c={}){if(!e){n.add(()=>this.play(l,c));return}let h=e.anims[l];if(h===void 0)throw new Error(`Anim not found: ${l}`);r&&this.stop(),r=typeof h=="number"?{name:l,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:p(()=>{},"onEnd")}:{name:l,timer:0,loop:c.loop??h.loop??!1,pingpong:c.pingpong??h.pingpong??!1,speed:c.speed??h.speed??10,onEnd:c.onEnd??(()=>{})},s=typeof h=="number"?null:h.from<h.to?1:-1,this.frame=typeof h=="number"?h:h.from,this.trigger("animStart",l)},stop(){if(!r)return;let l=r.name;r=null,this.trigger("animEnd",l)},numFrames(){return(e==null?void 0:e.frames.length)??0},getCurAnim(){return r},curAnim(){return r==null?void 0:r.name},getAnim(l){return(e==null?void 0:e.anims[l])??null},hasAnim(l){return!!this.getAnim(l)},onAnimEnd(l){return this.on("animEnd",l)},onAnimStart(l){return this.on("animStart",l)},renderArea(){return new Et(P(0),this.width,this.height)},inspect(){return typeof i=="string"?`sprite: "${i}"`:null}}}p(So,"sprite");function Pm(i,t={}){function e(s){var o,a;let n=ur(Object.assign(dr(s),{text:s.text+"",size:s.textSize,font:s.font,width:t.width&&s.width,align:s.align,letterSpacing:s.letterSpacing,lineSpacing:s.lineSpacing,transform:s.textTransform,styles:s.textStyles}));return t.width||(s.width=n.width/(((o=s.scale)==null?void 0:o.x)||1)),s.height=n.height/(((a=s.scale)==null?void 0:a.y)||1),n}p(e,"update");let r={id:"text",set text(s){i=s,e(this),this.renderedText=Mo(i).text},get text(){return i},textSize:t.size??36,font:t.font,width:t.width??0,height:0,align:t.align,lineSpacing:t.lineSpacing,letterSpacing:t.letterSpacing,textTransform:t.transform,textStyles:t.styles,renderedText:i?Mo(i).text:"",add(){Go(()=>e(this))},draw(){mr(e(this))},renderArea(){return new Et(P(0),this.width,this.height)}};return e(r),r}p(Pm,"text");function Vm(i,t){return{id:"rect",width:i,height:t,draw(){Ns(Object.assign(dr(this),{width:this.width,height:this.height}))},renderArea(){return new Et(P(0),this.width,this.height)},inspect(){return`uvquad: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)})h`}}}p(Vm,"uvquad");function qm(i={}){let t=null,e=null,r=null,s=null;return{id:"agent",require:["pos","tile"],agentSpeed:i.speed??100,allowDiagonals:i.allowDiagonals??!0,getDistanceToTarget(){return t?this.pos.dist(t):0},getNextLocation(){return e&&r?e[r]:null},getPath(){return e?e.slice():null},getTarget(){return t},isNavigationFinished(){return e?r===null:!0},isTargetReachable(){return e!==null},isTargetReached(){return t?this.pos.eq(t):!0},setTarget(n){t=n,e=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),r=e?0:null,e&&r!==null?(s||(s=this.getLevel().onNavigationMapChanged(()=>{t&&e&&r!==null&&(e=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),e?(r=0,this.trigger("navigationNext",this,e[r])):(r=null,this.trigger("navigationEnded",this)))}),this.onDestroy(()=>s==null?void 0:s.cancel())),this.trigger("navigationStarted",this),this.trigger("navigationNext",this,e[r])):this.trigger("navigationEnded",this)},update(){if(t&&e&&r!==null){if(this.pos.sdist(e[r])<2)if(r===e.length-1){this.pos=t.clone(),r=null,this.trigger("navigationEnded",this),this.trigger("targetReached",this);return}else r++,this.trigger("navigationNext",this,e[r]);this.moveTo(e[r],this.agentSpeed)}},onNavigationStarted(n){return this.on("navigationStarted",n)},onNavigationNext(n){return this.on("navigationNext",n)},onNavigationEnded(n){return this.on("navigationEnded",n)},onTargetReached(n){return this.on("targetReached",n)},inspect(){return"agent: "+JSON.stringify({target:JSON.stringify(t),path:JSON.stringify(e)})}}}p(qm,"agent");function Im(i){let t=i.graph;return{id:"pathfinder",require:["pos"],navigateTo(e){var r;return(r=this.graph)==null?void 0:r.getWaypointPath(this.pos,e,i.navigationOpt)},get graph(){if(t)return t;let e=this.parent;for(;e;){if(e.is("pathfinderMap"))return e.graph;e=e.parent}},set graph(e){t=e}}}p(Im,"pathfinder");function jm(i={}){let t=i.waypoints,e=i.speed||100,r=i.endBehavior||"stop",s=0,n=t!=null;return{id:"patrol",require:["pos"],get patrolSpeed(){return e},set patrolSpeed(o){e=o},get waypoints(){return t},set waypoints(o){t=o,s=0,n=!1},get nextLocation(){return t?t[s]:void 0},update(){let o=this.nextLocation;if(!(!t||!o||n)&&(this.moveTo(o,e),this.pos.sdist(o)<9))switch(r){case"loop":s=(s+1)%t.length;break;case"ping-pong":s=s+1,s==t.length&&(t.reverse(),s=0);break;case"stop":s=Math.min(s+1,t.length-1),s==t.length-1&&(n=!0,this.trigger("patrolFinished"));break}},onPatrolFinished(o){return this.on("patrolFinished",o)}}}p(jm,"patrol");function Lm(i,t={}){let e=typeof i=="function"?i:()=>x.game.root.query(i),r=t.checkFrequency||1,s=typeof t.direction=="number"?j.fromAngle(t.direction):t.direction,n=0;return{id:"sentry",require:["pos"],direction:typeof t.direction=="number"?j.fromAngle(t.direction):t.direction,spotted:[],set directionAngle(o){this.direction=o!==void 0?j.fromAngle(o):void 0},get directionAngle(){return this.direction?this.direction.angle():void 0},fieldOfView:t.fieldOfView||200,isWithinFieldOfView(o,a,l){let c=(typeof a=="number"?j.fromAngle(a):a)||s,h=l||t.fieldOfView;if(!c||!h||h>=360)return!0;let d=h/2;return o.pos&&c.angleBetween(o.pos.sub(this.pos))<=d},hasLineOfSight(o){let a=Fl(this.pos,o.pos.sub(this.pos),t.raycastExclude);return a!=null&&a.object===o},update(){if(n+=Xt(),n>r){n-=r;let o=e();if(o.length&&s&&this.fieldOfView&&this.fieldOfView<360){let a=this.fieldOfView/2;o=o.filter(l=>l.pos&&s.angleBetween(l.pos.sub(this.pos))<=a)}o.length&&t.lineOfSight&&(o=o.filter(a=>a.pos&&this.hasLineOfSight(a))),o.length>0&&(this.spotted=o,this.trigger("objectSpotted",o))}},onObjectsSpotted(o){return this.on("objectSpotted",o)}}}p(Lm,"sentry");function ql(i={}){let t=P(0),e=i.isObstacle??!1,r=i.cost??0,s=i.edges??[],n=p(()=>{let a={left:1,top:2,right:4,bottom:8};return s.map(l=>a[l]||0).reduce((l,c)=>l|c,0)},"getEdgeMask"),o=n();return{id:"tile",tilePosOffset:i.offset??P(0),set tilePos(a){let l=this.getLevel();t=a.clone(),this.pos=P(this.tilePos.x*l.tileWidth(),this.tilePos.y*l.tileHeight()).add(this.tilePosOffset)},get tilePos(){return t},set isObstacle(a){e!==a&&(e=a,this.getLevel().invalidateNavigationMap())},get isObstacle(){return e},set cost(a){r!==a&&(r=a,this.getLevel().invalidateNavigationMap())},get cost(){return r},set edges(a){s=a,o=n(),this.getLevel().invalidateNavigationMap()},get edges(){return s},get edgeMask(){return o},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(P(-1,0))},moveRight(){this.tilePos=this.tilePos.add(P(1,0))},moveUp(){this.tilePos=this.tilePos.add(P(0,-1))},moveDown(){this.tilePos=this.tilePos.add(P(0,1))}}}p(ql,"tile");var js,Il=(js=class{constructor(t,e,r){S(this,"name");S(this,"duration");S(this,"loops");S(this,"direction");S(this,"easing");S(this,"interpolation");S(this,"isFinished");S(this,"timing");S(this,"easings");S(this,"relative");this.name=t,this.duration=e.duration,this.loops=e.loops||0,this.direction=e.direction||"forward",this.easing=e.easing||yn.linear,this.interpolation=e.interpolation||"linear",this.isFinished=!1,this.timing=e.timing,this.easings=e.easings,this.relative=r}update(t,e){return!0}getLowerKeyIndexAndRelativeTime(t,e,r){let s=e-1,n=t/this.duration;if(this.loops!==0&&n>=this.loops)return[s,0];let o=Math.trunc(n);if(n-=o,(this.direction=="reverse"||this.direction=="ping-pong"&&o&1)&&(n=1-n),r){let a=0;for(;r[a+1]!==void 0&&r[a+1]<n;)a++;return a>=s?[s,0]:[a,(n-r[a])/(r[a+1]-r[a])]}else{let a=Math.floor((e-1)*n);return[a,(n-a/s)*s]}}setValue(t,e,r){if(this.relative)switch(e){case"pos":t.pos=t.base.pos.add(r);break;case"angle":t.angle=t.base.angle+r;break;case"scale":t.scale=t.base.scale.scale(r);break;case"opacity":t.opacity=t.base.opacity*r;break;default:t[e]=r}else t[e]=r}serialize(){let t={duration:this.duration,keys:[]};return this.loops&&(t.loops=this.loops),this.direction!=="forward"&&(t.direction=this.direction),this.easing!=yn.linear&&(t.easing=this.easing.name),this.interpolation!=="linear"&&(t.interpolation=this.interpolation),this.timing&&(t.timing=this.timing),this.easings&&(t.easings=this.easings.map(e=>this.easing.name)),t}},p(js,"AnimateChannel"),js);function qa(i,t){return t.add(t.sub(i))}p(qa,"reflect");var Ls,Pp=(Ls=class extends Il{constructor(e,r,s,n){super(e,s,n);S(this,"keys");this.keys=r}update(e,r){let[s,n]=this.getLowerKeyIndexAndRelativeTime(r,this.keys.length,this.timing);if(n==0||this.interpolation==="none")this.setValue(e,this.name,this.keys[s]);else{let o=this.easings?this.easings[s]:this.easing;this.setValue(e,this.name,_e(this.keys[s],this.keys[s+1],o(n)))}return n==1}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}},p(Ls,"AnimateChannelNumber"),Ls),Ts,Vp=(Ts=class extends Il{constructor(e,r,s,n,o){var a;super(e,s,n);S(this,"keys");S(this,"curves");S(this,"dcurves");if(this.keys=r,this.interpolation==="spline"){this.curves=[],o&&(this.dcurves=[]);for(let l=0;l<this.keys.length-1;l++){let c=this.keys[l],h=l+1,d=this.keys[h],m=l>0?this.keys[l-1]:qa(d,c),f=h<this.keys.length-1?this.keys[h+1]:qa(c,d);this.curves.push(pn(m,c,d,f)),o&&((a=this.dcurves)==null||a.push(pn(m,c,d,f,Ic)))}}}update(e,r){let[s,n]=this.getLowerKeyIndexAndRelativeTime(r,this.keys.length,this.timing);if(n==0||this.interpolation==="none")this.setValue(e,this.name,this.keys[s]);else{let o=this.easings?this.easings[s]:this.easing;switch(this.interpolation){case"linear":this.setValue(e,this.name,this.keys[s].lerp(this.keys[s+1],o(n)));break;case"slerp":this.setValue(e,this.name,this.keys[s].slerp(this.keys[s+1],o(n)));break;case"spline":if(this.curves){this.setValue(e,this.name,this.curves[s](o(n))),this.dcurves&&this.setValue(e,"angle",this.dcurves[s](o(n)).angle());break}}}return n==1}serialize(){return Object.assign(super.serialize(),{keys:this.keys.map(e=>[e.x,e.y])})}},p(Ts,"AnimateChannelVec2"),Ts),Rs,qp=(Rs=class extends Il{constructor(e,r,s,n){super(e,s,n);S(this,"keys");this.keys=r}update(e,r){let[s,n]=this.getLowerKeyIndexAndRelativeTime(r,this.keys.length,this.timing);if(n==0||this.interpolation=="none")this.setValue(e,this.name,this.keys[s]);else{let o=this.easings?this.easings[s]:this.easing;this.setValue(e,this.name,this.keys[s].lerp(this.keys[s+1],o(n)))}return n==1}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}},p(Rs,"AnimateChannelColor"),Rs);function Tm(i={}){let t=[],e=0,r=!1;return{id:"animate",require:i.followMotion?["rotate"]:void 0,base:{pos:P(0,0),angle:0,scale:P(1,1),opacity:1},add(){i.relative&&(this.is("pos")&&(this.base.pos=this.pos.clone()),this.is("rotate")&&(this.base.angle=this.angle),this.is("scale")&&(this.base.scale=this.scale),this.is("opacity")&&(this.base.opacity=this.opacity))},update(){let s=!0,n;e+=Xt();for(let o of t)n=o.update(this,e),n&&!o.isFinished&&(o.isFinished=!0,this.trigger("animateChannelFinished",o.name)),s&&(s=n);s&&!r&&(r=!0,this.trigger("animateFinished"))},animate(s,n,o){r=!1,this.unanimate(s),typeof n[0]=="number"?t.push(new Pp(s,n,o,i.relative||!1)):n[0]instanceof j?t.push(new Vp(s,n,o,i.relative||!1,s==="pos"&&(i.followMotion||!1))):n[0]instanceof ut&&t.push(new qp(s,n,o,i.relative||!1))},unanimate(s){let n=t.findIndex(o=>o.name===s);n>=0&&t.splice(n,1)},unanimateAll(){t.splice(0,t.length)},onAnimateFinished(s){return this.on("animateFinished",s)},onAnimateChannelFinished(s){return this.on("animateChannelFinished",s)},serializeAnimationChannels(){return t.reduce((s,n)=>(s[n.name]=n.serialize(),s),{})},serializeAnimationOptions(){let s={};return i.followMotion&&(s.followMotion=!0),i.relative&&(s.relative=!0),s}}}p(Tm,"animate");function jl(i,t){let e={name:i.name};return i.is("animate")&&(e.channels=i.serializeAnimationChannels(),Object.assign(e,i.serializeAnimationOptions())),i.children.length>0&&(e.children=i.children.filter(r=>r.is("named")).map(r=>jl(r,r.name))),e}p(jl,"serializeAnimation");function Ia(i=2,t=1){let e=0;return{require:["scale"],update(){let r=Math.sin(e*i)*t;r<0&&this.destroy(),this.scale=P(r),e+=Xt()}}}p(Ia,"boom");function Rm(i,t){if(i==null)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(e=1){this.setHP(i-e),this.trigger("hurt",e)},heal(e=1){let r=i;this.setHP(i+e),this.trigger("heal",i-r)},hp(){return i},maxHP(){return t??null},setMaxHP(e){t=e},setHP(e){i=t?Math.min(t,e):e,i<=0&&this.trigger("death")},onHurt(e){return this.on("hurt",e)},onHeal(e){return this.on("heal",e)},onDeath(e){return this.on("death",e)},inspect(){return`health: ${i}`}}}p(Rm,"health");function zm(i,t={}){if(i==null)throw new Error("lifespan() requires time");let e=t.fade??0;return{id:"lifespan",require:["opacity"],async add(){await x.game.root.wait(i),this.opacity=this.opacity??1,e>0&&await x.game.root.tween(this.opacity,0,e,r=>this.opacity=r,yn.linear),this.destroy()}}}p(zm,"lifespan");function Nm(i){return{id:"named",name:i}}p(Nm,"named");function Om(i,t,e){if(!i)throw new Error("state() requires an initial state");let r={};function s(l){r[l]||(r[l]={enter:new Ce,end:new Ce,update:new Ce,draw:new Ce})}p(s,"initStateEvents");function n(l,c,h){return s(c),r[c][l].add(h)}p(n,"on");function o(l,c,...h){s(c),r[c][l].trigger(...h)}p(o,"trigger");let a=!1;return{id:"state",state:i,enterState(l,...c){if(a=!0,t&&!t.includes(l))throw new Error(`State not found: ${l}`);let h=this.state;if(e){if(!(e!=null&&e[h]))return;let d=typeof e[h]=="string"?[e[h]]:e[h];if(!d.includes(l))throw new Error(`Cannot transition state from "${h}" to "${l}". Available transitions: ${d.map(m=>`"${m}"`).join(", ")}`)}o("end",h,...c),this.state=l,o("enter",l,...c),o("enter",`${h} -> ${l}`,...c)},onStateTransition(l,c,h){return n("enter",`${l} -> ${c}`,h)},onStateEnter(l,c){return n("enter",l,c)},onStateUpdate(l,c){return n("update",l,c)},onStateDraw(l,c){return n("draw",l,c)},onStateEnd(l,c){return n("end",l,c)},update(){a||(o("enter",i),a=!0),o("update",this.state)},draw(){o("draw",this.state)},inspect(){return`state: ${this.state}`}}}p(Om,"state");function Ll(i){return{id:"stay",stay:!0,scenesToStay:i}}p(Ll,"stay");function Um(i=!0,t){let e,r;return{id:"textInput",hasFocus:i,require:["text"],add(){e=x.k.onCharInput(s=>{this.hasFocus&&(!t||this.text.length<t)&&(x.k.isKeyDown("shift")?this.text+=s.toUpperCase():this.text+=s)}),r=x.k.onKeyPressRepeat("backspace",()=>{this.hasFocus&&(this.text=this.text.slice(0,-1))})},destroy(){e.cancel(),r.cancel()}}}p(Um,"textInput");function Do(){return{id:"timer",wait(i,t){let e=[];t&&e.push(t);let r=0,s=this.onUpdate(()=>{r+=x.app.state.dt,r>=i&&(e.forEach(n=>n()),s.cancel())});return{get paused(){return s.paused},set paused(n){s.paused=n},cancel:s.cancel,onEnd(n){e.push(n)},then(n){return this.onEnd(n),this}}},loop(i,t){let e=null,r=p(()=>{e=this.wait(i,r),t()},"newAction");return e=this.wait(0,r),{get paused(){return(e==null?void 0:e.paused)??!1},set paused(s){e&&(e.paused=s)},cancel:p(()=>e==null?void 0:e.cancel(),"cancel")}},tween(i,t,e,r,s=yn.linear){let n=0,o=[],a=this.onUpdate(()=>{n+=x.app.state.dt;let l=Math.min(n/e,1);r(_e(i,t,s(l))),l===1&&(a.cancel(),r(t),o.forEach(c=>c()))});return{get paused(){return a.paused},set paused(l){a.paused=l},onEnd(l){o.push(l)},then(l){return this.onEnd(l),this},cancel(){a.cancel()},finish(){a.cancel(),r(t),o.forEach(l=>l())}}}}}p(Do,"timer");var ja=0;function Jm(){return ja>0}p(Jm,"usesArea");function Hm(i={}){let t={},e=new Set;return{id:"area",collisionIgnore:i.collisionIgnore??[],add(){ja++,this.area.cursor&&this.onHover(()=>x.app.setCursor(this.area.cursor)),this.onCollideUpdate((r,s)=>{if(!r.id)throw new Error("area() requires the object to have an id");t[r.id]||this.trigger("collide",r,s),s&&(t[r.id]=s,e.add(r.id))})},destroy(){ja--},fixedUpdate(){for(let r in t)e.has(Number(r))||(this.trigger("collideEnd",t[r].target),delete t[r]);e.clear()},drawInspect(){let r=this.localArea();ke(),Pt(this.area.offset);let s={outline:{width:4/cl(),color:xt(0,0,255)},anchor:this.anchor,fill:!1,fixed:rr(this)};r instanceof Et?Fe({...s,pos:r.pos,width:r.width*this.area.scale.x,height:r.height*this.area.scale.y}):r instanceof ve?zi({...s,pts:r.pts,scale:this.area.scale}):r instanceof Se&&Jr({...s,pos:r.center,radius:r.radius}),fe()},area:{shape:i.shape??null,scale:i.scale?P(i.scale):P(1),offset:i.offset??P(0),cursor:i.cursor??null},isClicked(){return x.app.isMousePressed()&&this.isHovering()},isHovering(){let r=rr(this)?x.k.mousePos():x.k.toWorld(x.k.mousePos());return this.hasPoint(r)},checkCollision(r){if(!r.id)throw new Error("checkCollision() requires the object to have an id");return t[r.id]??null},getCollisions(){return Object.values(t)},isColliding(r){if(!r.id)throw new Error("isColliding() requires the object to have an id");return!!t[r.id]},isOverlapping(r){if(!r.id)throw new Error("isOverlapping() requires the object to have an id");let s=t[r.id];return s&&s.hasOverlap()},onClick(r,s="left"){let n=x.app.onMousePress(s,()=>{this.isHovering()&&r()});return this.onDestroy(()=>n.cancel()),n},onHover(r){let s=!1;return this.onUpdate(()=>{s?s=this.isHovering():this.isHovering()&&(s=!0,r())})},onHoverUpdate(r){return this.onUpdate(()=>{this.isHovering()&&r()})},onHoverEnd(r){let s=!1;return this.onUpdate(()=>{s?this.isHovering()||(s=!1,r()):s=this.isHovering()})},onCollide(r,s){if(typeof r=="function"&&s===void 0)return this.on("collide",r);if(typeof r=="string")return this.onCollide((n,o)=>{n.is(r)&&(s==null||s(n,o))});throw new Error("onCollide() requires either a function or a tag")},onCollideUpdate(r,s){if(typeof r=="function"&&s===void 0)return this.on("collideUpdate",r);if(typeof r=="string")return this.on("collideUpdate",(n,o)=>n.is(r)&&(s==null?void 0:s(n,o)));throw new Error("onCollideUpdate() requires either a function or a tag")},onCollideEnd(r,s){if(typeof r=="function"&&s===void 0)return this.on("collideEnd",r);if(typeof r=="string")return this.on("collideEnd",n=>n.is(r)&&(s==null?void 0:s(n)));throw new Error("onCollideEnd() requires either a function or a tag")},hasPoint(r){return Ni(this.worldArea(),r)},resolveCollision(r){let s=this.checkCollision(r);s&&!s.resolved&&(this.pos=this.pos.add(s.displacement),s.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let r=this.localArea();if(!(r instanceof ve||r instanceof Et))throw new Error("Only support polygon and rect shapes for now");let s=this.transform.clone().translate(this.area.offset).scale(P(this.area.scale??1));if(r instanceof Et){let n=Ur(this.anchor||Ho).add(1,1).scale(-.5).scale(r.width,r.height);s.translate(n)}return r.transform(s)},screenArea(){let r=this.worldArea();return rr(this)?r:r.transform(x.game.cam.transform)},inspect(){var r,s,n,o,a,l,c;return((r=this.area.scale)==null?void 0:r.x)==((s=this.area.scale)==null?void 0:s.y)?`area: ${(o=(n=this.area.scale)==null?void 0:n.x)==null?void 0:o.toFixed(1)}x`:`area: (${(l=(a=this.area.scale)==null?void 0:a.x)==null?void 0:l.toFixed(1)}x, ${(c=this.area.scale.y)==null?void 0:c.toFixed(1)}y)`}}}p(Hm,"area");function Wm(i={}){let t=null,e=null,r=!1,s=P(0),n=null,o=null,a;return{id:"body",require:["pos"],vel:P(0),drag:i.drag??0,jumpForce:i.jumpForce??pp,gravityScale:i.gravityScale??1,isStatic:i.isStatic??!1,mass:i.mass??1,add(){if(n=this.pos.clone(),o=this.pos.clone(),a=this.pos.clone(),this.mass===0)throw new Error("Can't set body mass to 0");this.is("area")&&(this.onCollideUpdate((l,c)=>{if(!c||!l.is("body")||c.resolved)return;this.trigger("beforePhysicsResolve",c);let h=c.reverse();if(l.trigger("beforePhysicsResolve",h),!(c.resolved||h.resolved)&&!(this.isStatic&&l.isStatic)){if(!this.isStatic&&!l.isStatic){let d=this.mass+l.mass;this.pos=this.pos.add(c.displacement.scale(l.mass/d)),l.pos=l.pos.add(c.displacement.scale(-this.mass/d)),this.transform=ys(this),l.transform=ys(l)}else{let d=!this.isStatic&&l.isStatic?c:c.reverse();d.source.pos=d.source.pos.add(d.displacement),d.source.transform=ys(d.source)}c.resolved=!0,this.trigger("physicsResolve",c),l.trigger("physicsResolve",c.reverse())}}),this.onPhysicsResolve(l=>{if(x.game.gravity)if(l.isBottom()&&this.isFalling()){this.vel=this.vel.reject(x.game.gravity.unit());let c=t;t=l.target,c!=t&&(e=l.target.pos),r?r=!1:c||(this.trigger("ground",t),l.target.trigger("land",this))}else l.isTop()&&this.isJumping()&&(this.vel=this.vel.reject(x.game.gravity.unit()),this.trigger("headbutt",l.target),l.target.trigger("headbutted",this))}))},update(){t&&this.isColliding(t)&&t.exists()&&t.is("body")&&(e&&!t.pos.eq(e)&&i.stickToPlatform!==!1&&this.moveBy(t.pos.sub(e)),e=t.pos);let l=bo();l&&(this.pos.x==a.x&&(this.pos.x=_e(n.x,o.x,l/wo()),a.x=this.pos.x),this.pos.y==a.y&&(this.pos.y=_e(n.y,o.y,l/wo()),a.y=this.pos.y))},fixedUpdate(){if(n&&(this.pos.x==a.x&&(this.pos.x=n.x),this.pos.y==a.y&&(this.pos.y=n.y),n=null),x.game.gravity&&!this.isStatic){r&&(t=null,e=null,this.trigger("fallOff"),r=!1),t&&(!this.isColliding(t)||!t.exists()||!t.is("body"))&&(r=!0);let l=this.vel.clone();this.vel=this.vel.add(x.game.gravity.scale(this.gravityScale*Xt()));let c=i.maxVelocity??fp;this.vel.slen()>c*c&&(this.vel=this.vel.unit().scale(c)),l.dot(x.game.gravity)<0&&this.vel.dot(x.game.gravity)>=0&&this.trigger("fall")}if(this.vel.x+=s.x*Xt(),this.vel.y+=s.y*Xt(),this.vel.x*=1-this.drag*Xt(),this.vel.y*=1-this.drag*Xt(),this.move(this.vel),bo()){n=this.pos.clone();let l=this.vel.add(s.scale(Xt()));o=this.pos.add(l.scale(Xt())),a=this.pos.clone()}s.x=0,s.y=0},onPhysicsResolve(l){return this.on("physicsResolve",l)},onBeforePhysicsResolve(l){return this.on("beforePhysicsResolve",l)},curPlatform(){return t},isGrounded(){return t!==null},isFalling(){return this.vel.dot(cn())>0},isJumping(){return this.vel.dot(cn())<0},applyImpulse(l){this.vel=this.vel.add(l)},addForce(l){s.x+=l.x/this.mass,s.y+=l.y/this.mass},jump(l){t=null,e=null,this.vel=cn().scale(-l||-this.jumpForce)},onGround(l){return this.on("ground",l)},onFall(l){return this.on("fall",l)},onFallOff(l){return this.on("fallOff",l)},onHeadbutt(l){return this.on("headbutt",l)},onLand(l){return this.on("land",l)},onHeadbutted(l){return this.on("headbutted",l)},inspect(){return`gravityScale: ${this.gravityScale}x`}}}p(Wm,"body");function Km(i=2){let t=i;return{id:"doubleJump",require:["body"],numJumps:i,add(){this.onGround(()=>{t=this.numJumps})},doubleJump(e){t<=0||(t<this.numJumps&&this.trigger("doubleJump"),t--,this.jump(e))},onDoubleJump(e){return this.on("doubleJump",e)},inspect(){return`jumpsLeft: ${t}`}}}p(Km,"doubleJump");function Ym(i){return{id:"surfaceEffector",require:["area"],speed:i.speed,speedVariation:i.speedVariation??0,forceScale:i.speedVariation??.9,add(){this.onCollideUpdate("body",(t,e)=>{var o;let r=e==null?void 0:e.normal.normal(),s=t.vel.project(r),n=(o=r==null?void 0:r.scale(this.speed))==null?void 0:o.sub(s);t.addForce(n==null?void 0:n.scale(t.mass*this.forceScale))})}}}p(Ym,"surfaceEffector");function Gm(i){return{id:"areaEffector",require:["area"],useGlobalAngle:i.useGlobalAngle||!1,forceAngle:i.forceAngle,forceMagnitude:i.forceMagnitude,forceVariation:i.forceVariation??0,linearDrag:i.linearDrag??0,add(){this.onCollideUpdate("body",(t,e)=>{let r=j.fromAngle(this.forceAngle).scale(this.forceMagnitude);t.addForce(r),this.linearDrag&&t.addForce(t.vel.scale(-this.linearDrag))})}}}p(Gm,"areaEffector");function Xm(i){return{id:"pointEffector",require:["area","pos"],forceMagnitude:i.forceMagnitude,forceVariation:i.forceVariation??0,distanceScale:i.distanceScale??1,forceMode:i.forceMode||"inverseLinear",linearDrag:i.linearDrag??0,add(){this.onCollideUpdate("body",(t,e)=>{let r=this.pos.sub(t.pos),s=r.len(),n=s*this.distanceScale/10,o=this.forceMode==="constant"?1:this.forceMode==="inverseLinear"?1/n:1/n**2,a=r.scale(this.forceMagnitude*o/s);t.addForce(a),this.linearDrag&&t.addForce(t.vel.scale(-this.linearDrag))})}}}p(Xm,"pointEffector");function Qm(i){return{id:"constantForce",require:["body"],force:i.force,update(){this.force&&this.addForce(this.force)}}}p(Qm,"constantForce");function Zm(i){return{id:"buoyancyEffector",require:["area"],surfaceLevel:i.surfaceLevel,density:i.density??1,linearDrag:i.linearDrag??1,angularDrag:i.angularDrag??.2,flowAngle:i.flowAngle??0,flowMagnitude:i.flowMagnitude??0,flowVariation:i.flowVariation??0,add(){this.onCollideUpdate("body",(t,e)=>{let r=t,s=r.worldArea(),[n,o]=s.cut(P(-100,this.surfaceLevel),P(100,this.surfaceLevel));n&&(this.applyBuoyancy(r,n),this.applyDrag(r,n)),this.flowMagnitude&&r.addForce(j.fromAngle(this.flowAngle).scale(this.flowMagnitude))})},applyBuoyancy(t,e){let r=this.density*e.area(),s=P(0,1).scale(-r);t.addForce(s)},applyDrag(t,e){let r=t.vel,s=this.density*this.linearDrag,n=r.scale(-s);t.addForce(n)}}}p(Zm,"buoyancyEffector");function Po(i){if(!i)throw new Error("Please define an anchor");return{id:"anchor",anchor:i,inspect(){return typeof this.anchor=="string"?"anchor: "+this.anchor:"anchor: "+this.anchor.toString()}}}p(Po,"anchor");function Tl(){return{id:"fixed",fixed:!0}}p(Tl,"fixed");function $m(i,t){return{id:"follow",require:["pos"],follow:{obj:i,offset:t??P(0)},add(){i.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){i.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}p($m,"follow");function td(i){var e;let t=(e=x.game.layers)==null?void 0:e.indexOf(i);return{id:"layer",get layerIndex(){return t??null},get layer(){var r;return t?((r=x.game.layers)==null?void 0:r[t])??null:null},set layer(r){var s;if(t=(s=x.game.layers)==null?void 0:s.indexOf(r),t==-1)throw Error("Invalid layer name")},inspect(){return`layer: ${this.layer}`}}}p(td,"layer");function ed(i,t){let e=typeof i=="number"?j.fromAngle(i):i.unit();return{id:"move",require:["pos"],update(){this.move(e.scale(t))}}}p(ed,"move");function id(i={}){let t=i.distance??dp,e=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let r=this.screenPos();if(!r)return!1;let s=new Et(P(0),te(),ie());return!Mn(s,r)&&s.sdistToPoint(r)>t*t},onExitScreen(r){return this.on("exitView",r)},onEnterScreen(r){return this.on("enterView",r)},update(){this.isOffScreen()?(e||(this.trigger("exitView"),e=!0),i.hide&&(this.hidden=!0),i.pause&&(this.paused=!0),i.destroy&&this.destroy()):(e&&(this.trigger("enterView"),e=!1),i.hide&&(this.hidden=!1),i.pause&&(this.paused=!1))}}}p(id,"offscreen");function An(...i){return{id:"pos",pos:P(...i),moveBy(...t){this.pos=this.pos.add(P(...t))},move(...t){this.moveBy(P(...t).scale(Xt()))},moveTo(...t){if(typeof t[0]=="number"&&typeof t[1]=="number")return this.moveTo(P(t[0],t[1]),t[2]);let e=t[0],r=t[1];if(r===void 0){this.pos=P(e);return}let s=e.sub(this.pos);if(s.len()<=r*Xt()){this.pos=P(e);return}this.move(s.unit().scale(r))},worldPos(t=null){return t?(this.pos=this.pos.add(this.fromWorld(t)),null):this.parent?this.parent.transform.multVec2(this.pos):this.pos},toWorld(t){return this.parent?this.parent.transform.multVec2(this.pos.add(t)):this.pos.add(t)},fromWorld(t){return this.parent?this.parent.transform.invert().multVec2(t).sub(this.pos):t.sub(this.pos)},screenPos(t=null){if(t)return this.pos=this.pos.add(this.fromScreen(t)),null;{let e=this.worldPos();return e?rr(this)?e:Eo(e):null}},toScreen(t){let e=this.toWorld(t);return rr(this)?e:Eo(e)},fromScreen(t){return rr(this)?this.fromWorld(t):this.fromWorld(Sl(t))},toOther(t,e){return t.fromWorld(this.toWorld(e))},fromOther(t,e){return t.toOther(this,e)},inspect(){return`pos: (${Math.round(this.pos.x)}x, ${Math.round(this.pos.y)}y)`},drawInspect(){Jr({color:xt(255,0,0),radius:4/cl()})}}}p(An,"pos");function rd(i){return{id:"rotate",angle:i??0,rotateBy(t){this.angle+=t},rotateTo(t){this.angle=t},inspect(){return`angle: ${Math.round(this.angle)}`}}}p(rd,"rotate");function xn(...i){if(i.length===0)return xn(1);let t=P(...i);return{id:"scale",set scale(e){if(!(e instanceof j))throw Error("The scale property on scale is a vector. Use scaleTo or scaleBy to set the scale with a number.");t=P(e)},get scale(){return t},scaleTo(...e){t=P(...e)},scaleBy(...e){t=t.scale(P(...e))},inspect(){return t.x==t.y?`scale: ${t.x.toFixed(1)}x`:`scale: (${t.x.toFixed(1)}x, ${t.y.toFixed(1)}y)`}}}p(xn,"scale");function sd(i){return{id:"z",z:i,inspect(){return`z: ${this.z}`}}}p(sd,"z");var Ip="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOcAAACDCAYAAAB2kQxsAAAAAXNSR0IArs4c6QAABqxJREFUeJztnU1yFDkQRtMEB+AG7Fk6fBPO6ZsQLGc/N5gbMAtosJvqKv2kpPxS763A0W5XSXqVqZ+SngzgF58/fflx/7N///vnacW1gBkFD2Z2LOYNBF3Dx9UXAGs5kxLWwhNxU2qlJHrOhwLfkNZoiaBzIa3dCFJYLXgSboKXmETPeVDQyamR8vX55fe/v37/9vBzCDoH0tqktEpZ+t0IOh4KOBm16euZmETPtVDAiRgRLRF0HRRuEkrFrE1hzR4Lipxj+bD6AqCPz5++/Bgp5tXfdv1CeAdPPmFmSkn0nE+a0drdFm6XiOkdKWEuKRptTXqlLuqqFNaM6Dkb+T5nbb+npo8WjZVinqFantFJk9bWojaRThq7HzKN8wiPJ7aCoJHEZN5zHvJp7RE1DTV6SnZ1fa/PL1MjJtF5HmnT2tJF3GZ/BIj05I8ULUtR6ypER7ogjxpw61rRGxEal4KYjNyORzatbUlHSxr06tFcBTHPiN5NUEJWzlZKG/aKRqYk5tl1IKgPafucZ7w+vxSluLP6olHnL6MQQfYV6bpk/+BRZXm+cXHEiApSipZHlE6tRBDMkxmyysl5VsmtjXiFoJmiZU35ZWK0oNv1OY+omSv0GDDKJCaMI42cHg25dvFCi6QZxVS6ViVSpLUz38A4oiS9ySjlW2althGWKZrN6XNuOVpbwq0ReIzqZhfTrHwE/PZZuEYqcnqO0tZQGxVqRylprLGIEDXNkLOKEakbYsYiiphmiQaEZuD9BghixiKSmGYJIueqBt4TRZEyHtHENCNyNtMaRREzHhHFNBOKnKv7myVcVXKka4WfRBXTjMjpypl8iBmP6MsOmed0Bgk1UHjxXlpORIAWIqeybyGtha1QEdNMRM5s7wLCGpTENBORE6AXNTHNkBM2QFFMM4F5ToX5TYiLqphmRE7YmMhimiEnJEb9XBdJOUlp4Qp1Mc1E5QQ4I/qyvFJCy8n8JnijEjXNAi3fQ0TwIEM6e2OqnAgII8kkptkgOZEQZlN6BquZjqhVFxlBOkZq4Z6WASAFQQ8jZwQJ70FK8CTiaeb3fDSLJyMiwiwiS/q0SkwEBE+85jYjSTpcTiSE2WQRtVlOpAMVemVdtjXmlZxICFlQk/TJjHcmYS96JJ0p6KmcZggKeWmVdPopYwgKuxJVUuQE+EU0Sd99KYICxJH0ry9DUIA/rFy3WyWnGYLCnqyQ9PCXERTgmJmSPvwlBAU4p1bUWklPP1yytA9JYWdGRtLLDyEowDUjomiRwQgKUIZnJC3OgREUoByPSDpkDyEkBfhJj6RNQ7xEUYA6aiS9Cdo8SUoUBaijVtCuFQwICtBGiajdawARFKCNK0HdVtEjKUAd0+Q0q9v/FklhJ1rmP4e8JEoUBejfq2jYNgtEUdgJzwN7u6dSSkBQyMSME7O7FyHUQpoLCqw8rv5o+d6Uw3NvfzjagUkAZvOlLH1lLMyx8wCzWBEhW3ZDmLZ7NTsrwCpmyui5A1+IPidigjcjhZy14/vytBYxwRsPMVcf/2c2QU72wQUVIgj5lqFyIiZEJ5qQb1me1gLMJLKM93wY9cVETYiGkphmg+RETFhJljY2LHICQB/uchI1AXxwlRMxAfwgrYVtUHvxwk1OoiaAL8MjJ2ICtOEip1q6APnJEBS6VwiRzp4vtM5YBvf3m/EeI8DyvUZK33z4+v1bqsZ7dN+3n2W6zwgMO44hY0X1vIqkXh419x7lXh9ds8oyviFyRqmcXrxf2FUtF89ymFkG6nI2p7WZB4FGvUWfLcVt4ahsdy+TR7ifz6lc0F5v0GfalmXldpE3esrr6PrTR84sjNjS4kpQhQhaUi4lD6KR1xK9DHupfoKoR02vSFDy9FWNoKVivv1/lG7OfZkqR043OZUbWgmtFaomaGl51ZTHCnFv5bqNnFGjZvRtEFUEHSHmI1ZHWgVBXZ5+sxvX7ANlPChpjKsknSllKaPlRU4nZo0Yjq6wiIJGFPMML2mj3M8ZRRe4QkzF6FhCJEFbBn4i0iKswn11yenZiLLKeMRqQdWiZSmlkqrcV9d0gPfksAcqBW+2ZqAoq5gZGSrnTtGwlVmCIqUepxWxerj7iIyNZ7SgiKmJhJw7NJpRgiKmLuHl3KnReA4UIaU+y+WkcbzHQ1DEzMGQ9aJH0BDK6RE0y9wlTDp2HuppERQxc0FFBaZGUMTMB5UlQG/fHyk1odJEaBUUMXWh4oSoFRQxtaHyxMi2uBseQwUKciUoYuaAShTlkaCImQcqUph7QREzF/8DSS/2GZ2/N/sAAAAASUVORK5CYII=",jp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOcAAACDCAYAAAB2kQxsAAAAAXNSR0IArs4c6QAABdRJREFUeJzt3d3N3TYMgGG16ADdoAhyl7UyV9bqXRB0g2zQXgRGDcOWSIoUaX3vAwQBknMk/4gWLcnHrQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACDEb9kb8FH99eeXf6Wf/efn35ynDyj1pEsb6G6NUxOYZ7sdB/QtPdnWRnn29gbKMYDUspPs0SgPb22cHANo/JG9AZF6wWBp3JLgeir36bvff3x9LOvzp2/dbSFA97bk5I4a9VMD7TXOUcP0uJ+d6emu5d6V1QvMs5nj8FZPx37X/b2TFpzShtnafeP0DipJMFnLnN3/w1OQ7tZgP+pA4VVKcHo0TG36KNULKGt5XsHZmi1APS5WM2Vqg0i7vbsG6YcIznN9vRTxXHavgdxtv6Tc3vc1pAHqdaG6ipwKYprpf1sFp6aH0gRTrxxLubPB2avHu+c/l3mICvqnsr//+Cq+qGrK1Xw/wzbBaRkNvSv3yew9cq+cu89L6nu6F/cMzCgzF1ftANlbe+Otp1IkDVxyVfbo6Z481f3507dhvXfbrk3HpdtjKTNqKuio8678c7mzF6ns6arfMyrVNoA75wMfNU2hKSeCx3Fq7dc+SPfDc39H9Vqn2CT//4bsYeT1PecOJyGSJdh6PZOlbElPZz2PHtlD1cUeS4LT4z5IOihwfNaD5ERm9qxH/dZ7Vmt9M999CtCZbdLUP/p3r2zFQ0paG8lr4Eb6+ZWBcSeq/qhyK6bXUfXOSgtO7/tOb9eT1NveqKttpYbiyXu/euV51JV16/T6e86zyF5TUp731V5Sp+Z7M71h9QvFNWWuvr0Sy4LzLfNvrel6zRX1e+hN2VzrnNlfaYD0xhCs++851lDh3vNV95xe6YvHgb8bwbNcuc+f09wbaUj2dzYgjz93//5kh94t0quCM8OKK6glKKuM0EYHfhUZWd8WwenZa0rLsp6s2YY66o0k9WUvS4NManBaGuo1eDIHgUZ1ePdkntsfFaCz5VZJdStsxyt7ziMNXHEAK5yk1mqmhrMPf1fcp57Vqe3SqZTMEduZhqAZyaywFne0DVHngHTZ11bznE88l/1lBZ9meP8851plWkBCO7drmQvWnL/sY/fKtFaqN3iy6iofsQxNktJnTMgfPXJUz3w3VaP5vOQ7Iyszvy2DczSi+aYFET2jINUEqFcAS4+rV480WlwRWXe07dLa0YGvfl9kmbTvPZJ1TXGvn4t4yuRp+2aMgk27wkm63DIztU3vOVfueC8wK4zKWtK0M+nvJXmOdlt65MgFFCva06qsKz044SvjIiN5TjLaaHxhtNyyouXBGZ1WSn66Ivt+M7pRZAWoZsDq+t2emeM1am/WtHxFG9runrO1/n1CxLK7CilxJM/H4bwuTJJBvWtgvm0gcNu01uvpd8la1soLE7xkpYDea4Ot6W3GOSzRc3o/qHw2M9qmXWA+uw+jbd0hyO9Yz0+vJ9QGcO/8ZV2YUqYVPN8dImXp3aJ/w1XTGGYfKZN+P7IXiXqO1uINLzFOm/Pz+BV4C03PNEqpZl//ELXP1ro8nhLyKLPHMyAiXyvh4cMFZ2uyAJXc62gzgJl1nhrSLMEzcLx+5qQnIhgqv6qhTHC2Zmus1tUuowCVDkRU6j0jgiJqhLPSSq2q7wMtMSBkdbcQWjNCq2nMlRrTnajAPP/t+c5Sj3K8VNueQ+pGzaa2MyOb2sZseW2dpL6ZnjMzfeQFt/Fe3XP2WIfGvRY6a569jCJ9TaIlcCS9KQE5p1TP2VrMbwLNDlZEvpE5AkGxh9f2nLO/QOetytIwAnMf6SfS2ns+jaZ6B4i2sWvSvF0HWOAj/aRGNFAaPXbw2rS2Rzr0T/ChshKNM3qd4135BCaqK9VAKy+lAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/4DBC0k0jFtF9wAAAAASUVORK5CYII=",Lp="3001.0.0",x={k:null,globalOpt:null,gfx:null,game:null,app:null,assets:null,fontCacheCanvas:null,fontCacheC2d:null,debug:null,audio:null,pixelDensity:null,canvas:null,gscale:null,kaSprite:null,boomSprite:null},Tp=p((i={})=>{x.k&&(console.warn("KAPLAY already initialized, you are calling kaplay() multiple times, it may lead bugs!"),x.k.quit()),x.globalOpt=i;let t=i.root??document.body;t===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let e=i.canvas??t.appendChild(document.createElement("canvas"));x.canvas=e;let r=i.scale??1;x.gscale=r;let s=i.width&&i.height&&!i.stretch&&!i.letterbox;s?(e.width=i.width*r,e.height=i.height*r):(e.width=e.parentElement.offsetWidth,e.height=e.parentElement.offsetHeight);let n=["outline: none","cursor: default"];if(s){let Q=e.width,ht=e.height;n.push(`width: ${Q}px`),n.push(`height: ${ht}px`)}else n.push("width: 100%"),n.push("height: 100%");i.crisp&&(n.push("image-rendering: pixelated"),n.push("image-rendering: crisp-edges")),e.style.cssText=n.join(";");let o=i.pixelDensity||1;x.pixelDensity=o,e.width*=o,e.height*=o,e.tabIndex=0;let a=document.createElement("canvas");a.width=256,a.height=256,x.fontCacheCanvas=a;let l=a.getContext("2d",{willReadFrequently:!0});x.fontCacheC2d=l;let c=Wd({canvas:e,touchToMouse:i.touchToMouse,gamepads:i.gamepads,pixelDensity:i.pixelDensity,maxFPS:i.maxFPS,buttons:i.buttons});x.app=c;let h=[],d=c.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});if(!d)throw new Error("WebGL not supported");let m=d,f=Ou(m,{texFilter:i.texFilter}),y=xp(i,f);x.gfx=y;let v=Sp();x.audio=v;let g=_p(f);x.assets=g;let A=Fp();x.game=A,A.root.use(Do());function B(Q,ht){let dt=new ko(f,Q,ht);return{clear:p(()=>dt.clear(),"clear"),free:p(()=>dt.free(),"free"),toDataURL:p(()=>dt.toDataURL(),"toDataURL"),toImageData:p(()=>dt.toImageData(),"toImageData"),width:dt.width,height:dt.height,draw:p(bt=>{Me(),dt.bind(),bt(),Me(),dt.unbind()},"draw")}}p(B,"makeCanvas");function F(){m.clear(m.COLOR_BUFFER_BIT),y.frameBuffer.bind(),m.clear(m.COLOR_BUFFER_BIT),y.bgColor||Ti(()=>{Ns({width:te(),height:ie(),quad:new Vt(0,0,te()/64,ie()/64),tex:y.bgTex,fixed:!0})}),y.renderer.numDraws=0,y.fixed=!1,y.transformStack.length=0,y.transform=new Ai}p(F,"frameStart");function E(Q,ht){y.postShader=Q,y.postShaderUniform=ht??null}p(E,"usePostEffect");function k(){Me(),y.lastDrawCalls=y.renderer.numDraws,y.frameBuffer.unbind(),m.viewport(0,0,m.drawingBufferWidth,m.drawingBufferHeight);let Q=y.width,ht=y.height;y.width=m.drawingBufferWidth/o,y.height=m.drawingBufferHeight/o,gn({flipY:!0,tex:y.frameBuffer.tex,pos:new j(y.viewport.x,y.viewport.y),width:y.viewport.width,height:y.viewport.height,shader:y.postShader,uniform:typeof y.postShaderUniform=="function"?y.postShaderUniform():y.postShaderUniform,fixed:!0}),Me(),y.width=Q,y.height=ht}p(k,"frameEnd");let w=!1,b={inspect:!1,timeScale:1,showLog:!0,fps:p(()=>c.fps(),"fps"),numFrames:p(()=>c.numFrames(),"numFrames"),stepFrame:he,drawCalls:p(()=>y.lastDrawCalls,"drawCalls"),clearLog:p(()=>A.logs=[],"clearLog"),log:p((...Q)=>{let ht=i.logMax??8,dt=Q.length>1?Q.concat(" ").join(" "):Q[0];A.logs.unshift({msg:dt,time:c.time()}),A.logs.length>ht&&(A.logs=A.logs.slice(0,ht))},"log"),error:p(Q=>b.log(new Error(Q.toString?Q.toString():Q)),"error"),curRecording:null,numObjects:p(()=>K("*",{recursive:!0}).length,"numObjects"),get paused(){return w},set paused(Q){w=Q,Q?v.ctx.suspend():v.ctx.resume()}};x.debug=b;function M(Q,ht){try{return JSON.parse(window.localStorage[Q])}catch{return ht?(V(Q,ht),ht):null}}p(M,"getData");function V(Q,ht){window.localStorage[Q]=JSON.stringify(ht)}p(V,"setData");function T(Q,...ht){let dt=Q(Kt),bt;typeof dt=="function"?bt=dt(...ht)(Kt):bt=dt;for(let Jt in bt)Kt[Jt]=bt[Jt],i.global!==!1&&(window[Jt]=bt[Jt]);return Kt}p(T,"plug");function z(Q){let ht=c.canvas.captureStream(Q),dt=v.ctx.createMediaStreamDestination();v.masterNode.connect(dt);let bt=new MediaRecorder(ht),Jt=[];return bt.ondataavailable=gt=>{gt.data.size>0&&Jt.push(gt.data)},bt.onerror=()=>{v.masterNode.disconnect(dt),ht.getTracks().forEach(gt=>gt.stop())},bt.start(),{resume(){bt.resume()},pause(){bt.pause()},stop(){return bt.stop(),v.masterNode.disconnect(dt),ht.getTracks().forEach(gt=>gt.stop()),new Promise(gt=>{bt.onstop=()=>{gt(new Blob(Jt,{type:"video/mp4"}))}})},download(gt="kaboom.mp4"){this.stop().then(ae=>Ca(gt,ae))}}}p(z,"record");function O(){return document.activeElement===c.canvas}p(O,"isFocused");let J=A.root.add.bind(A.root),W=A.root.readd.bind(A.root),tt=A.root.removeAll.bind(A.root),K=A.root.get.bind(A.root),Z=A.root.wait.bind(A.root),ot=A.root.loop.bind(A.root),Y=A.root.query.bind(A.root),ct=A.root.tween.bind(A.root),ft=_s(null,jp),X=_s(null,Ip);x.kaSprite=ft,x.boomSprite=X;function Zt(){A.root.fixedUpdate()}p(Zt,"fixedUpdateFrame");function he(){A.root.update()}p(he,"updateFrame");const vr=class vr{constructor(ht,dt,bt,Jt,gt=!1){S(this,"source");S(this,"target");S(this,"normal");S(this,"distance");S(this,"resolved",!1);this.source=ht,this.target=dt,this.normal=bt,this.distance=Jt,this.resolved=gt}get displacement(){return this.normal.scale(this.distance)}reverse(){return new vr(this.target,this.source,this.normal.scale(-1),this.distance,this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.cross(A.gravity||P(0,1))>0}isRight(){return this.displacement.cross(A.gravity||P(0,1))<0}isTop(){return this.displacement.dot(A.gravity||P(0,1))>0}isBottom(){return this.displacement.dot(A.gravity||P(0,1))<0}preventResolution(){this.resolved=!0}};p(vr,"Collision");let ge=vr;function bi(){if(!Jm())return;let Q={},ht=i.hashGridSize||64,dt=new Ai,bt=[];function Jt(gt){if(bt.push(dt.clone()),gt.pos&&dt.translate(gt.pos),gt.scale&&dt.scale(gt.scale),gt.angle&&dt.rotate(gt.angle),gt.transform=dt.clone(),gt.c("area")&&!gt.paused){let ae=gt,Ki=ae.worldArea().bbox(),Qo=Math.floor(Ki.pos.x/ht),Zo=Math.floor(Ki.pos.y/ht),jn=Math.ceil((Ki.pos.x+Ki.width)/ht),Ln=Math.ceil((Ki.pos.y+Ki.height)/ht),Ws=new Set;for(let Ke=Qo;Ke<=jn;Ke++)for(let Ci=Zo;Ci<=Ln;Ci++)if(!Q[Ke])Q[Ke]={},Q[Ke][Ci]=[ae];else if(!Q[Ke][Ci])Q[Ke][Ci]=[ae];else{let Gr=Q[Ke][Ci];t:for(let Ie of Gr){if(Ie.paused||!Ie.exists()||Ws.has(Ie.id))continue;for(let ki of ae.collisionIgnore)if(Ie.is(ki))continue t;for(let ki of Ie.collisionIgnore)if(ae.is(ki))continue t;let Ks=Nc(ae.worldArea(),Ie.worldArea());if(Ks){let ki=new ge(ae,Ie,Ks.normal,Ks.distance);ae.trigger("collideUpdate",Ie,ki);let Ys=ki.reverse();Ys.resolved=ki.resolved,Ie.trigger("collideUpdate",ae,Ys)}Ws.add(Ie.id)}Gr.push(ae)}}gt.children.forEach(Jt),dt=bt.pop()}p(Jt,"checkObj"),Jt(A.root)}p(bi,"checkFrame");function Wi(Q){console.error(Q),v.ctx.suspend();let ht=Q.message??String(Q)??"Unknown error, check console for more info";c.run(()=>{},()=>{F(),Ti(()=>{let dt=te(),bt=ie(),Jt={size:36,width:dt-32*2,letterSpacing:4,lineSpacing:4,font:Bo,fixed:!0};Fe({width:dt,height:bt,color:xt(0,0,255),fixed:!0});let gt=ur({...Jt,text:"Error",pos:P(32),color:xt(255,128,0),fixed:!0});mr(gt),Va({...Jt,text:ht,pos:P(32,32+gt.height+16),fixed:!0}),fe(),A.events.trigger("error",Q)}),k()})}p(Wi,"handleErr");function yr(Q){h.push(Q)}p(yr,"onCleanup");function _r(){A.events.onOnce("frameEnd",()=>{c.quit(),m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT|m.STENCIL_BUFFER_BIT);let Q=m.getParameter(m.MAX_TEXTURE_IMAGE_UNITS);for(let ht=0;ht<Q;ht++)m.activeTexture(m.TEXTURE0+ht),m.bindTexture(m.TEXTURE_2D,null),m.bindTexture(m.TEXTURE_CUBE_MAP,null);m.bindBuffer(m.ARRAY_BUFFER,null),m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,null),m.bindRenderbuffer(m.RENDERBUFFER,null),m.bindFramebuffer(m.FRAMEBUFFER,null),f.destroy(),h.forEach(ht=>ht())})}p(_r,"quit");let Bi=!0;c.run(()=>{try{g.loaded&&(b.paused||Zt(),bi())}catch(Q){Wi(Q)}},(Q,ht)=>{try{Q(),g.loaded||hr()===1&&!Bi&&(g.loaded=!0,A.events.trigger("load")),!g.loaded&&i.loadingScreen!==!1||Bi?(F(),Hu(),k()):(b.paused||he(),bi(),F(),Ju(),i.debug!==!1&&Uu(),k()),Bi&&(Bi=!1),A.events.trigger("frameEnd"),ht()}catch(dt){Wi(dt)}}),Cl(),Pl();let Kt={_k:x,VERSION:Lp,loadRoot:bu,loadProgress:hr,loadSprite:_s,loadSpriteAtlas:Al,loadSound:ju,loadMusic:Lu,loadBitmapFont:Su,loadFont:Fu,loadShader:Vu,loadShaderURL:qu,loadAseprite:Mu,loadPedit:Du,loadBean:ku,loadJSON:Bu,load:Co,getSound:gl,getFont:yl,getBitmapFont:_l,getSprite:dl,getShader:vl,getAsset:Cu,Asset:He,SpriteData:cr,SoundData:vn,width:te,height:ie,center:_n,dt:Xt,fixedDt:wo,restDt:bo,time:c.time,screenshot:c.screenshot,record:z,isFocused:O,setCursor:c.setCursor,getCursor:c.getCursor,setCursorLocked:c.setCursorLocked,isCursorLocked:c.isCursorLocked,setFullscreen:c.setFullscreen,isFullscreen:c.isFullscreen,isTouchscreen:c.isTouchscreen,onLoad:Go,onLoading:_m,onResize:vm,onGamepadConnect:c.onGamepadConnect,onGamepadDisconnect:c.onGamepadDisconnect,onError:gm,onCleanup:yr,camPos:rm,camScale:sm,camFlash:om,camRot:nm,camTransform:am,shake:lm,toScreen:Eo,toWorld:Sl,setGravity:Am,getGravity:xm,setGravityDirection:wm,getGravityDirection:cn,setBackground:pu,getBackground:fu,getGamepads:c.getGamepads,getTreeRoot:Mm,add:J,make:Xo,destroy:Vl,destroyAll:tt,get:K,query:Y,readd:W,pos:An,scale:xn,rotate:rd,color:kl,opacity:Ml,anchor:Po,area:Hm,sprite:So,text:Pm,polygon:em,rect:El,circle:Gu,uvquad:Vm,outline:$u,particles:tm,body:Wm,surfaceEffector:Ym,areaEffector:Gm,pointEffector:Xm,buoyancyEffector:Zm,constantForce:Qm,doubleJump:Km,shader:im,textInput:Um,timer:Do,fixed:Tl,stay:Ll,health:Rm,lifespan:zm,named:Nm,state:Om,z:sd,layer:td,move:ed,offscreen:id,follow:$m,fadeIn:Qu,mask:Zu,drawon:Xu,raycast:Fl,tile:ql,animate:Tm,serializeAnimation:jl,agent:qm,sentry:Lm,patrol:jm,pathfinder:Im,on:wi,onFixedUpdate:bp,onUpdate:Bp,onDraw:Cp,onAdd:cm,onDestroy:kp,onClick:Mp,onCollide:um,onCollideUpdate:mm,onCollideEnd:dm,onHover:pm,onHoverUpdate:fm,onHoverEnd:ym,onKeyDown:c.onKeyDown,onKeyPress:c.onKeyPress,onKeyPressRepeat:c.onKeyPressRepeat,onKeyRelease:c.onKeyRelease,onMouseDown:c.onMouseDown,onMousePress:c.onMousePress,onMouseRelease:c.onMouseRelease,onMouseMove:c.onMouseMove,onCharInput:c.onCharInput,onTouchStart:c.onTouchStart,onTouchMove:c.onTouchMove,onTouchEnd:c.onTouchEnd,onScroll:c.onScroll,onHide:c.onHide,onShow:c.onShow,onGamepadButtonDown:c.onGamepadButtonDown,onGamepadButtonPress:c.onGamepadButtonPress,onGamepadButtonRelease:c.onGamepadButtonRelease,onGamepadStick:c.onGamepadStick,onButtonPress:c.onButtonPress,onButtonDown:c.onButtonDown,onButtonRelease:c.onButtonRelease,mousePos:ul,mouseDeltaPos:c.mouseDeltaPos,isKeyDown:c.isKeyDown,isKeyPressed:c.isKeyPressed,isKeyPressedRepeat:c.isKeyPressedRepeat,isKeyReleased:c.isKeyReleased,isMouseDown:c.isMouseDown,isMousePressed:c.isMousePressed,isMouseReleased:c.isMouseReleased,isMouseMoved:c.isMouseMoved,isGamepadButtonPressed:c.isGamepadButtonPressed,isGamepadButtonDown:c.isGamepadButtonDown,isGamepadButtonReleased:c.isGamepadButtonReleased,getGamepadStick:c.getGamepadStick,isButtonPressed:c.isButtonPressed,isButtonDown:c.isButtonDown,isButtonReleased:c.isButtonReleased,setButton:c.setButton,getButton:c.getButton,pressButton:c.pressButton,releaseButton:c.releaseButton,getLastInputDeviceType:c.getLastInputDeviceType,charInputted:c.charInputted,loop:ot,wait:Z,play:Bm,volume:Cm,burp:Dl,audioCtx:v.ctx,Line:Ve,Rect:Et,Circle:Se,Ellipse:Ji,Point:Pd,Polygon:ve,Vec2:j,Color:ut,Mat4:Ai,Quad:Vt,RNG:nc,rand:Gt,randi:Ga,randSeed:oc,vec2:P,rgb:xt,hsl2rgb:Ed,quad:Nt,choose:hc,chooseMultiple:lc,shuffle:Xa,chance:ac,lerp:_e,tween:ct,easings:yn,map:ei,mapc:sc,wave:Ya,deg2rad:Ut,rad2deg:lr,clamp:gi,evaluateQuadratic:Cc,evaluateQuadraticFirstDerivative:kc,evaluateQuadraticSecondDerivative:Mc,evaluateBezier:No,evaluateBezierFirstDerivative:Fc,evaluateBezierSecondDerivative:Ec,evaluateCatmullRom:Sc,evaluateCatmullRomFirstDerivative:Dc,curveLengthApproximation:nl,normalizedCurve:Pc,hermite:Hs,cardinal:ol,catmullRom:pn,bezier:Vc,kochanekBartels:qc,easingSteps:zc,easingLinear:Tc,easingCubicBezier:Rc,testLineLine:Io,testRectRect:Qa,testRectLine:jo,testRectPoint:Mn,testCirclePolygon:En,testLinePoint:Lo,testLineCircle:Js,isConvex:Wc,triangulate:ll,NavMesh:sp,drawSprite:Ku,drawText:Va,formatText:ur,drawRect:Fe,drawLine:ps,drawLines:Yo,drawTriangle:bl,drawCircle:Jr,drawEllipse:xl,drawUVQuad:Ns,drawPolygon:zi,drawCurve:wl,drawBezier:Nu,drawFormattedText:mr,drawMasked:Wu,drawSubtracted:Yu,pushTransform:ke,popTransform:fe,pushTranslate:Pt,pushScale:zs,pushRotate:zr,pushMatrix:yu,usePostEffect:E,makeCanvas:B,debug:b,scene:Fm,getSceneName:Dm,go:Em,onSceneLeave:Sm,layers:Dp,addLevel:hm,getData:M,setData:V,download:Oo,downloadJSON:Xc,downloadText:hl,downloadBlob:Ca,plug:T,ASCII_CHARS:gu,canvas:c.canvas,addKaboom:km,LEFT:j.LEFT,RIGHT:j.RIGHT,UP:j.UP,DOWN:j.DOWN,RED:ut.RED,GREEN:ut.GREEN,BLUE:ut.BLUE,YELLOW:ut.YELLOW,MAGENTA:ut.MAGENTA,CYAN:ut.CYAN,WHITE:ut.WHITE,BLACK:ut.BLACK,quit:_r,KEvent:Ce,KEventHandler:fn,KEventController:Or};x.k=Kt;let In=i.plugins;if(In&&In.forEach(T),i.global!==!1)for(let Q in Kt)window[Q]=Kt[Q];return i.focus!==!1&&c.canvas.focus(),Kt},"kaplay"),Rp=Tp;/**
 * Planck.js v1.1.2
 * @license The MIT license
 * @copyright Copyright (c) 2024 Erin Catto, Ali Shakiba
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var La=function(i,t){return La=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])},La(i,t)};function oe(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");La(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var ne=function(){return ne=Object.assign||function(t){for(var e,r=1,s=arguments.length;r<s;r++){e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},ne.apply(this,arguments)},qe=function(i,t){(i===null||typeof i>"u")&&(i={});var e=ne({},i);for(var r in t)t.hasOwnProperty(r)&&typeof i[r]>"u"&&(e[r]=t[r]);if(typeof Object.getOwnPropertySymbols=="function")for(var s=Object.getOwnPropertySymbols(t),n=0;n<s.length;n++){var o=s[n];t.propertyIsEnumerable(o)&&typeof i[o]>"u"&&(e[o]=t[o])}return e},zp=Math.random,Ee=1e-9,Np=Number.isFinite;function Op(i){return i|=i>>1,i|=i>>2,i|=i>>4,i|=i>>8,i|=i>>16,i+1}function Up(i){return i>0&&(i&i-1)===0}function nd(i,t,e){return typeof t>"u"?(e=1,t=0):typeof e>"u"&&(e=t,t=0),e>t?(i=(i-t)%(e-t),i+(i<0?e:t)):(i=(i-e)%(t-e),i+(i<=0?t:e))}function re(i,t,e){return i<t?t:i>e?e:i}function Jp(i,t){return typeof i>"u"?(t=1,i=0):typeof t>"u"&&(t=i,i=0),i===t?i:zp()*(t-i)+i}var Hr=Object.create(Math);Hr.EPSILON=Ee;Hr.isFinite=Np;Hr.nextPowerOfTwo=Op;Hr.isPowerOfTwo=Up;Hr.mod=nd;Hr.clamp=re;Hr.random=Jp;var oh=Math.abs,ra=Math.sqrt,ah=Math.max,lh=Math.min,u=function(){function i(t,e){if(!(this instanceof i))return new i(t,e);typeof t>"u"?(this.x=0,this.y=0):typeof t=="object"?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}return i.prototype._serialize=function(){return{x:this.x,y:this.y}},i._deserialize=function(t){var e=Object.create(i.prototype);return e.x=t.x,e.y=t.y,e},i.zero=function(){var t=Object.create(i.prototype);return t.x=0,t.y=0,t},i.neo=function(t,e){var r=Object.create(i.prototype);return r.x=t,r.y=e,r},i.clone=function(t){return i.neo(t.x,t.y)},i.prototype.toString=function(){return JSON.stringify(this)},i.isValid=function(t){return t===null||typeof t>"u"?!1:Number.isFinite(t.x)&&Number.isFinite(t.y)},i.assert=function(t){},i.prototype.clone=function(){return i.clone(this)},i.prototype.setZero=function(){return this.x=0,this.y=0,this},i.prototype.set=function(t,e){return typeof t=="object"?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),this},i.prototype.setNum=function(t,e){return this.x=t,this.y=e,this},i.prototype.setVec2=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.wSet=function(t,e,r,s){return typeof r<"u"||typeof s<"u"?this.setCombine(t,e,r,s):this.setMul(t,e)},i.prototype.setCombine=function(t,e,r,s){var n=t*e.x+r*s.x,o=t*e.y+r*s.y;return this.x=n,this.y=o,this},i.prototype.setMul=function(t,e){var r=t*e.x,s=t*e.y;return this.x=r,this.y=s,this},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},i.prototype.wAdd=function(t,e,r,s){return typeof r<"u"||typeof s<"u"?this.addCombine(t,e,r,s):this.addMul(t,e)},i.prototype.addCombine=function(t,e,r,s){var n=t*e.x+r*s.x,o=t*e.y+r*s.y;return this.x+=n,this.y+=o,this},i.prototype.addMul=function(t,e){var r=t*e.x,s=t*e.y;return this.x+=r,this.y+=s,this},i.prototype.wSub=function(t,e,r,s){return typeof r<"u"||typeof s<"u"?this.subCombine(t,e,r,s):this.subMul(t,e)},i.prototype.subCombine=function(t,e,r,s){var n=t*e.x+r*s.x,o=t*e.y+r*s.y;return this.x-=n,this.y-=o,this},i.prototype.subMul=function(t,e){var r=t*e.x,s=t*e.y;return this.x-=r,this.y-=s,this},i.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.mul=function(t){return this.x*=t,this.y*=t,this},i.prototype.length=function(){return i.lengthOf(this)},i.prototype.lengthSquared=function(){return i.lengthSquared(this)},i.prototype.normalize=function(){var t=this.length();if(t<Ee)return 0;var e=1/t;return this.x*=e,this.y*=e,t},i.lengthOf=function(t){return ra(t.x*t.x+t.y*t.y)},i.lengthSquared=function(t){return t.x*t.x+t.y*t.y},i.distance=function(t,e){var r=t.x-e.x,s=t.y-e.y;return ra(r*r+s*s)},i.distanceSquared=function(t,e){var r=t.x-e.x,s=t.y-e.y;return r*r+s*s},i.areEqual=function(t,e){return t===e||typeof e=="object"&&e!==null&&t.x===e.x&&t.y===e.y},i.skew=function(t){return i.neo(-t.y,t.x)},i.dot=function(t,e){return t.x*e.x+t.y*e.y},i.cross=function(t,e){return typeof e=="number"?i.neo(e*t.y,-e*t.x):typeof t=="number"?i.neo(-t*e.y,t*e.x):t.x*e.y-t.y*e.x},i.crossVec2Vec2=function(t,e){return t.x*e.y-t.y*e.x},i.crossVec2Num=function(t,e){return i.neo(e*t.y,-e*t.x)},i.crossNumVec2=function(t,e){return i.neo(-t*e.y,t*e.x)},i.addCross=function(t,e,r){if(typeof r=="number")return i.neo(r*e.y+t.x,-r*e.x+t.y);if(typeof e=="number")return i.neo(-e*r.y+t.x,e*r.x+t.y)},i.addCrossVec2Num=function(t,e,r){return i.neo(r*e.y+t.x,-r*e.x+t.y)},i.addCrossNumVec2=function(t,e,r){return i.neo(-e*r.y+t.x,e*r.x+t.y)},i.add=function(t,e){return i.neo(t.x+e.x,t.y+e.y)},i.wAdd=function(t,e,r,s){return typeof r<"u"||typeof s<"u"?i.combine(t,e,r,s):i.mulNumVec2(t,e)},i.combine=function(t,e,r,s){return i.zero().setCombine(t,e,r,s)},i.sub=function(t,e){return i.neo(t.x-e.x,t.y-e.y)},i.mul=function(t,e){if(typeof t=="object")return i.neo(t.x*e,t.y*e);if(typeof e=="object")return i.neo(t*e.x,t*e.y)},i.mulVec2Num=function(t,e){return i.neo(t.x*e,t.y*e)},i.mulNumVec2=function(t,e){return i.neo(t*e.x,t*e.y)},i.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},i.neg=function(t){return i.neo(-t.x,-t.y)},i.abs=function(t){return i.neo(oh(t.x),oh(t.y))},i.mid=function(t,e){return i.neo((t.x+e.x)*.5,(t.y+e.y)*.5)},i.upper=function(t,e){return i.neo(ah(t.x,e.x),ah(t.y,e.y))},i.lower=function(t,e){return i.neo(lh(t.x,e.x),lh(t.y,e.y))},i.prototype.clamp=function(t){var e=this.x*this.x+this.y*this.y;if(e>t*t){var r=t/ra(e);this.x*=r,this.y*=r}return this},i.clamp=function(t,e){var r=i.neo(t.x,t.y);return r.clamp(e),r},i.scaleFn=function(t,e){return function(r){return i.neo(r.x*t,r.y*e)}},i.translateFn=function(t,e){return function(r){return i.neo(r.x+t,r.y+e)}},i}(),Le=Math.max,Ye=Math.min,Yt=function(){function i(t,e){if(!(this instanceof i))return new i(t,e);this.lowerBound=u.zero(),this.upperBound=u.zero(),typeof t=="object"&&this.lowerBound.setVec2(t),typeof e=="object"?this.upperBound.setVec2(e):typeof t=="object"&&this.upperBound.setVec2(t)}return i.prototype.isValid=function(){return i.isValid(this)},i.isValid=function(t){return t===null||typeof t>"u"?!1:u.isValid(t.lowerBound)&&u.isValid(t.upperBound)&&u.sub(t.upperBound,t.lowerBound).lengthSquared()>=0},i.assert=function(t){},i.prototype.getCenter=function(){return u.neo((this.lowerBound.x+this.upperBound.x)*.5,(this.lowerBound.y+this.upperBound.y)*.5)},i.prototype.getExtents=function(){return u.neo((this.upperBound.x-this.lowerBound.x)*.5,(this.upperBound.y-this.lowerBound.y)*.5)},i.prototype.getPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+this.upperBound.y-this.lowerBound.y)},i.prototype.combine=function(t,e){e=e||this;var r=t.lowerBound,s=t.upperBound,n=e.lowerBound,o=e.upperBound,a=Ye(r.x,n.x),l=Ye(r.y,n.y),c=Le(o.x,s.x),h=Le(o.y,s.y);this.lowerBound.setNum(a,l),this.upperBound.setNum(c,h)},i.prototype.combinePoints=function(t,e){this.lowerBound.setNum(Ye(t.x,e.x),Ye(t.y,e.y)),this.upperBound.setNum(Le(t.x,e.x),Le(t.y,e.y))},i.prototype.set=function(t){this.lowerBound.setNum(t.lowerBound.x,t.lowerBound.y),this.upperBound.setNum(t.upperBound.x,t.upperBound.y)},i.prototype.contains=function(t){var e=!0;return e=e&&this.lowerBound.x<=t.lowerBound.x,e=e&&this.lowerBound.y<=t.lowerBound.y,e=e&&t.upperBound.x<=this.upperBound.x,e=e&&t.upperBound.y<=this.upperBound.y,e},i.prototype.extend=function(t){return i.extend(this,t),this},i.extend=function(t,e){return t.lowerBound.x-=e,t.lowerBound.y-=e,t.upperBound.x+=e,t.upperBound.y+=e,t},i.testOverlap=function(t,e){var r=e.lowerBound.x-t.upperBound.x,s=t.lowerBound.x-e.upperBound.x,n=e.lowerBound.y-t.upperBound.y,o=t.lowerBound.y-e.upperBound.y;return!(r>0||n>0||s>0||o>0)},i.areEqual=function(t,e){return u.areEqual(t.lowerBound,e.lowerBound)&&u.areEqual(t.upperBound,e.upperBound)},i.diff=function(t,e){var r=Le(0,Ye(t.upperBound.x,e.upperBound.x)-Le(e.lowerBound.x,t.lowerBound.x)),s=Le(0,Ye(t.upperBound.y,e.upperBound.y)-Le(e.lowerBound.y,t.lowerBound.y)),n=t.upperBound.x-t.lowerBound.x,o=t.upperBound.y-t.lowerBound.y,a=e.upperBound.x-e.lowerBound.x,l=e.upperBound.y-e.lowerBound.y;return n*o+a*l-r*s},i.prototype.rayCast=function(t,e){for(var r=-1/0,s=1/0,n=e.p1,o=u.sub(e.p2,e.p1),a=u.abs(o),l=u.zero(),c="x";c!==null;c=c==="x"?"y":null)if(a.x<Ee){if(n[c]<this.lowerBound[c]||this.upperBound[c]<n[c])return!1}else{var h=1/o[c],d=(this.lowerBound[c]-n[c])*h,m=(this.upperBound[c]-n[c])*h,f=-1;if(d>m){var y=d;d=m,m=y,f=1}if(d>r&&(l.setZero(),l[c]=f,r=d),s=Ye(s,m),r>s)return!1}return r<0||e.maxFraction<r?!1:(t.fraction=r,t.normal=l,!0)},i.prototype.toString=function(){return JSON.stringify(this)},i.combinePoints=function(t,e,r){return t.lowerBound.x=Ye(e.x,r.x),t.lowerBound.y=Ye(e.y,r.y),t.upperBound.x=Le(e.x,r.x),t.upperBound.y=Le(e.y,r.y),t},i.combinedPerimeter=function(t,e){var r=Ye(t.lowerBound.x,e.lowerBound.x),s=Ye(t.lowerBound.y,e.lowerBound.y),n=Le(t.upperBound.x,e.upperBound.x),o=Le(t.upperBound.y,e.upperBound.y);return 2*(n-r+o-s)},i}(),Nn=Math.PI,st=function(){function i(){}return Object.defineProperty(i,"polygonRadius",{get:function(){return 2*i.linearSlop},enumerable:!1,configurable:!0}),i.lengthUnitsPerMeter=1,i.maxManifoldPoints=2,i.maxPolygonVertices=12,i.aabbExtension=.1,i.aabbMultiplier=2,i.linearSlop=.005,i.angularSlop=2/180*Nn,i.maxSubSteps=8,i.maxTOIContacts=32,i.maxTOIIterations=20,i.maxDistanceIterations=20,i.velocityThreshold=1,i.maxLinearCorrection=.2,i.maxAngularCorrection=8/180*Nn,i.maxTranslation=2,i.maxRotation=.5*Nn,i.baumgarte=.2,i.toiBaugarte=.75,i.timeToSleep=.5,i.linearSleepTolerance=.01,i.angularSleepTolerance=2/180*Nn,i}(),H=function(){function i(){}return Object.defineProperty(i,"maxManifoldPoints",{get:function(){return st.maxManifoldPoints},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxPolygonVertices",{get:function(){return st.maxPolygonVertices},enumerable:!1,configurable:!0}),Object.defineProperty(i,"aabbExtension",{get:function(){return st.aabbExtension*st.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"aabbMultiplier",{get:function(){return st.aabbMultiplier},enumerable:!1,configurable:!0}),Object.defineProperty(i,"linearSlop",{get:function(){return st.linearSlop*st.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"linearSlopSquared",{get:function(){return st.linearSlop*st.lengthUnitsPerMeter*st.linearSlop*st.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"angularSlop",{get:function(){return st.angularSlop},enumerable:!1,configurable:!0}),Object.defineProperty(i,"polygonRadius",{get:function(){return 2*st.linearSlop},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxSubSteps",{get:function(){return st.maxSubSteps},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxTOIContacts",{get:function(){return st.maxTOIContacts},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxTOIIterations",{get:function(){return st.maxTOIIterations},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxDistanceIterations",{get:function(){return st.maxDistanceIterations},enumerable:!1,configurable:!0}),Object.defineProperty(i,"velocityThreshold",{get:function(){return st.velocityThreshold*st.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxLinearCorrection",{get:function(){return st.maxLinearCorrection*st.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxAngularCorrection",{get:function(){return st.maxAngularCorrection},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxTranslation",{get:function(){return st.maxTranslation*st.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxTranslationSquared",{get:function(){return st.maxTranslation*st.lengthUnitsPerMeter*st.maxTranslation*st.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxRotation",{get:function(){return st.maxRotation},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxRotationSquared",{get:function(){return st.maxRotation*st.maxRotation},enumerable:!1,configurable:!0}),Object.defineProperty(i,"baumgarte",{get:function(){return st.baumgarte},enumerable:!1,configurable:!0}),Object.defineProperty(i,"toiBaugarte",{get:function(){return st.toiBaugarte},enumerable:!1,configurable:!0}),Object.defineProperty(i,"timeToSleep",{get:function(){return st.timeToSleep},enumerable:!1,configurable:!0}),Object.defineProperty(i,"linearSleepTolerance",{get:function(){return st.linearSleepTolerance*st.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"linearSleepToleranceSqr",{get:function(){return st.linearSleepTolerance*st.lengthUnitsPerMeter*st.linearSleepTolerance*st.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"angularSleepTolerance",{get:function(){return st.angularSleepTolerance},enumerable:!1,configurable:!0}),Object.defineProperty(i,"angularSleepToleranceSqr",{get:function(){return st.angularSleepTolerance*st.angularSleepTolerance},enumerable:!1,configurable:!0}),i}(),un=function(){function i(t){this._list=[],this._max=1/0,this._hasCreateFn=!1,this._createCount=0,this._hasAllocateFn=!1,this._allocateCount=0,this._hasReleaseFn=!1,this._releaseCount=0,this._hasDisposeFn=!1,this._disposeCount=0,this._list=[],this._max=t.max||this._max,this._createFn=t.create,this._hasCreateFn=typeof this._createFn=="function",this._allocateFn=t.allocate,this._hasAllocateFn=typeof this._allocateFn=="function",this._releaseFn=t.release,this._hasReleaseFn=typeof this._releaseFn=="function",this._disposeFn=t.dispose,this._hasDisposeFn=typeof this._disposeFn=="function"}return i.prototype.max=function(t){return typeof t=="number"?(this._max=t,this):this._max},i.prototype.size=function(){return this._list.length},i.prototype.allocate=function(){var t;return this._list.length>0?t=this._list.shift():(this._createCount++,this._hasCreateFn?t=this._createFn():t={}),this._allocateCount++,this._hasAllocateFn&&this._allocateFn(t),t},i.prototype.release=function(t){this._list.length<this._max?(this._releaseCount++,this._hasReleaseFn&&this._releaseFn(t),this._list.push(t)):(this._disposeCount++,this._hasDisposeFn&&(t=this._disposeFn(t)))},i.prototype.toString=function(){return" +"+this._createCount+" >"+this._allocateCount+" <"+this._releaseCount+" -"+this._disposeCount+" ="+this._list.length+"/"+this._max},i}(),hh=Math.abs,xe=Math.max,Hp=function(){function i(t){this.aabb=new Yt,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=-1,this.id=t}return i.prototype.toString=function(){return this.id+": "+this.userData},i.prototype.isLeaf=function(){return this.child1==null},i}(),ch=new un({create:function(){return new Hp},release:function(i){i.userData=null,i.parent=null,i.child1=null,i.child2=null,i.height=-1,i.id=void 0}}),Wp=function(){function i(){this.inputPool=new un({create:function(){return{}},release:function(t){}}),this.stackPool=new un({create:function(){return[]},release:function(t){t.length=0}}),this.iteratorPool=new un({create:function(){return new Kp},release:function(t){t.close()}}),this.m_root=null,this.m_nodes={},this.m_lastProxyId=0}return i.prototype.getUserData=function(t){var e=this.m_nodes[t];return e.userData},i.prototype.getFatAABB=function(t){var e=this.m_nodes[t];return e.aabb},i.prototype.allocateNode=function(){var t=ch.allocate();return t.id=++this.m_lastProxyId,this.m_nodes[t.id]=t,t},i.prototype.freeNode=function(t){delete this.m_nodes[t.id],ch.release(t)},i.prototype.createProxy=function(t,e){var r=this.allocateNode();return r.aabb.set(t),Yt.extend(r.aabb,H.aabbExtension),r.userData=e,r.height=0,this.insertLeaf(r),r.id},i.prototype.destroyProxy=function(t){var e=this.m_nodes[t];this.removeLeaf(e),this.freeNode(e)},i.prototype.moveProxy=function(t,e,r){var s=this.m_nodes[t];return s.aabb.contains(e)?!1:(this.removeLeaf(s),s.aabb.set(e),e=s.aabb,Yt.extend(e,H.aabbExtension),r.x<0?e.lowerBound.x+=r.x*H.aabbMultiplier:e.upperBound.x+=r.x*H.aabbMultiplier,r.y<0?e.lowerBound.y+=r.y*H.aabbMultiplier:e.upperBound.y+=r.y*H.aabbMultiplier,this.insertLeaf(s),!0)},i.prototype.insertLeaf=function(t){if(this.m_root==null){this.m_root=t,this.m_root.parent=null;return}for(var e=t.aabb,r=this.m_root;!r.isLeaf();){var s=r.child1,n=r.child2,o=r.aabb.getPerimeter(),a=Yt.combinedPerimeter(r.aabb,e),l=2*a,c=2*(a-o),h=Yt.combinedPerimeter(e,s.aabb),d=h+c;if(!s.isLeaf()){var m=s.aabb.getPerimeter();d-=m}var f=Yt.combinedPerimeter(e,n.aabb),y=f+c;if(!n.isLeaf()){var m=n.aabb.getPerimeter();y-=m}if(l<d&&l<y)break;d<y?r=s:r=n}var v=r,g=v.parent,A=this.allocateNode();for(A.parent=g,A.userData=null,A.aabb.combine(e,v.aabb),A.height=v.height+1,g!=null?(g.child1===v?g.child1=A:g.child2=A,A.child1=v,A.child2=t,v.parent=A,t.parent=A):(A.child1=v,A.child2=t,v.parent=A,t.parent=A,this.m_root=A),r=t.parent;r!=null;){r=this.balance(r);var s=r.child1,n=r.child2;r.height=1+xe(s.height,n.height),r.aabb.combine(s.aabb,n.aabb),r=r.parent}},i.prototype.removeLeaf=function(t){if(t===this.m_root){this.m_root=null;return}var e=t.parent,r=e.parent,s;if(e.child1===t?s=e.child2:s=e.child1,r!=null){r.child1===e?r.child1=s:r.child2=s,s.parent=r,this.freeNode(e);for(var n=r;n!=null;){n=this.balance(n);var o=n.child1,a=n.child2;n.aabb.combine(o.aabb,a.aabb),n.height=1+xe(o.height,a.height),n=n.parent}}else this.m_root=s,s.parent=null,this.freeNode(e)},i.prototype.balance=function(t){var e=t;if(e.isLeaf()||e.height<2)return t;var r=e.child1,s=e.child2,n=s.height-r.height;if(n>1){var o=s.child1,a=s.child2;return s.child1=e,s.parent=e.parent,e.parent=s,s.parent!=null?s.parent.child1===t?s.parent.child1=s:s.parent.child2=s:this.m_root=s,o.height>a.height?(s.child2=o,e.child2=a,a.parent=e,e.aabb.combine(r.aabb,a.aabb),s.aabb.combine(e.aabb,o.aabb),e.height=1+xe(r.height,a.height),s.height=1+xe(e.height,o.height)):(s.child2=a,e.child2=o,o.parent=e,e.aabb.combine(r.aabb,o.aabb),s.aabb.combine(e.aabb,a.aabb),e.height=1+xe(r.height,o.height),s.height=1+xe(e.height,a.height)),s}if(n<-1){var l=r.child1,c=r.child2;return r.child1=e,r.parent=e.parent,e.parent=r,r.parent!=null?r.parent.child1===e?r.parent.child1=r:r.parent.child2=r:this.m_root=r,l.height>c.height?(r.child2=l,e.child1=c,c.parent=e,e.aabb.combine(s.aabb,c.aabb),r.aabb.combine(e.aabb,l.aabb),e.height=1+xe(s.height,c.height),r.height=1+xe(e.height,l.height)):(r.child2=c,e.child1=l,l.parent=e,e.aabb.combine(s.aabb,l.aabb),r.aabb.combine(e.aabb,c.aabb),e.height=1+xe(s.height,l.height),r.height=1+xe(e.height,c.height)),r}return e},i.prototype.getHeight=function(){return this.m_root==null?0:this.m_root.height},i.prototype.getAreaRatio=function(){if(this.m_root==null)return 0;for(var t=this.m_root,e=t.aabb.getPerimeter(),r=0,s,n=this.iteratorPool.allocate().preorder(this.m_root);s=n.next();)s.height<0||(r+=s.aabb.getPerimeter());return this.iteratorPool.release(n),r/e},i.prototype.computeHeight=function(t){var e;if(typeof t<"u"?e=this.m_nodes[t]:e=this.m_root,e.isLeaf())return 0;var r=this.computeHeight(e.child1.id),s=this.computeHeight(e.child2.id);return 1+xe(r,s)},i.prototype.validateStructure=function(t){if(t!=null){this.m_root;var e=t.child1,r=t.child2;t.isLeaf()||(this.validateStructure(e),this.validateStructure(r))}},i.prototype.validateMetrics=function(t){if(t!=null){var e=t.child1,r=t.child2;if(!t.isLeaf()){e.height,r.height;var s=new Yt;s.combine(e.aabb,r.aabb),this.validateMetrics(e),this.validateMetrics(r)}}},i.prototype.validate=function(){},i.prototype.getMaxBalance=function(){for(var t=0,e,r=this.iteratorPool.allocate().preorder(this.m_root);e=r.next();)if(!(e.height<=1)){var s=hh(e.child2.height-e.child1.height);t=xe(t,s)}return this.iteratorPool.release(r),t},i.prototype.rebuildBottomUp=function(){for(var t=[],e=0,r,s=this.iteratorPool.allocate().preorder(this.m_root);r=s.next();)r.height<0||(r.isLeaf()?(r.parent=null,t[e]=r,++e):this.freeNode(r));for(this.iteratorPool.release(s);e>1;){for(var n=1/0,o=-1,a=-1,l=0;l<e;++l)for(var c=t[l].aabb,h=l+1;h<e;++h){var d=t[h].aabb,m=Yt.combinedPerimeter(c,d);m<n&&(o=l,a=h,n=m)}var f=t[o],y=t[a],v=this.allocateNode();v.child1=f,v.child2=y,v.height=1+xe(f.height,y.height),v.aabb.combine(f.aabb,y.aabb),v.parent=null,f.parent=v,y.parent=v,t[a]=t[e-1],t[o]=v,--e}this.m_root=t[0]},i.prototype.shiftOrigin=function(t){for(var e,r=this.iteratorPool.allocate().preorder(this.m_root);e=r.next();){var s=e.aabb;s.lowerBound.x-=t.x,s.lowerBound.y-=t.y,s.upperBound.x-=t.x,s.upperBound.y-=t.y}this.iteratorPool.release(r)},i.prototype.query=function(t,e){var r=this.stackPool.allocate();for(r.push(this.m_root);r.length>0;){var s=r.pop();if(s!=null&&Yt.testOverlap(s.aabb,t))if(s.isLeaf()){var n=e(s.id);if(n===!1)return}else r.push(s.child1),r.push(s.child2)}this.stackPool.release(r)},i.prototype.rayCast=function(t,e){var r=t.p1,s=t.p2,n=u.sub(s,r);n.normalize();var o=u.crossNumVec2(1,n),a=u.abs(o),l=t.maxFraction,c=new Yt,h=u.combine(1-l,r,l,s);c.combinePoints(r,h);var d=this.stackPool.allocate(),m=this.inputPool.allocate();for(d.push(this.m_root);d.length>0;){var f=d.pop();if(f!=null&&Yt.testOverlap(f.aabb,c)!==!1){var y=f.aabb.getCenter(),v=f.aabb.getExtents(),g=hh(u.dot(o,u.sub(r,y)))-u.dot(a,v);if(!(g>0))if(f.isLeaf()){m.p1=u.clone(t.p1),m.p2=u.clone(t.p2),m.maxFraction=l;var A=e(m,f.id);if(A===0)break;A>0&&(l=A,h=u.combine(1-l,r,l,s),c.combinePoints(r,h))}else d.push(f.child1),d.push(f.child2)}}this.stackPool.release(d),this.inputPool.release(m)},i}(),Kp=function(){function i(){this.parents=[],this.states=[]}return i.prototype.preorder=function(t){return this.parents.length=0,this.parents.push(t),this.states.length=0,this.states.push(0),this},i.prototype.next=function(){for(;this.parents.length>0;){var t=this.parents.length-1,e=this.parents[t];if(this.states[t]===0)return this.states[t]=1,e;if(this.states[t]===1&&(this.states[t]=2,e.child1))return this.parents.push(e.child1),this.states.push(1),e.child1;if(this.states[t]===2&&(this.states[t]=3,e.child2))return this.parents.push(e.child2),this.states.push(1),e.child2;this.parents.pop(),this.states.pop()}},i.prototype.close=function(){this.parents.length=0},i}(),Yp=Math.max,Gp=Math.min,Xp=function(){function i(){var t=this;this.m_tree=new Wp,this.m_moveBuffer=[],this.query=function(e,r){t.m_tree.query(e,r)},this.queryCallback=function(e){if(e===t.m_queryProxyId)return!0;var r=Gp(e,t.m_queryProxyId),s=Yp(e,t.m_queryProxyId),n=t.m_tree.getUserData(r),o=t.m_tree.getUserData(s);return t.m_callback(n,o),!0}}return i.prototype.getUserData=function(t){return this.m_tree.getUserData(t)},i.prototype.testOverlap=function(t,e){var r=this.m_tree.getFatAABB(t),s=this.m_tree.getFatAABB(e);return Yt.testOverlap(r,s)},i.prototype.getFatAABB=function(t){return this.m_tree.getFatAABB(t)},i.prototype.getProxyCount=function(){return this.m_moveBuffer.length},i.prototype.getTreeHeight=function(){return this.m_tree.getHeight()},i.prototype.getTreeBalance=function(){return this.m_tree.getMaxBalance()},i.prototype.getTreeQuality=function(){return this.m_tree.getAreaRatio()},i.prototype.rayCast=function(t,e){this.m_tree.rayCast(t,e)},i.prototype.shiftOrigin=function(t){this.m_tree.shiftOrigin(t)},i.prototype.createProxy=function(t,e){var r=this.m_tree.createProxy(t,e);return this.bufferMove(r),r},i.prototype.destroyProxy=function(t){this.unbufferMove(t),this.m_tree.destroyProxy(t)},i.prototype.moveProxy=function(t,e,r){var s=this.m_tree.moveProxy(t,e,r);s&&this.bufferMove(t)},i.prototype.touchProxy=function(t){this.bufferMove(t)},i.prototype.bufferMove=function(t){this.m_moveBuffer.push(t)},i.prototype.unbufferMove=function(t){for(var e=0;e<this.m_moveBuffer.length;++e)this.m_moveBuffer[e]===t&&(this.m_moveBuffer[e]=null)},i.prototype.updatePairs=function(t){for(this.m_callback=t;this.m_moveBuffer.length>0;)if(this.m_queryProxyId=this.m_moveBuffer.pop(),this.m_queryProxyId!==null){var e=this.m_tree.getFatAABB(this.m_queryProxyId);this.m_tree.query(e,this.queryCallback)}},i}(),od=Math.sin,ad=Math.cos,Rl=Math.sqrt;function I(i,t){return{x:i,y:t}}function Qp(i){return{s:od(i),c:ad(i)}}function Qt(i,t,e){return i.x=t,i.y=e,i}function D(i,t){return i.x=t.x,i.y=t.y,i}function G(i){return i.x=0,i.y=0,i}function wn(i){return i.x=-i.x,i.y=-i.y,i}function Oe(i,t){return i.x+=t.x,i.y+=t.y,i}function Zp(i,t,e){return i.x=t.x+e.x,i.y=t.x+e.y,i}function ji(i,t){return i.x-=t.x,i.y-=t.y,i}function rt(i,t,e){return i.x=t.x-e.x,i.y=t.y-e.y,i}function uh(i,t){return i.x*=t,i.y*=t,i}function $(i,t,e){return i.x=t*e.x,i.y=t*e.y,i}function ii(i,t,e){return i.x+=t*e.x,i.y+=t*e.y,i}function an(i,t,e){return i.x-=t*e.x,i.y-=t*e.y,i}function Bt(i,t,e,r,s){return i.x=t*e.x+r*s.x,i.y=t*e.y+r*s.y,i}function pi(i,t,e,r,s,n,o){return i.x=t*e.x+r*s.x+n*o.x,i.y=t*e.y+r*s.y+n*o.y,i}function $p(i){var t=Rl(i.x*i.x+i.y*i.y);if(t!==0){var e=1/t;i.x*=e,i.y*=e}return t}function ri(i){var t=Rl(i.x*i.x+i.y*i.y);if(t>0){var e=1/t;i.x*=e,i.y*=e}return i}function Vr(i,t,e){var r=e*t.y,s=-e*t.x;return i.x=r,i.y=s,i}function Be(i,t,e){var r=-t*e.y,s=t*e.x;return i.x=r,i.y=s,i}function lt(i,t){return i.x*t.y-i.y*t.x}function N(i,t){return i.x*t.x+i.y*t.y}function qr(i){return i.x*i.x+i.y*i.y}function ld(i,t){var e=i.x-t.x,r=i.y-t.y;return Rl(e*e+r*r)}function Ir(i,t){var e=i.x-t.x,r=i.y-t.y;return e*e+r*r}function tf(i,t){return i.c=ad(t),i.s=od(t),i}function Je(i,t,e){return i.x=t.c*e.x-t.s*e.y,i.y=t.s*e.x+t.c*e.y,i}function fs(i,t,e){var r=t.c*e.x+t.s*e.y,s=-t.s*e.x+t.c*e.y;return i.x=r,i.y=s,i}function ef(i,t,e,r){var s=t.c*r.x+t.s*r.y,n=-t.s*r.x+t.c*r.y,o=e.c*s-e.s*n,a=e.s*s+e.c*n;return i.x=o,i.y=a,i}function Wr(i,t,e){return{p:I(i,t),q:Qp(e)}}function Vo(i,t){return i.p.x=t.p.x,i.p.y=t.p.y,i.q.s=t.q.s,i.q.c=t.q.c,i}function it(i,t,e){var r=t.q.c*e.x-t.q.s*e.y+t.p.x,s=t.q.s*e.x+t.q.c*e.y+t.p.y;return i.x=r,i.y=s,i}function zl(i,t,e){var r=e.x-t.p.x,s=e.y-t.p.y,n=t.q.c*r+t.q.s*s,o=-t.q.s*r+t.q.c*s;return i.x=n,i.y=o,i}function hd(i,t,e,r){var s=t.q.c*r.x-t.q.s*r.y+t.p.x,n=t.q.s*r.x+t.q.c*r.y+t.p.y,o=s-e.p.x,a=n-e.p.y,l=e.q.c*o+e.q.s*a,c=-e.q.s*o+e.q.c*a;return i.x=l,i.y=c,i}function cd(i,t,e){var r=t.q.c*e.q.c+t.q.s*e.q.s,s=t.q.c*e.q.s-t.q.s*e.q.c,n=t.q.c*(e.p.x-t.p.x)+t.q.s*(e.p.y-t.p.y),o=-t.q.s*(e.p.x-t.p.x)+t.q.c*(e.p.y-t.p.y);return i.q.c=r,i.q.s=s,i.p.x=n,i.p.y=o,i}var mh=Math.sin,dh=Math.cos,rf=Math.atan2,L=function(){function i(t){if(!(this instanceof i))return new i(t);typeof t=="number"?this.setAngle(t):typeof t=="object"?this.setRot(t):this.setIdentity()}return i.neo=function(t){var e=Object.create(i.prototype);return e.setAngle(t),e},i.clone=function(t){var e=Object.create(i.prototype);return e.s=t.s,e.c=t.c,e},i.identity=function(){var t=Object.create(i.prototype);return t.s=0,t.c=1,t},i.isValid=function(t){return t===null||typeof t>"u"?!1:Number.isFinite(t.s)&&Number.isFinite(t.c)},i.assert=function(t){},i.prototype.setIdentity=function(){this.s=0,this.c=1},i.prototype.set=function(t){typeof t=="object"?(this.s=t.s,this.c=t.c):(this.s=mh(t),this.c=dh(t))},i.prototype.setRot=function(t){this.s=t.s,this.c=t.c},i.prototype.setAngle=function(t){this.s=mh(t),this.c=dh(t)},i.prototype.getAngle=function(){return rf(this.s,this.c)},i.prototype.getXAxis=function(){return u.neo(this.c,this.s)},i.prototype.getYAxis=function(){return u.neo(-this.s,this.c)},i.mul=function(t,e){if("c"in e&&"s"in e){var r=i.identity();return r.s=t.s*e.c+t.c*e.s,r.c=t.c*e.c-t.s*e.s,r}else if("x"in e&&"y"in e)return u.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},i.mulRot=function(t,e){var r=i.identity();return r.s=t.s*e.c+t.c*e.s,r.c=t.c*e.c-t.s*e.s,r},i.mulVec2=function(t,e){return u.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},i.mulSub=function(t,e,r){var s=t.c*(e.x-r.x)-t.s*(e.y-r.y),n=t.s*(e.x-r.x)+t.c*(e.y-r.y);return u.neo(s,n)},i.mulT=function(t,e){if("c"in e&&"s"in e){var r=i.identity();return r.s=t.c*e.s-t.s*e.c,r.c=t.c*e.c+t.s*e.s,r}else if("x"in e&&"y"in e)return u.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)},i.mulTRot=function(t,e){var r=i.identity();return r.s=t.c*e.s-t.s*e.c,r.c=t.c*e.c+t.s*e.s,r},i.mulTVec2=function(t,e){return u.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)},i}(),sf=Math.atan2,ph=Math.PI,gr=I(0,0),Os=function(){function i(){this.localCenter=u.zero(),this.c=u.zero(),this.a=0,this.alpha0=0,this.c0=u.zero(),this.a0=0}return i.prototype.recycle=function(){G(this.localCenter),G(this.c),this.a=0,this.alpha0=0,G(this.c0),this.a0=0},i.prototype.setTransform=function(t){it(gr,t,this.localCenter),D(this.c,gr),D(this.c0,gr),this.a=this.a0=sf(t.q.s,t.q.c)},i.prototype.setLocalCenter=function(t,e){D(this.localCenter,t),it(gr,e,this.localCenter),D(this.c,gr),D(this.c0,gr)},i.prototype.getTransform=function(t,e){e===void 0&&(e=0),tf(t.q,(1-e)*this.a0+e*this.a),Bt(t.p,1-e,this.c0,e,this.c),ji(t.p,Je(gr,t.q,this.localCenter))},i.prototype.advance=function(t){var e=(t-this.alpha0)/(1-this.alpha0);Bt(this.c0,e,this.c,1-e,this.c0),this.a0=e*this.a+(1-e)*this.a0,this.alpha0=t},i.prototype.forward=function(){this.a0=this.a,D(this.c0,this.c)},i.prototype.normalize=function(){var t=nd(this.a0,-ph,+ph);this.a-=this.a0-t,this.a0=t},i.prototype.set=function(t){D(this.localCenter,t.localCenter),D(this.c,t.c),this.a=t.a,this.alpha0=t.alpha0,D(this.c0,t.c0),this.a0=t.a0},i}(),si=function(){function i(t,e){if(!(this instanceof i))return new i(t,e);this.p=u.zero(),this.q=L.identity(),typeof t<"u"&&this.p.setVec2(t),typeof e<"u"&&this.q.setAngle(e)}return i.clone=function(t){var e=Object.create(i.prototype);return e.p=u.clone(t.p),e.q=L.clone(t.q),e},i.neo=function(t,e){var r=Object.create(i.prototype);return r.p=u.clone(t),r.q=L.clone(e),r},i.identity=function(){var t=Object.create(i.prototype);return t.p=u.zero(),t.q=L.identity(),t},i.prototype.setIdentity=function(){this.p.setZero(),this.q.setIdentity()},i.prototype.set=function(t,e){typeof e>"u"?(this.p.set(t.p),this.q.set(t.q)):(this.p.set(t),this.q.set(e))},i.prototype.setNum=function(t,e){this.p.setVec2(t),this.q.setAngle(e)},i.prototype.setTransform=function(t){this.p.setVec2(t.p),this.q.setRot(t.q)},i.isValid=function(t){return t===null||typeof t>"u"?!1:u.isValid(t.p)&&L.isValid(t.q)},i.assert=function(t){},i.mul=function(t,e){if(Array.isArray(e)){for(var r=[],s=0;s<e.length;s++)r[s]=i.mul(t,e[s]);return r}else{if("x"in e&&"y"in e)return i.mulVec2(t,e);if("p"in e&&"q"in e)return i.mulXf(t,e)}},i.mulAll=function(t,e){for(var r=[],s=0;s<e.length;s++)r[s]=i.mul(t,e[s]);return r},i.mulFn=function(t){return function(e){return i.mul(t,e)}},i.mulVec2=function(t,e){var r=t.q.c*e.x-t.q.s*e.y+t.p.x,s=t.q.s*e.x+t.q.c*e.y+t.p.y;return u.neo(r,s)},i.mulXf=function(t,e){var r=i.identity();return r.q=L.mulRot(t.q,e.q),r.p=u.add(L.mulVec2(t.q,e.p),t.p),r},i.mulT=function(t,e){if("x"in e&&"y"in e)return i.mulTVec2(t,e);if("p"in e&&"q"in e)return i.mulTXf(t,e)},i.mulTVec2=function(t,e){var r=e.x-t.p.x,s=e.y-t.p.y,n=t.q.c*r+t.q.s*s,o=-t.q.s*r+t.q.c*s;return u.neo(n,o)},i.mulTXf=function(t,e){var r=i.identity();return r.q.setRot(L.mulTRot(t.q,e.q)),r.p.setVec2(L.mulTVec2(t.q,u.sub(e.p,t.p))),r},i}(),nf=function(){function i(){this.v=u.zero(),this.w=0}return i}(),ud=Math.sin,md=Math.cos,of=function(){function i(){this.c=u.zero(),this.a=0}return i.prototype.getTransform=function(t,e){return t.q.c=md(this.a),t.q.s=ud(this.a),t.p.x=this.c.x-(t.q.c*e.x-t.q.s*e.y),t.p.y=this.c.y-(t.q.s*e.x+t.q.c*e.y),t},i}();function On(i,t,e,r){return i.q.c=md(r),i.q.s=ud(r),i.p.x=e.x-(i.q.c*t.x-i.q.s*t.y),i.p.y=e.y-(i.q.s*t.x+i.q.c*t.y),i}var Kr=function(){function i(){this.style={},this.appData={}}return i.isValid=function(t){return t===null||typeof t>"u"?!1:typeof t.m_type=="string"&&typeof t.m_radius=="number"},i}(),fh=new Yt,yh=new Yt,_h=I(0,0),af={userData:null,friction:.2,restitution:0,density:0,isSensor:!1,filterGroupIndex:0,filterCategoryBits:1,filterMaskBits:65535},vh=function(){function i(t,e){this.aabb=new Yt,this.fixture=t,this.childIndex=e,this.proxyId}return i}(),qo=function(){function i(t,e,r){this.style={},this.appData={},e.shape?(r=e,e=e.shape):typeof r=="number"&&(r={density:r}),r=qe(r,af),this.m_body=t,this.m_friction=r.friction,this.m_restitution=r.restitution,this.m_density=r.density,this.m_isSensor=r.isSensor,this.m_filterGroupIndex=r.filterGroupIndex,this.m_filterCategoryBits=r.filterCategoryBits,this.m_filterMaskBits=r.filterMaskBits,this.m_shape=e,this.m_next=null,this.m_proxies=[],this.m_proxyCount=0;for(var s=this.m_shape.getChildCount(),n=0;n<s;++n)this.m_proxies[n]=new vh(this,n);this.m_userData=r.userData}return i.prototype._reset=function(){var t=this.getBody(),e=t.m_world.m_broadPhase;this.destroyProxies(e),this.m_shape._reset&&this.m_shape._reset();for(var r=this.m_shape.getChildCount(),s=0;s<r;++s)this.m_proxies[s]=new vh(this,s);this.createProxies(e,t.m_xf),t.resetMassData()},i.prototype._serialize=function(){return{friction:this.m_friction,restitution:this.m_restitution,density:this.m_density,isSensor:this.m_isSensor,filterGroupIndex:this.m_filterGroupIndex,filterCategoryBits:this.m_filterCategoryBits,filterMaskBits:this.m_filterMaskBits,shape:this.m_shape}},i._deserialize=function(t,e,r){var s=r(Kr,t.shape),n=s&&new i(e,s,t);return n},i.prototype.getType=function(){return this.m_shape.m_type},i.prototype.getShape=function(){return this.m_shape},i.prototype.isSensor=function(){return this.m_isSensor},i.prototype.setSensor=function(t){t!=this.m_isSensor&&(this.m_body.setAwake(!0),this.m_isSensor=t)},i.prototype.getUserData=function(){return this.m_userData},i.prototype.setUserData=function(t){this.m_userData=t},i.prototype.getBody=function(){return this.m_body},i.prototype.getNext=function(){return this.m_next},i.prototype.getDensity=function(){return this.m_density},i.prototype.setDensity=function(t){this.m_density=t},i.prototype.getFriction=function(){return this.m_friction},i.prototype.setFriction=function(t){this.m_friction=t},i.prototype.getRestitution=function(){return this.m_restitution},i.prototype.setRestitution=function(t){this.m_restitution=t},i.prototype.testPoint=function(t){return this.m_shape.testPoint(this.m_body.getTransform(),t)},i.prototype.rayCast=function(t,e,r){return this.m_shape.rayCast(t,e,this.m_body.getTransform(),r)},i.prototype.getMassData=function(t){this.m_shape.computeMass(t,this.m_density)},i.prototype.getAABB=function(t){return this.m_proxies[t].aabb},i.prototype.createProxies=function(t,e){this.m_proxyCount=this.m_shape.getChildCount();for(var r=0;r<this.m_proxyCount;++r){var s=this.m_proxies[r];this.m_shape.computeAABB(s.aabb,e,r),s.proxyId=t.createProxy(s.aabb,s)}},i.prototype.destroyProxies=function(t){for(var e=0;e<this.m_proxyCount;++e){var r=this.m_proxies[e];t.destroyProxy(r.proxyId),r.proxyId=null}this.m_proxyCount=0},i.prototype.synchronize=function(t,e,r){for(var s=0;s<this.m_proxyCount;++s){var n=this.m_proxies[s];this.m_shape.computeAABB(fh,e,n.childIndex),this.m_shape.computeAABB(yh,r,n.childIndex),n.aabb.combine(fh,yh),rt(_h,r.p,e.p),t.moveProxy(n.proxyId,n.aabb,_h)}},i.prototype.setFilterData=function(t){this.m_filterGroupIndex=t.groupIndex,this.m_filterCategoryBits=t.categoryBits,this.m_filterMaskBits=t.maskBits,this.refilter()},i.prototype.getFilterGroupIndex=function(){return this.m_filterGroupIndex},i.prototype.setFilterGroupIndex=function(t){this.m_filterGroupIndex=t,this.refilter()},i.prototype.getFilterCategoryBits=function(){return this.m_filterCategoryBits},i.prototype.setFilterCategoryBits=function(t){this.m_filterCategoryBits=t,this.refilter()},i.prototype.getFilterMaskBits=function(){return this.m_filterMaskBits},i.prototype.setFilterMaskBits=function(t){this.m_filterMaskBits=t,this.refilter()},i.prototype.refilter=function(){if(this.m_body!=null){for(var t=this.m_body.getContactList();t;){var e=t.contact,r=e.getFixtureA(),s=e.getFixtureB();(r==this||s==this)&&e.flagForFiltering(),t=t.next}var n=this.m_body.getWorld();if(n!=null)for(var o=n.m_broadPhase,a=0;a<this.m_proxyCount;++a)o.touchProxy(this.m_proxies[a].proxyId)}},i.prototype.shouldCollide=function(t){if(t.m_filterGroupIndex===this.m_filterGroupIndex&&t.m_filterGroupIndex!==0)return t.m_filterGroupIndex>0;var e=(t.m_filterMaskBits&this.m_filterCategoryBits)!==0,r=(t.m_filterCategoryBits&this.m_filterMaskBits)!==0,s=e&&r;return s},i}(),ms="static",gh="kinematic",Ge="dynamic",Un=I(0,0),Ar=I(0,0),Jn=I(0,0),Hn=I(0,0),Ah=Wr(0,0,0),lf={type:ms,position:u.zero(),angle:0,linearVelocity:u.zero(),angularVelocity:0,linearDamping:0,angularDamping:0,fixedRotation:!1,bullet:!1,gravityScale:1,allowSleep:!0,awake:!0,active:!0,userData:null},_t=function(){function i(t,e){this.style={},this.appData={},e=qe(e,lf),this.m_world=t,this.m_awakeFlag=e.awake,this.m_autoSleepFlag=e.allowSleep,this.m_bulletFlag=e.bullet,this.m_fixedRotationFlag=e.fixedRotation,this.m_activeFlag=e.active,this.m_islandFlag=!1,this.m_toiFlag=!1,this.m_userData=e.userData,this.m_type=e.type,this.m_type==Ge?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_xf=si.identity(),this.m_xf.p.setVec2(e.position),this.m_xf.q.setAngle(e.angle),this.m_sweep=new Os,this.m_sweep.setTransform(this.m_xf),this.c_velocity=new nf,this.c_position=new of,this.m_force=u.zero(),this.m_torque=0,this.m_linearVelocity=u.clone(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_gravityScale=e.gravityScale,this.m_sleepTime=0,this.m_jointList=null,this.m_contactList=null,this.m_fixtureList=null,this.m_prev=null,this.m_next=null,this.m_destroyed=!1}return i.prototype._serialize=function(){for(var t=[],e=this.m_fixtureList;e;e=e.m_next)t.push(e);return{type:this.m_type,bullet:this.m_bulletFlag,position:this.m_xf.p,angle:this.m_xf.q.getAngle(),linearVelocity:this.m_linearVelocity,angularVelocity:this.m_angularVelocity,fixtures:t}},i._deserialize=function(t,e,r){var s=new i(e,t);if(t.fixtures)for(var n=t.fixtures.length-1;n>=0;n--){var o=r(qo,t.fixtures[n],s);s._addFixture(o)}return s},i.prototype.isWorldLocked=function(){return!!(this.m_world&&this.m_world.isLocked())},i.prototype.getWorld=function(){return this.m_world},i.prototype.getNext=function(){return this.m_next},i.prototype.setUserData=function(t){this.m_userData=t},i.prototype.getUserData=function(){return this.m_userData},i.prototype.getFixtureList=function(){return this.m_fixtureList},i.prototype.getJointList=function(){return this.m_jointList},i.prototype.getContactList=function(){return this.m_contactList},i.prototype.isStatic=function(){return this.m_type==ms},i.prototype.isDynamic=function(){return this.m_type==Ge},i.prototype.isKinematic=function(){return this.m_type==gh},i.prototype.setStatic=function(){return this.setType(ms),this},i.prototype.setDynamic=function(){return this.setType(Ge),this},i.prototype.setKinematic=function(){return this.setType(gh),this},i.prototype.getType=function(){return this.m_type},i.prototype.setType=function(t){if(this.isWorldLocked()!=!0&&this.m_type!=t){this.m_type=t,this.resetMassData(),this.m_type==ms&&(this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_sweep.forward(),this.synchronizeFixtures()),this.setAwake(!0),this.m_force.setZero(),this.m_torque=0;for(var e=this.m_contactList;e;){var r=e;e=e.next,this.m_world.destroyContact(r.contact)}this.m_contactList=null;for(var s=this.m_world.m_broadPhase,n=this.m_fixtureList;n;n=n.m_next)for(var o=0;o<n.m_proxyCount;++o)s.touchProxy(n.m_proxies[o].proxyId)}},i.prototype.isBullet=function(){return this.m_bulletFlag},i.prototype.setBullet=function(t){this.m_bulletFlag=!!t},i.prototype.isSleepingAllowed=function(){return this.m_autoSleepFlag},i.prototype.setSleepingAllowed=function(t){this.m_autoSleepFlag=!!t,this.m_autoSleepFlag==!1&&this.setAwake(!0)},i.prototype.isAwake=function(){return this.m_awakeFlag},i.prototype.setAwake=function(t){t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_force.setZero(),this.m_torque=0)},i.prototype.isActive=function(){return this.m_activeFlag},i.prototype.setActive=function(t){if(t!=this.m_activeFlag)if(this.m_activeFlag=!!t,this.m_activeFlag){for(var e=this.m_world.m_broadPhase,r=this.m_fixtureList;r;r=r.m_next)r.createProxies(e,this.m_xf);this.m_world.m_newFixture=!0}else{for(var e=this.m_world.m_broadPhase,r=this.m_fixtureList;r;r=r.m_next)r.destroyProxies(e);for(var s=this.m_contactList;s;){var n=s;s=s.next,this.m_world.destroyContact(n.contact)}this.m_contactList=null}},i.prototype.isFixedRotation=function(){return this.m_fixedRotationFlag},i.prototype.setFixedRotation=function(t){this.m_fixedRotationFlag!=t&&(this.m_fixedRotationFlag=!!t,this.m_angularVelocity=0,this.resetMassData())},i.prototype.getTransform=function(){return this.m_xf},i.prototype.setTransform=function(t,e){if(this.isWorldLocked()!=!0){typeof e=="number"?this.m_xf.setNum(t,e):this.m_xf.setTransform(t),this.m_sweep.setTransform(this.m_xf);for(var r=this.m_world.m_broadPhase,s=this.m_fixtureList;s;s=s.m_next)s.synchronize(r,this.m_xf,this.m_xf);this.setAwake(!0)}},i.prototype.synchronizeTransform=function(){this.m_sweep.getTransform(this.m_xf,1)},i.prototype.synchronizeFixtures=function(){this.m_sweep.getTransform(Ah,0);for(var t=this.m_world.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.synchronize(t,Ah,this.m_xf)},i.prototype.advance=function(t){this.m_sweep.advance(t),D(this.m_sweep.c,this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_sweep.getTransform(this.m_xf,1)},i.prototype.getPosition=function(){return this.m_xf.p},i.prototype.setPosition=function(t){this.setTransform(t,this.m_sweep.a)},i.prototype.getAngle=function(){return this.m_sweep.a},i.prototype.setAngle=function(t){this.setTransform(this.m_xf.p,t)},i.prototype.getWorldCenter=function(){return this.m_sweep.c},i.prototype.getLocalCenter=function(){return this.m_sweep.localCenter},i.prototype.getLinearVelocity=function(){return this.m_linearVelocity},i.prototype.getLinearVelocityFromWorldPoint=function(t){var e=u.sub(t,this.m_sweep.c);return u.add(this.m_linearVelocity,u.crossNumVec2(this.m_angularVelocity,e))},i.prototype.getLinearVelocityFromLocalPoint=function(t){return this.getLinearVelocityFromWorldPoint(this.getWorldPoint(t))},i.prototype.setLinearVelocity=function(t){this.m_type!=ms&&(u.dot(t,t)>0&&this.setAwake(!0),this.m_linearVelocity.setVec2(t))},i.prototype.getAngularVelocity=function(){return this.m_angularVelocity},i.prototype.setAngularVelocity=function(t){this.m_type!=ms&&(t*t>0&&this.setAwake(!0),this.m_angularVelocity=t)},i.prototype.getLinearDamping=function(){return this.m_linearDamping},i.prototype.setLinearDamping=function(t){this.m_linearDamping=t},i.prototype.getAngularDamping=function(){return this.m_angularDamping},i.prototype.setAngularDamping=function(t){this.m_angularDamping=t},i.prototype.getGravityScale=function(){return this.m_gravityScale},i.prototype.setGravityScale=function(t){this.m_gravityScale=t},i.prototype.getMass=function(){return this.m_mass},i.prototype.getInertia=function(){return this.m_I+this.m_mass*u.dot(this.m_sweep.localCenter,this.m_sweep.localCenter)},i.prototype.getMassData=function(t){t.mass=this.m_mass,t.I=this.getInertia(),D(t.center,this.m_sweep.localCenter)},i.prototype.resetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,G(this.m_sweep.localCenter),this.isStatic()||this.isKinematic()){D(this.m_sweep.c0,this.m_xf.p),D(this.m_sweep.c,this.m_xf.p),this.m_sweep.a0=this.m_sweep.a;return}G(Ar);for(var t=this.m_fixtureList;t;t=t.m_next)if(t.m_density!=0){var e={mass:0,center:I(0,0),I:0};t.getMassData(e),this.m_mass+=e.mass,ii(Ar,e.mass,e.center),this.m_I+=e.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,$(Ar,this.m_invMass,Ar)):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&this.m_fixedRotationFlag==!1?(this.m_I-=this.m_mass*N(Ar,Ar),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0),D(Un,this.m_sweep.c),this.m_sweep.setLocalCenter(Ar,this.m_xf),rt(Jn,this.m_sweep.c,Un),Be(Hn,this.m_angularVelocity,Jn),Oe(this.m_linearVelocity,Hn)},i.prototype.setMassData=function(t){this.isWorldLocked()!=!0&&this.m_type==Ge&&(this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&this.m_fixedRotationFlag==!1&&(this.m_I=t.I-this.m_mass*N(t.center,t.center),this.m_invI=1/this.m_I),D(Un,this.m_sweep.c),this.m_sweep.setLocalCenter(t.center,this.m_xf),rt(Jn,this.m_sweep.c,Un),Be(Hn,this.m_angularVelocity,Jn),Oe(this.m_linearVelocity,Hn))},i.prototype.applyForce=function(t,e,r){r===void 0&&(r=!0),this.m_type==Ge&&(r&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_force.add(t),this.m_torque+=u.crossVec2Vec2(u.sub(e,this.m_sweep.c),t)))},i.prototype.applyForceToCenter=function(t,e){e===void 0&&(e=!0),this.m_type==Ge&&(e&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&this.m_force.add(t))},i.prototype.applyTorque=function(t,e){e===void 0&&(e=!0),this.m_type==Ge&&(e&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))},i.prototype.applyLinearImpulse=function(t,e,r){r===void 0&&(r=!0),this.m_type==Ge&&(r&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.addMul(this.m_invMass,t),this.m_angularVelocity+=this.m_invI*u.crossVec2Vec2(u.sub(e,this.m_sweep.c),t)))},i.prototype.applyAngularImpulse=function(t,e){e===void 0&&(e=!0),this.m_type==Ge&&(e&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},i.prototype.shouldCollide=function(t){if(this.m_type!=Ge&&t.m_type!=Ge)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&e.joint.m_collideConnected==!1)return!1;return!0},i.prototype._addFixture=function(t){if(this.isWorldLocked()==!0)return null;if(this.m_activeFlag){var e=this.m_world.m_broadPhase;t.createProxies(e,this.m_xf)}return t.m_next=this.m_fixtureList,this.m_fixtureList=t,t.m_density>0&&this.resetMassData(),this.m_world.m_newFixture=!0,t},i.prototype.createFixture=function(t,e){if(this.isWorldLocked()==!0)return null;var r=new qo(this,t,e);return this._addFixture(r),r},i.prototype.destroyFixture=function(t){if(this.isWorldLocked()!=!0){if(this.m_fixtureList===t)this.m_fixtureList=t.m_next;else for(var e=this.m_fixtureList;e!=null;){if(e.m_next===t){e.m_next=t.m_next;break}e=e.m_next}for(var r=this.m_contactList;r;){var s=r.contact;r=r.next;var n=s.getFixtureA(),o=s.getFixtureB();(t==n||t==o)&&this.m_world.destroyContact(s)}if(this.m_activeFlag){var a=this.m_world.m_broadPhase;t.destroyProxies(a)}t.m_body=null,t.m_next=null,this.m_world.publish("remove-fixture",t),this.resetMassData()}},i.prototype.getWorldPoint=function(t){return si.mulVec2(this.m_xf,t)},i.prototype.getWorldVector=function(t){return L.mulVec2(this.m_xf.q,t)},i.prototype.getLocalPoint=function(t){return si.mulTVec2(this.m_xf,t)},i.prototype.getLocalVector=function(t){return L.mulTVec2(this.m_xf.q,t)},i.STATIC="static",i.KINEMATIC="kinematic",i.DYNAMIC="dynamic",i}(),xh=function(){function i(){this.other=null,this.joint=null,this.prev=null,this.next=null}return i}(),se=function(){function i(t,e,r){this.m_type="unknown-joint",this.m_prev=null,this.m_next=null,this.m_edgeA=new xh,this.m_edgeB=new xh,this.m_islandFlag=!1,this.style={},this.appData={},e="bodyA"in t?t.bodyA:e,r="bodyB"in t?t.bodyB:r,this.m_bodyA=e,this.m_bodyB=r,this.m_collideConnected=!!t.collideConnected,this.m_userData=t.userData}return i.prototype.isActive=function(){return this.m_bodyA.isActive()&&this.m_bodyB.isActive()},i.prototype.getType=function(){return this.m_type},i.prototype.getBodyA=function(){return this.m_bodyA},i.prototype.getBodyB=function(){return this.m_bodyB},i.prototype.getNext=function(){return this.m_next},i.prototype.getUserData=function(){return this.m_userData},i.prototype.setUserData=function(t){this.m_userData=t},i.prototype.getCollideConnected=function(){return this.m_collideConnected},i.prototype.shiftOrigin=function(t){},i.prototype._resetAnchors=function(t){return this._reset(t)},i}(),Mt={gjkCalls:0,gjkIters:0,gjkMaxIters:0,toiTime:0,toiMaxTime:0,toiCalls:0,toiIters:0,toiMaxIters:0,toiRootIters:0,toiMaxRootIters:0,toString:function(i){i=typeof i=="string"?i:`
`;var t="";for(var e in this)typeof this[e]!="function"&&typeof this[e]!="object"&&(t+=e+": "+this[e]+i);return t}},hf=function(){return Date.now()},cf=function(i){return Date.now()-i};const wh={now:hf,diff:cf};var uf=Math.max,Wn=I(0,0),Kn=I(0,0),we=I(0,0),Yn=I(0,0),sa=I(0,0),mf=I(0,0),df=I(0,0);Mt.gjkCalls=0;Mt.gjkIters=0;Mt.gjkMaxIters=0;var Nl=function(){function i(){this.proxyA=new Nr,this.proxyB=new Nr,this.transformA=si.identity(),this.transformB=si.identity(),this.useRadii=!1}return i.prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.transformA.setIdentity(),this.transformB.setIdentity(),this.useRadii=!1},i}(),Ol=function(){function i(){this.pointA=I(0,0),this.pointB=I(0,0),this.distance=0,this.iterations=0}return i.prototype.recycle=function(){G(this.pointA),G(this.pointB),this.distance=0,this.iterations=0},i}(),Ul=function(){function i(){this.metric=0,this.indexA=[],this.indexB=[],this.count=0}return i.prototype.recycle=function(){this.metric=0,this.indexA.length=0,this.indexB.length=0,this.count=0},i}(),Yr=function(i,t,e){++Mt.gjkCalls;var r=e.proxyA,s=e.proxyB,n=e.transformA,o=e.transformB;Xe.recycle(),Xe.readCache(t,r,n,s,o);for(var a=Xe.m_v,l=H.maxDistanceIterations,c=[],h=[],d=0,m=0;m<l;){d=Xe.m_count;for(var f=0;f<d;++f)c[f]=a[f].indexA,h[f]=a[f].indexB;if(Xe.solve(),Xe.m_count===3)break;var y=Xe.getSearchDirection();if(qr(y)<Ee*Ee)break;var v=a[Xe.m_count];v.indexA=r.getSupport(fs(Wn,n.q,$(Wn,-1,y))),it(v.wA,n,r.getVertex(v.indexA)),v.indexB=s.getSupport(fs(Wn,o.q,y)),it(v.wB,o,s.getVertex(v.indexB)),rt(v.w,v.wB,v.wA),++m,++Mt.gjkIters;for(var g=!1,f=0;f<d;++f)if(v.indexA===c[f]&&v.indexB===h[f]){g=!0;break}if(g)break;++Xe.m_count}if(Mt.gjkMaxIters=uf(Mt.gjkMaxIters,m),Xe.getWitnessPoints(i.pointA,i.pointB),i.distance=ld(i.pointA,i.pointB),i.iterations=m,Xe.writeCache(t),e.useRadii){var A=r.m_radius,B=s.m_radius;if(i.distance>A+B&&i.distance>Ee)i.distance-=A+B,rt(Kn,i.pointB,i.pointA),ri(Kn),ii(i.pointA,A,Kn),an(i.pointB,B,Kn);else{var F=rt(Wn,i.pointA,i.pointB);D(i.pointA,F),D(i.pointB,F),i.distance=0}}},Nr=function(){function i(){this.m_vertices=[],this.m_count=0,this.m_radius=0}return i.prototype.recycle=function(){this.m_vertices.length=0,this.m_count=0,this.m_radius=0},i.prototype.getVertexCount=function(){return this.m_count},i.prototype.getVertex=function(t){return this.m_vertices[t]},i.prototype.getSupport=function(t){for(var e=-1,r=-1/0,s=0;s<this.m_count;++s){var n=N(this.m_vertices[s],t);n>r&&(e=s,r=n)}return e},i.prototype.getSupportVertex=function(t){return this.m_vertices[this.getSupport(t)]},i.prototype.set=function(t,e){t.computeDistanceProxy(this,e)},i.prototype.setVertices=function(t,e,r){this.m_vertices=t,this.m_count=e,this.m_radius=r},i}(),na=function(){function i(){this.wA=I(0,0),this.indexA=0,this.wB=I(0,0),this.indexB=0,this.w=I(0,0),this.a=0}return i.prototype.recycle=function(){this.indexA=0,this.indexB=0,G(this.wA),G(this.wB),G(this.w),this.a=0},i.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,D(this.wA,t.wA),D(this.wB,t.wB),D(this.w,t.w),this.a=t.a},i}(),Gn=I(0,0),Gs=I(0,0),pf=function(){function i(){this.m_v1=new na,this.m_v2=new na,this.m_v3=new na,this.m_v=[this.m_v1,this.m_v2,this.m_v3]}return i.prototype.recycle=function(){this.m_v1.recycle(),this.m_v2.recycle(),this.m_v3.recycle(),this.m_count=0},i.prototype.toString=function(){return this.m_count===3?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y,this.m_v3.a,this.m_v3.wA.x,this.m_v3.wA.y,this.m_v3.wB.x,this.m_v3.wB.y].toString():this.m_count===2?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y].toString():this.m_count===1?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y].toString():"+"+this.m_count},i.prototype.readCache=function(t,e,r,s,n){this.m_count=t.count;for(var o=0;o<this.m_count;++o){var a=this.m_v[o];a.indexA=t.indexA[o],a.indexB=t.indexB[o];var l=e.getVertex(a.indexA),c=s.getVertex(a.indexB);it(a.wA,r,l),it(a.wB,n,c),rt(a.w,a.wB,a.wA),a.a=0}if(this.m_count>1){var h=t.metric,d=this.getMetric();(d<.5*h||2*h<d||d<Ee)&&(this.m_count=0)}if(this.m_count===0){var a=this.m_v[0];a.indexA=0,a.indexB=0;var l=e.getVertex(0),c=s.getVertex(0);it(a.wA,r,l),it(a.wB,n,c),rt(a.w,a.wB,a.wA),a.a=1,this.m_count=1}},i.prototype.writeCache=function(t){t.metric=this.getMetric(),t.count=this.m_count;for(var e=0;e<this.m_count;++e)t.indexA[e]=this.m_v[e].indexA,t.indexB[e]=this.m_v[e].indexB},i.prototype.getSearchDirection=function(){var t=this.m_v1,e=this.m_v2;switch(this.m_v3,this.m_count){case 1:return Qt(Gn,-t.w.x,-t.w.y);case 2:{rt(we,e.w,t.w);var r=-lt(we,t.w);return r>0?Qt(Gn,-we.y,we.x):Qt(Gn,we.y,-we.x)}default:return G(Gn)}},i.prototype.getClosestPoint=function(){var t=this.m_v1,e=this.m_v2;switch(this.m_v3,this.m_count){case 0:return G(Gs);case 1:return D(Gs,t.w);case 2:return Bt(Gs,t.a,t.w,e.a,e.w);case 3:return G(Gs);default:return G(Gs)}},i.prototype.getWitnessPoints=function(t,e){var r=this.m_v1,s=this.m_v2,n=this.m_v3;switch(this.m_count){case 0:break;case 1:D(t,r.wA),D(e,r.wB);break;case 2:Bt(t,r.a,r.wA,s.a,s.wA),Bt(e,r.a,r.wB,s.a,s.wB);break;case 3:pi(t,r.a,r.wA,s.a,s.wA,n.a,n.wA),D(e,t);break}},i.prototype.getMetric=function(){switch(this.m_count){case 0:return 0;case 1:return 0;case 2:return ld(this.m_v1.w,this.m_v2.w);case 3:return lt(rt(mf,this.m_v2.w,this.m_v1.w),rt(df,this.m_v3.w,this.m_v1.w));default:return 0}},i.prototype.solve=function(){switch(this.m_count){case 1:break;case 2:this.solve2();break;case 3:this.solve3();break}},i.prototype.solve2=function(){var t=this.m_v1.w,e=this.m_v2.w;rt(we,e,t);var r=-N(t,we);if(r<=0){this.m_v1.a=1,this.m_count=1;return}var s=N(e,we);if(s<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.set(this.m_v2);return}var n=1/(s+r);this.m_v1.a=s*n,this.m_v2.a=r*n,this.m_count=2},i.prototype.solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,r=this.m_v3.w;rt(we,e,t);var s=N(t,we),n=N(e,we),o=n,a=-s;rt(Yn,r,t);var l=N(t,Yn),c=N(r,Yn),h=c,d=-l;rt(sa,r,e);var m=N(e,sa),f=N(r,sa),y=f,v=-m,g=lt(we,Yn),A=g*lt(e,r),B=g*lt(r,t),F=g*lt(t,e);if(a<=0&&d<=0){this.m_v1.a=1,this.m_count=1;return}if(o>0&&a>0&&F<=0){var E=1/(o+a);this.m_v1.a=o*E,this.m_v2.a=a*E,this.m_count=2;return}if(h>0&&d>0&&B<=0){var k=1/(h+d);this.m_v1.a=h*k,this.m_v3.a=d*k,this.m_count=2,this.m_v2.set(this.m_v3);return}if(o<=0&&v<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.set(this.m_v2);return}if(h<=0&&y<=0){this.m_v3.a=1,this.m_count=1,this.m_v1.set(this.m_v3);return}if(y>0&&v>0&&A<=0){var w=1/(y+v);this.m_v2.a=y*w,this.m_v3.a=v*w,this.m_count=2,this.m_v1.set(this.m_v3);return}var b=1/(A+B+F);this.m_v1.a=A*b,this.m_v2.a=B*b,this.m_v3.a=F*b,this.m_count=3},i}(),Xe=new pf,xr=new Nl,bh=new Ul,oa=new Ol,Jl=function(i,t,e,r,s,n){return xr.recycle(),xr.proxyA.set(i,t),xr.proxyB.set(e,r),Vo(xr.transformA,s),Vo(xr.transformB,n),xr.useRadii=!0,oa.recycle(),bh.recycle(),Yr(oa,bh,xr),oa.distance<10*Ee};Yr.testOverlap=Jl;Yr.Input=Nl;Yr.Output=Ol;Yr.Proxy=Nr;Yr.Cache=Ul;(function(){function i(){this.proxyA=new Nr,this.proxyB=new Nr,this.transformA=si.identity(),this.transformB=si.identity(),this.translationB=u.zero()}return i.prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.transformA.setIdentity(),this.transformB.setIdentity(),G(this.translationB)},i})();var ff=Math.abs,Xn=Math.max,dd=function(){function i(){this.proxyA=new Nr,this.proxyB=new Nr,this.sweepA=new Os,this.sweepB=new Os}return i.prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.sweepA.recycle(),this.sweepB.recycle(),this.tMax=-1},i}(),Ue;(function(i){i[i.e_unset=-1]="e_unset",i[i.e_unknown=0]="e_unknown",i[i.e_failed=1]="e_failed",i[i.e_overlapped=2]="e_overlapped",i[i.e_touching=3]="e_touching",i[i.e_separated=4]="e_separated"})(Ue||(Ue={}));var pd=function(){function i(){this.state=Ue.e_unset,this.t=-1}return i.prototype.recycle=function(){this.state=Ue.e_unset,this.t=-1},i}();Mt.toiTime=0;Mt.toiMaxTime=0;Mt.toiCalls=0;Mt.toiIters=0;Mt.toiMaxIters=0;Mt.toiRootIters=0;Mt.toiMaxRootIters=0;var Qr=new Nl,aa=new Ol,la=new Ul,ue=Wr(0,0,0),me=Wr(0,0,0),Xs=I(0,0),hi=I(0,0),Te=I(0,0),ce=I(0,0),Qn=I(0,0),Zn=I(0,0),$n=I(0,0),to=I(0,0),Hl=function(i,t){var e=wh.now();++Mt.toiCalls,i.state=Ue.e_unknown,i.t=t.tMax;var r=t.proxyA,s=t.proxyB,n=t.sweepA,o=t.sweepB;n.normalize(),o.normalize();var a=t.tMax,l=r.m_radius+s.m_radius,c=Xn(H.linearSlop,l-3*H.linearSlop),h=.25*H.linearSlop,d=0,m=H.maxTOIIterations,f=0;for(la.recycle(),Qr.proxyA.setVertices(r.m_vertices,r.m_count,r.m_radius),Qr.proxyB.setVertices(s.m_vertices,s.m_count,s.m_radius),Qr.useRadii=!1;;){if(n.getTransform(ue,d),o.getTransform(me,d),Vo(Qr.transformA,ue),Vo(Qr.transformB,me),Yr(aa,la,Qr),aa.distance<=0){i.state=Ue.e_overlapped,i.t=0;break}if(aa.distance<c+h){i.state=Ue.e_touching,i.t=d;break}Qs.initialize(la,r,n,s,o,d);for(var y=!1,v=a,g=0;;){var A=Qs.findMinSeparation(v);if(A>c+h){i.state=Ue.e_separated,i.t=a,y=!0;break}if(A>c-h){d=v;break}var B=Qs.evaluate(d);if(B<c-h){i.state=Ue.e_failed,i.t=d,y=!0;break}if(B<=c+h){i.state=Ue.e_touching,i.t=d,y=!0;break}for(var F=0,E=d,k=v;;){var w=void 0;F&1?w=E+(c-B)*(k-E)/(A-B):w=.5*(E+k),++F,++Mt.toiRootIters;var b=Qs.evaluate(w);if(ff(b-c)<h){v=w;break}if(b>c?(E=w,B=b):(k=w,A=b),F===50)break}if(Mt.toiMaxRootIters=Xn(Mt.toiMaxRootIters,F),++g,g===H.maxPolygonVertices)break}if(++f,++Mt.toiIters,y)break;if(f===m){i.state=Ue.e_failed,i.t=d;break}}Mt.toiMaxIters=Xn(Mt.toiMaxIters,f);var M=wh.diff(e);Mt.toiMaxTime=Xn(Mt.toiMaxTime,M),Mt.toiTime+=M,Qs.recycle()},fi;(function(i){i[i.e_unset=-1]="e_unset",i[i.e_points=1]="e_points",i[i.e_faceA=2]="e_faceA",i[i.e_faceB=3]="e_faceB"})(fi||(fi={}));var yf=function(){function i(){this.m_proxyA=null,this.m_proxyB=null,this.m_sweepA=null,this.m_sweepB=null,this.m_type=fi.e_unset,this.m_localPoint=I(0,0),this.m_axis=I(0,0),this.indexA=-1,this.indexB=-1}return i.prototype.recycle=function(){this.m_proxyA=null,this.m_proxyB=null,this.m_sweepA=null,this.m_sweepB=null,this.m_type=fi.e_unset,G(this.m_localPoint),G(this.m_axis),this.indexA=-1,this.indexB=-1},i.prototype.initialize=function(t,e,r,s,n,o){var a=t.count;if(this.m_proxyA=e,this.m_proxyB=s,this.m_sweepA=r,this.m_sweepB=n,this.m_sweepA.getTransform(ue,o),this.m_sweepB.getTransform(me,o),a===1){this.m_type=fi.e_points;var l=this.m_proxyA.getVertex(t.indexA[0]),c=this.m_proxyB.getVertex(t.indexB[0]);it(hi,ue,l),it(Te,me,c),rt(this.m_axis,Te,hi);var h=$p(this.m_axis);return h}else if(t.indexA[0]===t.indexA[1]){this.m_type=fi.e_faceB;var d=s.getVertex(t.indexB[0]),m=s.getVertex(t.indexB[1]);Vr(this.m_axis,rt(Xs,m,d),1),ri(this.m_axis),Je(ce,me.q,this.m_axis),Bt(this.m_localPoint,.5,d,.5,m),it(Te,me,this.m_localPoint);var f=e.getVertex(t.indexA[0]),y=si.mulVec2(ue,f),h=N(y,ce)-N(Te,ce);return h<0&&(wn(this.m_axis),h=-h),h}else{this.m_type=fi.e_faceA;var v=this.m_proxyA.getVertex(t.indexA[0]),g=this.m_proxyA.getVertex(t.indexA[1]);Vr(this.m_axis,rt(Xs,g,v),1),ri(this.m_axis),Je(ce,ue.q,this.m_axis),Bt(this.m_localPoint,.5,v,.5,g),it(hi,ue,this.m_localPoint);var A=this.m_proxyB.getVertex(t.indexB[0]);it(Te,me,A);var h=N(Te,ce)-N(hi,ce);return h<0&&(wn(this.m_axis),h=-h),h}},i.prototype.compute=function(t,e){switch(this.m_sweepA.getTransform(ue,e),this.m_sweepB.getTransform(me,e),this.m_type){case fi.e_points:{t&&(fs(Qn,ue.q,this.m_axis),fs(Zn,me.q,$(Xs,-1,this.m_axis)),this.indexA=this.m_proxyA.getSupport(Qn),this.indexB=this.m_proxyB.getSupport(Zn)),D($n,this.m_proxyA.getVertex(this.indexA)),D(to,this.m_proxyB.getVertex(this.indexB)),it(hi,ue,$n),it(Te,me,to);var r=N(Te,this.m_axis)-N(hi,this.m_axis);return r}case fi.e_faceA:{Je(ce,ue.q,this.m_axis),it(hi,ue,this.m_localPoint),t&&(fs(Zn,me.q,$(Xs,-1,ce)),this.indexA=-1,this.indexB=this.m_proxyB.getSupport(Zn)),D(to,this.m_proxyB.getVertex(this.indexB)),it(Te,me,to);var r=N(Te,ce)-N(hi,ce);return r}case fi.e_faceB:{Je(ce,me.q,this.m_axis),it(Te,me,this.m_localPoint),t&&(fs(Qn,ue.q,$(Xs,-1,ce)),this.indexB=-1,this.indexA=this.m_proxyA.getSupport(Qn)),D($n,this.m_proxyA.getVertex(this.indexA)),it(hi,ue,$n);var r=N(hi,ce)-N(Te,ce);return r}default:return t&&(this.indexA=-1,this.indexB=-1),0}},i.prototype.findMinSeparation=function(t){return this.compute(!0,t)},i.prototype.evaluate=function(t){return this.compute(!1,t)},i}(),Qs=new yf;Hl.Input=dd;Hl.Output=pd;var Bh=Math.abs,Ch=Math.sqrt,eo=Math.min,Wl=function(){function i(){this.dt=0,this.inv_dt=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1,this.blockSolve=!0,this.inv_dt0=0,this.dtRatio=1}return i.prototype.reset=function(t){this.dt>0&&(this.inv_dt0=this.inv_dt),this.dt=t,this.inv_dt=t==0?0:1/t,this.dtRatio=t*this.inv_dt0},i}(),Zr=new Wl,Ei=I(0,0),$t=I(0,0),io=I(0,0),$r=new dd,ha=new pd,kh=new Os,Mh=new Os,Fh=new Os,_f=function(){function i(t){this.contact=t,this.normals=[],this.tangents=[]}return i.prototype.recycle=function(){this.normals.length=0,this.tangents.length=0},Object.defineProperty(i.prototype,"normalImpulses",{get:function(){var t=this.contact,e=this.normals;e.length=0;for(var r=0;r<t.v_points.length;++r)e.push(t.v_points[r].normalImpulse);return e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"tangentImpulses",{get:function(){var t=this.contact,e=this.tangents;e.length=0;for(var r=0;r<t.v_points.length;++r)e.push(t.v_points[r].tangentImpulse);return e},enumerable:!1,configurable:!0}),i}(),fd=function(){function i(t){this.m_world=t,this.m_stack=[],this.m_bodies=[],this.m_contacts=[],this.m_joints=[]}return i.prototype.clear=function(){this.m_stack.length=0,this.m_bodies.length=0,this.m_contacts.length=0,this.m_joints.length=0},i.prototype.addBody=function(t){this.m_bodies.push(t)},i.prototype.addContact=function(t){this.m_contacts.push(t)},i.prototype.addJoint=function(t){this.m_joints.push(t)},i.prototype.solveWorld=function(t){for(var e=this.m_world,r=e.m_bodyList;r;r=r.m_next)r.m_islandFlag=!1;for(var s=e.m_contactList;s;s=s.m_next)s.m_islandFlag=!1;for(var n=e.m_jointList;n;n=n.m_next)n.m_islandFlag=!1;for(var o=this.m_stack,a=e.m_bodyList;a;a=a.m_next)if(!a.m_islandFlag&&!(a.isAwake()==!1||a.isActive()==!1)&&!a.isStatic()){for(this.clear(),o.push(a),a.m_islandFlag=!0;o.length>0;){var r=o.pop();if(this.addBody(r),r.m_awakeFlag=!0,!r.isStatic()){for(var l=r.m_contactList;l;l=l.next){var c=l.contact;if(!c.m_islandFlag&&!(c.isEnabled()==!1||c.isTouching()==!1)){var h=c.m_fixtureA.m_isSensor,d=c.m_fixtureB.m_isSensor;if(!(h||d)){this.addContact(c),c.m_islandFlag=!0;var m=l.other;m.m_islandFlag||(o.push(m),m.m_islandFlag=!0)}}}for(var f=r.m_jointList;f;f=f.next)if(f.joint.m_islandFlag!=!0){var m=f.other;m.isActive()!=!1&&(this.addJoint(f.joint),f.joint.m_islandFlag=!0,!m.m_islandFlag&&(o.push(m),m.m_islandFlag=!0))}}}this.solveIsland(t);for(var y=0;y<this.m_bodies.length;++y){var r=this.m_bodies[y];r.isStatic()&&(r.m_islandFlag=!1)}}},i.prototype.solveIsland=function(t){for(var e=this.m_world,r=e.m_gravity,s=e.m_allowSleep,n=t.dt,o=0;o<this.m_bodies.length;++o){var a=this.m_bodies[o];D(Ei,a.m_sweep.c);var l=a.m_sweep.a;D($t,a.m_linearVelocity);var c=a.m_angularVelocity;D(a.m_sweep.c0,a.m_sweep.c),a.m_sweep.a0=a.m_sweep.a,a.isDynamic()&&(ii($t,n*a.m_gravityScale,r),ii($t,n*a.m_invMass,a.m_force),c+=n*a.m_invI*a.m_torque,$($t,1/(1+n*a.m_linearDamping),$t),c*=1/(1+n*a.m_angularDamping)),D(a.c_position.c,Ei),a.c_position.a=l,D(a.c_velocity.v,$t),a.c_velocity.w=c}for(var o=0;o<this.m_contacts.length;++o){var h=this.m_contacts[o];h.initConstraint(t)}for(var o=0;o<this.m_contacts.length;++o){var h=this.m_contacts[o];h.initVelocityConstraint(t)}if(t.warmStarting)for(var o=0;o<this.m_contacts.length;++o){var h=this.m_contacts[o];h.warmStartConstraint(t)}for(var o=0;o<this.m_joints.length;++o){var d=this.m_joints[o];d.initVelocityConstraints(t)}for(var o=0;o<t.velocityIterations;++o){for(var m=0;m<this.m_joints.length;++m){var d=this.m_joints[m];d.solveVelocityConstraints(t)}for(var m=0;m<this.m_contacts.length;++m){var h=this.m_contacts[m];h.solveVelocityConstraint(t)}}for(var o=0;o<this.m_contacts.length;++o){var h=this.m_contacts[o];h.storeConstraintImpulses(t)}for(var o=0;o<this.m_bodies.length;++o){var a=this.m_bodies[o];D(Ei,a.c_position.c);var l=a.c_position.a;D($t,a.c_velocity.v);var c=a.c_velocity.w;$(io,n,$t);var f=qr(io);if(f>H.maxTranslationSquared){var y=H.maxTranslation/Ch(f);uh($t,y)}var v=n*c;if(v*v>H.maxRotationSquared){var y=H.maxRotation/Bh(v);c*=y}ii(Ei,n,$t),l+=n*c,D(a.c_position.c,Ei),a.c_position.a=l,D(a.c_velocity.v,$t),a.c_velocity.w=c}for(var g=!1,o=0;o<t.positionIterations;++o){for(var A=0,m=0;m<this.m_contacts.length;++m){var h=this.m_contacts[m],B=h.solvePositionConstraint(t);A=eo(A,B)}for(var F=A>=-3*H.linearSlop,E=!0,m=0;m<this.m_joints.length;++m){var d=this.m_joints[m],k=d.solvePositionConstraints(t);E=E&&k}if(F&&E){g=!0;break}}for(var o=0;o<this.m_bodies.length;++o){var a=this.m_bodies[o];D(a.m_sweep.c,a.c_position.c),a.m_sweep.a=a.c_position.a,D(a.m_linearVelocity,a.c_velocity.v),a.m_angularVelocity=a.c_velocity.w,a.synchronizeTransform()}if(this.postSolveIsland(),s){for(var w=1/0,b=H.linearSleepToleranceSqr,M=H.angularSleepToleranceSqr,o=0;o<this.m_bodies.length;++o){var a=this.m_bodies[o];a.isStatic()||(a.m_autoSleepFlag==!1||a.m_angularVelocity*a.m_angularVelocity>M||qr(a.m_linearVelocity)>b?(a.m_sleepTime=0,w=0):(a.m_sleepTime+=n,w=eo(w,a.m_sleepTime)))}if(w>=H.timeToSleep&&g)for(var o=0;o<this.m_bodies.length;++o){var a=this.m_bodies[o];a.setAwake(!1)}}},i.prototype.solveWorldTOI=function(t){var e=this.m_world;if(e.m_stepComplete){for(var r=e.m_bodyList;r;r=r.m_next)r.m_islandFlag=!1,r.m_sweep.alpha0=0;for(var s=e.m_contactList;s;s=s.m_next)s.m_toiFlag=!1,s.m_islandFlag=!1,s.m_toiCount=0,s.m_toi=1}for(;;){for(var n=null,o=1,a=e.m_contactList;a;a=a.m_next)if(a.isEnabled()!=!1&&!(a.m_toiCount>H.maxSubSteps)){var l=1;if(a.m_toiFlag)l=a.m_toi;else{var c=a.getFixtureA(),h=a.getFixtureB();if(c.isSensor()||h.isSensor())continue;var d=c.getBody(),m=h.getBody(),f=d.isAwake()&&!d.isStatic(),y=m.isAwake()&&!m.isStatic();if(f==!1&&y==!1)continue;var v=d.isBullet()||!d.isDynamic(),g=m.isBullet()||!m.isDynamic();if(v==!1&&g==!1)continue;var A=d.m_sweep.alpha0;d.m_sweep.alpha0<m.m_sweep.alpha0?(A=m.m_sweep.alpha0,d.m_sweep.advance(A)):m.m_sweep.alpha0<d.m_sweep.alpha0&&(A=d.m_sweep.alpha0,m.m_sweep.advance(A));var B=a.getChildIndexA(),F=a.getChildIndexB();d.m_sweep,m.m_sweep,$r.proxyA.set(c.getShape(),B),$r.proxyB.set(h.getShape(),F),$r.sweepA.set(d.m_sweep),$r.sweepB.set(m.m_sweep),$r.tMax=1,Hl(ha,$r);var E=ha.t;ha.state==Ue.e_touching?l=eo(A+(1-A)*E,1):l=1,a.m_toi=l,a.m_toiFlag=!0}l<o&&(n=a,o=l)}if(n==null||1-10*Ee<o){e.m_stepComplete=!0;break}var k=n.getFixtureA(),w=n.getFixtureB(),b=k.getBody(),M=w.getBody();if(Mh.set(b.m_sweep),Fh.set(M.m_sweep),b.advance(o),M.advance(o),n.update(e),n.m_toiFlag=!1,++n.m_toiCount,n.isEnabled()==!1||n.isTouching()==!1){n.setEnabled(!1),b.m_sweep.set(Mh),M.m_sweep.set(Fh),b.synchronizeTransform(),M.synchronizeTransform();continue}b.setAwake(!0),M.setAwake(!0),this.clear(),this.addBody(b),this.addBody(M),this.addContact(n),b.m_islandFlag=!0,M.m_islandFlag=!0,n.m_islandFlag=!0;for(var V=[b,M],T=0;T<V.length;++T){var z=V[T];if(z.isDynamic())for(var O=z.m_contactList;O;O=O.next){var J=O.contact;if(!J.m_islandFlag){var W=O.other;if(!(W.isDynamic()&&!z.isBullet()&&!W.isBullet())){var tt=J.m_fixtureA.m_isSensor,K=J.m_fixtureB.m_isSensor;if(!(tt||K)){if(kh.set(W.m_sweep),W.m_islandFlag==!1&&W.advance(o),J.update(e),J.isEnabled()==!1||J.isTouching()==!1){W.m_sweep.set(kh),W.synchronizeTransform();continue}J.m_islandFlag=!0,this.addContact(J),!W.m_islandFlag&&(W.m_islandFlag=!0,W.isStatic()||W.setAwake(!0),this.addBody(W))}}}}}Zr.reset((1-o)*t.dt),Zr.dtRatio=1,Zr.positionIterations=20,Zr.velocityIterations=t.velocityIterations,Zr.warmStarting=!1,this.solveIslandTOI(Zr,b,M);for(var T=0;T<this.m_bodies.length;++T){var z=this.m_bodies[T];if(z.m_islandFlag=!1,!!z.isDynamic()){z.synchronizeFixtures();for(var O=z.m_contactList;O;O=O.next)O.contact.m_toiFlag=!1,O.contact.m_islandFlag=!1}}if(e.findNewContacts(),e.m_subStepping){e.m_stepComplete=!1;break}}},i.prototype.solveIslandTOI=function(t,e,r){for(var h=0;h<this.m_bodies.length;++h){var s=this.m_bodies[h];D(s.c_position.c,s.m_sweep.c),s.c_position.a=s.m_sweep.a,D(s.c_velocity.v,s.m_linearVelocity),s.c_velocity.w=s.m_angularVelocity}for(var h=0;h<this.m_contacts.length;++h){var n=this.m_contacts[h];n.initConstraint(t)}for(var h=0;h<t.positionIterations;++h){for(var o=0,a=0;a<this.m_contacts.length;++a){var n=this.m_contacts[a],l=n.solvePositionConstraintTOI(t,e,r);o=eo(o,l)}var c=o>=-1.5*H.linearSlop;if(c)break}var h;D(e.m_sweep.c0,e.c_position.c),e.m_sweep.a0=e.c_position.a,D(r.m_sweep.c0,r.c_position.c),r.m_sweep.a0=r.c_position.a;for(var h=0;h<this.m_contacts.length;++h){var n=this.m_contacts[h];n.initVelocityConstraint(t)}for(var h=0;h<t.velocityIterations;++h)for(var a=0;a<this.m_contacts.length;++a){var n=this.m_contacts[a];n.solveVelocityConstraint(t)}for(var d=t.dt,h=0;h<this.m_bodies.length;++h){var s=this.m_bodies[h];D(Ei,s.c_position.c);var m=s.c_position.a;D($t,s.c_velocity.v);var f=s.c_velocity.w;$(io,d,$t);var y=qr(io);if(y>H.maxTranslationSquared){var v=H.maxTranslation/Ch(y);uh($t,v)}var g=d*f;if(g*g>H.maxRotationSquared){var v=H.maxRotation/Bh(g);f*=v}ii(Ei,d,$t),m+=d*f,D(s.c_position.c,Ei),s.c_position.a=m,D(s.c_velocity.v,$t),s.c_velocity.w=f,D(s.m_sweep.c,Ei),s.m_sweep.a=m,D(s.m_linearVelocity,$t),s.m_angularVelocity=f,s.synchronizeTransform()}this.postSolveIsland()},i.prototype.postSolveIsland=function(){for(var t=0;t<this.m_contacts.length;++t){var e=this.m_contacts[t];this.m_world.postSolve(e,e.m_impulse)}},i}();fd.TimeStep=Wl;var ni=function(){function i(t,e,r,s){typeof t=="object"&&t!==null?(this.ex=u.clone(t),this.ey=u.clone(e)):typeof t=="number"?(this.ex=u.neo(t,r),this.ey=u.neo(e,s)):(this.ex=u.zero(),this.ey=u.zero())}return i.prototype.toString=function(){return JSON.stringify(this)},i.isValid=function(t){return t===null||typeof t>"u"?!1:u.isValid(t.ex)&&u.isValid(t.ey)},i.assert=function(t){},i.prototype.set=function(t,e,r,s){typeof t=="number"&&typeof e=="number"&&typeof r=="number"&&typeof s=="number"?(this.ex.setNum(t,r),this.ey.setNum(e,s)):typeof t=="object"&&typeof e=="object"?(this.ex.setVec2(t),this.ey.setVec2(e)):typeof t=="object"&&(this.ex.setVec2(t.ex),this.ey.setVec2(t.ey))},i.prototype.setIdentity=function(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1},i.prototype.setZero=function(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0},i.prototype.getInverse=function(){var t=this.ex.x,e=this.ey.x,r=this.ex.y,s=this.ey.y,n=t*s-e*r;n!==0&&(n=1/n);var o=new i;return o.ex.x=n*s,o.ey.x=-n*e,o.ex.y=-n*r,o.ey.y=n*t,o},i.prototype.solve=function(t){var e=this.ex.x,r=this.ey.x,s=this.ex.y,n=this.ey.y,o=e*n-r*s;o!==0&&(o=1/o);var a=u.zero();return a.x=o*(n*t.x-r*t.y),a.y=o*(e*t.y-s*t.x),a},i.mul=function(t,e){if(e&&"x"in e&&"y"in e){var r=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return u.neo(r,s)}else if(e&&"ex"in e&&"ey"in e){var n=t.ex.x*e.ex.x+t.ey.x*e.ex.y,o=t.ex.x*e.ey.x+t.ey.x*e.ey.y,a=t.ex.y*e.ex.x+t.ey.y*e.ex.y,l=t.ex.y*e.ey.x+t.ey.y*e.ey.y;return new i(n,o,a,l)}},i.mulVec2=function(t,e){var r=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return u.neo(r,s)},i.mulMat22=function(t,e){var r=t.ex.x*e.ex.x+t.ey.x*e.ex.y,s=t.ex.x*e.ey.x+t.ey.x*e.ey.y,n=t.ex.y*e.ex.x+t.ey.y*e.ex.y,o=t.ex.y*e.ey.x+t.ey.y*e.ey.y;return new i(r,s,n,o)},i.mulT=function(t,e){if(e&&"x"in e&&"y"in e)return u.neo(u.dot(e,t.ex),u.dot(e,t.ey));if(e&&"ex"in e&&"ey"in e){var r=u.neo(u.dot(t.ex,e.ex),u.dot(t.ey,e.ex)),s=u.neo(u.dot(t.ex,e.ey),u.dot(t.ey,e.ey));return new i(r,s)}},i.mulTVec2=function(t,e){return u.neo(u.dot(e,t.ex),u.dot(e,t.ey))},i.mulTMat22=function(t,e){var r=u.neo(u.dot(t.ex,e.ex),u.dot(t.ey,e.ex)),s=u.neo(u.dot(t.ex,e.ey),u.dot(t.ey,e.ey));return new i(r,s)},i.abs=function(t){return new i(u.abs(t.ex),u.abs(t.ey))},i.add=function(t,e){return new i(u.add(t.ex,e.ex),u.add(t.ey,e.ey))},i}(),vf=Math.sqrt,ca=I(0,0),ua=I(0,0),Zs=I(0,0),Si=I(0,0),Di=I(0,0),ma=I(0,0),ro=I(0,0),Yi=I(0,0),Ft;(function(i){i[i.e_unset=-1]="e_unset",i[i.e_circles=0]="e_circles",i[i.e_faceA=1]="e_faceA",i[i.e_faceB=2]="e_faceB"})(Ft||(Ft={}));var mt;(function(i){i[i.e_unset=-1]="e_unset",i[i.e_vertex=0]="e_vertex",i[i.e_face=1]="e_face"})(mt||(mt={}));var Pr;(function(i){i[i.nullState=0]="nullState",i[i.addState=1]="addState",i[i.persistState=2]="persistState",i[i.removeState=3]="removeState"})(Pr||(Pr={}));var Pe=function(){function i(){this.v=I(0,0),this.id=new _d}return i.prototype.set=function(t){D(this.v,t.v),this.id.set(t.id)},i.prototype.recycle=function(){G(this.v),this.id.recycle()},i}(),yd=function(){function i(){this.localNormal=I(0,0),this.localPoint=I(0,0),this.points=[new Eh,new Eh],this.pointCount=0}return i.prototype.set=function(t){this.type=t.type,D(this.localNormal,t.localNormal),D(this.localPoint,t.localPoint),this.pointCount=t.pointCount,this.points[0].set(t.points[0]),this.points[1].set(t.points[1])},i.prototype.recycle=function(){this.type=Ft.e_unset,G(this.localNormal),G(this.localPoint),this.pointCount=0,this.points[0].recycle(),this.points[1].recycle()},i.prototype.getWorldManifold=function(t,e,r,s,n){if(this.pointCount==0)return t;t=t||new vd,t.pointCount=this.pointCount;var o=t.normal,a=t.points,l=t.separations;switch(this.type){case Ft.e_circles:{Qt(o,1,0);var c=this.points[0];it(ca,e,this.localPoint),it(ua,s,c.localPoint),rt(ma,ua,ca);var h=qr(ma);if(h>Ee*Ee){var d=vf(h);$(o,1/d,ma)}Bt(Si,1,ca,r,o),Bt(Di,1,ua,-n,o),Bt(a[0],.5,Si,.5,Di),l[0]=N(rt(Zs,Di,Si),o);break}case Ft.e_faceA:{Je(o,e.q,this.localNormal),it(ro,e,this.localPoint);for(var m=0;m<this.pointCount;++m){var c=this.points[m];it(Yi,s,c.localPoint),Bt(Si,1,Yi,r-N(rt(Zs,Yi,ro),o),o),Bt(Di,1,Yi,-n,o),Bt(a[m],.5,Si,.5,Di),l[m]=N(rt(Zs,Di,Si),o)}break}case Ft.e_faceB:{Je(o,s.q,this.localNormal),it(ro,s,this.localPoint);for(var m=0;m<this.pointCount;++m){var c=this.points[m];it(Yi,e,c.localPoint),Bt(Di,1,Yi,n-N(rt(Zs,Yi,ro),o),o),Bt(Si,1,Yi,-r,o),Bt(a[m],.5,Si,.5,Di),l[m]=N(rt(Zs,Si,Di),o)}wn(o);break}}return t},i.clipSegmentToLine=bn,i.ClipVertex=Pe,i.getPointStates=gf,i.PointState=Pr,i}(),Eh=function(){function i(){this.localPoint=I(0,0),this.normalImpulse=0,this.tangentImpulse=0,this.id=new _d}return i.prototype.set=function(t){D(this.localPoint,t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.set(t.id)},i.prototype.recycle=function(){G(this.localPoint),this.normalImpulse=0,this.tangentImpulse=0,this.id.recycle()},i}(),_d=function(){function i(){this.key=-1,this.indexA=-1,this.indexB=-1,this.typeA=mt.e_unset,this.typeB=mt.e_unset}return i.prototype.setFeatures=function(t,e,r,s){this.indexA=t,this.indexB=r,this.typeA=e,this.typeB=s,this.key=this.indexA+this.indexB*4+this.typeA*16+this.typeB*64},i.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.typeA=t.typeA,this.typeB=t.typeB,this.key=this.indexA+this.indexB*4+this.typeA*16+this.typeB*64},i.prototype.swapFeatures=function(){var t=this.indexA,e=this.indexB,r=this.typeA,s=this.typeB;this.indexA=e,this.indexB=t,this.typeA=s,this.typeB=r,this.key=this.indexA+this.indexB*4+this.typeA*16+this.typeB*64},i.prototype.recycle=function(){this.indexA=0,this.indexB=0,this.typeA=mt.e_unset,this.typeB=mt.e_unset,this.key=-1},i}(),vd=function(){function i(){this.normal=I(0,0),this.points=[I(0,0),I(0,0)],this.separations=[0,0],this.pointCount=0}return i.prototype.recycle=function(){G(this.normal),G(this.points[0]),G(this.points[1]),this.separations[0]=0,this.separations[1]=0,this.pointCount=0},i}();function gf(i,t,e,r){for(var s=0;s<e.pointCount;++s){var n=e.points[s].id;i[s]=Pr.removeState;for(var o=0;o<r.pointCount;++o)if(r.points[o].id.key===n.key){i[s]=Pr.persistState;break}}for(var s=0;s<r.pointCount;++s){var n=r.points[s].id;t[s]=Pr.addState;for(var o=0;o<e.pointCount;++o)if(e.points[o].id.key===n.key){t[s]=Pr.persistState;break}}}function bn(i,t,e,r,s){var n=0,o=N(e,t[0].v)-r,a=N(e,t[1].v)-r;if(o<=0&&i[n++].set(t[0]),a<=0&&i[n++].set(t[1]),o*a<0){var l=o/(o-a);Bt(i[n].v,1-l,t[0].v,l,t[1].v),i[n].id.setFeatures(s,mt.e_vertex,t[0].id.indexB,mt.e_face),++n}return n}var Af=Math.sqrt,xf=Math.max,wf=Math.min,Sh=new un({create:function(){return new xi},release:function(i){i.recycle()}}),ts=new yd,so=new vd,Dh=function(){function i(t){this.prev=null,this.next=null,this.other=null,this.contact=t}return i.prototype.recycle=function(){this.prev=null,this.next=null,this.other=null},i}();function Ph(i,t){return Af(i*t)}function Vh(i,t){return i>t?i:t}var wr=[],qh=function(){function i(){this.rA=I(0,0),this.rB=I(0,0),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}return i.prototype.recycle=function(){G(this.rA),G(this.rB),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0},i}(),Pi=I(0,0),St=I(0,0),Vi=I(0,0),Dt=I(0,0),Gi=I(0,0),br=Wr(0,0,0),Br=Wr(0,0,0),no=I(0,0),oo=I(0,0),es=I(0,0),ao=I(0,0),da=I(0,0),pa=I(0,0),It=I(0,0),vt=I(0,0),$s=I(0,0),Re=I(0,0),is=I(0,0),rs=I(0,0),be=I(0,0),qi=I(0,0),wt=I(0,0),ze=I(0,0),jt=I(0,0),Lt=I(0,0),ci=I(0,0),xi=function(){function i(){this.m_nodeA=new Dh(this),this.m_nodeB=new Dh(this),this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=-1,this.m_indexB=-1,this.m_evaluateFcn=null,this.m_manifold=new yd,this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_impulse=new _f(this),this.v_points=[new qh,new qh],this.v_normal=I(0,0),this.v_normalMass=new ni,this.v_K=new ni,this.v_pointCount=0,this.v_tangentSpeed=0,this.v_friction=0,this.v_restitution=0,this.v_invMassA=0,this.v_invMassB=0,this.v_invIA=0,this.v_invIB=0,this.p_localPoints=[I(0,0),I(0,0)],this.p_localNormal=I(0,0),this.p_localPoint=I(0,0),this.p_localCenterA=I(0,0),this.p_localCenterB=I(0,0),this.p_type=Ft.e_unset,this.p_radiusA=0,this.p_radiusB=0,this.p_pointCount=0,this.p_invMassA=0,this.p_invMassB=0,this.p_invIA=0,this.p_invIB=0}return i.prototype.initialize=function(t,e,r,s,n){this.m_fixtureA=t,this.m_fixtureB=r,this.m_indexA=e,this.m_indexB=s,this.m_evaluateFcn=n,this.m_friction=Ph(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=Vh(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},i.prototype.recycle=function(){this.m_nodeA.recycle(),this.m_nodeB.recycle(),this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=-1,this.m_indexB=-1,this.m_evaluateFcn=null,this.m_manifold.recycle(),this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_impulse.recycle();for(var t=0,e=this.v_points;t<e.length;t++){var r=e[t];r.recycle()}G(this.v_normal),this.v_normalMass.setZero(),this.v_K.setZero(),this.v_pointCount=0,this.v_tangentSpeed=0,this.v_friction=0,this.v_restitution=0,this.v_invMassA=0,this.v_invMassB=0,this.v_invIA=0,this.v_invIB=0;for(var s=0,n=this.p_localPoints;s<n.length;s++){var o=n[s];G(o)}G(this.p_localNormal),G(this.p_localPoint),G(this.p_localCenterA),G(this.p_localCenterB),this.p_type=Ft.e_unset,this.p_radiusA=0,this.p_radiusB=0,this.p_pointCount=0,this.p_invMassA=0,this.p_invMassB=0,this.p_invIA=0,this.p_invIB=0},i.prototype.initConstraint=function(t){var e=this.m_fixtureA,r=this.m_fixtureB;if(!(e===null||r===null)){var s=e.m_body,n=r.m_body;if(!(s===null||n===null)){var o=e.m_shape,a=r.m_shape;if(!(o===null||a===null)){var l=this.m_manifold,c=l.pointCount;this.v_invMassA=s.m_invMass,this.v_invMassB=n.m_invMass,this.v_invIA=s.m_invI,this.v_invIB=n.m_invI,this.v_friction=this.m_friction,this.v_restitution=this.m_restitution,this.v_tangentSpeed=this.m_tangentSpeed,this.v_pointCount=c,this.v_K.setZero(),this.v_normalMass.setZero(),this.p_invMassA=s.m_invMass,this.p_invMassB=n.m_invMass,this.p_invIA=s.m_invI,this.p_invIB=n.m_invI,D(this.p_localCenterA,s.m_sweep.localCenter),D(this.p_localCenterB,n.m_sweep.localCenter),this.p_radiusA=o.m_radius,this.p_radiusB=a.m_radius,this.p_type=l.type,D(this.p_localNormal,l.localNormal),D(this.p_localPoint,l.localPoint),this.p_pointCount=c;for(var h=0;h<H.maxManifoldPoints;++h)this.v_points[h].recycle(),G(this.p_localPoints[h]);for(var h=0;h<c;++h){var d=l.points[h],m=this.v_points[h];t.warmStarting&&(m.normalImpulse=t.dtRatio*d.normalImpulse,m.tangentImpulse=t.dtRatio*d.tangentImpulse),D(this.p_localPoints[h],d.localPoint)}}}}},i.prototype.getManifold=function(){return this.m_manifold},i.prototype.getWorldManifold=function(t){var e=this.m_fixtureA,r=this.m_fixtureB;if(!(e===null||r===null)){var s=e.m_body,n=r.m_body;if(!(s===null||n===null)){var o=e.m_shape,a=r.m_shape;if(!(o===null||a===null))return this.m_manifold.getWorldManifold(t,s.getTransform(),o.m_radius,n.getTransform(),a.m_radius)}}},i.prototype.setEnabled=function(t){this.m_enabledFlag=!!t},i.prototype.isEnabled=function(){return this.m_enabledFlag},i.prototype.isTouching=function(){return this.m_touchingFlag},i.prototype.getNext=function(){return this.m_next},i.prototype.getFixtureA=function(){return this.m_fixtureA},i.prototype.getFixtureB=function(){return this.m_fixtureB},i.prototype.getChildIndexA=function(){return this.m_indexA},i.prototype.getChildIndexB=function(){return this.m_indexB},i.prototype.flagForFiltering=function(){this.m_filterFlag=!0},i.prototype.setFriction=function(t){this.m_friction=t},i.prototype.getFriction=function(){return this.m_friction},i.prototype.resetFriction=function(){var t=this.m_fixtureA,e=this.m_fixtureB;t===null||e===null||(this.m_friction=Ph(t.m_friction,e.m_friction))},i.prototype.setRestitution=function(t){this.m_restitution=t},i.prototype.getRestitution=function(){return this.m_restitution},i.prototype.resetRestitution=function(){var t=this.m_fixtureA,e=this.m_fixtureB;t===null||e===null||(this.m_restitution=Vh(t.m_restitution,e.m_restitution))},i.prototype.setTangentSpeed=function(t){this.m_tangentSpeed=t},i.prototype.getTangentSpeed=function(){return this.m_tangentSpeed},i.prototype.evaluate=function(t,e,r){var s=this.m_fixtureA,n=this.m_fixtureB;s===null||n===null||this.m_evaluateFcn(t,e,s,this.m_indexA,r,n,this.m_indexB)},i.prototype.update=function(t){var e=this.m_fixtureA,r=this.m_fixtureB;if(!(e===null||r===null)){var s=e.m_body,n=r.m_body;if(!(s===null||n===null)){var o=e.m_shape,a=r.m_shape;if(!(o===null||a===null)){this.m_enabledFlag=!0;var l=!1,c=this.m_touchingFlag,h=e.m_isSensor,d=r.m_isSensor,m=h||d,f=s.m_xf,y=n.m_xf;if(m)l=Jl(o,this.m_indexA,a,this.m_indexB,f,y),this.m_manifold.pointCount=0;else{ts.recycle(),ts.set(this.m_manifold),this.m_manifold.recycle(),this.evaluate(this.m_manifold,f,y),l=this.m_manifold.pointCount>0;for(var v=0;v<this.m_manifold.pointCount;++v){var g=this.m_manifold.points[v];g.normalImpulse=0,g.tangentImpulse=0;for(var A=0;A<ts.pointCount;++A){var B=ts.points[A];if(B.id.key===g.id.key){g.normalImpulse=B.normalImpulse,g.tangentImpulse=B.tangentImpulse;break}}}l!==c&&(s.setAwake(!0),n.setAwake(!0))}this.m_touchingFlag=l;var F=typeof t=="object"&&t!==null;!c&&l&&F&&t.beginContact(this),c&&!l&&F&&t.endContact(this),!m&&l&&F&&ts&&t.preSolve(this,ts)}}}},i.prototype.solvePositionConstraint=function(t){return this._solvePositionConstraint(t,null,null)},i.prototype.solvePositionConstraintTOI=function(t,e,r){return this._solvePositionConstraint(t,e,r)},i.prototype._solvePositionConstraint=function(t,e,r){var s=e!==null&&r!==null,n=0,o=this.m_fixtureA,a=this.m_fixtureB;if(o===null||a===null)return n;var l=o.m_body,c=a.m_body;if(l===null||c===null)return n;l.c_velocity,c.c_velocity;var h=l.c_position,d=c.c_position,m=this.p_localCenterA,f=this.p_localCenterB,y=0,v=0;(!s||l===e||l===r)&&(y=this.p_invMassA,v=this.p_invIA);var g=0,A=0;(!s||c===e||c===r)&&(g=this.p_invMassB,A=this.p_invIB),D(Pi,h.c);var B=h.a;D(Vi,d.c);for(var F=d.a,E=0;E<this.p_pointCount;++E){On(br,m,Pi,B),On(Br,f,Vi,F);var k=void 0;switch(this.p_type){case Ft.e_circles:{it(no,br,this.p_localPoint),it(oo,Br,this.p_localPoints[0]),rt(vt,oo,no),ri(vt),Bt($s,.5,no,.5,oo),k=N(oo,vt)-N(no,vt)-this.p_radiusA-this.p_radiusB;break}case Ft.e_faceA:{Je(vt,br.q,this.p_localNormal),it(ao,br,this.p_localPoint),it(es,Br,this.p_localPoints[E]),k=N(es,vt)-N(ao,vt)-this.p_radiusA-this.p_radiusB,D($s,es);break}case Ft.e_faceB:{Je(vt,Br.q,this.p_localNormal),it(ao,Br,this.p_localPoint),it(es,br,this.p_localPoints[E]),k=N(es,vt)-N(ao,vt)-this.p_radiusA-this.p_radiusB,D($s,es),wn(vt);break}default:return n}rt(da,$s,Pi),rt(pa,$s,Vi),n=wf(n,k);var w=s?H.toiBaugarte:H.baumgarte,b=H.linearSlop,M=H.maxLinearCorrection,V=re(w*(k+b),-M,0),T=lt(da,vt),z=lt(pa,vt),O=y+g+v*T*T+A*z*z,J=O>0?-V/O:0;$(It,J,vt),an(Pi,y,It),B-=v*lt(da,It),ii(Vi,g,It),F+=A*lt(pa,It)}return D(h.c,Pi),h.a=B,D(d.c,Vi),d.a=F,n},i.prototype.initVelocityConstraint=function(t){var e=this.m_fixtureA,r=this.m_fixtureB;if(!(e===null||r===null)){var s=e.m_body,n=r.m_body;if(!(s===null||n===null)){var o=s.c_velocity,a=n.c_velocity,l=s.c_position,c=n.c_position,h=this.p_radiusA,d=this.p_radiusB,m=this.m_manifold,f=this.v_invMassA,y=this.v_invMassB,v=this.v_invIA,g=this.v_invIB,A=this.p_localCenterA,B=this.p_localCenterB;D(Pi,l.c);var F=l.a;D(St,o.v);var E=o.w;D(Vi,c.c);var k=c.a;D(Dt,a.v);var w=a.w;On(br,A,Pi,F),On(Br,B,Vi,k),so.recycle(),m.getWorldManifold(so,br,h,Br,d),D(this.v_normal,so.normal);for(var b=0;b<this.v_pointCount;++b){var M=this.v_points[b],V=so.points[b];rt(M.rA,V,Pi),rt(M.rB,V,Vi);var T=lt(M.rA,this.v_normal),z=lt(M.rB,this.v_normal),O=f+y+v*T*T+g*z*z;M.normalMass=O>0?1/O:0,Vr(Gi,this.v_normal,1);var J=lt(M.rA,Gi),W=lt(M.rB,Gi),tt=f+y+v*J*J+g*W*W;M.tangentMass=tt>0?1/tt:0,M.velocityBias=0;var K=0;K+=N(this.v_normal,Dt),K+=N(this.v_normal,Be(ci,w,M.rB)),K-=N(this.v_normal,St),K-=N(this.v_normal,Be(ci,E,M.rA)),K<-H.velocityThreshold&&(M.velocityBias=-this.v_restitution*K)}if(this.v_pointCount==2&&t.blockSolve){var Z=this.v_points[0],ot=this.v_points[1],Y=lt(Z.rA,this.v_normal),ct=lt(Z.rB,this.v_normal),ft=lt(ot.rA,this.v_normal),X=lt(ot.rB,this.v_normal),Zt=f+y+v*Y*Y+g*ct*ct,he=f+y+v*ft*ft+g*X*X,ge=f+y+v*Y*ft+g*ct*X,bi=1e3;if(Zt*Zt<bi*(Zt*he-ge*ge)){this.v_K.ex.setNum(Zt,ge),this.v_K.ey.setNum(ge,he);var Wi=this.v_K.ex.x,yr=this.v_K.ey.x,_r=this.v_K.ex.y,Bi=this.v_K.ey.y,Kt=Wi*Bi-yr*_r;Kt!==0&&(Kt=1/Kt),this.v_normalMass.ex.x=Kt*Bi,this.v_normalMass.ey.x=-Kt*yr,this.v_normalMass.ex.y=-Kt*_r,this.v_normalMass.ey.y=Kt*Wi}else this.v_pointCount=1}D(l.c,Pi),l.a=F,D(o.v,St),o.w=E,D(c.c,Vi),c.a=k,D(a.v,Dt),a.w=w}}},i.prototype.warmStartConstraint=function(t){var e=this.m_fixtureA,r=this.m_fixtureB;if(!(e===null||r===null)){var s=e.m_body,n=r.m_body;if(!(s===null||n===null)){var o=s.c_velocity,a=n.c_velocity;s.c_position,n.c_position;var l=this.v_invMassA,c=this.v_invIA,h=this.v_invMassB,d=this.v_invIB;D(St,o.v);var m=o.w;D(Dt,a.v);var f=a.w;D(vt,this.v_normal),Vr(Gi,vt,1);for(var y=0;y<this.v_pointCount;++y){var v=this.v_points[y];Bt(It,v.normalImpulse,vt,v.tangentImpulse,Gi),m-=c*lt(v.rA,It),an(St,l,It),f+=d*lt(v.rB,It),ii(Dt,h,It)}D(o.v,St),o.w=m,D(a.v,Dt),a.w=f}}},i.prototype.storeConstraintImpulses=function(t){for(var e=this.m_manifold,r=0;r<this.v_pointCount;++r)e.points[r].normalImpulse=this.v_points[r].normalImpulse,e.points[r].tangentImpulse=this.v_points[r].tangentImpulse},i.prototype.solveVelocityConstraint=function(t){var e=this.m_fixtureA,r=this.m_fixtureB;if(!(e===null||r===null)){var s=e.m_body,n=r.m_body;if(!(s===null||n===null)){var o=s.c_velocity;s.c_position;var a=n.c_velocity;n.c_position;var l=this.v_invMassA,c=this.v_invIA,h=this.v_invMassB,d=this.v_invIB;D(St,o.v);var m=o.w;D(Dt,a.v);var f=a.w;D(vt,this.v_normal),Vr(Gi,vt,1);for(var y=this.v_friction,v=0;v<this.v_pointCount;++v){var g=this.v_points[v];G(Re),Oe(Re,Dt),Oe(Re,Be(ci,f,g.rB)),ji(Re,St),ji(Re,Be(ci,m,g.rA));var A=N(Re,Gi)-this.v_tangentSpeed,B=g.tangentMass*-A,F=y*g.normalImpulse,E=re(g.tangentImpulse+B,-F,F);B=E-g.tangentImpulse,g.tangentImpulse=E,$(It,B,Gi),an(St,l,It),m-=c*lt(g.rA,It),ii(Dt,h,It),f+=d*lt(g.rB,It)}if(this.v_pointCount==1||t.blockSolve==!1)for(var k=0;k<this.v_pointCount;++k){var g=this.v_points[k];G(Re),Oe(Re,Dt),Oe(Re,Be(ci,f,g.rB)),ji(Re,St),ji(Re,Be(ci,m,g.rA));var w=N(Re,vt),B=-g.normalMass*(w-g.velocityBias),E=xf(g.normalImpulse+B,0);B=E-g.normalImpulse,g.normalImpulse=E,$(It,B,vt),an(St,l,It),m-=c*lt(g.rA,It),ii(Dt,h,It),f+=d*lt(g.rB,It)}else{var b=this.v_points[0],M=this.v_points[1];Qt(qi,b.normalImpulse,M.normalImpulse),G(is),Oe(is,Dt),Oe(is,Be(ci,f,b.rB)),ji(is,St),ji(is,Be(ci,m,b.rA)),G(rs),Oe(rs,Dt),Oe(rs,Be(ci,f,M.rB)),ji(rs,St),ji(rs,Be(ci,m,M.rA));var V=N(is,vt),T=N(rs,vt);for(Qt(be,V-b.velocityBias,T-M.velocityBias),be.x-=this.v_K.ex.x*qi.x+this.v_K.ey.x*qi.y,be.y-=this.v_K.ex.y*qi.x+this.v_K.ey.y*qi.y;;){if(G(wt),wt.x=-(this.v_normalMass.ex.x*be.x+this.v_normalMass.ey.x*be.y),wt.y=-(this.v_normalMass.ex.y*be.x+this.v_normalMass.ey.y*be.y),wt.x>=0&&wt.y>=0){rt(ze,wt,qi),$(jt,ze.x,vt),$(Lt,ze.y,vt),pi(St,-l,jt,-l,Lt,1,St),m-=c*(lt(b.rA,jt)+lt(M.rA,Lt)),pi(Dt,h,jt,h,Lt,1,Dt),f+=d*(lt(b.rB,jt)+lt(M.rB,Lt)),b.normalImpulse=wt.x,M.normalImpulse=wt.y;break}if(wt.x=-b.normalMass*be.x,wt.y=0,V=0,T=this.v_K.ex.y*wt.x+be.y,wt.x>=0&&T>=0){rt(ze,wt,qi),$(jt,ze.x,vt),$(Lt,ze.y,vt),pi(St,-l,jt,-l,Lt,1,St),m-=c*(lt(b.rA,jt)+lt(M.rA,Lt)),pi(Dt,h,jt,h,Lt,1,Dt),f+=d*(lt(b.rB,jt)+lt(M.rB,Lt)),b.normalImpulse=wt.x,M.normalImpulse=wt.y;break}if(wt.x=0,wt.y=-M.normalMass*be.y,V=this.v_K.ey.x*wt.y+be.x,T=0,wt.y>=0&&V>=0){rt(ze,wt,qi),$(jt,ze.x,vt),$(Lt,ze.y,vt),pi(St,-l,jt,-l,Lt,1,St),m-=c*(lt(b.rA,jt)+lt(M.rA,Lt)),pi(Dt,h,jt,h,Lt,1,Dt),f+=d*(lt(b.rB,jt)+lt(M.rB,Lt)),b.normalImpulse=wt.x,M.normalImpulse=wt.y;break}if(wt.x=0,wt.y=0,V=be.x,T=be.y,V>=0&&T>=0){rt(ze,wt,qi),$(jt,ze.x,vt),$(Lt,ze.y,vt),pi(St,-l,jt,-l,Lt,1,St),m-=c*(lt(b.rA,jt)+lt(M.rA,Lt)),pi(Dt,h,jt,h,Lt,1,Dt),f+=d*(lt(b.rB,jt)+lt(M.rB,Lt)),b.normalImpulse=wt.x,M.normalImpulse=wt.y;break}break}}D(o.v,St),o.w=m,D(a.v,Dt),a.w=f}}},i.addType=function(t,e,r){wr[t]=wr[t]||{},wr[t][e]=r},i.create=function(t,e,r,s){var n=t.m_shape.m_type,o=r.m_shape.m_type,a=Sh.allocate(),l;if(l=wr[n]&&wr[n][o])a.initialize(t,e,r,s,l);else if(l=wr[o]&&wr[o][n])a.initialize(r,s,t,e,l);else return null;t=a.m_fixtureA,r=a.m_fixtureB,e=a.getChildIndexA(),s=a.getChildIndexB();var c=t.m_body,h=r.m_body;return a.m_nodeA.contact=a,a.m_nodeA.other=h,a.m_nodeA.prev=null,a.m_nodeA.next=c.m_contactList,c.m_contactList!=null&&(c.m_contactList.prev=a.m_nodeA),c.m_contactList=a.m_nodeA,a.m_nodeB.contact=a,a.m_nodeB.other=c,a.m_nodeB.prev=null,a.m_nodeB.next=h.m_contactList,h.m_contactList!=null&&(h.m_contactList.prev=a.m_nodeB),h.m_contactList=a.m_nodeB,t.isSensor()==!1&&r.isSensor()==!1&&(c.setAwake(!0),h.setAwake(!0)),a},i.destroy=function(t,e){var r=t.m_fixtureA,s=t.m_fixtureB;if(!(r===null||s===null)){var n=r.m_body,o=s.m_body;n===null||o===null||(t.isTouching()&&e.endContact(t),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==n.m_contactList&&(n.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==o.m_contactList&&(o.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&!r.m_isSensor&&!s.m_isSensor&&(n.setAwake(!0),o.setAwake(!0)),Sh.release(t))}},i}(),bf={gravity:u.zero(),allowSleep:!0,warmStarting:!0,continuousPhysics:!0,subStepping:!1,blockSolve:!0,velocityIterations:8,positionIterations:3},Vn=function(){function i(t){if(!(this instanceof i))return new i(t);this.s_step=new Wl,t?u.isValid(t)&&(t={gravity:t}):t={},t=qe(t,bf),this.m_solver=new fd(this),this.m_broadPhase=new Xp,this.m_contactList=null,this.m_contactCount=0,this.m_bodyList=null,this.m_bodyCount=0,this.m_jointList=null,this.m_jointCount=0,this.m_stepComplete=!0,this.m_allowSleep=t.allowSleep,this.m_gravity=u.clone(t.gravity),this.m_clearForces=!0,this.m_newFixture=!1,this.m_locked=!1,this.m_warmStarting=t.warmStarting,this.m_continuousPhysics=t.continuousPhysics,this.m_subStepping=t.subStepping,this.m_blockSolve=t.blockSolve,this.m_velocityIterations=t.velocityIterations,this.m_positionIterations=t.positionIterations,this.m_t=0}return i.prototype._serialize=function(){for(var t=[],e=[],r=this.getBodyList();r;r=r.getNext())t.push(r);for(var s=this.getJointList();s;s=s.getNext())typeof s._serialize=="function"&&e.push(s);return{gravity:this.m_gravity,bodies:t,joints:e}},i._deserialize=function(t,e,r){if(!t)return new i;var s=new i(t.gravity);if(t.bodies)for(var n=t.bodies.length-1;n>=0;n-=1)s._addBody(r(_t,t.bodies[n],s));if(t.joints)for(var n=t.joints.length-1;n>=0;n--)s.createJoint(r(se,t.joints[n],s));return s},i.prototype.getBodyList=function(){return this.m_bodyList},i.prototype.getJointList=function(){return this.m_jointList},i.prototype.getContactList=function(){return this.m_contactList},i.prototype.getBodyCount=function(){return this.m_bodyCount},i.prototype.getJointCount=function(){return this.m_jointCount},i.prototype.getContactCount=function(){return this.m_contactCount},i.prototype.setGravity=function(t){this.m_gravity.set(t)},i.prototype.getGravity=function(){return this.m_gravity},i.prototype.isLocked=function(){return this.m_locked},i.prototype.setAllowSleeping=function(t){if(t!=this.m_allowSleep&&(this.m_allowSleep=t,this.m_allowSleep==!1))for(var e=this.m_bodyList;e;e=e.m_next)e.setAwake(!0)},i.prototype.getAllowSleeping=function(){return this.m_allowSleep},i.prototype.setWarmStarting=function(t){this.m_warmStarting=t},i.prototype.getWarmStarting=function(){return this.m_warmStarting},i.prototype.setContinuousPhysics=function(t){this.m_continuousPhysics=t},i.prototype.getContinuousPhysics=function(){return this.m_continuousPhysics},i.prototype.setSubStepping=function(t){this.m_subStepping=t},i.prototype.getSubStepping=function(){return this.m_subStepping},i.prototype.setAutoClearForces=function(t){this.m_clearForces=t},i.prototype.getAutoClearForces=function(){return this.m_clearForces},i.prototype.clearForces=function(){for(var t=this.m_bodyList;t;t=t.getNext())t.m_force.setZero(),t.m_torque=0},i.prototype.queryAABB=function(t,e){var r=this.m_broadPhase;this.m_broadPhase.query(t,function(s){var n=r.getUserData(s);return e(n.fixture)})},i.prototype.rayCast=function(t,e,r){var s=this.m_broadPhase;this.m_broadPhase.rayCast({maxFraction:1,p1:t,p2:e},function(n,o){var a=s.getUserData(o),l=a.fixture,c=a.childIndex,h={},d=l.rayCast(h,n,c);if(d){var m=h.fraction,f=u.add(u.mulNumVec2(1-m,n.p1),u.mulNumVec2(m,n.p2));return r(l,f,h.normal,m)}return n.maxFraction})},i.prototype.getProxyCount=function(){return this.m_broadPhase.getProxyCount()},i.prototype.getTreeHeight=function(){return this.m_broadPhase.getTreeHeight()},i.prototype.getTreeBalance=function(){return this.m_broadPhase.getTreeBalance()},i.prototype.getTreeQuality=function(){return this.m_broadPhase.getTreeQuality()},i.prototype.shiftOrigin=function(t){if(!this.m_locked){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.sub(t),e.m_sweep.c0.sub(t),e.m_sweep.c.sub(t);for(var r=this.m_jointList;r;r=r.m_next)r.shiftOrigin(t);this.m_broadPhase.shiftOrigin(t)}},i.prototype._addBody=function(t){this.isLocked()||(t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount)},i.prototype.createBody=function(t,e){if(this.isLocked())return null;var r={};t&&(u.isValid(t)?r={position:t,angle:e}:typeof t=="object"&&(r=t));var s=new _t(this,r);return this._addBody(s),s},i.prototype.createDynamicBody=function(t,e){var r={};return t&&(u.isValid(t)?r={position:t,angle:e}:typeof t=="object"&&(r=t)),r.type="dynamic",this.createBody(r)},i.prototype.createKinematicBody=function(t,e){var r={};return t&&(u.isValid(t)?r={position:t,angle:e}:typeof t=="object"&&(r=t)),r.type="kinematic",this.createBody(r)},i.prototype.destroyBody=function(t){if(!this.isLocked()){if(t.m_destroyed)return!1;for(var e=t.m_jointList;e;){var r=e;e=e.next,this.publish("remove-joint",r.joint),this.destroyJoint(r.joint),t.m_jointList=e}t.m_jointList=null;for(var s=t.m_contactList;s;){var n=s;s=s.next,this.destroyContact(n.contact),t.m_contactList=s}t.m_contactList=null;for(var o=t.m_fixtureList;o;){var a=o;o=o.m_next,this.publish("remove-fixture",a),a.destroyProxies(this.m_broadPhase),t.m_fixtureList=o}return t.m_fixtureList=null,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),t.m_destroyed=!0,--this.m_bodyCount,this.publish("remove-body",t),!0}},i.prototype.createJoint=function(t){if(this.isLocked())return null;if(t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB,t.m_collideConnected==!1)for(var e=t.m_bodyB.getContactList();e;e=e.next)e.other==t.m_bodyA&&e.contact.flagForFiltering();return t},i.prototype.destroyJoint=function(t){if(!this.isLocked()){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var e=t.m_bodyA,r=t.m_bodyB;if(e.setAwake(!0),r.setAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==r.m_jointList&&(r.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,--this.m_jointCount,t.m_collideConnected==!1)for(var s=r.getContactList();s;)s.other==e&&s.contact.flagForFiltering(),s=s.next;this.publish("remove-joint",t)}},i.prototype.step=function(t,e,r){if(this.publish("pre-step",t),(e|0)!==e&&(e=0),e=e||this.m_velocityIterations,r=r||this.m_positionIterations,this.m_newFixture&&(this.findNewContacts(),this.m_newFixture=!1),this.m_locked=!0,this.s_step.reset(t),this.s_step.velocityIterations=e,this.s_step.positionIterations=r,this.s_step.warmStarting=this.m_warmStarting,this.s_step.blockSolve=this.m_blockSolve,this.updateContacts(),this.m_stepComplete&&t>0){this.m_solver.solveWorld(this.s_step);for(var s=this.m_bodyList;s;s=s.getNext())s.m_islandFlag!=!1&&(s.isStatic()||s.synchronizeFixtures());this.findNewContacts()}this.m_continuousPhysics&&t>0&&this.m_solver.solveWorldTOI(this.s_step),this.m_clearForces&&this.clearForces(),this.m_locked=!1,this.publish("post-step",t)},i.prototype.findNewContacts=function(){var t=this;this.m_broadPhase.updatePairs(function(e,r){return t.createContact(e,r)})},i.prototype.createContact=function(t,e){var r=t.fixture,s=e.fixture,n=t.childIndex,o=e.childIndex,a=r.getBody(),l=s.getBody();if(a!=l){for(var c=l.getContactList();c;){if(c.other==a){var h=c.contact.getFixtureA(),d=c.contact.getFixtureB(),m=c.contact.getChildIndexA(),f=c.contact.getChildIndexB();if(h==r&&d==s&&m==n&&f==o||h==s&&d==r&&m==o&&f==n)return}c=c.next}if(l.shouldCollide(a)!=!1&&s.shouldCollide(r)!=!1){var y=xi.create(r,n,s,o);y!=null&&(y.m_prev=null,this.m_contactList!=null&&(y.m_next=this.m_contactList,this.m_contactList.m_prev=y),this.m_contactList=y,++this.m_contactCount)}}},i.prototype.updateContacts=function(){for(var t,e=this.m_contactList;t=e;){e=t.getNext();var r=t.getFixtureA(),s=t.getFixtureB(),n=t.getChildIndexA(),o=t.getChildIndexB(),a=r.getBody(),l=s.getBody();if(t.m_filterFlag){if(l.shouldCollide(a)==!1){this.destroyContact(t);continue}if(s.shouldCollide(r)==!1){this.destroyContact(t);continue}t.m_filterFlag=!1}var c=a.isAwake()&&!a.isStatic(),h=l.isAwake()&&!l.isStatic();if(!(c==!1&&h==!1)){var d=r.m_proxies[n].proxyId,m=s.m_proxies[o].proxyId,f=this.m_broadPhase.testOverlap(d,m);if(f==!1){this.destroyContact(t);continue}t.update(this)}}},i.prototype.destroyContact=function(t){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_contactList&&(this.m_contactList=t.m_next),xi.destroy(t,this),--this.m_contactCount},i.prototype.on=function(t,e){return typeof t!="string"||typeof e!="function"?this:(this._listeners||(this._listeners={}),this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e),this)},i.prototype.off=function(t,e){if(typeof t!="string"||typeof e!="function")return this;var r=this._listeners&&this._listeners[t];if(!r||!r.length)return this;var s=r.indexOf(e);return s>=0&&r.splice(s,1),this},i.prototype.publish=function(t,e,r,s){var n=this._listeners&&this._listeners[t];if(!n||!n.length)return 0;for(var o=0;o<n.length;o++)n[o].call(this,e,r,s);return n.length},i.prototype.beginContact=function(t){this.publish("begin-contact",t)},i.prototype.endContact=function(t){this.publish("end-contact",t)},i.prototype.preSolve=function(t,e){this.publish("pre-solve",t,e)},i.prototype.postSolve=function(t,e){this.publish("post-solve",t,e)},i}(),pt=function(){function i(t,e,r){if(!(this instanceof i))return new i(t,e,r);typeof t>"u"?(this.x=0,this.y=0,this.z=0):typeof t=="object"?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=e,this.z=r)}return i.prototype._serialize=function(){return{x:this.x,y:this.y,z:this.z}},i._deserialize=function(t){var e=Object.create(i.prototype);return e.x=t.x,e.y=t.y,e.z=t.z,e},i.neo=function(t,e,r){var s=Object.create(i.prototype);return s.x=t,s.y=e,s.z=r,s},i.zero=function(){var t=Object.create(i.prototype);return t.x=0,t.y=0,t.z=0,t},i.clone=function(t){return i.neo(t.x,t.y,t.z)},i.prototype.toString=function(){return JSON.stringify(this)},i.isValid=function(t){return t===null||typeof t>"u"?!1:Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)},i.assert=function(t){},i.prototype.setZero=function(){return this.x=0,this.y=0,this.z=0,this},i.prototype.set=function(t,e,r){return this.x=t,this.y=e,this.z=r,this},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.prototype.mul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.areEqual=function(t,e){return t===e||typeof t=="object"&&t!==null&&typeof e=="object"&&e!==null&&t.x===e.x&&t.y===e.y&&t.z===e.z},i.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},i.cross=function(t,e){return new i(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)},i.add=function(t,e){return new i(t.x+e.x,t.y+e.y,t.z+e.z)},i.sub=function(t,e){return new i(t.x-e.x,t.y-e.y,t.z-e.z)},i.mul=function(t,e){return new i(e*t.x,e*t.y,e*t.z)},i.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},i.neg=function(t){return new i(-t.x,-t.y,-t.z)},i}(),Ih=I(0,0),jh=I(0,0),Oi=function(i){oe(t,i);function t(e,r){var s=this;return s instanceof t?(s=i.call(this)||this,s.m_type=t.TYPE,s.m_radius=H.polygonRadius,s.m_vertex1=e?u.clone(e):u.zero(),s.m_vertex2=r?u.clone(r):u.zero(),s.m_vertex0=u.zero(),s.m_vertex3=u.zero(),s.m_hasVertex0=!1,s.m_hasVertex3=!1,s):new t(e,r)}return t.prototype._serialize=function(){return{type:this.m_type,vertex1:this.m_vertex1,vertex2:this.m_vertex2,vertex0:this.m_vertex0,vertex3:this.m_vertex3,hasVertex0:this.m_hasVertex0,hasVertex3:this.m_hasVertex3}},t._deserialize=function(e){var r=new t(e.vertex1,e.vertex2);return r.m_hasVertex0&&r.setPrevVertex(e.vertex0),r.m_hasVertex3&&r.setNextVertex(e.vertex3),r},t.prototype._reset=function(){},t.prototype.getRadius=function(){return this.m_radius},t.prototype.getType=function(){return this.m_type},t.prototype.setNext=function(e){return this.setNextVertex(e)},t.prototype.setNextVertex=function(e){return e?(this.m_vertex3.setVec2(e),this.m_hasVertex3=!0):(this.m_vertex3.setZero(),this.m_hasVertex3=!1),this},t.prototype.getNextVertex=function(){return this.m_vertex3},t.prototype.setPrev=function(e){return this.setPrevVertex(e)},t.prototype.setPrevVertex=function(e){return e?(this.m_vertex0.setVec2(e),this.m_hasVertex0=!0):(this.m_vertex0.setZero(),this.m_hasVertex0=!1),this},t.prototype.getPrevVertex=function(){return this.m_vertex0},t.prototype._set=function(e,r){return this.m_vertex1.setVec2(e),this.m_vertex2.setVec2(r),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},t.prototype._clone=function(){var e=new t;return e.m_type=this.m_type,e.m_radius=this.m_radius,e.m_vertex1.setVec2(this.m_vertex1),e.m_vertex2.setVec2(this.m_vertex2),e.m_vertex0.setVec2(this.m_vertex0),e.m_vertex3.setVec2(this.m_vertex3),e.m_hasVertex0=this.m_hasVertex0,e.m_hasVertex3=this.m_hasVertex3,e},t.prototype.getChildCount=function(){return 1},t.prototype.testPoint=function(e,r){return!1},t.prototype.rayCast=function(e,r,s,n){var o=L.mulTVec2(s.q,u.sub(r.p1,s.p)),a=L.mulTVec2(s.q,u.sub(r.p2,s.p)),l=u.sub(a,o),c=this.m_vertex1,h=this.m_vertex2,d=u.sub(h,c),m=u.neo(d.y,-d.x);m.normalize();var f=u.dot(m,u.sub(c,o)),y=u.dot(m,l);if(y==0)return!1;var v=f/y;if(v<0||r.maxFraction<v)return!1;var g=u.add(o,u.mulNumVec2(v,l)),A=u.sub(h,c),B=u.dot(A,A);if(B==0)return!1;var F=u.dot(u.sub(g,c),A)/B;return F<0||1<F?!1:(e.fraction=v,f>0?e.normal=L.mulVec2(s.q,m).neg():e.normal=L.mulVec2(s.q,m),!0)},t.prototype.computeAABB=function(e,r,s){it(Ih,r,this.m_vertex1),it(jh,r,this.m_vertex2),Yt.combinePoints(e,Ih,jh),Yt.extend(e,this.m_radius)},t.prototype.computeMass=function(e,r){e.mass=0,Bt(e.center,.5,this.m_vertex1,.5,this.m_vertex2),e.I=0},t.prototype.computeDistanceProxy=function(e){e.m_vertices[0]=this.m_vertex1,e.m_vertices[1]=this.m_vertex2,e.m_vertices.length=2,e.m_count=2,e.m_radius=this.m_radius},t.TYPE="edge",t}(Kr),Lh=I(0,0),Th=I(0,0),Bn=function(i){oe(t,i);function t(e,r){var s=this;return s instanceof t?(s=i.call(this)||this,s.m_type=t.TYPE,s.m_radius=H.polygonRadius,s.m_vertices=[],s.m_count=0,s.m_prevVertex=null,s.m_nextVertex=null,s.m_hasPrevVertex=!1,s.m_hasNextVertex=!1,s.m_isLoop=!!r,e&&e.length&&(r?s._createLoop(e):s._createChain(e)),s):new t(e,r)}return t.prototype._serialize=function(){var e={type:this.m_type,vertices:this.m_isLoop?this.m_vertices.slice(0,this.m_vertices.length-1):this.m_vertices,isLoop:this.m_isLoop,hasPrevVertex:this.m_hasPrevVertex,hasNextVertex:this.m_hasNextVertex,prevVertex:null,nextVertex:null};return this.m_prevVertex&&(e.prevVertex=this.m_prevVertex),this.m_nextVertex&&(e.nextVertex=this.m_nextVertex),e},t._deserialize=function(e,r,s){var n=[];if(e.vertices)for(var o=0;o<e.vertices.length;o++)n.push(s(u,e.vertices[o]));var a=new t(n,e.isLoop);return e.prevVertex&&a.setPrevVertex(e.prevVertex),e.nextVertex&&a.setNextVertex(e.nextVertex),a},t.prototype.getType=function(){return this.m_type},t.prototype.getRadius=function(){return this.m_radius},t.prototype._createLoop=function(e){if(!(e.length<3)){for(var r=1;r<e.length;++r)e[r-1],e[r];this.m_vertices=[],this.m_count=e.length+1;for(var r=0;r<e.length;++r)this.m_vertices[r]=u.clone(e[r]);return this.m_vertices[e.length]=u.clone(e[0]),this.m_prevVertex=this.m_vertices[this.m_count-2],this.m_nextVertex=this.m_vertices[1],this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this}},t.prototype._createChain=function(e){for(var r=1;r<e.length;++r)e[r-1],e[r];this.m_vertices=[],this.m_count=e.length;for(var r=0;r<e.length;++r)this.m_vertices[r]=u.clone(e[r]);return this.m_prevVertex=null,this.m_nextVertex=null,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this},t.prototype._reset=function(){this.m_isLoop?this._createLoop(this.m_vertices.slice(0,this.m_vertices.length-1)):this._createChain(this.m_vertices)},t.prototype.setPrevVertex=function(e){this.m_prevVertex=e,this.m_hasPrevVertex=!0},t.prototype.getPrevVertex=function(){return this.m_prevVertex},t.prototype.setNextVertex=function(e){this.m_nextVertex=e,this.m_hasNextVertex=!0},t.prototype.getNextVertex=function(){return this.m_nextVertex},t.prototype._clone=function(){var e=new t;return e._createChain(this.m_vertices),e.m_type=this.m_type,e.m_radius=this.m_radius,e.m_prevVertex=this.m_prevVertex,e.m_nextVertex=this.m_nextVertex,e.m_hasPrevVertex=this.m_hasPrevVertex,e.m_hasNextVertex=this.m_hasNextVertex,e},t.prototype.getChildCount=function(){return this.m_count-1},t.prototype.getChildEdge=function(e,r){e.m_type=Oi.TYPE,e.m_radius=this.m_radius,e.m_vertex1=this.m_vertices[r],e.m_vertex2=this.m_vertices[r+1],r>0?(e.m_vertex0=this.m_vertices[r-1],e.m_hasVertex0=!0):(e.m_vertex0=this.m_prevVertex,e.m_hasVertex0=this.m_hasPrevVertex),r<this.m_count-2?(e.m_vertex3=this.m_vertices[r+2],e.m_hasVertex3=!0):(e.m_vertex3=this.m_nextVertex,e.m_hasVertex3=this.m_hasNextVertex)},t.prototype.getVertex=function(e){return e<this.m_count?this.m_vertices[e]:this.m_vertices[0]},t.prototype.isLoop=function(){return this.m_isLoop},t.prototype.testPoint=function(e,r){return!1},t.prototype.rayCast=function(e,r,s,n){var o=new Oi(this.getVertex(n),this.getVertex(n+1));return o.rayCast(e,r,s,0)},t.prototype.computeAABB=function(e,r,s){it(Lh,r,this.getVertex(s)),it(Th,r,this.getVertex(s+1)),Yt.combinePoints(e,Lh,Th)},t.prototype.computeMass=function(e,r){e.mass=0,G(e.center),e.I=0},t.prototype.computeDistanceProxy=function(e,r){e.m_vertices[0]=this.getVertex(r),e.m_vertices[1]=this.getVertex(r+1),e.m_count=2,e.m_radius=this.m_radius},t.TYPE="chain",t}(Kr),Rh=Math.max,fa=Math.min,Dr=I(0,0),zh=I(0,0),tn=I(0,0),ss=I(0,0),Cr=I(0,0),Xi=I(0,0),Ui=function(i){oe(t,i);function t(e){var r=this;return r instanceof t?(r=i.call(this)||this,r.m_type=t.TYPE,r.m_radius=H.polygonRadius,r.m_centroid=u.zero(),r.m_vertices=[],r.m_normals=[],r.m_count=0,e&&e.length&&r._set(e),r):new t(e)}return t.prototype._serialize=function(){return{type:this.m_type,vertices:this.m_vertices}},t._deserialize=function(e,r,s){var n=[];if(e.vertices)for(var o=0;o<e.vertices.length;o++)n.push(s(u,e.vertices[o]));var a=new t(n);return a},t.prototype.getType=function(){return this.m_type},t.prototype.getRadius=function(){return this.m_radius},t.prototype._clone=function(){var e=new t;e.m_type=this.m_type,e.m_radius=this.m_radius,e.m_count=this.m_count,e.m_centroid.setVec2(this.m_centroid);for(var r=0;r<this.m_count;r++)e.m_vertices.push(this.m_vertices[r].clone());for(var r=0;r<this.m_normals.length;r++)e.m_normals.push(this.m_normals[r].clone());return e},t.prototype.getChildCount=function(){return 1},t.prototype._reset=function(){this._set(this.m_vertices)},t.prototype._set=function(e){if(e.length<3){this._setAsBox(1,1);return}for(var r=fa(e.length,H.maxPolygonVertices),s=[],n=0;n<r;++n){for(var o=e[n],a=!0,l=0;l<s.length;++l)if(u.distanceSquared(o,s[l])<.25*H.linearSlopSquared){a=!1;break}a&&s.push(u.clone(o))}if(r=s.length,r<3){this._setAsBox(1,1);return}for(var c=0,h=s[0].x,n=1;n<r;++n){var d=s[n].x;(d>h||d===h&&s[n].y<s[c].y)&&(c=n,h=d)}for(var m=[],f=0,y=c;;){m[f]=y;for(var v=0,l=1;l<r;++l){if(v===y){v=l;continue}var g=u.sub(s[v],s[m[f]]),o=u.sub(s[l],s[m[f]]),A=u.crossVec2Vec2(g,o);A<0&&(v=l),A===0&&o.lengthSquared()>g.lengthSquared()&&(v=l)}if(++f,y=v,v===c)break}if(f<3){this._setAsBox(1,1);return}this.m_count=f,this.m_vertices=[];for(var n=0;n<f;++n)this.m_vertices[n]=s[m[n]];for(var n=0;n<f;++n){var B=n,F=n+1<f?n+1:0,E=u.sub(this.m_vertices[F],this.m_vertices[B]);this.m_normals[n]=u.crossVec2Num(E,1),this.m_normals[n].normalize()}this.m_centroid=Bf(this.m_vertices,f)},t.prototype._setAsBox=function(e,r,s,n){if(this.m_vertices[0]=u.neo(e,-r),this.m_vertices[1]=u.neo(e,r),this.m_vertices[2]=u.neo(-e,r),this.m_vertices[3]=u.neo(-e,-r),this.m_normals[0]=u.neo(1,0),this.m_normals[1]=u.neo(0,1),this.m_normals[2]=u.neo(-1,0),this.m_normals[3]=u.neo(0,-1),this.m_count=4,s&&u.isValid(s)){n=n||0,D(this.m_centroid,s);var o=si.identity();o.p.setVec2(s),o.q.setAngle(n);for(var a=0;a<this.m_count;++a)this.m_vertices[a]=si.mulVec2(o,this.m_vertices[a]),this.m_normals[a]=L.mulVec2(o.q,this.m_normals[a])}},t.prototype.testPoint=function(e,r){for(var s=zl(Dr,e,r),n=0;n<this.m_count;++n){var o=N(this.m_normals[n],s)-N(this.m_normals[n],this.m_vertices[n]);if(o>0)return!1}return!0},t.prototype.rayCast=function(e,r,s,n){for(var o=L.mulTVec2(s.q,u.sub(r.p1,s.p)),a=L.mulTVec2(s.q,u.sub(r.p2,s.p)),l=u.sub(a,o),c=0,h=r.maxFraction,d=-1,m=0;m<this.m_count;++m){var f=u.dot(this.m_normals[m],u.sub(this.m_vertices[m],o)),y=u.dot(this.m_normals[m],l);if(y==0){if(f<0)return!1}else y<0&&f<c*y?(c=f/y,d=m):y>0&&f<h*y&&(h=f/y);if(h<c)return!1}return d>=0?(e.fraction=c,e.normal=L.mulVec2(s.q,this.m_normals[d]),!0):!1},t.prototype.computeAABB=function(e,r,s){for(var n=1/0,o=1/0,a=-1/0,l=-1/0,c=0;c<this.m_count;++c){var h=it(Dr,r,this.m_vertices[c]);n=fa(n,h.x),a=Rh(a,h.x),o=fa(o,h.y),l=Rh(l,h.y)}Qt(e.lowerBound,n-this.m_radius,o-this.m_radius),Qt(e.upperBound,a+this.m_radius,l+this.m_radius)},t.prototype.computeMass=function(e,r){G(Cr);var s=0,n=0;G(Xi);for(var o=0;o<this.m_count;++o)Oe(Xi,this.m_vertices[o]);$(Xi,1/this.m_count,Xi);for(var a=1/3,o=0;o<this.m_count;++o){rt(tn,this.m_vertices[o],Xi),o+1<this.m_count?rt(ss,this.m_vertices[o+1],Xi):rt(ss,this.m_vertices[0],Xi);var l=lt(tn,ss),c=.5*l;s+=c,Bt(Dr,c*a,tn,c*a,ss),Oe(Cr,Dr);var h=tn.x,d=tn.y,m=ss.x,f=ss.y,y=h*h+m*h+m*m,v=d*d+f*d+f*f;n+=.25*a*l*(y+v)}e.mass=r*s,$(Cr,1/s,Cr),Zp(e.center,Cr,Xi),e.I=r*n,e.I+=e.mass*(N(e.center,e.center)-N(Cr,Cr))},t.prototype.validate=function(){for(var e=0;e<this.m_count;++e){var r=e,s=e<this.m_count-1?r+1:0,n=this.m_vertices[r];rt(zh,this.m_vertices[s],n);for(var o=0;o<this.m_count;++o)if(!(o==r||o==s)){var a=lt(zh,rt(Dr,this.m_vertices[o],n));if(a<0)return!1}}return!0},t.prototype.computeDistanceProxy=function(e){for(var r=0;r<this.m_count;++r)e.m_vertices[r]=this.m_vertices[r];e.m_vertices.length=this.m_count,e.m_count=this.m_count,e.m_radius=this.m_radius},t.TYPE="polygon",t}(Kr);function Bf(i,t){for(var e=u.zero(),r=0,s=u.zero(),n,o=1/3,n=0;n<t;++n){var a=s,l=i[n],c=n+1<t?i[n+1]:i[0],h=u.sub(l,a),d=u.sub(c,a),m=u.crossVec2Vec2(h,d),f=.5*m;r+=f,pi(Dr,1,a,1,l,1,c),ii(e,f*o,Dr)}return e.mul(1/r),e}var Cf=Math.sqrt,kf=Math.PI,Nh=I(0,0),pr=function(i){oe(t,i);function t(e,r){var s=this;return s instanceof t?(s=i.call(this)||this,s.m_type=t.TYPE,s.m_p=u.zero(),s.m_radius=1,typeof e=="object"&&u.isValid(e)?(s.m_p.setVec2(e),typeof r=="number"&&(s.m_radius=r)):typeof e=="number"&&(s.m_radius=e),s):new t(e,r)}return t.prototype._serialize=function(){return{type:this.m_type,p:this.m_p,radius:this.m_radius}},t._deserialize=function(e){return new t(e.p,e.radius)},t.prototype._reset=function(){},t.prototype.getType=function(){return this.m_type},t.prototype.getRadius=function(){return this.m_radius},t.prototype.getCenter=function(){return this.m_p},t.prototype._clone=function(){var e=new t;return e.m_type=this.m_type,e.m_radius=this.m_radius,e.m_p=this.m_p.clone(),e},t.prototype.getChildCount=function(){return 1},t.prototype.testPoint=function(e,r){var s=it(Nh,e,this.m_p);return Ir(r,s)<=this.m_radius*this.m_radius},t.prototype.rayCast=function(e,r,s,n){var o=u.add(s.p,L.mulVec2(s.q,this.m_p)),a=u.sub(r.p1,o),l=u.dot(a,a)-this.m_radius*this.m_radius,c=u.sub(r.p2,r.p1),h=u.dot(a,c),d=u.dot(c,c),m=h*h-d*l;if(m<0||d<Ee)return!1;var f=-(h+Cf(m));return 0<=f&&f<=r.maxFraction*d?(f/=d,e.fraction=f,e.normal=u.add(a,u.mulNumVec2(f,c)),e.normal.normalize(),!0):!1},t.prototype.computeAABB=function(e,r,s){var n=it(Nh,r,this.m_p);Qt(e.lowerBound,n.x-this.m_radius,n.y-this.m_radius),Qt(e.upperBound,n.x+this.m_radius,n.y+this.m_radius)},t.prototype.computeMass=function(e,r){e.mass=r*kf*this.m_radius*this.m_radius,D(e.center,this.m_p),e.I=e.mass*(.5*this.m_radius*this.m_radius+qr(this.m_p))},t.prototype.computeDistanceProxy=function(e){e.m_vertices[0]=this.m_p,e.m_vertices.length=1,e.m_count=1,e.m_radius=this.m_radius},t.TYPE="circle",t}(Kr),Mf=Math.abs,Ff=Math.PI,Ef={frequencyHz:0,dampingRatio:0},Ta=function(i){oe(t,i);function t(e,r,s,n,o){var a=this;if(!(a instanceof t))return new t(e,r,s,n,o);if(s&&n&&"m_type"in n&&"x"in s&&"y"in s){var l=s;s=n,n=l}return e=qe(e,Ef),a=i.call(this,e,r,s)||this,r=a.m_bodyA,s=a.m_bodyB,a.m_type=t.TYPE,a.m_localAnchorA=u.clone(n?r.getLocalPoint(n):e.localAnchorA||u.zero()),a.m_localAnchorB=u.clone(o?s.getLocalPoint(o):e.localAnchorB||u.zero()),a.m_length=Number.isFinite(e.length)?e.length:u.distance(r.getWorldPoint(a.m_localAnchorA),s.getWorldPoint(a.m_localAnchorB)),a.m_frequencyHz=e.frequencyHz,a.m_dampingRatio=e.dampingRatio,a.m_impulse=0,a.m_gamma=0,a.m_bias=0,a}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,length:this.m_length,impulse:this.m_impulse,gamma:this.m_gamma,bias:this.m_bias}},t._deserialize=function(e,r,s){e=ne({},e),e.bodyA=s(_t,e.bodyA,r),e.bodyB=s(_t,e.bodyB,r);var n=new t(e);return n},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),e.length>0?this.m_length=+e.length:e.length<0||(e.anchorA||e.anchorA||e.anchorA||e.anchorA)&&(this.m_length=u.distance(this.m_bodyA.getWorldPoint(this.m_localAnchorA),this.m_bodyB.getWorldPoint(this.m_localAnchorB))),Number.isFinite(e.frequencyHz)&&(this.m_frequencyHz=e.frequencyHz),Number.isFinite(e.dampingRatio)&&(this.m_dampingRatio=e.dampingRatio)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.setLength=function(e){this.m_length=e},t.prototype.getLength=function(){return this.m_length},t.prototype.setFrequency=function(e){this.m_frequencyHz=e},t.prototype.getFrequency=function(){return this.m_frequencyHz},t.prototype.setDampingRatio=function(e){this.m_dampingRatio=e},t.prototype.getDampingRatio=function(){return this.m_dampingRatio},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return u.mulNumVec2(this.m_impulse,this.m_u).mul(e)},t.prototype.getReactionTorque=function(e){return 0},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_position.c,l=this.m_bodyB.c_position.a,c=this.m_bodyB.c_velocity.v,h=this.m_bodyB.c_velocity.w,d=L.neo(s),m=L.neo(l);this.m_rA=L.mulVec2(d,u.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=L.mulVec2(m,u.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_u=u.sub(u.add(a,this.m_rB),u.add(r,this.m_rA));var f=this.m_u.length();f>H.linearSlop?this.m_u.mul(1/f):this.m_u.setNum(0,0);var y=u.crossVec2Vec2(this.m_rA,this.m_u),v=u.crossVec2Vec2(this.m_rB,this.m_u),g=this.m_invMassA+this.m_invIA*y*y+this.m_invMassB+this.m_invIB*v*v;if(this.m_mass=g!=0?1/g:0,this.m_frequencyHz>0){var A=f-this.m_length,B=2*Ff*this.m_frequencyHz,F=2*this.m_mass*this.m_dampingRatio*B,E=this.m_mass*B*B,k=e.dt;this.m_gamma=k*(F+k*E),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=A*k*E*this.m_gamma,g+=this.m_gamma,this.m_mass=g!=0?1/g:0}else this.m_gamma=0,this.m_bias=0;if(e.warmStarting){this.m_impulse*=e.dtRatio;var w=u.mulNumVec2(this.m_impulse,this.m_u);n.subMul(this.m_invMassA,w),o-=this.m_invIA*u.crossVec2Vec2(this.m_rA,w),c.addMul(this.m_invMassB,w),h+=this.m_invIB*u.crossVec2Vec2(this.m_rB,w)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(n),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.setVec2(c),this.m_bodyB.c_velocity.w=h},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,a=u.add(r,u.crossNumVec2(s,this.m_rA)),l=u.add(n,u.crossNumVec2(o,this.m_rB)),c=u.dot(this.m_u,l)-u.dot(this.m_u,a),h=-this.m_mass*(c+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=h;var d=u.mulNumVec2(h,this.m_u);r.subMul(this.m_invMassA,d),s-=this.m_invIA*u.crossVec2Vec2(this.m_rA,d),n.addMul(this.m_invMassB,d),o+=this.m_invIB*u.crossVec2Vec2(this.m_rB,d),this.m_bodyA.c_velocity.v.setVec2(r),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.setVec2(n),this.m_bodyB.c_velocity.w=o},t.prototype.solvePositionConstraints=function(e){if(this.m_frequencyHz>0)return!0;var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,a=L.neo(s),l=L.neo(o),c=L.mulSub(a,this.m_localAnchorA,this.m_localCenterA),h=L.mulSub(l,this.m_localAnchorB,this.m_localCenterB),d=u.sub(u.add(n,h),u.add(r,c)),m=d.normalize(),f=re(m-this.m_length,-H.maxLinearCorrection,H.maxLinearCorrection),y=-this.m_mass*f,v=u.mulNumVec2(y,d);return r.subMul(this.m_invMassA,v),s-=this.m_invIA*u.crossVec2Vec2(c,v),n.addMul(this.m_invMassB,v),o+=this.m_invIB*u.crossVec2Vec2(h,v),this.m_bodyA.c_position.c.setVec2(r),this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c.setVec2(n),this.m_bodyB.c_position.a=o,Mf(f)<H.linearSlop},t.TYPE="distance-joint",t}(se),Sf={maxForce:0,maxTorque:0},Ra=function(i){oe(t,i);function t(e,r,s,n){var o=this;return o instanceof t?(e=qe(e,Sf),o=i.call(this,e,r,s)||this,r=o.m_bodyA,s=o.m_bodyB,o.m_type=t.TYPE,o.m_localAnchorA=u.clone(n?r.getLocalPoint(n):e.localAnchorA||u.zero()),o.m_localAnchorB=u.clone(n?s.getLocalPoint(n):e.localAnchorB||u.zero()),o.m_linearImpulse=u.zero(),o.m_angularImpulse=0,o.m_maxForce=e.maxForce,o.m_maxTorque=e.maxTorque,o):new t(e,r,s,n)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB}},t._deserialize=function(e,r,s){e=ne({},e),e.bodyA=s(_t,e.bodyA,r),e.bodyB=s(_t,e.bodyB,r);var n=new t(e);return n},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),Number.isFinite(e.maxForce)&&(this.m_maxForce=e.maxForce),Number.isFinite(e.maxTorque)&&(this.m_maxTorque=e.maxTorque)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.setMaxForce=function(e){this.m_maxForce=e},t.prototype.getMaxForce=function(){return this.m_maxForce},t.prototype.setMaxTorque=function(e){this.m_maxTorque=e},t.prototype.getMaxTorque=function(){return this.m_maxTorque},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return u.mulNumVec2(e,this.m_linearImpulse)},t.prototype.getReactionTorque=function(e){return e*this.m_angularImpulse},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,c=L.neo(r),h=L.neo(o);this.m_rA=L.mulVec2(c,u.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=L.mulVec2(h,u.sub(this.m_localAnchorB,this.m_localCenterB));var d=this.m_invMassA,m=this.m_invMassB,f=this.m_invIA,y=this.m_invIB,v=new ni;if(v.ex.x=d+m+f*this.m_rA.y*this.m_rA.y+y*this.m_rB.y*this.m_rB.y,v.ex.y=-f*this.m_rA.x*this.m_rA.y-y*this.m_rB.x*this.m_rB.y,v.ey.x=v.ex.y,v.ey.y=d+m+f*this.m_rA.x*this.m_rA.x+y*this.m_rB.x*this.m_rB.x,this.m_linearMass=v.getInverse(),this.m_angularMass=f+y,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),e.warmStarting){this.m_linearImpulse.mul(e.dtRatio),this.m_angularImpulse*=e.dtRatio;var g=u.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);s.subMul(d,g),n-=f*(u.crossVec2Vec2(this.m_rA,g)+this.m_angularImpulse),a.addMul(m,g),l+=y*(u.crossVec2Vec2(this.m_rB,g)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=l},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,a=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,h=this.m_invIB,d=e.dt;{var m=o-s,f=-this.m_angularMass*m,y=this.m_angularImpulse,v=d*this.m_maxTorque;this.m_angularImpulse=re(this.m_angularImpulse+f,-v,v),f=this.m_angularImpulse-y,s-=c*f,o+=h*f}{var m=u.sub(u.add(n,u.crossNumVec2(o,this.m_rB)),u.add(r,u.crossNumVec2(s,this.m_rA))),f=u.neg(ni.mulVec2(this.m_linearMass,m)),y=this.m_linearImpulse;this.m_linearImpulse.add(f);var v=d*this.m_maxForce;this.m_linearImpulse.lengthSquared()>v*v&&(this.m_linearImpulse.normalize(),this.m_linearImpulse.mul(v)),f=u.sub(this.m_linearImpulse,y),r.subMul(a,f),s-=c*u.crossVec2Vec2(this.m_rA,f),n.addMul(l,f),o+=h*u.crossVec2Vec2(this.m_rB,f)}this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=o},t.prototype.solvePositionConstraints=function(e){return!0},t.TYPE="friction-joint",t}(se),er=function(){function i(t,e,r){typeof t=="object"&&t!==null?(this.ex=pt.clone(t),this.ey=pt.clone(e),this.ez=pt.clone(r)):(this.ex=pt.zero(),this.ey=pt.zero(),this.ez=pt.zero())}return i.prototype.toString=function(){return JSON.stringify(this)},i.isValid=function(t){return t===null||typeof t>"u"?!1:pt.isValid(t.ex)&&pt.isValid(t.ey)&&pt.isValid(t.ez)},i.assert=function(t){},i.prototype.setZero=function(){return this.ex.setZero(),this.ey.setZero(),this.ez.setZero(),this},i.prototype.solve33=function(t){var e=this.ey.y*this.ez.z-this.ey.z*this.ez.y,r=this.ey.z*this.ez.x-this.ey.x*this.ez.z,s=this.ey.x*this.ez.y-this.ey.y*this.ez.x,n=this.ex.x*e+this.ex.y*r+this.ex.z*s;n!==0&&(n=1/n);var o=new pt;return e=this.ey.y*this.ez.z-this.ey.z*this.ez.y,r=this.ey.z*this.ez.x-this.ey.x*this.ez.z,s=this.ey.x*this.ez.y-this.ey.y*this.ez.x,o.x=n*(t.x*e+t.y*r+t.z*s),e=t.y*this.ez.z-t.z*this.ez.y,r=t.z*this.ez.x-t.x*this.ez.z,s=t.x*this.ez.y-t.y*this.ez.x,o.y=n*(this.ex.x*e+this.ex.y*r+this.ex.z*s),e=this.ey.y*t.z-this.ey.z*t.y,r=this.ey.z*t.x-this.ey.x*t.z,s=this.ey.x*t.y-this.ey.y*t.x,o.z=n*(this.ex.x*e+this.ex.y*r+this.ex.z*s),o},i.prototype.solve22=function(t){var e=this.ex.x,r=this.ey.x,s=this.ex.y,n=this.ey.y,o=e*n-r*s;o!==0&&(o=1/o);var a=u.zero();return a.x=o*(n*t.x-r*t.y),a.y=o*(e*t.y-s*t.x),a},i.prototype.getInverse22=function(t){var e=this.ex.x,r=this.ey.x,s=this.ex.y,n=this.ey.y,o=e*n-r*s;o!==0&&(o=1/o),t.ex.x=o*n,t.ey.x=-o*r,t.ex.z=0,t.ex.y=-o*s,t.ey.y=o*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},i.prototype.getSymInverse33=function(t){var e=pt.dot(this.ex,pt.cross(this.ey,this.ez));e!==0&&(e=1/e);var r=this.ex.x,s=this.ey.x,n=this.ez.x,o=this.ey.y,a=this.ez.y,l=this.ez.z;t.ex.x=e*(o*l-a*a),t.ex.y=e*(n*a-s*l),t.ex.z=e*(s*a-n*o),t.ey.x=t.ex.y,t.ey.y=e*(r*l-n*n),t.ey.z=e*(n*s-r*a),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(r*o-s*s)},i.mul=function(t,e){if(e&&"z"in e&&"y"in e&&"x"in e){var r=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,s=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,n=t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z;return new pt(r,s,n)}else if(e&&"y"in e&&"x"in e){var r=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return u.neo(r,s)}},i.mulVec3=function(t,e){var r=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,s=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,n=t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z;return new pt(r,s,n)},i.mulVec2=function(t,e){var r=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return u.neo(r,s)},i.add=function(t,e){return new i(pt.add(t.ex,e.ex),pt.add(t.ey,e.ey),pt.add(t.ez,e.ez))},i}(),Oh=Math.abs,Wt;(function(i){i[i.inactiveLimit=0]="inactiveLimit",i[i.atLowerLimit=1]="atLowerLimit",i[i.atUpperLimit=2]="atUpperLimit",i[i.equalLimits=3]="equalLimits"})(Wt||(Wt={}));var ns={lowerAngle:0,upperAngle:0,maxMotorTorque:0,motorSpeed:0,enableLimit:!1,enableMotor:!1},Li=function(i){oe(t,i);function t(e,r,s,n){var o=this,a,l,c,h,d,m;return o instanceof t?(e=e??{},o=i.call(this,e,r,s)||this,r=o.m_bodyA,s=o.m_bodyB,o.m_mass=new er,o.m_limitState=Wt.inactiveLimit,o.m_type=t.TYPE,u.isValid(n)?o.m_localAnchorA=r.getLocalPoint(n):u.isValid(e.localAnchorA)?o.m_localAnchorA=u.clone(e.localAnchorA):o.m_localAnchorA=u.zero(),u.isValid(n)?o.m_localAnchorB=s.getLocalPoint(n):u.isValid(e.localAnchorB)?o.m_localAnchorB=u.clone(e.localAnchorB):o.m_localAnchorB=u.zero(),Number.isFinite(e.referenceAngle)?o.m_referenceAngle=e.referenceAngle:o.m_referenceAngle=s.getAngle()-r.getAngle(),o.m_impulse=new pt,o.m_motorImpulse=0,o.m_lowerAngle=(a=e.lowerAngle)!==null&&a!==void 0?a:ns.lowerAngle,o.m_upperAngle=(l=e.upperAngle)!==null&&l!==void 0?l:ns.upperAngle,o.m_maxMotorTorque=(c=e.maxMotorTorque)!==null&&c!==void 0?c:ns.maxMotorTorque,o.m_motorSpeed=(h=e.motorSpeed)!==null&&h!==void 0?h:ns.motorSpeed,o.m_enableLimit=(d=e.enableLimit)!==null&&d!==void 0?d:ns.enableLimit,o.m_enableMotor=(m=e.enableMotor)!==null&&m!==void 0?m:ns.enableMotor,o):new t(e,r,s,n)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerAngle:this.m_lowerAngle,upperAngle:this.m_upperAngle,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},t._deserialize=function(e,r,s){e=ne({},e),e.bodyA=s(_t,e.bodyA,r),e.bodyB=s(_t,e.bodyB,r);var n=new t(e);return n},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),Number.isFinite(e.referenceAngle)&&(this.m_referenceAngle=e.referenceAngle),e.enableLimit!==void 0&&(this.m_enableLimit=e.enableLimit),Number.isFinite(e.lowerAngle)&&(this.m_lowerAngle=e.lowerAngle),Number.isFinite(e.upperAngle)&&(this.m_upperAngle=e.upperAngle),Number.isFinite(e.maxMotorTorque)&&(this.m_maxMotorTorque=e.maxMotorTorque),Number.isFinite(e.motorSpeed)&&(this.m_motorSpeed=e.motorSpeed),e.enableMotor!==void 0&&(this.m_enableMotor=e.enableMotor)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.getReferenceAngle=function(){return this.m_referenceAngle},t.prototype.getJointAngle=function(){var e=this.m_bodyA,r=this.m_bodyB;return r.m_sweep.a-e.m_sweep.a-this.m_referenceAngle},t.prototype.getJointSpeed=function(){var e=this.m_bodyA,r=this.m_bodyB;return r.m_angularVelocity-e.m_angularVelocity},t.prototype.isMotorEnabled=function(){return this.m_enableMotor},t.prototype.enableMotor=function(e){e!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=e)},t.prototype.getMotorTorque=function(e){return e*this.m_motorImpulse},t.prototype.setMotorSpeed=function(e){e!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=e)},t.prototype.getMotorSpeed=function(){return this.m_motorSpeed},t.prototype.setMaxMotorTorque=function(e){e!=this.m_maxMotorTorque&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=e)},t.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},t.prototype.isLimitEnabled=function(){return this.m_enableLimit},t.prototype.enableLimit=function(e){e!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=e,this.m_impulse.z=0)},t.prototype.getLowerLimit=function(){return this.m_lowerAngle},t.prototype.getUpperLimit=function(){return this.m_upperAngle},t.prototype.setLimits=function(e,r){(e!=this.m_lowerAngle||r!=this.m_upperAngle)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=e,this.m_upperAngle=r)},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return u.neo(this.m_impulse.x,this.m_impulse.y).mul(e)},t.prototype.getReactionTorque=function(e){return e*this.m_impulse.z},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,c=L.neo(r),h=L.neo(o);this.m_rA=L.mulVec2(c,u.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=L.mulVec2(h,u.sub(this.m_localAnchorB,this.m_localCenterB));var d=this.m_invMassA,m=this.m_invMassB,f=this.m_invIA,y=this.m_invIB,v=f+y===0;if(this.m_mass.ex.x=d+m+this.m_rA.y*this.m_rA.y*f+this.m_rB.y*this.m_rB.y*y,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*f-this.m_rB.y*this.m_rB.x*y,this.m_mass.ez.x=-this.m_rA.y*f-this.m_rB.y*y,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=d+m+this.m_rA.x*this.m_rA.x*f+this.m_rB.x*this.m_rB.x*y,this.m_mass.ez.y=this.m_rA.x*f+this.m_rB.x*y,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=f+y,this.m_motorMass=f+y,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(this.m_enableMotor==!1||v)&&(this.m_motorImpulse=0),this.m_enableLimit&&v==!1){var g=o-r-this.m_referenceAngle;Oh(this.m_upperAngle-this.m_lowerAngle)<2*H.angularSlop?this.m_limitState=Wt.equalLimits:g<=this.m_lowerAngle?(this.m_limitState!=Wt.atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=Wt.atLowerLimit):g>=this.m_upperAngle?(this.m_limitState!=Wt.atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=Wt.atUpperLimit):(this.m_limitState=Wt.inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=Wt.inactiveLimit;if(e.warmStarting){this.m_impulse.mul(e.dtRatio),this.m_motorImpulse*=e.dtRatio;var A=u.neo(this.m_impulse.x,this.m_impulse.y);s.subMul(d,A),n-=f*(u.crossVec2Vec2(this.m_rA,A)+this.m_motorImpulse+this.m_impulse.z),a.addMul(m,A),l+=y*(u.crossVec2Vec2(this.m_rB,A)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=l},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,a=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,h=this.m_invIB,d=c+h===0;if(this.m_enableMotor&&this.m_limitState!=Wt.equalLimits&&d==!1){var m=o-s-this.m_motorSpeed,f=-this.m_motorMass*m,y=this.m_motorImpulse,v=e.dt*this.m_maxMotorTorque;this.m_motorImpulse=re(this.m_motorImpulse+f,-v,v),f=this.m_motorImpulse-y,s-=c*f,o+=h*f}if(this.m_enableLimit&&this.m_limitState!=Wt.inactiveLimit&&d==!1){var g=u.zero();g.addCombine(1,n,1,u.crossNumVec2(o,this.m_rB)),g.subCombine(1,r,1,u.crossNumVec2(s,this.m_rA));var A=o-s,m=new pt(g.x,g.y,A),f=pt.neg(this.m_mass.solve33(m));if(this.m_limitState==Wt.equalLimits)this.m_impulse.add(f);else if(this.m_limitState==Wt.atLowerLimit){var B=this.m_impulse.z+f.z;if(B<0){var F=u.combine(-1,g,this.m_impulse.z,u.neo(this.m_mass.ez.x,this.m_mass.ez.y)),E=this.m_mass.solve22(F);f.x=E.x,f.y=E.y,f.z=-this.m_impulse.z,this.m_impulse.x+=E.x,this.m_impulse.y+=E.y,this.m_impulse.z=0}else this.m_impulse.add(f)}else if(this.m_limitState==Wt.atUpperLimit){var B=this.m_impulse.z+f.z;if(B>0){var F=u.combine(-1,g,this.m_impulse.z,u.neo(this.m_mass.ez.x,this.m_mass.ez.y)),E=this.m_mass.solve22(F);f.x=E.x,f.y=E.y,f.z=-this.m_impulse.z,this.m_impulse.x+=E.x,this.m_impulse.y+=E.y,this.m_impulse.z=0}else this.m_impulse.add(f)}var k=u.neo(f.x,f.y);r.subMul(a,k),s-=c*(u.crossVec2Vec2(this.m_rA,k)+f.z),n.addMul(l,k),o+=h*(u.crossVec2Vec2(this.m_rB,k)+f.z)}else{var m=u.zero();m.addCombine(1,n,1,u.crossNumVec2(o,this.m_rB)),m.subCombine(1,r,1,u.crossNumVec2(s,this.m_rA));var f=this.m_mass.solve22(u.neg(m));this.m_impulse.x+=f.x,this.m_impulse.y+=f.y,r.subMul(a,f),s-=c*u.crossVec2Vec2(this.m_rA,f),n.addMul(l,f),o+=h*u.crossVec2Vec2(this.m_rB,f)}this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=o},t.prototype.solvePositionConstraints=function(e){var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,a=L.neo(s),l=L.neo(o),c=0,h=0,d=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&this.m_limitState!=Wt.inactiveLimit&&d==!1){var m=o-s-this.m_referenceAngle,f=0;if(this.m_limitState==Wt.equalLimits){var y=re(m-this.m_lowerAngle,-H.maxAngularCorrection,H.maxAngularCorrection);f=-this.m_motorMass*y,c=Oh(y)}else if(this.m_limitState==Wt.atLowerLimit){var y=m-this.m_lowerAngle;c=-y,y=re(y+H.angularSlop,-H.maxAngularCorrection,0),f=-this.m_motorMass*y}else if(this.m_limitState==Wt.atUpperLimit){var y=m-this.m_upperAngle;c=y,y=re(y-H.angularSlop,0,H.maxAngularCorrection),f=-this.m_motorMass*y}s-=this.m_invIA*f,o+=this.m_invIB*f}{a.setAngle(s),l.setAngle(o);var v=L.mulVec2(a,u.sub(this.m_localAnchorA,this.m_localCenterA)),g=L.mulVec2(l,u.sub(this.m_localAnchorB,this.m_localCenterB)),y=u.zero();y.addCombine(1,n,1,g),y.subCombine(1,r,1,v),h=y.length();var A=this.m_invMassA,B=this.m_invMassB,F=this.m_invIA,E=this.m_invIB,k=new ni;k.ex.x=A+B+F*v.y*v.y+E*g.y*g.y,k.ex.y=-F*v.x*v.y-E*g.x*g.y,k.ey.x=k.ex.y,k.ey.y=A+B+F*v.x*v.x+E*g.x*g.x;var w=u.neg(k.solve(y));r.subMul(A,w),s-=F*u.crossVec2Vec2(v,w),n.addMul(B,w),o+=E*u.crossVec2Vec2(g,w)}return this.m_bodyA.c_position.c.setVec2(r),this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c.setVec2(n),this.m_bodyB.c_position.a=o,h<=H.linearSlop&&c<=H.angularSlop},t.TYPE="revolute-joint",t}(se),en=Math.abs,Uh=Math.max,Df=Math.min,de;(function(i){i[i.inactiveLimit=0]="inactiveLimit",i[i.atLowerLimit=1]="atLowerLimit",i[i.atUpperLimit=2]="atUpperLimit",i[i.equalLimits=3]="equalLimits"})(de||(de={}));var Pf={enableLimit:!1,lowerTranslation:0,upperTranslation:0,enableMotor:!1,maxMotorForce:0,motorSpeed:0},za=function(i){oe(t,i);function t(e,r,s,n,o){var a=this;return a instanceof t?(e=qe(e,Pf),a=i.call(this,e,r,s)||this,r=a.m_bodyA,s=a.m_bodyB,a.m_type=t.TYPE,a.m_localAnchorA=u.clone(n?r.getLocalPoint(n):e.localAnchorA||u.zero()),a.m_localAnchorB=u.clone(n?s.getLocalPoint(n):e.localAnchorB||u.zero()),a.m_localXAxisA=u.clone(o?r.getLocalVector(o):e.localAxisA||u.neo(1,0)),a.m_localXAxisA.normalize(),a.m_localYAxisA=u.crossNumVec2(1,a.m_localXAxisA),a.m_referenceAngle=Number.isFinite(e.referenceAngle)?e.referenceAngle:s.getAngle()-r.getAngle(),a.m_impulse=new pt,a.m_motorMass=0,a.m_motorImpulse=0,a.m_lowerTranslation=e.lowerTranslation,a.m_upperTranslation=e.upperTranslation,a.m_maxMotorForce=e.maxMotorForce,a.m_motorSpeed=e.motorSpeed,a.m_enableLimit=e.enableLimit,a.m_enableMotor=e.enableMotor,a.m_limitState=de.inactiveLimit,a.m_axis=u.zero(),a.m_perp=u.zero(),a.m_K=new er,a):new t(e,r,s,n,o)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerTranslation:this.m_lowerTranslation,upperTranslation:this.m_upperTranslation,maxMotorForce:this.m_maxMotorForce,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA,referenceAngle:this.m_referenceAngle}},t._deserialize=function(e,r,s){e=ne({},e),e.bodyA=s(_t,e.bodyA,r),e.bodyB=s(_t,e.bodyB,r),e.localAxisA=u.clone(e.localAxisA);var n=new t(e);return n},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),e.localAxisA&&(this.m_localXAxisA.setVec2(e.localAxisA),this.m_localYAxisA.setVec2(u.crossNumVec2(1,e.localAxisA))),Number.isFinite(e.referenceAngle)&&(this.m_referenceAngle=e.referenceAngle),typeof e.enableLimit<"u"&&(this.m_enableLimit=!!e.enableLimit),Number.isFinite(e.lowerTranslation)&&(this.m_lowerTranslation=e.lowerTranslation),Number.isFinite(e.upperTranslation)&&(this.m_upperTranslation=e.upperTranslation),typeof e.enableMotor<"u"&&(this.m_enableMotor=!!e.enableMotor),Number.isFinite(e.maxMotorForce)&&(this.m_maxMotorForce=e.maxMotorForce),Number.isFinite(e.motorSpeed)&&(this.m_motorSpeed=e.motorSpeed)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.getLocalAxisA=function(){return this.m_localXAxisA},t.prototype.getReferenceAngle=function(){return this.m_referenceAngle},t.prototype.getJointTranslation=function(){var e=this.m_bodyA.getWorldPoint(this.m_localAnchorA),r=this.m_bodyB.getWorldPoint(this.m_localAnchorB),s=u.sub(r,e),n=this.m_bodyA.getWorldVector(this.m_localXAxisA),o=u.dot(s,n);return o},t.prototype.getJointSpeed=function(){var e=this.m_bodyA,r=this.m_bodyB,s=L.mulVec2(e.m_xf.q,u.sub(this.m_localAnchorA,e.m_sweep.localCenter)),n=L.mulVec2(r.m_xf.q,u.sub(this.m_localAnchorB,r.m_sweep.localCenter)),o=u.add(e.m_sweep.c,s),a=u.add(r.m_sweep.c,n),l=u.sub(a,o),c=L.mulVec2(e.m_xf.q,this.m_localXAxisA),h=e.m_linearVelocity,d=r.m_linearVelocity,m=e.m_angularVelocity,f=r.m_angularVelocity,y=u.dot(l,u.crossNumVec2(m,c))+u.dot(c,u.sub(u.addCrossNumVec2(d,f,n),u.addCrossNumVec2(h,m,s)));return y},t.prototype.isLimitEnabled=function(){return this.m_enableLimit},t.prototype.enableLimit=function(e){e!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=e,this.m_impulse.z=0)},t.prototype.getLowerLimit=function(){return this.m_lowerTranslation},t.prototype.getUpperLimit=function(){return this.m_upperTranslation},t.prototype.setLimits=function(e,r){(e!=this.m_lowerTranslation||r!=this.m_upperTranslation)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=r,this.m_impulse.z=0)},t.prototype.isMotorEnabled=function(){return this.m_enableMotor},t.prototype.enableMotor=function(e){e!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=e)},t.prototype.setMotorSpeed=function(e){e!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=e)},t.prototype.setMaxMotorForce=function(e){e!=this.m_maxMotorForce&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorForce=e)},t.prototype.getMaxMotorForce=function(){return this.m_maxMotorForce},t.prototype.getMotorSpeed=function(){return this.m_motorSpeed},t.prototype.getMotorForce=function(e){return e*this.m_motorImpulse},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return u.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis).mul(e)},t.prototype.getReactionTorque=function(e){return e*this.m_impulse.y},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_position.c,l=this.m_bodyB.c_position.a,c=this.m_bodyB.c_velocity.v,h=this.m_bodyB.c_velocity.w,d=L.neo(s),m=L.neo(l),f=L.mulVec2(d,u.sub(this.m_localAnchorA,this.m_localCenterA)),y=L.mulVec2(m,u.sub(this.m_localAnchorB,this.m_localCenterB)),v=u.zero();v.addCombine(1,a,1,y),v.subCombine(1,r,1,f);var g=this.m_invMassA,A=this.m_invMassB,B=this.m_invIA,F=this.m_invIB;this.m_axis=L.mulVec2(d,this.m_localXAxisA),this.m_a1=u.crossVec2Vec2(u.add(v,f),this.m_axis),this.m_a2=u.crossVec2Vec2(y,this.m_axis),this.m_motorMass=g+A+B*this.m_a1*this.m_a1+F*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass);{this.m_perp=L.mulVec2(d,this.m_localYAxisA),this.m_s1=u.crossVec2Vec2(u.add(v,f),this.m_perp),this.m_s2=u.crossVec2Vec2(y,this.m_perp),u.crossVec2Vec2(f,this.m_perp);var E=g+A+B*this.m_s1*this.m_s1+F*this.m_s2*this.m_s2,k=B*this.m_s1+F*this.m_s2,w=B*this.m_s1*this.m_a1+F*this.m_s2*this.m_a2,b=B+F;b==0&&(b=1);var M=B*this.m_a1+F*this.m_a2,V=g+A+B*this.m_a1*this.m_a1+F*this.m_a2*this.m_a2;this.m_K.ex.set(E,k,w),this.m_K.ey.set(k,b,M),this.m_K.ez.set(w,M,V)}if(this.m_enableLimit){var T=u.dot(this.m_axis,v);en(this.m_upperTranslation-this.m_lowerTranslation)<2*H.linearSlop?this.m_limitState=de.equalLimits:T<=this.m_lowerTranslation?this.m_limitState!=de.atLowerLimit&&(this.m_limitState=de.atLowerLimit,this.m_impulse.z=0):T>=this.m_upperTranslation?this.m_limitState!=de.atUpperLimit&&(this.m_limitState=de.atUpperLimit,this.m_impulse.z=0):(this.m_limitState=de.inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=de.inactiveLimit,this.m_impulse.z=0;if(this.m_enableMotor==!1&&(this.m_motorImpulse=0),e.warmStarting){this.m_impulse.mul(e.dtRatio),this.m_motorImpulse*=e.dtRatio;var z=u.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis),O=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,J=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;n.subMul(g,z),o-=B*O,c.addMul(A,z),h+=F*J}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(n),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.setVec2(c),this.m_bodyB.c_velocity.w=h},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,a=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,h=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!=de.equalLimits){var d=u.dot(this.m_axis,u.sub(n,r))+this.m_a2*o-this.m_a1*s,m=this.m_motorMass*(this.m_motorSpeed-d),f=this.m_motorImpulse,y=e.dt*this.m_maxMotorForce;this.m_motorImpulse=re(this.m_motorImpulse+m,-y,y),m=this.m_motorImpulse-f;var v=u.mulNumVec2(m,this.m_axis),g=m*this.m_a1,A=m*this.m_a2;r.subMul(a,v),s-=c*g,n.addMul(l,v),o+=h*A}var B=u.zero();if(B.x+=u.dot(this.m_perp,n)+this.m_s2*o,B.x-=u.dot(this.m_perp,r)+this.m_s1*s,B.y=o-s,this.m_enableLimit&&this.m_limitState!=de.inactiveLimit){var F=0;F+=u.dot(this.m_axis,n)+this.m_a2*o,F-=u.dot(this.m_axis,r)+this.m_a1*s;var d=new pt(B.x,B.y,F),E=pt.clone(this.m_impulse),k=this.m_K.solve33(pt.neg(d));this.m_impulse.add(k),this.m_limitState==de.atLowerLimit?this.m_impulse.z=Uh(this.m_impulse.z,0):this.m_limitState==de.atUpperLimit&&(this.m_impulse.z=Df(this.m_impulse.z,0));var w=u.combine(-1,B,-(this.m_impulse.z-E.z),u.neo(this.m_K.ez.x,this.m_K.ez.y)),b=u.add(this.m_K.solve22(w),u.neo(E.x,E.y));this.m_impulse.x=b.x,this.m_impulse.y=b.y,k=pt.sub(this.m_impulse,E);var v=u.combine(k.x,this.m_perp,k.z,this.m_axis),g=k.x*this.m_s1+k.y+k.z*this.m_a1,A=k.x*this.m_s2+k.y+k.z*this.m_a2;r.subMul(a,v),s-=c*g,n.addMul(l,v),o+=h*A}else{var k=this.m_K.solve22(u.neg(B));this.m_impulse.x+=k.x,this.m_impulse.y+=k.y;var v=u.mulNumVec2(k.x,this.m_perp),g=k.x*this.m_s1+k.y,A=k.x*this.m_s2+k.y;r.subMul(a,v),s-=c*g,n.addMul(l,v),o+=h*A}this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=o},t.prototype.solvePositionConstraints=function(e){var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,a=L.neo(s),l=L.neo(o),c=this.m_invMassA,h=this.m_invMassB,d=this.m_invIA,m=this.m_invIB,f=L.mulVec2(a,u.sub(this.m_localAnchorA,this.m_localCenterA)),y=L.mulVec2(l,u.sub(this.m_localAnchorB,this.m_localCenterB)),v=u.sub(u.add(n,y),u.add(r,f)),g=L.mulVec2(a,this.m_localXAxisA),A=u.crossVec2Vec2(u.add(v,f),g),B=u.crossVec2Vec2(y,g),F=L.mulVec2(a,this.m_localYAxisA),E=u.crossVec2Vec2(u.add(v,f),F),k=u.crossVec2Vec2(y,F),w=new pt,b=u.zero();b.x=u.dot(F,v),b.y=o-s-this.m_referenceAngle;var M=en(b.x),V=en(b.y),T=H.linearSlop,z=H.maxLinearCorrection,O=!1,J=0;if(this.m_enableLimit){var W=u.dot(g,v);en(this.m_upperTranslation-this.m_lowerTranslation)<2*T?(J=re(W,-z,z),M=Uh(M,en(W)),O=!0):W<=this.m_lowerTranslation?(J=re(W-this.m_lowerTranslation+T,-z,0),M=Math.max(M,this.m_lowerTranslation-W),O=!0):W>=this.m_upperTranslation&&(J=re(W-this.m_upperTranslation-T,0,z),M=Math.max(M,W-this.m_upperTranslation),O=!0)}if(O){var tt=c+h+d*E*E+m*k*k,K=d*E+m*k,Z=d*E*A+m*k*B,ot=d+m;ot==0&&(ot=1);var Y=d*A+m*B,ct=c+h+d*A*A+m*B*B,ft=new er;ft.ex.set(tt,K,Z),ft.ey.set(K,ot,Y),ft.ez.set(Z,Y,ct);var X=new pt;X.x=b.x,X.y=b.y,X.z=J,w=ft.solve33(pt.neg(X))}else{var tt=c+h+d*E*E+m*k*k,K=d*E+m*k,ot=d+m;ot==0&&(ot=1);var ft=new ni;ft.ex.setNum(tt,K),ft.ey.setNum(K,ot);var Zt=ft.solve(u.neg(b));w.x=Zt.x,w.y=Zt.y,w.z=0}var he=u.combine(w.x,F,w.z,g),ge=w.x*E+w.y+w.z*A,bi=w.x*k+w.y+w.z*B;return r.subMul(c,he),s-=d*ge,n.addMul(h,he),o+=m*bi,this.m_bodyA.c_position.c=r,this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c=n,this.m_bodyB.c_position.a=o,M<=H.linearSlop&&V<=H.angularSlop},t.TYPE="prismatic-joint",t}(se),Vf={ratio:1},Na=function(i){oe(t,i);function t(e,r,s,n,o,a){var l=this;if(!(l instanceof t))return new t(e,r,s,n,o,a);e=qe(e,Vf),l=i.call(this,e,r,s)||this,r=l.m_bodyA,s=l.m_bodyB,l.m_type=t.TYPE,l.m_joint1=n||e.joint1,l.m_joint2=o||e.joint2,l.m_ratio=Number.isFinite(a)?a:e.ratio,l.m_type1=l.m_joint1.getType(),l.m_type2=l.m_joint2.getType();var c,h;l.m_bodyC=l.m_joint1.getBodyA(),l.m_bodyA=l.m_joint1.getBodyB();var d=l.m_bodyA.m_xf,m=l.m_bodyA.m_sweep.a,f=l.m_bodyC.m_xf,y=l.m_bodyC.m_sweep.a;if(l.m_type1===Li.TYPE){var v=l.m_joint1;l.m_localAnchorC=v.m_localAnchorA,l.m_localAnchorA=v.m_localAnchorB,l.m_referenceAngleA=v.m_referenceAngle,l.m_localAxisC=u.zero(),c=m-y-l.m_referenceAngleA}else{var g=l.m_joint1;l.m_localAnchorC=g.m_localAnchorA,l.m_localAnchorA=g.m_localAnchorB,l.m_referenceAngleA=g.m_referenceAngle,l.m_localAxisC=g.m_localXAxisA;var A=l.m_localAnchorC,B=L.mulTVec2(f.q,u.add(L.mulVec2(d.q,l.m_localAnchorA),u.sub(d.p,f.p)));c=u.dot(B,l.m_localAxisC)-u.dot(A,l.m_localAxisC)}l.m_bodyD=l.m_joint2.getBodyA(),l.m_bodyB=l.m_joint2.getBodyB();var F=l.m_bodyB.m_xf,E=l.m_bodyB.m_sweep.a,k=l.m_bodyD.m_xf,w=l.m_bodyD.m_sweep.a;if(l.m_type2===Li.TYPE){var v=l.m_joint2;l.m_localAnchorD=v.m_localAnchorA,l.m_localAnchorB=v.m_localAnchorB,l.m_referenceAngleB=v.m_referenceAngle,l.m_localAxisD=u.zero(),h=E-w-l.m_referenceAngleB}else{var g=l.m_joint2;l.m_localAnchorD=g.m_localAnchorA,l.m_localAnchorB=g.m_localAnchorB,l.m_referenceAngleB=g.m_referenceAngle,l.m_localAxisD=g.m_localXAxisA;var b=l.m_localAnchorD,M=L.mulTVec2(k.q,u.add(L.mulVec2(F.q,l.m_localAnchorB),u.sub(F.p,k.p)));h=u.dot(M,l.m_localAxisD)-u.dot(b,l.m_localAxisD)}return l.m_constant=c+l.m_ratio*h,l.m_impulse=0,l}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,joint1:this.m_joint1,joint2:this.m_joint2,ratio:this.m_ratio}},t._deserialize=function(e,r,s){e=ne({},e),e.bodyA=s(_t,e.bodyA,r),e.bodyB=s(_t,e.bodyB,r),e.joint1=s(se,e.joint1,r),e.joint2=s(se,e.joint2,r);var n=new t(e);return n},t.prototype._reset=function(e){Number.isFinite(e.ratio)&&(this.m_ratio=e.ratio)},t.prototype.getJoint1=function(){return this.m_joint1},t.prototype.getJoint2=function(){return this.m_joint2},t.prototype.setRatio=function(e){this.m_ratio=e},t.prototype.getRatio=function(){return this.m_ratio},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return u.mulNumVec2(this.m_impulse,this.m_JvAC).mul(e)},t.prototype.getReactionTorque=function(e){var r=this.m_impulse*this.m_JwA;return e*r},t.prototype.initVelocityConstraints=function(e){this.m_lcA=this.m_bodyA.m_sweep.localCenter,this.m_lcB=this.m_bodyB.m_sweep.localCenter,this.m_lcC=this.m_bodyC.m_sweep.localCenter,this.m_lcD=this.m_bodyD.m_sweep.localCenter,this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var r=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,c=this.m_bodyC.c_position.a,h=this.m_bodyC.c_velocity.v,d=this.m_bodyC.c_velocity.w,m=this.m_bodyD.c_position.a,f=this.m_bodyD.c_velocity.v,y=this.m_bodyD.c_velocity.w,v=L.neo(r),g=L.neo(o),A=L.neo(c),B=L.neo(m);if(this.m_mass=0,this.m_type1==Li.TYPE)this.m_JvAC=u.zero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var F=L.mulVec2(A,this.m_localAxisC),E=L.mulSub(A,this.m_localAnchorC,this.m_lcC),k=L.mulSub(v,this.m_localAnchorA,this.m_lcA);this.m_JvAC=F,this.m_JwC=u.crossVec2Vec2(E,F),this.m_JwA=u.crossVec2Vec2(k,F),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_type2==Li.TYPE)this.m_JvBD=u.zero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var F=L.mulVec2(B,this.m_localAxisD),w=L.mulSub(B,this.m_localAnchorD,this.m_lcD),b=L.mulSub(g,this.m_localAnchorB,this.m_lcB);this.m_JvBD=u.mulNumVec2(this.m_ratio,F),this.m_JwD=this.m_ratio*u.crossVec2Vec2(w,F),this.m_JwB=this.m_ratio*u.crossVec2Vec2(b,F),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,e.warmStarting?(s.addMul(this.m_mA*this.m_impulse,this.m_JvAC),n+=this.m_iA*this.m_impulse*this.m_JwA,a.addMul(this.m_mB*this.m_impulse,this.m_JvBD),l+=this.m_iB*this.m_impulse*this.m_JwB,h.subMul(this.m_mC*this.m_impulse,this.m_JvAC),d-=this.m_iC*this.m_impulse*this.m_JwC,f.subMul(this.m_mD*this.m_impulse,this.m_JvBD),y-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,this.m_bodyA.c_velocity.v.setVec2(s),this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v.setVec2(a),this.m_bodyB.c_velocity.w=l,this.m_bodyC.c_velocity.v.setVec2(h),this.m_bodyC.c_velocity.w=d,this.m_bodyD.c_velocity.v.setVec2(f),this.m_bodyD.c_velocity.w=y},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,a=this.m_bodyC.c_velocity.v,l=this.m_bodyC.c_velocity.w,c=this.m_bodyD.c_velocity.v,h=this.m_bodyD.c_velocity.w,d=u.dot(this.m_JvAC,r)-u.dot(this.m_JvAC,a)+u.dot(this.m_JvBD,n)-u.dot(this.m_JvBD,c);d+=this.m_JwA*s-this.m_JwC*l+(this.m_JwB*o-this.m_JwD*h);var m=-this.m_mass*d;this.m_impulse+=m,r.addMul(this.m_mA*m,this.m_JvAC),s+=this.m_iA*m*this.m_JwA,n.addMul(this.m_mB*m,this.m_JvBD),o+=this.m_iB*m*this.m_JwB,a.subMul(this.m_mC*m,this.m_JvAC),l-=this.m_iC*m*this.m_JwC,c.subMul(this.m_mD*m,this.m_JvBD),h-=this.m_iD*m*this.m_JwD,this.m_bodyA.c_velocity.v.setVec2(r),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.setVec2(n),this.m_bodyB.c_velocity.w=o,this.m_bodyC.c_velocity.v.setVec2(a),this.m_bodyC.c_velocity.w=l,this.m_bodyD.c_velocity.v.setVec2(c),this.m_bodyD.c_velocity.w=h},t.prototype.solvePositionConstraints=function(e){var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,a=this.m_bodyC.c_position.c,l=this.m_bodyC.c_position.a,c=this.m_bodyD.c_position.c,h=this.m_bodyD.c_position.a,d=L.neo(s),m=L.neo(o),f=L.neo(l),y=L.neo(h),v=0,g,A,B,F,E,k,w,b,M=0;if(this.m_type1==Li.TYPE)B=u.zero(),E=1,w=1,M+=this.m_iA+this.m_iC,g=s-l-this.m_referenceAngleA;else{var V=L.mulVec2(f,this.m_localAxisC),T=L.mulSub(f,this.m_localAnchorC,this.m_lcC),z=L.mulSub(d,this.m_localAnchorA,this.m_lcA);B=V,w=u.crossVec2Vec2(T,V),E=u.crossVec2Vec2(z,V),M+=this.m_mC+this.m_mA+this.m_iC*w*w+this.m_iA*E*E;var O=u.sub(this.m_localAnchorC,this.m_lcC),J=L.mulTVec2(f,u.add(z,u.sub(r,a)));g=u.dot(u.sub(J,O),this.m_localAxisC)}if(this.m_type2==Li.TYPE)F=u.zero(),k=this.m_ratio,b=this.m_ratio,M+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),A=o-h-this.m_referenceAngleB;else{var V=L.mulVec2(y,this.m_localAxisD),W=L.mulSub(y,this.m_localAnchorD,this.m_lcD),tt=L.mulSub(m,this.m_localAnchorB,this.m_lcB);F=u.mulNumVec2(this.m_ratio,V),b=this.m_ratio*u.crossVec2Vec2(W,V),k=this.m_ratio*u.crossVec2Vec2(tt,V),M+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*b*b+this.m_iB*k*k;var K=u.sub(this.m_localAnchorD,this.m_lcD),Z=L.mulTVec2(y,u.add(tt,u.sub(n,c)));A=u.dot(Z,this.m_localAxisD)-u.dot(K,this.m_localAxisD)}var ot=g+this.m_ratio*A-this.m_constant,Y=0;return M>0&&(Y=-ot/M),r.addMul(this.m_mA*Y,B),s+=this.m_iA*Y*E,n.addMul(this.m_mB*Y,F),o+=this.m_iB*Y*k,a.subMul(this.m_mC*Y,B),l-=this.m_iC*Y*w,c.subMul(this.m_mD*Y,F),h-=this.m_iD*Y*b,this.m_bodyA.c_position.c.setVec2(r),this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c.setVec2(n),this.m_bodyB.c_position.a=o,this.m_bodyC.c_position.c.setVec2(a),this.m_bodyC.c_position.a=l,this.m_bodyD.c_position.c.setVec2(c),this.m_bodyD.c_position.a=h,v<H.linearSlop},t.TYPE="gear-joint",t}(se),qf={maxForce:1,maxTorque:1,correctionFactor:.3},Oa=function(i){oe(t,i);function t(e,r,s){var n=this;return n instanceof t?(e=qe(e,qf),n=i.call(this,e,r,s)||this,r=n.m_bodyA,s=n.m_bodyB,n.m_type=t.TYPE,n.m_linearOffset=u.isValid(e.linearOffset)?u.clone(e.linearOffset):r.getLocalPoint(s.getPosition()),n.m_angularOffset=Number.isFinite(e.angularOffset)?e.angularOffset:s.getAngle()-r.getAngle(),n.m_linearImpulse=u.zero(),n.m_angularImpulse=0,n.m_maxForce=e.maxForce,n.m_maxTorque=e.maxTorque,n.m_correctionFactor=e.correctionFactor,n):new t(e,r,s)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,correctionFactor:this.m_correctionFactor,linearOffset:this.m_linearOffset,angularOffset:this.m_angularOffset}},t._deserialize=function(e,r,s){e=ne({},e),e.bodyA=s(_t,e.bodyA,r),e.bodyB=s(_t,e.bodyB,r);var n=new t(e);return n},t.prototype._reset=function(e){Number.isFinite(e.angularOffset)&&(this.m_angularOffset=e.angularOffset),Number.isFinite(e.maxForce)&&(this.m_maxForce=e.maxForce),Number.isFinite(e.maxTorque)&&(this.m_maxTorque=e.maxTorque),Number.isFinite(e.correctionFactor)&&(this.m_correctionFactor=e.correctionFactor),u.isValid(e.linearOffset)&&this.m_linearOffset.set(e.linearOffset)},t.prototype.setMaxForce=function(e){this.m_maxForce=e},t.prototype.getMaxForce=function(){return this.m_maxForce},t.prototype.setMaxTorque=function(e){this.m_maxTorque=e},t.prototype.getMaxTorque=function(){return this.m_maxTorque},t.prototype.setCorrectionFactor=function(e){this.m_correctionFactor=e},t.prototype.getCorrectionFactor=function(){return this.m_correctionFactor},t.prototype.setLinearOffset=function(e){(e.x!=this.m_linearOffset.x||e.y!=this.m_linearOffset.y)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_linearOffset.set(e))},t.prototype.getLinearOffset=function(){return this.m_linearOffset},t.prototype.setAngularOffset=function(e){e!=this.m_angularOffset&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_angularOffset=e)},t.prototype.getAngularOffset=function(){return this.m_angularOffset},t.prototype.getAnchorA=function(){return this.m_bodyA.getPosition()},t.prototype.getAnchorB=function(){return this.m_bodyB.getPosition()},t.prototype.getReactionForce=function(e){return u.mulNumVec2(e,this.m_linearImpulse)},t.prototype.getReactionTorque=function(e){return e*this.m_angularImpulse},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_position.c,l=this.m_bodyB.c_position.a,c=this.m_bodyB.c_velocity.v,h=this.m_bodyB.c_velocity.w,d=L.neo(s),m=L.neo(l);this.m_rA=L.mulVec2(d,u.sub(this.m_linearOffset,this.m_localCenterA)),this.m_rB=L.mulVec2(m,u.neg(this.m_localCenterB));var f=this.m_invMassA,y=this.m_invMassB,v=this.m_invIA,g=this.m_invIB,A=new ni;if(A.ex.x=f+y+v*this.m_rA.y*this.m_rA.y+g*this.m_rB.y*this.m_rB.y,A.ex.y=-v*this.m_rA.x*this.m_rA.y-g*this.m_rB.x*this.m_rB.y,A.ey.x=A.ex.y,A.ey.y=f+y+v*this.m_rA.x*this.m_rA.x+g*this.m_rB.x*this.m_rB.x,this.m_linearMass=A.getInverse(),this.m_angularMass=v+g,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),this.m_linearError=u.zero(),this.m_linearError.addCombine(1,a,1,this.m_rB),this.m_linearError.subCombine(1,r,1,this.m_rA),this.m_angularError=l-s-this.m_angularOffset,e.warmStarting){this.m_linearImpulse.mul(e.dtRatio),this.m_angularImpulse*=e.dtRatio;var B=u.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);n.subMul(f,B),o-=v*(u.crossVec2Vec2(this.m_rA,B)+this.m_angularImpulse),c.addMul(y,B),h+=g*(u.crossVec2Vec2(this.m_rB,B)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=n,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=c,this.m_bodyB.c_velocity.w=h},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,a=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,h=this.m_invIB,d=e.dt,m=e.inv_dt;{var f=o-s+m*this.m_correctionFactor*this.m_angularError,y=-this.m_angularMass*f,v=this.m_angularImpulse,g=d*this.m_maxTorque;this.m_angularImpulse=re(this.m_angularImpulse+y,-g,g),y=this.m_angularImpulse-v,s-=c*y,o+=h*y}{var f=u.zero();f.addCombine(1,n,1,u.crossNumVec2(o,this.m_rB)),f.subCombine(1,r,1,u.crossNumVec2(s,this.m_rA)),f.addMul(m*this.m_correctionFactor,this.m_linearError);var y=u.neg(ni.mulVec2(this.m_linearMass,f)),v=u.clone(this.m_linearImpulse);this.m_linearImpulse.add(y);var g=d*this.m_maxForce;this.m_linearImpulse.clamp(g),y=u.sub(this.m_linearImpulse,v),r.subMul(a,y),s-=c*u.crossVec2Vec2(this.m_rA,y),n.addMul(l,y),o+=h*u.crossVec2Vec2(this.m_rB,y)}this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=o},t.prototype.solvePositionConstraints=function(e){return!0},t.TYPE="motor-joint",t}(se),If=Math.PI,jf={maxForce:0,frequencyHz:5,dampingRatio:.7},Ua=function(i){oe(t,i);function t(e,r,s,n){var o=this;return o instanceof t?(e=qe(e,jf),o=i.call(this,e,r,s)||this,r=o.m_bodyA,s=o.m_bodyB,o.m_type=t.TYPE,u.isValid(n)?o.m_targetA=u.clone(n):u.isValid(e.target)?o.m_targetA=u.clone(e.target):o.m_targetA=u.zero(),o.m_localAnchorB=si.mulTVec2(s.getTransform(),o.m_targetA),o.m_maxForce=e.maxForce,o.m_impulse=u.zero(),o.m_frequencyHz=e.frequencyHz,o.m_dampingRatio=e.dampingRatio,o.m_beta=0,o.m_gamma=0,o.m_rB=u.zero(),o.m_localCenterB=u.zero(),o.m_invMassB=0,o.m_invIB=0,o.m_mass=new ni,o.m_C=u.zero(),o):new t(e,r,s,n)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,target:this.m_targetA,maxForce:this.m_maxForce,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,_localAnchorB:this.m_localAnchorB}},t._deserialize=function(e,r,s){e=ne({},e),e.bodyA=s(_t,e.bodyA,r),e.bodyB=s(_t,e.bodyB,r),e.target=u.clone(e.target);var n=new t(e);return e._localAnchorB&&(n.m_localAnchorB=e._localAnchorB),n},t.prototype._reset=function(e){Number.isFinite(e.maxForce)&&(this.m_maxForce=e.maxForce),Number.isFinite(e.frequencyHz)&&(this.m_frequencyHz=e.frequencyHz),Number.isFinite(e.dampingRatio)&&(this.m_dampingRatio=e.dampingRatio)},t.prototype.setTarget=function(e){u.areEqual(e,this.m_targetA)||(this.m_bodyB.setAwake(!0),this.m_targetA.set(e))},t.prototype.getTarget=function(){return this.m_targetA},t.prototype.setMaxForce=function(e){this.m_maxForce=e},t.prototype.getMaxForce=function(){return this.m_maxForce},t.prototype.setFrequency=function(e){this.m_frequencyHz=e},t.prototype.getFrequency=function(){return this.m_frequencyHz},t.prototype.setDampingRatio=function(e){this.m_dampingRatio=e},t.prototype.getDampingRatio=function(){return this.m_dampingRatio},t.prototype.getAnchorA=function(){return u.clone(this.m_targetA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return u.mulNumVec2(e,this.m_impulse)},t.prototype.getReactionTorque=function(e){return e*0},t.prototype.shiftOrigin=function(e){this.m_targetA.sub(e)},t.prototype.initVelocityConstraints=function(e){this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyB.c_position,s=this.m_bodyB.c_velocity,n=r.c,o=r.a,a=s.v,l=s.w,c=L.neo(o),h=this.m_bodyB.getMass(),d=2*If*this.m_frequencyHz,m=2*h*this.m_dampingRatio*d,f=h*(d*d),y=e.dt;this.m_gamma=y*(m+y*f),this.m_gamma!=0&&(this.m_gamma=1/this.m_gamma),this.m_beta=y*f*this.m_gamma,this.m_rB=L.mulVec2(c,u.sub(this.m_localAnchorB,this.m_localCenterB));var v=new ni;v.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,v.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,v.ey.x=v.ex.y,v.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass=v.getInverse(),this.m_C.setVec2(n),this.m_C.addCombine(1,this.m_rB,-1,this.m_targetA),this.m_C.mul(this.m_beta),l*=.98,e.warmStarting?(this.m_impulse.mul(e.dtRatio),a.addMul(this.m_invMassB,this.m_impulse),l+=this.m_invIB*u.crossVec2Vec2(this.m_rB,this.m_impulse)):this.m_impulse.setZero(),s.v.setVec2(a),s.w=l},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyB.c_velocity,s=u.clone(r.v),n=r.w,o=u.crossNumVec2(n,this.m_rB);o.add(s),o.addCombine(1,this.m_C,this.m_gamma,this.m_impulse),o.neg();var a=ni.mulVec2(this.m_mass,o),l=u.clone(this.m_impulse);this.m_impulse.add(a);var c=e.dt*this.m_maxForce;this.m_impulse.clamp(c),a=u.sub(this.m_impulse,l),s.addMul(this.m_invMassB,a),n+=this.m_invIB*u.crossVec2Vec2(this.m_rB,a),r.v.setVec2(s),r.w=n},t.prototype.solvePositionConstraints=function(e){return!0},t.TYPE="mouse-joint",t}(se),Lf=Math.abs,Tf={collideConnected:!0},Ja=function(i){oe(t,i);function t(e,r,s,n,o,a,l,c){var h=this;return h instanceof t?(e=qe(e,Tf),h=i.call(this,e,r,s)||this,r=h.m_bodyA,s=h.m_bodyB,h.m_type=t.TYPE,h.m_groundAnchorA=u.clone(n||e.groundAnchorA||u.neo(-1,1)),h.m_groundAnchorB=u.clone(o||e.groundAnchorB||u.neo(1,1)),h.m_localAnchorA=u.clone(a?r.getLocalPoint(a):e.localAnchorA||u.neo(-1,0)),h.m_localAnchorB=u.clone(l?s.getLocalPoint(l):e.localAnchorB||u.neo(1,0)),h.m_lengthA=Number.isFinite(e.lengthA)?e.lengthA:u.distance(a,n),h.m_lengthB=Number.isFinite(e.lengthB)?e.lengthB:u.distance(l,o),h.m_ratio=Number.isFinite(c)?c:e.ratio,h.m_constant=h.m_lengthA+h.m_ratio*h.m_lengthB,h.m_impulse=0,h):new t(e,r,s,n,o,a,l,c)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,groundAnchorA:this.m_groundAnchorA,groundAnchorB:this.m_groundAnchorB,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,lengthA:this.m_lengthA,lengthB:this.m_lengthB,ratio:this.m_ratio}},t._deserialize=function(e,r,s){e=ne({},e),e.bodyA=s(_t,e.bodyA,r),e.bodyB=s(_t,e.bodyB,r);var n=new t(e);return n},t.prototype._reset=function(e){u.isValid(e.groundAnchorA)&&this.m_groundAnchorA.set(e.groundAnchorA),u.isValid(e.groundAnchorB)&&this.m_groundAnchorB.set(e.groundAnchorB),u.isValid(e.localAnchorA)?this.m_localAnchorA.set(e.localAnchorA):u.isValid(e.anchorA)&&this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(e.anchorA)),u.isValid(e.localAnchorB)?this.m_localAnchorB.set(e.localAnchorB):u.isValid(e.anchorB)&&this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(e.anchorB)),Number.isFinite(e.lengthA)&&(this.m_lengthA=e.lengthA),Number.isFinite(e.lengthB)&&(this.m_lengthB=e.lengthB),Number.isFinite(e.ratio)&&(this.m_ratio=e.ratio)},t.prototype.getGroundAnchorA=function(){return this.m_groundAnchorA},t.prototype.getGroundAnchorB=function(){return this.m_groundAnchorB},t.prototype.getLengthA=function(){return this.m_lengthA},t.prototype.getLengthB=function(){return this.m_lengthB},t.prototype.getRatio=function(){return this.m_ratio},t.prototype.getCurrentLengthA=function(){var e=this.m_bodyA.getWorldPoint(this.m_localAnchorA),r=this.m_groundAnchorA;return u.distance(e,r)},t.prototype.getCurrentLengthB=function(){var e=this.m_bodyB.getWorldPoint(this.m_localAnchorB),r=this.m_groundAnchorB;return u.distance(e,r)},t.prototype.shiftOrigin=function(e){this.m_groundAnchorA.sub(e),this.m_groundAnchorB.sub(e)},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return u.mulNumVec2(this.m_impulse,this.m_uB).mul(e)},t.prototype.getReactionTorque=function(e){return 0},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_position.c,l=this.m_bodyB.c_position.a,c=this.m_bodyB.c_velocity.v,h=this.m_bodyB.c_velocity.w,d=L.neo(s),m=L.neo(l);this.m_rA=L.mulVec2(d,u.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=L.mulVec2(m,u.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_uA=u.sub(u.add(r,this.m_rA),this.m_groundAnchorA),this.m_uB=u.sub(u.add(a,this.m_rB),this.m_groundAnchorB);var f=this.m_uA.length(),y=this.m_uB.length();f>10*H.linearSlop?this.m_uA.mul(1/f):this.m_uA.setZero(),y>10*H.linearSlop?this.m_uB.mul(1/y):this.m_uB.setZero();var v=u.crossVec2Vec2(this.m_rA,this.m_uA),g=u.crossVec2Vec2(this.m_rB,this.m_uB),A=this.m_invMassA+this.m_invIA*v*v,B=this.m_invMassB+this.m_invIB*g*g;if(this.m_mass=A+this.m_ratio*this.m_ratio*B,this.m_mass>0&&(this.m_mass=1/this.m_mass),e.warmStarting){this.m_impulse*=e.dtRatio;var F=u.mulNumVec2(-this.m_impulse,this.m_uA),E=u.mulNumVec2(-this.m_ratio*this.m_impulse,this.m_uB);n.addMul(this.m_invMassA,F),o+=this.m_invIA*u.crossVec2Vec2(this.m_rA,F),c.addMul(this.m_invMassB,E),h+=this.m_invIB*u.crossVec2Vec2(this.m_rB,E)}else this.m_impulse=0;this.m_bodyA.c_velocity.v=n,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=c,this.m_bodyB.c_velocity.w=h},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,a=u.add(r,u.crossNumVec2(s,this.m_rA)),l=u.add(n,u.crossNumVec2(o,this.m_rB)),c=-u.dot(this.m_uA,a)-this.m_ratio*u.dot(this.m_uB,l),h=-this.m_mass*c;this.m_impulse+=h;var d=u.mulNumVec2(-h,this.m_uA),m=u.mulNumVec2(-this.m_ratio*h,this.m_uB);r.addMul(this.m_invMassA,d),s+=this.m_invIA*u.crossVec2Vec2(this.m_rA,d),n.addMul(this.m_invMassB,m),o+=this.m_invIB*u.crossVec2Vec2(this.m_rB,m),this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=o},t.prototype.solvePositionConstraints=function(e){var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,a=L.neo(s),l=L.neo(o),c=L.mulVec2(a,u.sub(this.m_localAnchorA,this.m_localCenterA)),h=L.mulVec2(l,u.sub(this.m_localAnchorB,this.m_localCenterB)),d=u.sub(u.add(r,this.m_rA),this.m_groundAnchorA),m=u.sub(u.add(n,this.m_rB),this.m_groundAnchorB),f=d.length(),y=m.length();f>10*H.linearSlop?d.mul(1/f):d.setZero(),y>10*H.linearSlop?m.mul(1/y):m.setZero();var v=u.crossVec2Vec2(c,d),g=u.crossVec2Vec2(h,m),A=this.m_invMassA+this.m_invIA*v*v,B=this.m_invMassB+this.m_invIB*g*g,F=A+this.m_ratio*this.m_ratio*B;F>0&&(F=1/F);var E=this.m_constant-f-this.m_ratio*y,k=Lf(E),w=-F*E,b=u.mulNumVec2(-w,d),M=u.mulNumVec2(-this.m_ratio*w,m);return r.addMul(this.m_invMassA,b),s+=this.m_invIA*u.crossVec2Vec2(c,b),n.addMul(this.m_invMassB,M),o+=this.m_invIB*u.crossVec2Vec2(h,M),this.m_bodyA.c_position.c=r,this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c=n,this.m_bodyB.c_position.a=o,k<H.linearSlop},t.TYPE="pulley-joint",t}(se),Rf=Math.min,mn;(function(i){i[i.inactiveLimit=0]="inactiveLimit",i[i.atLowerLimit=1]="atLowerLimit",i[i.atUpperLimit=2]="atUpperLimit",i[i.equalLimits=3]="equalLimits"})(mn||(mn={}));var zf={maxLength:0},Ha=function(i){oe(t,i);function t(e,r,s,n){var o=this;return o instanceof t?(e=qe(e,zf),o=i.call(this,e,r,s)||this,r=o.m_bodyA,s=o.m_bodyB,o.m_type=t.TYPE,o.m_localAnchorA=u.clone(n?r.getLocalPoint(n):e.localAnchorA||u.neo(-1,0)),o.m_localAnchorB=u.clone(n?s.getLocalPoint(n):e.localAnchorB||u.neo(1,0)),o.m_maxLength=e.maxLength,o.m_mass=0,o.m_impulse=0,o.m_length=0,o.m_state=mn.inactiveLimit,o):new t(e,r,s,n)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,maxLength:this.m_maxLength}},t._deserialize=function(e,r,s){e=ne({},e),e.bodyA=s(_t,e.bodyA,r),e.bodyB=s(_t,e.bodyB,r);var n=new t(e);return n},t.prototype._reset=function(e){Number.isFinite(e.maxLength)&&(this.m_maxLength=e.maxLength)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.setMaxLength=function(e){this.m_maxLength=e},t.prototype.getMaxLength=function(){return this.m_maxLength},t.prototype.getLimitState=function(){return this.m_state},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return u.mulNumVec2(this.m_impulse,this.m_u).mul(e)},t.prototype.getReactionTorque=function(e){return 0},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_position.c,l=this.m_bodyB.c_position.a,c=this.m_bodyB.c_velocity.v,h=this.m_bodyB.c_velocity.w,d=L.neo(s),m=L.neo(l);this.m_rA=L.mulSub(d,this.m_localAnchorA,this.m_localCenterA),this.m_rB=L.mulSub(m,this.m_localAnchorB,this.m_localCenterB),this.m_u=u.zero(),this.m_u.addCombine(1,a,1,this.m_rB),this.m_u.subCombine(1,r,1,this.m_rA),this.m_length=this.m_u.length();var f=this.m_length-this.m_maxLength;if(f>0?this.m_state=mn.atUpperLimit:this.m_state=mn.inactiveLimit,this.m_length>H.linearSlop)this.m_u.mul(1/this.m_length);else{this.m_u.setZero(),this.m_mass=0,this.m_impulse=0;return}var y=u.crossVec2Vec2(this.m_rA,this.m_u),v=u.crossVec2Vec2(this.m_rB,this.m_u),g=this.m_invMassA+this.m_invIA*y*y+this.m_invMassB+this.m_invIB*v*v;if(this.m_mass=g!=0?1/g:0,e.warmStarting){this.m_impulse*=e.dtRatio;var A=u.mulNumVec2(this.m_impulse,this.m_u);n.subMul(this.m_invMassA,A),o-=this.m_invIA*u.crossVec2Vec2(this.m_rA,A),c.addMul(this.m_invMassB,A),h+=this.m_invIB*u.crossVec2Vec2(this.m_rB,A)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(n),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.setVec2(c),this.m_bodyB.c_velocity.w=h},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,a=u.addCrossNumVec2(r,s,this.m_rA),l=u.addCrossNumVec2(n,o,this.m_rB),c=this.m_length-this.m_maxLength,h=u.dot(this.m_u,u.sub(l,a));c<0&&(h+=e.inv_dt*c);var d=-this.m_mass*h,m=this.m_impulse;this.m_impulse=Rf(0,this.m_impulse+d),d=this.m_impulse-m;var f=u.mulNumVec2(d,this.m_u);r.subMul(this.m_invMassA,f),s-=this.m_invIA*u.crossVec2Vec2(this.m_rA,f),n.addMul(this.m_invMassB,f),o+=this.m_invIB*u.crossVec2Vec2(this.m_rB,f),this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=o},t.prototype.solvePositionConstraints=function(e){var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,a=L.neo(s),l=L.neo(o),c=L.mulSub(a,this.m_localAnchorA,this.m_localCenterA),h=L.mulSub(l,this.m_localAnchorB,this.m_localCenterB),d=u.zero();d.addCombine(1,n,1,h),d.subCombine(1,r,1,c);var m=d.normalize(),f=m-this.m_maxLength;f=re(f,0,H.maxLinearCorrection);var y=-this.m_mass*f,v=u.mulNumVec2(y,d);return r.subMul(this.m_invMassA,v),s-=this.m_invIA*u.crossVec2Vec2(c,v),n.addMul(this.m_invMassB,v),o+=this.m_invIB*u.crossVec2Vec2(h,v),this.m_bodyA.c_position.c.setVec2(r),this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c.setVec2(n),this.m_bodyB.c_position.a=o,m-this.m_maxLength<H.linearSlop},t.TYPE="rope-joint",t}(se),Nf=Math.abs,Of=Math.PI,Uf={frequencyHz:0,dampingRatio:0},Wa=function(i){oe(t,i);function t(e,r,s,n){var o=this;return o instanceof t?(e=qe(e,Uf),o=i.call(this,e,r,s)||this,r=o.m_bodyA,s=o.m_bodyB,o.m_type=t.TYPE,o.m_localAnchorA=u.clone(n?r.getLocalPoint(n):e.localAnchorA||u.zero()),o.m_localAnchorB=u.clone(n?s.getLocalPoint(n):e.localAnchorB||u.zero()),o.m_referenceAngle=Number.isFinite(e.referenceAngle)?e.referenceAngle:s.getAngle()-r.getAngle(),o.m_frequencyHz=e.frequencyHz,o.m_dampingRatio=e.dampingRatio,o.m_impulse=new pt,o.m_bias=0,o.m_gamma=0,o.m_rA,o.m_rB,o.m_localCenterA,o.m_localCenterB,o.m_invMassA,o.m_invMassB,o.m_invIA,o.m_invIB,o.m_mass=new er,o):new t(e,r,s,n)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},t._deserialize=function(e,r,s){e=ne({},e),e.bodyA=s(_t,e.bodyA,r),e.bodyB=s(_t,e.bodyB,r);var n=new t(e);return n},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),Number.isFinite(e.frequencyHz)&&(this.m_frequencyHz=e.frequencyHz),Number.isFinite(e.dampingRatio)&&(this.m_dampingRatio=e.dampingRatio)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.getReferenceAngle=function(){return this.m_referenceAngle},t.prototype.setFrequency=function(e){this.m_frequencyHz=e},t.prototype.getFrequency=function(){return this.m_frequencyHz},t.prototype.setDampingRatio=function(e){this.m_dampingRatio=e},t.prototype.getDampingRatio=function(){return this.m_dampingRatio},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return u.neo(this.m_impulse.x,this.m_impulse.y).mul(e)},t.prototype.getReactionTorque=function(e){return e*this.m_impulse.z},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,c=L.neo(r),h=L.neo(o);this.m_rA=L.mulVec2(c,u.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=L.mulVec2(h,u.sub(this.m_localAnchorB,this.m_localCenterB));var d=this.m_invMassA,m=this.m_invMassB,f=this.m_invIA,y=this.m_invIB,v=new er;if(v.ex.x=d+m+this.m_rA.y*this.m_rA.y*f+this.m_rB.y*this.m_rB.y*y,v.ey.x=-this.m_rA.y*this.m_rA.x*f-this.m_rB.y*this.m_rB.x*y,v.ez.x=-this.m_rA.y*f-this.m_rB.y*y,v.ex.y=v.ey.x,v.ey.y=d+m+this.m_rA.x*this.m_rA.x*f+this.m_rB.x*this.m_rB.x*y,v.ez.y=this.m_rA.x*f+this.m_rB.x*y,v.ex.z=v.ez.x,v.ey.z=v.ez.y,v.ez.z=f+y,this.m_frequencyHz>0){v.getInverse22(this.m_mass);var g=f+y,A=g>0?1/g:0,B=o-r-this.m_referenceAngle,F=2*Of*this.m_frequencyHz,E=2*A*this.m_dampingRatio*F,k=A*F*F,w=e.dt;this.m_gamma=w*(E+w*k),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=B*w*k*this.m_gamma,g+=this.m_gamma,this.m_mass.ez.z=g!=0?1/g:0}else v.ez.z==0?(v.getInverse22(this.m_mass),this.m_gamma=0,this.m_bias=0):(v.getSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0);if(e.warmStarting){this.m_impulse.mul(e.dtRatio);var b=u.neo(this.m_impulse.x,this.m_impulse.y);s.subMul(d,b),n-=f*(u.crossVec2Vec2(this.m_rA,b)+this.m_impulse.z),a.addMul(m,b),l+=y*(u.crossVec2Vec2(this.m_rB,b)+this.m_impulse.z)}else this.m_impulse.setZero();this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=l},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,a=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,h=this.m_invIB;if(this.m_frequencyHz>0){var d=o-s,m=-this.m_mass.ez.z*(d+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=m,s-=c*m,o+=h*m;var f=u.zero();f.addCombine(1,n,1,u.crossNumVec2(o,this.m_rB)),f.subCombine(1,r,1,u.crossNumVec2(s,this.m_rA));var y=u.neg(er.mulVec2(this.m_mass,f));this.m_impulse.x+=y.x,this.m_impulse.y+=y.y;var v=u.clone(y);r.subMul(a,v),s-=c*u.crossVec2Vec2(this.m_rA,v),n.addMul(l,v),o+=h*u.crossVec2Vec2(this.m_rB,v)}else{var f=u.zero();f.addCombine(1,n,1,u.crossNumVec2(o,this.m_rB)),f.subCombine(1,r,1,u.crossNumVec2(s,this.m_rA));var d=o-s,g=new pt(f.x,f.y,d),A=pt.neg(er.mulVec3(this.m_mass,g));this.m_impulse.add(A);var v=u.neo(A.x,A.y);r.subMul(a,v),s-=c*(u.crossVec2Vec2(this.m_rA,v)+A.z),n.addMul(l,v),o+=h*(u.crossVec2Vec2(this.m_rB,v)+A.z)}this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=o},t.prototype.solvePositionConstraints=function(e){var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,a=L.neo(s),l=L.neo(o),c=this.m_invMassA,h=this.m_invMassB,d=this.m_invIA,m=this.m_invIB,f=L.mulVec2(a,u.sub(this.m_localAnchorA,this.m_localCenterA)),y=L.mulVec2(l,u.sub(this.m_localAnchorB,this.m_localCenterB)),v,g,A=new er;if(A.ex.x=c+h+f.y*f.y*d+y.y*y.y*m,A.ey.x=-f.y*f.x*d-y.y*y.x*m,A.ez.x=-f.y*d-y.y*m,A.ex.y=A.ey.x,A.ey.y=c+h+f.x*f.x*d+y.x*y.x*m,A.ez.y=f.x*d+y.x*m,A.ex.z=A.ez.x,A.ey.z=A.ez.y,A.ez.z=d+m,this.m_frequencyHz>0){var B=u.zero();B.addCombine(1,n,1,y),B.subCombine(1,r,1,f),v=B.length(),g=0;var F=u.neg(A.solve22(B));r.subMul(c,F),s-=d*u.crossVec2Vec2(f,F),n.addMul(h,F),o+=m*u.crossVec2Vec2(y,F)}else{var B=u.zero();B.addCombine(1,n,1,y),B.subCombine(1,r,1,f);var E=o-s-this.m_referenceAngle;v=B.length(),g=Nf(E);var k=new pt(B.x,B.y,E),w=new pt;if(A.ez.z>0)w=pt.neg(A.solve33(k));else{var b=u.neg(A.solve22(B));w.set(b.x,b.y,0)}var F=u.neo(w.x,w.y);r.subMul(c,F),s-=d*(u.crossVec2Vec2(f,F)+w.z),n.addMul(h,F),o+=m*(u.crossVec2Vec2(y,F)+w.z)}return this.m_bodyA.c_position.c=r,this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c=n,this.m_bodyB.c_position.a=o,v<=H.linearSlop&&g<=H.angularSlop},t.TYPE="weld-joint",t}(se),Jf=Math.abs,Hf=Math.PI,Wf={enableMotor:!1,maxMotorTorque:0,motorSpeed:0,frequencyHz:2,dampingRatio:.7},Ka=function(i){oe(t,i);function t(e,r,s,n,o){var a=this;return a instanceof t?(e=qe(e,Wf),a=i.call(this,e,r,s)||this,r=a.m_bodyA,s=a.m_bodyB,a.m_ax=u.zero(),a.m_ay=u.zero(),a.m_type=t.TYPE,a.m_localAnchorA=u.clone(n?r.getLocalPoint(n):e.localAnchorA||u.zero()),a.m_localAnchorB=u.clone(n?s.getLocalPoint(n):e.localAnchorB||u.zero()),u.isValid(o)?a.m_localXAxisA=r.getLocalVector(o):u.isValid(e.localAxisA)?a.m_localXAxisA=u.clone(e.localAxisA):u.isValid(e.localAxis)?a.m_localXAxisA=u.clone(e.localAxis):a.m_localXAxisA=u.neo(1,0),a.m_localYAxisA=u.crossNumVec2(1,a.m_localXAxisA),a.m_mass=0,a.m_impulse=0,a.m_motorMass=0,a.m_motorImpulse=0,a.m_springMass=0,a.m_springImpulse=0,a.m_maxMotorTorque=e.maxMotorTorque,a.m_motorSpeed=e.motorSpeed,a.m_enableMotor=e.enableMotor,a.m_frequencyHz=e.frequencyHz,a.m_dampingRatio=e.dampingRatio,a.m_bias=0,a.m_gamma=0,a):new t(e,r,s,n,o)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,enableMotor:this.m_enableMotor,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA}},t._deserialize=function(e,r,s){e=ne({},e),e.bodyA=s(_t,e.bodyA,r),e.bodyB=s(_t,e.bodyB,r);var n=new t(e);return n},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),e.localAxisA&&(this.m_localXAxisA.setVec2(e.localAxisA),this.m_localYAxisA.setVec2(u.crossNumVec2(1,e.localAxisA))),e.enableMotor!==void 0&&(this.m_enableMotor=e.enableMotor),Number.isFinite(e.maxMotorTorque)&&(this.m_maxMotorTorque=e.maxMotorTorque),Number.isFinite(e.motorSpeed)&&(this.m_motorSpeed=e.motorSpeed),Number.isFinite(e.frequencyHz)&&(this.m_frequencyHz=e.frequencyHz),Number.isFinite(e.dampingRatio)&&(this.m_dampingRatio=e.dampingRatio)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.getLocalAxisA=function(){return this.m_localXAxisA},t.prototype.getJointTranslation=function(){var e=this.m_bodyA,r=this.m_bodyB,s=e.getWorldPoint(this.m_localAnchorA),n=r.getWorldPoint(this.m_localAnchorB),o=u.sub(n,s),a=e.getWorldVector(this.m_localXAxisA),l=u.dot(o,a);return l},t.prototype.getJointSpeed=function(){var e=this.m_bodyA.m_angularVelocity,r=this.m_bodyB.m_angularVelocity;return r-e},t.prototype.isMotorEnabled=function(){return this.m_enableMotor},t.prototype.enableMotor=function(e){e!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=e)},t.prototype.setMotorSpeed=function(e){e!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=e)},t.prototype.getMotorSpeed=function(){return this.m_motorSpeed},t.prototype.setMaxMotorTorque=function(e){e!=this.m_maxMotorTorque&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=e)},t.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},t.prototype.getMotorTorque=function(e){return e*this.m_motorImpulse},t.prototype.setSpringFrequencyHz=function(e){this.m_frequencyHz=e},t.prototype.getSpringFrequencyHz=function(){return this.m_frequencyHz},t.prototype.setSpringDampingRatio=function(e){this.m_dampingRatio=e},t.prototype.getSpringDampingRatio=function(){return this.m_dampingRatio},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return u.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax).mul(e)},t.prototype.getReactionTorque=function(e){return e*this.m_motorImpulse},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_invMassA,s=this.m_invMassB,n=this.m_invIA,o=this.m_invIB,a=this.m_bodyA.c_position.c,l=this.m_bodyA.c_position.a,c=this.m_bodyA.c_velocity.v,h=this.m_bodyA.c_velocity.w,d=this.m_bodyB.c_position.c,m=this.m_bodyB.c_position.a,f=this.m_bodyB.c_velocity.v,y=this.m_bodyB.c_velocity.w,v=L.neo(l),g=L.neo(m),A=L.mulVec2(v,u.sub(this.m_localAnchorA,this.m_localCenterA)),B=L.mulVec2(g,u.sub(this.m_localAnchorB,this.m_localCenterB)),F=u.zero();if(F.addCombine(1,d,1,B),F.subCombine(1,a,1,A),this.m_ay=L.mulVec2(v,this.m_localYAxisA),this.m_sAy=u.crossVec2Vec2(u.add(F,A),this.m_ay),this.m_sBy=u.crossVec2Vec2(B,this.m_ay),this.m_mass=r+s+n*this.m_sAy*this.m_sAy+o*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){this.m_ax=L.mulVec2(v,this.m_localXAxisA),this.m_sAx=u.crossVec2Vec2(u.add(F,A),this.m_ax),this.m_sBx=u.crossVec2Vec2(B,this.m_ax);var E=r+s+n*this.m_sAx*this.m_sAx+o*this.m_sBx*this.m_sBx;if(E>0){this.m_springMass=1/E;var k=u.dot(F,this.m_ax),w=2*Hf*this.m_frequencyHz,b=2*this.m_springMass*this.m_dampingRatio*w,M=this.m_springMass*w*w,V=e.dt;this.m_gamma=V*(b+V*M),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=k*V*M*this.m_gamma,this.m_springMass=E+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=n+o,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),e.warmStarting){this.m_impulse*=e.dtRatio,this.m_springImpulse*=e.dtRatio,this.m_motorImpulse*=e.dtRatio;var T=u.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax),z=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,O=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;c.subMul(this.m_invMassA,T),h-=this.m_invIA*z,f.addMul(this.m_invMassB,T),y+=this.m_invIB*O}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(c),this.m_bodyA.c_velocity.w=h,this.m_bodyB.c_velocity.v.setVec2(f),this.m_bodyB.c_velocity.w=y},t.prototype.solveVelocityConstraints=function(e){var r=this.m_invMassA,s=this.m_invMassB,n=this.m_invIA,o=this.m_invIB,a=this.m_bodyA.c_velocity.v,l=this.m_bodyA.c_velocity.w,c=this.m_bodyB.c_velocity.v,h=this.m_bodyB.c_velocity.w;{var d=u.dot(this.m_ax,c)-u.dot(this.m_ax,a)+this.m_sBx*h-this.m_sAx*l,m=-this.m_springMass*(d+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=m;var f=u.mulNumVec2(m,this.m_ax),y=m*this.m_sAx,v=m*this.m_sBx;a.subMul(r,f),l-=n*y,c.addMul(s,f),h+=o*v}{var d=h-l-this.m_motorSpeed,m=-this.m_motorMass*d,g=this.m_motorImpulse,A=e.dt*this.m_maxMotorTorque;this.m_motorImpulse=re(this.m_motorImpulse+m,-A,A),m=this.m_motorImpulse-g,l-=n*m,h+=o*m}{var d=u.dot(this.m_ay,c)-u.dot(this.m_ay,a)+this.m_sBy*h-this.m_sAy*l,m=-this.m_mass*d;this.m_impulse+=m;var f=u.mulNumVec2(m,this.m_ay),y=m*this.m_sAy,v=m*this.m_sBy;a.subMul(r,f),l-=n*y,c.addMul(s,f),h+=o*v}this.m_bodyA.c_velocity.v.setVec2(a),this.m_bodyA.c_velocity.w=l,this.m_bodyB.c_velocity.v.setVec2(c),this.m_bodyB.c_velocity.w=h},t.prototype.solvePositionConstraints=function(e){var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,a=L.neo(s),l=L.neo(o),c=L.mulVec2(a,u.sub(this.m_localAnchorA,this.m_localCenterA)),h=L.mulVec2(l,u.sub(this.m_localAnchorB,this.m_localCenterB)),d=u.zero();d.addCombine(1,n,1,h),d.subCombine(1,r,1,c);var m=L.mulVec2(a,this.m_localYAxisA),f=u.crossVec2Vec2(u.add(d,c),m),y=u.crossVec2Vec2(h,m),v=u.dot(d,m),g=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy,A=g!=0?-v/g:0,B=u.mulNumVec2(A,m),F=A*f,E=A*y;return r.subMul(this.m_invMassA,B),s-=this.m_invIA*F,n.addMul(this.m_invMassB,B),o+=this.m_invIB*E,this.m_bodyA.c_position.c.setVec2(r),this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c.setVec2(n),this.m_bodyB.c_position.a=o,Jf(v)<=H.linearSlop},t.TYPE="wheel-joint",t}(se),Tt,Kf=0,Jh={World:Vn,Body:_t,Joint:se,Fixture:qo,Shape:Kr},Hh={Vec2:u,Vec3:pt,World:Vn,Body:_t,Joint:se,Fixture:qo,Shape:Kr},Yf=(Tt={},Tt[_t.STATIC]=_t,Tt[_t.DYNAMIC]=_t,Tt[_t.KINEMATIC]=_t,Tt[Bn.TYPE]=Bn,Tt[Ui.TYPE]=Ui,Tt[Oi.TYPE]=Oi,Tt[pr.TYPE]=pr,Tt[Ta.TYPE]=Ta,Tt[Ra.TYPE]=Ra,Tt[Na.TYPE]=Na,Tt[Oa.TYPE]=Oa,Tt[Ua.TYPE]=Ua,Tt[za.TYPE]=za,Tt[Ja.TYPE]=Ja,Tt[Li.TYPE]=Li,Tt[Ha.TYPE]=Ha,Tt[Wa.TYPE]=Wa,Tt[Ka.TYPE]=Ka,Tt),Gf={rootClass:Vn,preSerialize:function(i){return i},postSerialize:function(i,t){return i},preDeserialize:function(i){return i},postDeserialize:function(i,t){return i}},Kl=function(){function i(t){var e=this;this.toJson=function(r){var s=e.options.preSerialize,n=e.options.postSerialize,o=[],a=[r],l={};function c(y,v){if(y.__sid=y.__sid||++Kf,!l[y.__sid]){a.push(y);var g=o.length+a.length,A={refIndex:g,refType:v};l[y.__sid]=A}return l[y.__sid]}function h(y){y=s(y);var v=y._serialize();return v=n(v,y),v}function d(y,v){if(v===void 0&&(v=!1),typeof y!="object"||y===null)return y;if(typeof y._serialize=="function"){if(!v){for(var g in Jh)if(y instanceof Jh[g])return c(y,g)}y=h(y)}if(Array.isArray(y)){for(var A=[],B=0;B<y.length;B++)A[B]=d(y[B]);y=A}else{var A={};for(var B in y)y.hasOwnProperty(B)&&(A[B]=d(y[B]));y=A}return y}for(;a.length;){var m=a.shift(),f=d(m,!0);o.push(f)}return o},this.fromJson=function(r){var s=e.options.preDeserialize,n=e.options.postDeserialize,o=e.options.rootClass,a={};function l(d,m,f){(!d||!d._deserialize)&&(d=Yf[m.type]);var y=d&&d._deserialize;if(y){m=s(m);var v=d._deserialize,g=v(m,f,c);return g=n(g,m),g}}function c(d,m,f){var y=m.refIndex&&m.refType;if(!y)return l(d,m,f);var v=m;Hh[v.refType]&&(d=Hh[v.refType]);var g=v.refIndex;if(!a[g]){var A=r[g],B=l(d,A,f);a[g]=B}return a[g]}var h=l(o,r[0],null);return h},this.options=ne(ne({},Gf),t)}return i}(),gd=new Kl({rootClass:Vn});Kl.fromJson=gd.fromJson;Kl.toJson=gd.toJson;(function(){function i(){this.width=80,this.height=60,this.x=0,this.y=-10,this.scaleY=-1,this.hz=60,this.speed=1,this.background="#222222",this.activeKeys={},this.step=function(t,e){},this.keydown=function(t,e){},this.keyup=function(t,e){}}return i.mount=function(t){throw new Error("Not implemented")},i.start=function(t){var e=i.mount();return e.start(t),e},i.prototype.color=function(t,e,r){return t=t*256|0,e=e*256|0,r=r*256|0,"rgb("+t+", "+e+", "+r+")"},i})();var Xf=function(i){oe(t,i);function t(e,r,s,n){var o=this;return o instanceof t?(o=i.call(this)||this,o._setAsBox(e,r,s,n),o):new t(e,r,s,n)}return t.TYPE="polygon",t}(Ui);xi.addType(pr.TYPE,pr.TYPE,Qf);function Qf(i,t,e,r,s,n,o){Zf(i,e.getShape(),t,n.getShape(),s)}var Wh=I(0,0),Kh=I(0,0),Zf=function(i,t,e,r,s){i.pointCount=0,it(Wh,e,t.m_p),it(Kh,s,r.m_p);var n=Ir(Kh,Wh),o=t.m_radius,a=r.m_radius,l=o+a;n>l*l||(i.type=Ft.e_circles,D(i.localPoint,t.m_p),G(i.localNormal),i.pointCount=1,D(i.points[0].localPoint,r.m_p),i.points[0].id.setFeatures(0,mt.e_vertex,0,mt.e_vertex))};xi.addType(Oi.TYPE,pr.TYPE,$f);xi.addType(Bn.TYPE,pr.TYPE,ty);function $f(i,t,e,r,s,n,o){var a=e.getShape(),l=n.getShape();Ad(i,a,t,l,s)}function ty(i,t,e,r,s,n,o){var a=e.getShape(),l=new Oi;a.getChildEdge(l,r);var c=l,h=n.getShape();Ad(i,c,t,h,s)}var kr=I(0,0),ya=I(0,0),_a=I(0,0),Ii=I(0,0),Mr=I(0,0),os=I(0,0),Ad=function(i,t,e,r,s){i.pointCount=0,hd(Ii,s,e,r.m_p);var n=t.m_vertex1,o=t.m_vertex2;rt(kr,o,n);var a=N(kr,o)-N(kr,Ii),l=N(kr,Ii)-N(kr,n),c=t.m_radius+r.m_radius;if(l<=0){D(Mr,n);var h=Ir(Ii,n);if(h>c*c)return;if(t.m_hasVertex0){var d=t.m_vertex0,m=n;rt(ya,m,d);var f=N(ya,m)-N(ya,Ii);if(f>0)return}i.type=Ft.e_circles,G(i.localNormal),D(i.localPoint,Mr),i.pointCount=1,D(i.points[0].localPoint,r.m_p),i.points[0].id.setFeatures(0,mt.e_vertex,0,mt.e_vertex);return}if(a<=0){D(Mr,o);var y=Ir(Ii,Mr);if(y>c*c)return;if(t.m_hasVertex3){var v=t.m_vertex3,g=o;rt(_a,v,g);var A=N(_a,Ii)-N(_a,g);if(A>0)return}i.type=Ft.e_circles,G(i.localNormal),D(i.localPoint,Mr),i.pointCount=1,D(i.points[0].localPoint,r.m_p),i.points[0].id.setFeatures(1,mt.e_vertex,0,mt.e_vertex);return}var B=qr(kr);Bt(Mr,a/B,n,l/B,o);var F=Ir(Ii,Mr);F>c*c||(Be(os,1,kr),N(os,Ii)-N(os,n)<0&&wn(os),ri(os),i.type=Ft.e_faceA,D(i.localNormal,os),D(i.localPoint,n),i.pointCount=1,D(i.points[0].localPoint,r.m_p),i.points[0].id.setFeatures(0,mt.e_face,0,mt.e_vertex))},lo=[new Pe,new Pe],ho=[new Pe,new Pe],Fr=[new Pe,new Pe],co=I(0,0),Yh=I(0,0),va=I(0,0),ga=Wr(0,0,0),Er=I(0,0),as=I(0,0),uo=I(0,0),Gh=I(0,0),Xh=I(0,0),Qi=I(0,0),Aa=I(0,0),Qh=I(0,0);xi.addType(Ui.TYPE,Ui.TYPE,ey);function ey(i,t,e,r,s,n,o){ry(i,e.getShape(),t,n.getShape(),s)}function Zh(i,t,e,r,s){var n=i.m_count,o=e.m_count,a=i.m_normals,l=i.m_vertices,c=e.m_vertices;cd(ga,r,t);for(var h=0,d=-1/0,m=0;m<n;++m){Je(va,ga.q,a[m]),it(Yh,ga,l[m]);for(var f=1/0,y=0;y<o;++y){var v=N(va,c[y])-N(va,Yh);v<f&&(f=v)}f>d&&(d=f,h=m)}s.maxSeparation=d,s.bestIndex=h}function iy(i,t,e,r,s,n){var o=t.m_normals,a=s.m_count,l=s.m_vertices,c=s.m_normals;ef(Qh,n.q,e.q,o[r]);for(var h=0,d=1/0,m=0;m<a;++m){var f=N(Qh,c[m]);f<d&&(d=f,h=m)}var y=h,v=y+1<a?y+1:0;it(i[0].v,n,l[y]),i[0].id.setFeatures(r,mt.e_face,y,mt.e_vertex),it(i[1].v,n,l[v]),i[1].id.setFeatures(r,mt.e_face,v,mt.e_vertex)}var ls={maxSeparation:0,bestIndex:0},ry=function(i,t,e,r,s){i.pointCount=0;var n=t.m_radius+r.m_radius;Zh(t,e,r,s,ls);var o=ls.bestIndex,a=ls.maxSeparation;if(!(a>n)){Zh(r,s,t,e,ls);var l=ls.bestIndex,c=ls.maxSeparation;if(!(c>n)){var h,d,m,f,y,v,g=.1*H.linearSlop;c>a+g?(h=r,d=t,m=s,f=e,y=l,i.type=Ft.e_faceB,v=!0):(h=t,d=r,m=e,f=s,y=o,i.type=Ft.e_faceA,v=!1),lo[0].recycle(),lo[1].recycle(),iy(lo,h,m,y,d,f);var A=h.m_count,B=h.m_vertices,F=y,E=y+1<A?y+1:0;D(Er,B[F]),D(as,B[E]),rt(uo,as,Er),ri(uo),Vr(Gh,uo,1),Bt(Xh,.5,Er,.5,as),Je(Qi,m.q,uo),Vr(Aa,Qi,1),it(Er,m,Er),it(as,m,as);var k=N(Aa,Er),w=-N(Qi,Er)+n,b=N(Qi,as)+n;ho[0].recycle(),ho[1].recycle(),Fr[0].recycle(),Fr[1].recycle(),Qt(co,-Qi.x,-Qi.y);var M=bn(ho,lo,co,w,F);if(!(M<2)){Qt(co,Qi.x,Qi.y);var V=bn(Fr,ho,co,b,E);if(!(V<2)){D(i.localNormal,Gh),D(i.localPoint,Xh);for(var T=0,z=0;z<Fr.length;++z){var O=N(Aa,Fr[z].v)-k;if(O<=n){var J=i.points[T];zl(J.localPoint,f,Fr[z].v),J.id.set(Fr[z].id),v&&J.id.swapFeatures(),++T}}i.pointCount=T}}}}};xi.addType(Ui.TYPE,pr.TYPE,sy);function sy(i,t,e,r,s,n,o){ny(i,e.getShape(),t,n.getShape(),s)}var Qe=I(0,0),xa=I(0,0),ny=function(i,t,e,r,s){i.pointCount=0,hd(Qe,s,e,r.m_p);for(var n=0,o=-1/0,a=t.m_radius+r.m_radius,l=t.m_count,c=t.m_vertices,h=t.m_normals,d=0;d<l;++d){var m=N(h[d],Qe)-N(h[d],c[d]);if(m>a)return;m>o&&(o=m,n=d)}var f=n,y=f+1<l?f+1:0,v=c[f],g=c[y];if(o<Ee){i.pointCount=1,i.type=Ft.e_faceA,D(i.localNormal,h[n]),Bt(i.localPoint,.5,v,.5,g),D(i.points[0].localPoint,r.m_p),i.points[0].id.setFeatures(0,mt.e_vertex,0,mt.e_vertex);return}var A=N(Qe,g)-N(Qe,v)-N(v,g)+N(v,v),B=N(Qe,v)-N(Qe,g)-N(g,v)+N(g,g);if(A<=0){if(Ir(Qe,v)>a*a)return;i.pointCount=1,i.type=Ft.e_faceA,rt(i.localNormal,Qe,v),ri(i.localNormal),D(i.localPoint,v),D(i.points[0].localPoint,r.m_p),i.points[0].id.setFeatures(0,mt.e_vertex,0,mt.e_vertex)}else if(B<=0){if(Ir(Qe,g)>a*a)return;i.pointCount=1,i.type=Ft.e_faceA,rt(i.localNormal,Qe,g),ri(i.localNormal),D(i.localPoint,g),D(i.points[0].localPoint,r.m_p),i.points[0].id.setFeatures(0,mt.e_vertex,0,mt.e_vertex)}else{Bt(xa,.5,v,.5,g);var F=N(Qe,h[f])-N(xa,h[f]);if(F>a)return;i.pointCount=1,i.type=Ft.e_faceA,D(i.localNormal,h[f]),D(i.localPoint,xa),D(i.points[0].localPoint,r.m_p),i.points[0].id.setFeatures(0,mt.e_vertex,0,mt.e_vertex)}},oy=Math.min;xi.addType(Oi.TYPE,Ui.TYPE,ay);xi.addType(Bn.TYPE,Ui.TYPE,ly);function ay(i,t,e,r,s,n,o){wd(i,e.getShape(),t,n.getShape(),s)}var $h=new Oi;function ly(i,t,e,r,s,n,o){var a=e.getShape();a.getChildEdge($h,r),wd(i,$h,t,n.getShape(),s)}var Ne;(function(i){i[i.e_unknown=-1]="e_unknown",i[i.e_edgeA=1]="e_edgeA",i[i.e_edgeB=2]="e_edgeB"})(Ne||(Ne={}));var tc;(function(i){i[i.e_isolated=0]="e_isolated",i[i.e_concave=1]="e_concave",i[i.e_convex=2]="e_convex"})(tc||(tc={}));var xd=function(){function i(){}return i}(),hy=function(){function i(){this.vertices=[],this.normals=[],this.count=0;for(var t=0;t<H.maxPolygonVertices;t++)this.vertices.push(I(0,0)),this.normals.push(I(0,0))}return i}(),cy=function(){function i(){this.v1=I(0,0),this.v2=I(0,0),this.normal=I(0,0),this.sideNormal1=I(0,0),this.sideNormal2=I(0,0)}return i.prototype.recycle=function(){G(this.v1),G(this.v2),G(this.normal),G(this.sideNormal1),G(this.sideNormal2)},i}(),mo=[new Pe,new Pe],Zi=[new Pe,new Pe],Ze=[new Pe,new Pe],ui=new xd,le=new xd,Ht=new hy,nt=new cy,po=I(0,0),rn=I(0,0),hs=I(0,0),sn=I(0,0),nn=Wr(0,0,0),At=I(0,0),mi=I(0,0),et=I(0,0),di=I(0,0),Rt=I(0,0),zt=I(0,0),ec=I(0,0),$i=I(0,0),wd=function(i,t,e,r,s){cd(nn,e,s),it(po,nn,r.m_centroid);var n=t.m_vertex0,o=t.m_vertex1,a=t.m_vertex2,l=t.m_vertex3,c=t.m_hasVertex0,h=t.m_hasVertex3;rt(hs,a,o),ri(hs),Qt(et,hs.y,-hs.x);var d=N(et,po)-N(et,o),m=0,f=0,y=!1,v=!1;G(mi),G(di),c&&(rt(rn,o,n),ri(rn),Qt(mi,rn.y,-rn.x),y=lt(rn,hs)>=0,m=u.dot(mi,po)-u.dot(mi,n)),h&&(rt(sn,l,a),ri(sn),Qt(di,sn.y,-sn.x),v=u.crossVec2Vec2(hs,sn)>0,f=u.dot(di,po)-u.dot(di,a));var g;G(At),G(Rt),G(zt),c&&h?y&&v?(g=m>=0||d>=0||f>=0,g?(D(At,et),D(Rt,mi),D(zt,di)):($(At,-1,et),$(Rt,-1,et),$(zt,-1,et))):y?(g=m>=0||d>=0&&f>=0,g?(D(At,et),D(Rt,mi),D(zt,et)):($(At,-1,et),$(Rt,-1,di),$(zt,-1,et))):v?(g=f>=0||m>=0&&d>=0,g?(D(At,et),D(Rt,et),D(zt,di)):($(At,-1,et),$(Rt,-1,et),$(zt,-1,mi))):(g=m>=0&&d>=0&&f>=0,g?(D(At,et),D(Rt,et),D(zt,et)):($(At,-1,et),$(Rt,-1,di),$(zt,-1,mi))):c?y?(g=m>=0||d>=0,g?(D(At,et),D(Rt,mi),$(zt,-1,et)):($(At,-1,et),D(Rt,et),$(zt,-1,et))):(g=m>=0&&d>=0,g?(D(At,et),D(Rt,et),$(zt,-1,et)):($(At,-1,et),D(Rt,et),$(zt,-1,mi))):h?v?(g=d>=0||f>=0,g?(D(At,et),$(Rt,-1,et),D(zt,di)):($(At,-1,et),$(Rt,-1,et),D(zt,et))):(g=d>=0&&f>=0,g?(D(At,et),$(Rt,-1,et),D(zt,et)):($(At,-1,et),$(Rt,-1,di),D(zt,et))):(g=d>=0,g?(D(At,et),$(Rt,-1,et),$(zt,-1,et)):($(At,-1,et),D(Rt,et),D(zt,et))),Ht.count=r.m_count;for(var A=0;A<r.m_count;++A)it(Ht.vertices[A],nn,r.m_vertices[A]),Je(Ht.normals[A],nn.q,r.m_normals[A]);var B=r.m_radius+t.m_radius;i.pointCount=0;{ui.type=Ne.e_edgeA,ui.index=g?0:1,ui.separation=1/0;for(var A=0;A<Ht.count;++A){var F=Ht.vertices[A],E=N(At,F)-N(At,o);E<ui.separation&&(ui.separation=E)}}if(ui.type!=Ne.e_unknown&&!(ui.separation>B)){{le.type=Ne.e_unknown,le.index=-1,le.separation=-1/0,Qt(ec,-At.y,At.x);for(var A=0;A<Ht.count;++A){$($i,-1,Ht.normals[A]);var k=N($i,Ht.vertices[A])-N($i,o),w=N($i,Ht.vertices[A])-N($i,a),E=oy(k,w);if(E>B){le.type=Ne.e_edgeB,le.index=A,le.separation=E;break}if(N($i,ec)>=0){if(N($i,At)-N(zt,At)<-H.angularSlop)continue}else if(N($i,At)-N(Rt,At)<-H.angularSlop)continue;E>le.separation&&(le.type=Ne.e_edgeB,le.index=A,le.separation=E)}}if(!(le.type!=Ne.e_unknown&&le.separation>B)){var b=.98,M=.001,V;if(le.type==Ne.e_unknown?V=ui:le.separation>b*ui.separation+M?V=le:V=ui,Ze[0].recycle(),Ze[1].recycle(),V.type==Ne.e_edgeA){i.type=Ft.e_faceA;for(var T=0,z=N(At,Ht.normals[0]),A=1;A<Ht.count;++A){var O=N(At,Ht.normals[A]);O<z&&(z=O,T=A)}var J=T,W=J+1<Ht.count?J+1:0;D(Ze[0].v,Ht.vertices[J]),Ze[0].id.setFeatures(0,mt.e_face,J,mt.e_vertex),D(Ze[1].v,Ht.vertices[W]),Ze[1].id.setFeatures(0,mt.e_face,W,mt.e_vertex),g?(nt.i1=0,nt.i2=1,D(nt.v1,o),D(nt.v2,a),D(nt.normal,et)):(nt.i1=1,nt.i2=0,D(nt.v1,a),D(nt.v2,o),$(nt.normal,-1,et))}else i.type=Ft.e_faceB,D(Ze[0].v,o),Ze[0].id.setFeatures(0,mt.e_vertex,V.index,mt.e_face),D(Ze[1].v,a),Ze[1].id.setFeatures(0,mt.e_vertex,V.index,mt.e_face),nt.i1=V.index,nt.i2=nt.i1+1<Ht.count?nt.i1+1:0,D(nt.v1,Ht.vertices[nt.i1]),D(nt.v2,Ht.vertices[nt.i2]),D(nt.normal,Ht.normals[nt.i1]);Qt(nt.sideNormal1,nt.normal.y,-nt.normal.x),Qt(nt.sideNormal2,-nt.sideNormal1.x,-nt.sideNormal1.y),nt.sideOffset1=N(nt.sideNormal1,nt.v1),nt.sideOffset2=N(nt.sideNormal2,nt.v2),mo[0].recycle(),mo[1].recycle(),Zi[0].recycle(),Zi[1].recycle();var tt=bn(mo,Ze,nt.sideNormal1,nt.sideOffset1,nt.i1);if(!(tt<H.maxManifoldPoints)){var K=bn(Zi,mo,nt.sideNormal2,nt.sideOffset2,nt.i2);if(!(K<H.maxManifoldPoints)){V.type==Ne.e_edgeA?(D(i.localNormal,nt.normal),D(i.localPoint,nt.v1)):(D(i.localNormal,r.m_normals[nt.i1]),D(i.localPoint,r.m_vertices[nt.i1]));for(var Z=0,A=0;A<H.maxManifoldPoints;++A){var ot=N(nt.normal,Zi[A].v)-N(nt.normal,nt.v1);if(ot<=B){var Y=i.points[Z];V.type==Ne.e_edgeA?(zl(Y.localPoint,nn,Zi[A].v),Y.id.set(Zi[A].id)):(D(Y.localPoint,Zi[A].v),Y.id.set(Zi[A].id),Y.id.swapFeatures()),++Z}}i.pointCount=Z}}}}};function Us(i){return i*st.lengthUnitsPerMeter}function Cn(i){return i/st.lengthUnitsPerMeter}function uy(i){const t=i.center();return new u(Cn(t.x),Cn(t.y))}function kn(i){return new u(Cn(i.x),Cn(i.y))}function ye(i,t){return i.vec2(Us(t.x),Us(t.y))}function qn(i){return{color:i.color,opacity:i.opacity,outline:i.outline,shader:i.shader,uniform:i.uniform}}function We(i){let t=null;const e=bd(i);return e&&(t=e.world),t}function bd(i){let t=null,e=i.parent;for(;e;){if(e.c("kpWorld")){t=e;break}e=e.parent}return t}function wa(i){let t=null;const e=i.get("*",{recursive:!0});for(const r of e)if(r.c("kpWorld")){t=r;break}return t}function my(i,t,e){let r=null;return{id:"kpBody",require:["kpPos","kpRotate"],collisionIgnore:e??[],get body(){if(!r)throw new Error("kpBody is not initialized");return r},applyAngularImpulse(s,n=!0){this.body.applyAngularImpulse(s,n)},applyForce(s,n,o){this.body.applyForce(s,n,o)},applyForceToCenter(s,n){this.body.applyForceToCenter(s,n)},applyLinearImpulse(s,n,o){this.body.applyLinearImpulse(s,n,o)},applyTorque(s,n){this.body.applyTorque(s,n)},getAngularDamping(){return this.body.getAngularDamping()},getAngularVelocity(){return this.body.getAngularVelocity()},getContactList(){return this.body.getContactList()},getFixtureList(){return this.body.getFixtureList()},getGravityScale(){return this.body.getGravityScale()},getInertia(){return this.body.getInertia()},getJointList(){return this.body.getJointList()},getLinearDamping(){return this.body.getLinearDamping()},getLinearVelocity(){return this.body.getLinearVelocity()},getLinearVelocityFromLocalPoint(s){return this.body.getLinearVelocityFromLocalPoint(s)},getLinearVelocityFromWorldPoint(s){return this.body.getLinearVelocityFromWorldPoint(s)},getLocalCenter(){return this.body.getLocalCenter()},getLocalPoint(s){return this.body.getLocalPoint(s)},getLocalVector(s){return this.body.getLocalVector(s)},getMass(){return this.body.getMass()},getMassData(s){return this.body.getMassData(s)},getTransform(){return this.body.getTransform()},getBodyType(){return this.body.getType()},getWorldCenter(){return this.body.getWorldCenter()},getWorldPoint(s){return this.body.getWorldPoint(s)},getWorldVector(s){return this.body.getWorldVector(s)},isActive(){return this.body.isActive()},isAwake(){return this.body.isAwake()},isBullet(){return this.body.isBullet()},isDynamic(){return this.body.isDynamic()},isFixedRotation(){return this.body.isFixedRotation()},isKinematic(){return this.body.isKinematic()},isSleepingAllowed(){return this.body.isSleepingAllowed()},isStatic(){return this.body.isStatic()},isWorldLocked(){return this.body.isWorldLocked()},resetMassData(){this.body.resetMassData()},setActive(s){this.body.setActive(s)},setAngularDamping(s){this.body.setAngularDamping(s)},setAngularVelocity(s){this.body.setAngularVelocity(s)},setAwake(s){this.body.setAwake(s)},setBullet(s){this.body.setBullet(s)},setDynamic(){return this.body.setDynamic()},setFixedRotation(s){this.body.setFixedRotation(s)},setGravityScale(s){this.body.setGravityScale(s)},setKinematic(){return this.body.setKinematic()},setLinearDamping(s){this.body.setLinearDamping(s)},setLinearVelocity(s){this.body.setLinearVelocity(s)},setMassData(s){this.body.setMassData(s)},setSleepingAllowed(s){this.body.setSleepingAllowed(s)},setStatic(){return this.body.setStatic()},setTransform(s,n){this.setKPPosition(s),this.setKPAngle(n)},setType(s){this.body.setType(s)},isClicked(){return i.isMousePressed()&&this.isHovering()},isHovering(){return this.hasPoint(kn(i.toWorld(i.mousePos())))},checkContact(s){for(let n=this.body.getContactList();n;n=n.next){const o=n.contact.getFixtureA().getUserData().gameObj,a=n.contact.getFixtureB().getUserData().gameObj;if(o===this&&a===s||a===this&&o===s)return n.contact}return null},isColliding(s){return this.checkContact(s)!==null},isOverlapping(s){var n;for(let o=this.body.getFixtureList();o;o=o.getNext())for(let a=(n=s.body)==null?void 0:n.getFixtureList();a;a=a.getNext()){const l=o.getShape(),c=a.getShape(),h=o.getBody(),d=a.getBody();if(Jl(l,-1,c,-1,h.getTransform(),d.getTransform()))return!0}return!1},onClick(s,n="left"){const o=i.onMousePress(n,()=>{this.isHovering()&&s()});return this.onDestroy(()=>o.cancel()),o},onHover(s){let n=!1;return this.onUpdate(()=>{n?n=this.isHovering():this.isHovering()&&(n=!0,s())})},onHoverUpdate(s){return this.onUpdate(()=>{this.isHovering()&&s()})},onHoverEnd(s){let n=!1;return this.onUpdate(()=>{n?this.isHovering()||(n=!1,s()):n=this.isHovering()})},onCollide(...s){let n=null,o=()=>{};s.length===2?(n=s[0],o=s[1]):o=s[0],this.body.getWorld().on("begin-contact",a=>{fo(this,a,n,o)})},onCollideUpdate(...s){const n=this.body.getWorld();let o=!1,a=null,l=null,c=null,h=()=>{};s.length===2?(c=s[0],h=s[1]):h=s[0],n.on("begin-contact",d=>{fo(this,d,c,m=>{o=!0,a=m,l=d,i.debug.log("handling begin contact")})}),n.on("end-contact",d=>{fo(this,d,c,()=>{o=!1,a=null,l=null,i.debug.log("handling end contact")})}),i.onFixedUpdate(()=>{!o||!a||!l||h(a,l)})},onCollideEnd(...s){let n=null,o=()=>{};s.length===2?(n=s[0],o=s[1]):o=s[0],this.body.getWorld().on("end-contact",a=>{fo(this,a,n,o)})},hasPoint(s){for(let n=this.body.getFixtureList();n;n=n.getNext())if(n.testPoint(s))return!0;return!1},addToDestroyList(){const s=bd(this);if(!s)throw new Error("kpBody requires to be a descendant of kpWorld");s.addToDestroyList(this)},add(){const s=We(this);if(!s)throw new Error("kpBody requires to be a descendant of kpWorld");const n=(t==null?void 0:t.userData)??{};r=s.createBody({...t,position:kn(this.pos),angle:i.deg2rad(this.angle),userData:{...n,gameObj:this}})},fixedUpdate(){this.setKPPosition(this.body.getPosition()),this.setKPAngle(this.body.getAngle())},destroy(){this.body.getWorld().destroyBody(this.body),r=null},get inspectColor(){return this.body?this.body.isDynamic()?{r:0,g:191,b:255}:this.body.isKinematic()?{r:238,g:130,b:238}:{r:255,g:255,b:255}:{r:0,g:0,b:0}}}}function fo(i,t,e,r){const s=t.getFixtureA().getUserData().gameObj,n=t.getFixtureB().getUserData().gameObj;let o=s;if(s===i)o=n;else if(n!==i)return;if(e===null){r(o,t);return}o!=null&&o.tags.includes(e)&&r(o,t)}function dy(i,t){let e;return{id:"kpShape",get shape(){if(!e)throw new Error("kpBoxShape not initialized");return e},add(){e=new Xf(t.width/2,t.height/2,t==null?void 0:t.center,t==null?void 0:t.angle)},draw(){if(!t.draw)return;const r=qn(this),s=Us(t.width),n=Us(t.height),o=i.vec2(ye(i,this.shape.m_centroid));i.drawRect({...r,width:s,height:n,pos:o,anchor:"center",fill:t.fill})},destroy(){e=null}}}function py(i,t){let e=null;return{id:"kpShape",get shape(){if(!e)throw new Error("kpChainShape not initialized");return e},add(){e=new Bn(t==null?void 0:t.vertices,t==null?void 0:t.loop)},draw(){if(!(t!=null&&t.draw))return;const r=qn(this),s=this.shape.m_vertices,n=[];for(let o=0;o<s.length-1;o++)n.push(ye(i,s[o])),o===s.length-2&&n.push(ye(i,s[o+1]));t!=null&&t.loop&&n.push(n[0]),i.drawLines({...r,pts:n})},destroy(){e=null}}}function fy(i,t){let e=null;return{id:"kpShape",get shape(){if(!e)throw new Error("kpCircleShape not initialized");return e},add(){e=new pr((t==null?void 0:t.position)??u.zero(),t==null?void 0:t.radius)},draw(){if(!(t!=null&&t.draw))return;const r=qn(this);i.drawCircle({...r,pos:ye(i,this.shape.getCenter()),radius:Us(this.shape.getRadius()),fill:t==null?void 0:t.fill})},destroy(){e=null}}}function yy(i,t){let e=null;return{id:"kpShape",get shape(){if(!e)throw new Error("kpEdgeShape not initialized");return e},add(){e=new Oi(t==null?void 0:t.v1,t==null?void 0:t.v2)},draw(){if(!(t!=null&&t.draw))return;const r=qn(this),s=ye(i,this.shape.m_vertex1),n=ye(i,this.shape.m_vertex2);i.drawLine({...r,p1:s,p2:n})},destroy(){e=null}}}function _y(i){let t;return{id:"kpFixture",require:["kpShape"],get fixture(){if(!t)throw new Error("kpFixture is not initialized");return t},getDensity(){return this.fixture.getDensity()},getFriction(){return this.fixture.getFriction()},getRestitution(){return this.fixture.getRestitution()},isSensor(){return this.fixture.isSensor()},setDensity(e){return this.fixture.setDensity(e)},setFriction(e){return this.fixture.setFriction(e)},setRestitution(e){return this.fixture.setRestitution(e)},setSensor(e){return this.fixture.setSensor(e)},add(){let e=this;if(this.c("kpBody")||(e=this.parent),!e.c("kpBody"))throw new Error("A body is required");const r=(i==null?void 0:i.userData)??{};t=e.body.createFixture({...i,shape:this.shape,userData:{...r,gameObj:this}}),this.fixture.shouldCollide=s=>{if(e.collisionIgnore.length===0)return!0;const o=s.getUserData().gameObj;return o.tags.length===0?!0:!e.collisionIgnore.some(a=>o.tags.includes(a))}},destroy(){this.fixture.getBody().destroyFixture(this.fixture),t=null}}}function vy(i,t){let e=null;return{id:"kpShape",get shape(){if(!e)throw new Error("kpPolygonShape not initialized");return e},add(){e=new Ui(t==null?void 0:t.vertices)},draw(){if(!(t!=null&&t.draw))return;const r=qn(this),s=this.shape.m_vertices.map(n=>ye(i,n));i.drawPolygon({...r,pts:s,fill:t==null?void 0:t.fill})},destroy(){e=null}}}function gy(i,...t){return{id:"kpPos",getKPPosition(){const e=this.c("kpBody");return e&&e.body?e.body.getPosition():kn(this.pos)},setKPPosition(e){this.pos=ye(i,e);const r=this.c("kpBody");r&&r.body&&r.body.setPosition(e)},kpMove(...e){this.kpMoveBy(ba(...e).mul(i.dt()))},kpMoveBy(...e){const r=ba(...e);this.setKPPosition(this.getKPPosition().add(r))},kpMoveTo(...e){const r=new u;let s=1;e.length>=1&&typeof e[0]!="number"&&(r.set(e[0].x,e[0].y),e.length===2&&typeof e[1]=="number"&&(s=e[1])),e.length>=2&&typeof e[0]=="number"&&typeof e[1]=="number"&&(r.set(e[0],e[1]),e.length>=3&&typeof e[2]=="number"&&(s=e[2]));const n=r.sub(this.getKPPosition());if(n.length()>s*i.dt()){this.setKPPosition(r);return}n.normalize(),this.kpMove(r.mul(s))},add(){this.use(i.pos()),this.pos=ye(i,ba(...t))}}}function ba(...i){return i.length===2?new u(i[0],i[1]):i.length===1?new u(i[0]):new u}function Ay(i,t){const e=[];return{id:"kpWorld",world:new Vn(t),getAllowSleeping(){return this.world.getAllowSleeping()},getBodyCount(){return this.world.getBodyCount()},getBodyList(){return this.world.getBodyList()},getContactCount(){return this.world.getContactCount()},getGravity(){return this.world.getGravity()},getJointCount(){return this.world.getJointCount()},getJointList(){return this.world.getJointList()},isLocked(){return this.world.isLocked()},rayCast(r,s,n){this.world.rayCast(r,s,(o,a,l,c)=>{const h=o.getUserData().gameObj;return n(h,a,l,c)})},setAllowSleeping(r){this.world.setAllowSleeping(r)},setGravity(r){this.world.setGravity(r)},shiftOrigin(r){this.world.shiftOrigin(r)},onContactBegin(r){this.on("contactBegin",r)},onContactEnd(r){this.on("contactEnd",r)},onContactPreSolve(r){this.on("contactPreSolve",r)},onContactPostSolve(r){this.on("contactPostSolve",r)},onRemoveBody(r){this.on("removeBody",r)},onRemoveFixture(r){this.on("removeFixture",r)},onRemoveJoint(r){this.on("removeJoint",r)},addToDestroyList(r){e.push(r)},add(){this.world.on("begin-contact",r=>{const s=r.getFixtureA().getUserData(),n=r.getFixtureB().getUserData();s&&n&&this.trigger("contactBegin",s.gameObj,n.gameObj,r)}),this.world.on("end-contact",r=>{const s=r.getFixtureA().getUserData(),n=r.getFixtureB().getUserData();s&&n&&this.trigger("contactEnd",s.gameObj,n.gameObj,r)}),this.world.on("pre-solve",r=>{const s=r.getFixtureA().getUserData(),n=r.getFixtureB().getUserData();s&&n&&this.trigger("contactPreSolve",s.gameObj,n.gameObj,r)}),this.world.on("post-solve",r=>{const s=r.getFixtureA().getUserData(),n=r.getFixtureB().getUserData();s&&n&&this.trigger("contactPostSolve",s.gameObj,n.gameObj,r)}),this.world.on("remove-body",r=>{const s=r.getUserData();s&&this.trigger("removeBody",s.gameObj)}),this.world.on("remove-fixture",r=>{const s=r.getUserData();s&&this.trigger("removeFixture",s.gameObj)}),this.world.on("remove-joint",r=>{const s=r.getUserData();s&&this.trigger("removeJoint",s.gameObj)})},fixedUpdate(){this.world.step(i.fixedDt())},update(){if(!this.world.isLocked())for(;e.length>0;){const r=e.pop();r&&r.destroy()}}}}function oi(i,t,e,r=!1){const s=new i.Color(255,255,255),n=new i.Color(0,0,255);return{id:"kpJoint",get joint(){return{}},getAnchorA(){return this.joint.getAnchorA()},getAnchorB(){return this.joint.getAnchorB()},getCollideConnected(){return this.joint.getCollideConnected()},getGameObjA(){return t},getGameObjB(){return e},isActive(){return this.joint.isActive()},shiftOrigin(o){this.joint.shiftOrigin(o)},draw(){r&&i.drawLine({p1:ye(i,new u(this.getAnchorA())),p2:ye(i,new u(this.getAnchorB())),width:1,color:s})},drawInspect(){i.drawLine({p1:ye(i,new u(this.getAnchorA())),p2:ye(i,new u(this.getAnchorB())),width:4,color:n})}}}function xy(i,t,e,r,s){let n=null;return{...oi(i,e,r,t.draw),id:"kpDistanceJoint",get joint(){if(!n)throw new Error("kpDistanceJoint not initialized");return n},getDampingRatio(){return this.joint.getDampingRatio()},getFrequency(){return this.joint.getFrequency()},getLength(){return this.joint.getLength()},getLocalAnchorA(){return this.joint.getLocalAnchorA()},getLocalAnchorB(){return this.joint.getLocalAnchorB()},setDampingRatio(o){this.joint.setDampingRatio(o)},setFrequency(o){this.joint.setFrequency(o)},setLength(o){this.joint.setLength(o)},add(){const o=s?s.world:We(this);if(!o)throw new Error("kpDistanceJoint requires to be a descendant of kpWorld");const a=(t==null?void 0:t.userData)??{};n=o.createJoint(new Ta({...t,bodyA:e.body,bodyB:r.body,userData:{...a,gameObj:this}}))},destroy(){this.joint.getBodyA().getWorld().destroyJoint(this.joint),n=null}}}function wy(i,t,e,r,s){let n=null;return{...oi(i,e,r,t.draw),id:"kpFrictionJoint",get joint(){if(!n)throw new Error("kpFrictionJoint not initialized");return n},getLocalAnchorA(){return this.joint.getLocalAnchorA()},getLocalAnchorB(){return this.joint.getLocalAnchorB()},getMaxForce(){return this.joint.getMaxForce()},getMaxTorque(){return this.joint.getMaxTorque()},setMaxForce(o){this.joint.setMaxForce(o)},setMaxTorque(o){this.joint.setMaxTorque(o)},add(){const o=s?s.world:We(this);if(!o)throw new Error("kpFrictionJoint requires to be a descendant of kpWorld");const a=(t==null?void 0:t.userData)??{};n=o.createJoint(new Ra({...t,bodyA:e.body,bodyB:r.body,userData:{...a,gameObj:this}}))},destroy(){this.joint.getBodyA().getWorld().destroyJoint(this.joint),n=null}}}function by(i,t,e,r,s,n,o){let a=null;return{...oi(i,e,r,t.draw),id:"kpGearJoint",get joint(){if(!a)throw new Error("kpGearJoint not initialized");return a},getJoint1(){return s},getJoint2(){return n},getRatio(){return this.joint.getRatio()},setRatio(l){this.joint.setRatio(l)},add(){const l=o?o.world:We(this);if(!l)throw new Error("kpGearJoint requires to be a descendant of kpWorld");const c=(t==null?void 0:t.userData)??{};a=l.createJoint(new Na({...t,bodyA:e.body,bodyB:r.body,joint1:s.joint,joint2:n.joint,userData:{...c,gameObj:this}}))},destroy(){this.joint.getBodyA().getWorld().destroyJoint(this.joint),a=null}}}function By(i,t,e,r,s){let n=null;return{...oi(i,e,r,t.draw),id:"kpMotorJoint",get joint(){if(!n)throw new Error("kpMotorJoint not initialized");return n},getAngularOffset(){return this.joint.getAngularOffset()},getCorrectionFactor(){return this.joint.getCorrectionFactor()},getLinearOffset(){return this.joint.getLinearOffset()},getMaxForce(){return this.joint.getMaxForce()},getMaxTorque(){return this.joint.getMaxTorque()},setAngularOffset(o){this.joint.setAngularOffset(o)},setCorrectionFactor(o){this.joint.setCorrectionFactor(o)},setLinearOffset(o){this.joint.setLinearOffset(o)},setMaxForce(o){this.joint.setMaxForce(o)},setMaxTorque(o){this.joint.setMaxTorque(o)},add(){const o=s?s.world:We(this);if(!o)throw new Error("kpMotorJoint requires to be a descendant of kpWorld");const a=(t==null?void 0:t.userData)??{};n=o.createJoint(new Oa({...t,bodyA:e.body,bodyB:r.body,userData:{...a,gameObj:this}}))},destroy(){this.joint.getBodyA().getWorld().destroyJoint(this.joint),n=null}}}function Cy(i,t,e,r,s){let n=null;return{...oi(i,e,r,t.draw),id:"kpMouseJoint",get joint(){if(!n)throw new Error("kpMouseJoint not initialized");return n},getDampingRatio(){return this.joint.getDampingRatio()},getFrequency(){return this.joint.getFrequency()},getMaxForce(){return this.joint.getMaxForce()},getTarget(){return this.joint.getTarget()},setDampingRatio(o){this.joint.setDampingRatio(o)},setFrequency(o){this.joint.setFrequency(o)},setMaxForce(o){this.joint.setMaxForce(o)},setTarget(o){this.joint.setTarget(o)},add(){const o=s?s.world:We(this);if(!o)throw new Error("kpMouseJoint requires to be a descendant of kpWorld");const a=(t==null?void 0:t.userData)??{};n=o.createJoint(new Ua({...t,bodyA:e.body,bodyB:r.body,userData:{...a,gameObj:this}}))},destroy(){this.joint.getBodyA().getWorld().destroyJoint(this.joint),n=null}}}function ky(i,t,e,r,s){let n=null;return{...oi(i,e,r,t.draw),id:"kpPrismaticJoint",get joint(){if(!n)throw new Error("kpPrismaticJoint not initialized");return n},enableLimit(o){this.joint.enableLimit(o)},enableMotor(o){this.joint.enableMotor(o)},getJointSpeed(){return this.joint.getJointSpeed()},getJointTranslation(){return this.joint.getJointTranslation()},getLocalAnchorA(){return this.joint.getLocalAnchorA()},getLocalAnchorB(){return this.joint.getLocalAnchorB()},getLocalAxisA(){return this.joint.getLocalAxisA()},getLowerLimit(){return this.joint.getLowerLimit()},getMaxMotorForce(){return this.joint.getMaxMotorForce()},getMotorSpeed(){return this.joint.getMotorSpeed()},getReferenceAngle(){return this.joint.getReferenceAngle()},getUpperLimit(){return this.joint.getUpperLimit()},isLimitEnabled(){return this.joint.isLimitEnabled()},isMotorEnabled(){return this.joint.isMotorEnabled()},setLimits(o,a){this.joint.setLimits(o,a)},setMaxMotorForce(o){this.joint.setMaxMotorForce(o)},setMotorSpeed(o){this.joint.setMotorSpeed(o)},add(){const o=s?s.world:We(this);if(!o)throw new Error("kpPrismaticJoint requires to be a descendant of kpWorld");const a=(t==null?void 0:t.userData)??{};n=o.createJoint(new za({...t,bodyA:e.body,bodyB:r.body,userData:{...a,gameObj:this}}))},destroy(){this.joint.getBodyA().getWorld().destroyJoint(this.joint),n=null}}}function My(i,t,e,r,s){let n=null;return{...oi(i,e,r,t.draw),id:"kpPulleyJoint",get joint(){if(!n)throw new Error("kpPulleyJoint not initialized");return n},getCurrentLengthA(){return this.joint.getCurrentLengthA()},getCurrentLengthB(){return this.joint.getCurrentLengthB()},getGroundAnchorA(){return this.joint.getGroundAnchorA()},getGroundAnchorB(){return this.joint.getGroundAnchorB()},getLengthA(){return this.joint.getLengthA()},getLengthB(){return this.joint.getLengthB()},getRatio(){return this.joint.getRatio()},add(){const o=s?s.world:We(this);if(!o)throw new Error("kpPulleyJoint requires to be a descendant of kpWorld");const a=(t==null?void 0:t.userData)??{};n=o.createJoint(new Ja({...t,bodyA:e.body,bodyB:r.body,userData:{...a,gameObj:this}}))},destroy(){this.joint.getBodyA().getWorld().destroyJoint(this.joint),n=null}}}function Fy(i,t,e,r,s){let n=null;return{...oi(i,e,r,t.draw),id:"kpRevoluteJoint",get joint(){if(!n)throw new Error("kpRevoluteJoint not initialized");return n},enableLimit(o){this.joint.enableLimit(o)},enableMotor(o){this.joint.enableMotor(o)},getJointAngle(){return this.joint.getJointAngle()},getJointSpeed(){return this.joint.getJointSpeed()},getLocalAnchorA(){return this.joint.getLocalAnchorA()},getLocalAnchorB(){return this.joint.getLocalAnchorB()},getLowerLimit(){return this.joint.getLowerLimit()},getMaxMotorTorque(){return this.joint.getMaxMotorTorque()},getMotorSpeed(){return this.joint.getMotorSpeed()},getReferenceAngle(){return this.joint.getReferenceAngle()},getUpperLimit(){return this.joint.getUpperLimit()},isLimitEnabled(){return this.joint.isLimitEnabled()},isMotorEnabled(){return this.joint.isMotorEnabled()},setLimits(o,a){this.joint.setLimits(o,a)},setMaxMotorTorque(o){this.joint.setMaxMotorTorque(o)},setMotorSpeed(o){this.joint.setMotorSpeed(o)},add(){const o=s?s.world:We(this);if(!o)throw new Error("kpRevoluteJoint requires to be a descendant of kpWorld");const a=(t==null?void 0:t.userData)??{};n=o.createJoint(new Li({...t,bodyA:e.body,bodyB:r.body,userData:{...a,gameObj:this}}))},destroy(){this.joint.getBodyA().getWorld().destroyJoint(this.joint),n=null}}}function Ey(i,t,e,r,s){let n=null;return{...oi(i,e,r,t.draw),id:"kpRopeJoint",get joint(){if(!n)throw new Error("kpRopeJoint not initialized");return n},getLimitState(){return this.joint.getLimitState()},getLocalAnchorA(){return this.joint.getLocalAnchorA()},getLocalAnchorB(){return this.joint.getLocalAnchorB()},getMaxLength(){return this.joint.getMaxLength()},setMaxLength(o){this.joint.setMaxLength(o)},add(){const o=s?s.world:We(this);if(!o)throw new Error("kpRopeJoint requires to be a descendant of kpWorld");const a=(t==null?void 0:t.userData)??{};n=o.createJoint(new Ha({...t,bodyA:e.body,bodyB:r.body,userData:{...a,gameObj:this}}))},destroy(){this.joint.getBodyA().getWorld().destroyJoint(this.joint),n=null}}}function Sy(i,t=0){return{id:"kpRotate",getKPAngle(){const e=this.c("kpBody");return e&&e.body?e.body.getAngle():i.deg2rad(this.angle)},setKPAngle(e){this.angle=i.rad2deg(e);const r=this.c("kpBody");r&&r.body&&r.body.setAngle(e)},kpRotateBy(e){this.setKPAngle(this.getKPAngle()+e)},kpRotateTo(e){this.setKPAngle(e)},add(){this.use(i.rotate()),this.angle=i.rad2deg(t)}}}function Dy(i,t,e,r,s){let n=null;return{...oi(i,e,r,t.draw),id:"kpWeldJoint",get joint(){if(!n)throw new Error("kpWeldJoint not initialized");return n},getDampingRatio(){return this.joint.getDampingRatio()},getFrequency(){return this.joint.getFrequency()},getLocalAnchorA(){return this.joint.getLocalAnchorA()},getLocalAnchorB(){return this.joint.getLocalAnchorB()},setDampingRatio(o){this.joint.setDampingRatio(o)},setFrequency(o){this.joint.setFrequency(o)},add(){const o=s?s.world:We(this);if(!o)throw new Error("kpWeldJoint requires to be a descendant of kpWorld");const a=(t==null?void 0:t.userData)??{};n=o.createJoint(new Wa({...t,bodyA:e.body,bodyB:r.body,userData:{...a,gameObj:this}}))},destroy(){this.joint.getBodyA().getWorld().destroyJoint(this.joint),n=null}}}function Py(i,t,e,r,s){let n=null;return{...oi(i,e,r,t.draw),id:"kpWheelJoint",get joint(){if(!n)throw new Error("kpWheelJoint not initialized");return n},enableMotor(o){this.joint.enableMotor(o)},getJointSpeed(){return this.joint.getJointSpeed()},getJointTranslation(){return this.joint.getJointTranslation()},getLocalAnchorA(){return this.joint.getLocalAnchorA()},getLocalAnchorB(){return this.joint.getLocalAnchorB()},getLocalAxisA(){return this.joint.getLocalAxisA()},getMaxMotorTorque(){return this.joint.getMaxMotorTorque()},getMotorSpeed(){return this.joint.getMotorSpeed()},getSpringDampingRatio(){return this.joint.getSpringDampingRatio()},getSpringFrequencyHz(){return this.joint.getSpringFrequencyHz()},isMotorEnabled(){return this.joint.isMotorEnabled()},setMaxMotorTorque(o){this.joint.setMaxMotorTorque(o)},setMotorSpeed(o){this.joint.setMotorSpeed(o)},setSpringDampingRatio(o){this.joint.setSpringDampingRatio(o)},setSpringFrequencyHz(o){this.joint.setSpringFrequencyHz(o)},add(){const o=s?s.world:We(this);if(!o)throw new Error("kpWheelJoint requires to be a descendant of kpWorld");const a=(t==null?void 0:t.userData)??{};n=o.createJoint(new Ka({...t,bodyA:e.body,bodyB:r.body,userData:{...a,gameObj:this}}))},destroy(){this.joint.getBodyA().getWorld().destroyJoint(this.joint),n=null}}}const Vy=i=>t=>(st.lengthUnitsPerMeter=i==null?void 0:i.lengthUnitsPerMeter,{kpPos(...e){return gy(t,...e)},kpRotate(e){return Sy(t,e)},kpWorld(e){return Ay(t,e)},kpBody(e,r){return my(t,e,r)},kpFixture(e){return _y(e)},kpBoxShape(e){return dy(t,e)},kpChainShape(e){return py(t,e)},kpCircleShape(e){return fy(t,e)},kpEdgeShape(e){return yy(t,e)},kpPolygonShape(e){return vy(t,e)},kpDistanceJoint(e,r,s,n){return xy(t,e,r,s,n)},kpFrictionJoint(e,r,s,n){return wy(t,e,r,s,n)},kpGearJoint(e,r,s,n,o,a){return by(t,e,r,s,n,o,a)},kpMotorJoint(e,r,s,n){return By(t,e,r,s,n)},kpMouseJoint(e,r,s,n){return Cy(t,e,r,s,n)},kpPrismaticJoint(e,r,s,n){return ky(t,e,r,s,n)},kpPulleyJoint(e,r,s,n){return My(t,e,r,s,n)},kpRevoluteJoint(e,r,s,n){return Fy(t,e,r,s,n)},kpRopeJoint(e,r,s,n){return Ey(t,e,r,s,n)},kpWeldJoint(e,r,s,n){return Dy(t,e,r,s,n)},kpWheelJoint(e,r,s,n){return Py(t,e,r,s,n)},onKPCollide(e,r,s,n){const o=n||wa(t);if(!o)throw new Error("No pkWorld found");o.onContactBegin((a,l,c)=>{if(!a.tags.includes(e)&&!l.tags.includes(e)||!a.tags.includes(r)&&!l.tags.includes(r))return;let h=a,d=l;a.tags.includes(e)||(h=l,d=a),s(h,d,c)})},onKPCollideUpdate(e,r,s,n){const o=n||wa(t);if(!o)throw new Error("No pkWorld found");let a=!1,l=null,c=null,h;o.onContactBegin((d,m,f)=>{!d.tags.includes(e)&&!m.tags.includes(e)||!d.tags.includes(r)&&!m.tags.includes(r)||(a=!0,h=f,l=d,c=m)}),o.onContactEnd((d,m)=>{!d.tags.includes(e)&&!m.tags.includes(e)||!d.tags.includes(r)&&!m.tags.includes(r)||(a=!1,h=void 0,l=null,c=null)}),t.onFixedUpdate(()=>{if(!a||!l||!c||!h)return;let d=l,m=c;l.tags.includes(e)||(d=c,m=l),s(d,m,h)})},onKPCollideEnd(e,r,s,n){const o=n||wa(t);if(!o)throw new Error("No pkWorld found");o.onContactEnd((a,l,c)=>{if(!a.tags.includes(e)&&!l.tags.includes(e)||!a.tags.includes(r)&&!l.tags.includes(r))return;let h=a,d=l;a.tags.includes(e)||(h=l,d=a),s(h,d,c)})},kpCenter(){return uy(t)},kpMousePos(){return kn(t.mousePos())},m2p:Us,p2m:Cn,k2pVec2:kn,p2kVec2(e){return ye(t,e)}});function qy(){const i=ea.useRef(null),t=ea.useRef();return ea.useEffect(()=>{if(i.current!==null)return t.current||(t.current=Rp({global:!1,background:[20,20,20],plugins:[Vy({lengthUnitsPerMeter:10})],debug:!0,debugKey:"d",logTime:30,canvas:i.current,width:400,height:300,letterbox:!0,focus:!1}),Iy(t.current)),()=>{var e;(e=t.current)==null||e.quit(),t.current=void 0}},[]),_.jsx("div",{className:"gettingStartedResultContainer",children:_.jsx("canvas",{id:"game",ref:i,width:400,height:300})})}function Iy(i){const t=i.add([i.kpWorld({gravity:new u(0,10)})]);t.paused=!0,t.add([i.kpPos(i.kpCenter()),i.kpRotate(Math.PI*.1),i.kpEdgeShape({v1:new u(-10,0),v2:new u(10,0),draw:!0}),i.kpBody({type:"static"}),i.kpFixture()]),t.add([i.kpPos(i.kpCenter().sub({x:i.rand(-10,10),y:i.rand(10,15)})),i.kpRotate(),i.kpCircleShape({radius:1,draw:!0}),i.kpBody({type:"dynamic"}),i.kpFixture({density:1,friction:.3}),i.offscreen({destroy:!0})]);const e=i.add([i.rect(i.width(),i.height()),i.color(0,0,0)]),r=i.add([i.pos(i.center()),i.text("Click to view result",{size:20}),i.color(200,200,200),i.anchor("center")]);i.onClick(()=>{e.hidden=!0,r.hidden=!0,t.paused=!1})}const Ty={title:"Get started",description:"undefined"};function ic(i){const t={a:"a",code:"code",div:"div",em:"em",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",span:"span",strong:"strong",...rc(),...i.components};return _.jsxs(_.Fragment,{children:[_.jsx(t.header,{children:_.jsxs(t.h1,{id:"get-started",children:["Get started",_.jsx(t.a,{"aria-hidden":"true",tabIndex:"-1",href:"#get-started",children:_.jsx(t.div,{"data-autolink-icon":!0})})]})}),`
`,_.jsxs(t.h2,{id:"installation",children:["Installation",_.jsx(t.a,{"aria-hidden":"true",tabIndex:"-1",href:"#installation",children:_.jsx(t.div,{"data-autolink-icon":!0})})]}),`
`,_.jsx(t.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0","data-title":"npm","data-lang":"bash",children:_.jsx(t.code,{children:_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#F69D50"},children:"npm"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" i"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" kaplanck"})]})})}),`
`,_.jsxs(t.h2,{id:"example",children:["Example",_.jsx(t.a,{"aria-hidden":"true",tabIndex:"-1",href:"#example",children:_.jsx(t.div,{"data-autolink-icon":!0})})]}),`
`,_.jsx(t.p,{children:_.jsx(t.em,{children:"The following assumes you already have a KAPLAY project set up."})}),`
`,_.jsx(t.p,{children:'Lets create our own version of "Hello World" using KaPlanck.'}),`
`,_.jsx(t.p,{children:"Lets start by importing our dependencies and add a KAPLAY instance:"}),`
`,_.jsx(t.pre,{className:"shiki shiki-themes github-light github-dark-dimmed has-highlighted",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0","data-title":"example.ts","data-lang":"ts",children:_.jsxs(t.code,{"data-line-numbers":!0,children:[_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 1. Import modules."})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" KaPlanckPlugin "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "kaplanck"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" kaplay "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "kaplay"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" { Vec2 } "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "planck"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsx(t.span,{className:"line","data-empty-line":!0,children:" "}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 2. Create a new KAPLAY instance."})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"const"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" k"}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" ="}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" kaplay"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  global: "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"false"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:","})]}),`
`,_.jsxs(t.span,{className:"line highlighted",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  plugins: ["}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"KaPlanckPlugin"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"()], "})]}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"});"})})]})}),`
`,_.jsx(t.p,{children:"As shown, adding the plugin to KAPLAY is as easy as adding the highlighted line."}),`
`,_.jsx(t.p,{children:"Next, let us add a world container (a game object that holds our physics world):"}),`
`,_.jsx(t.pre,{className:"shiki shiki-themes github-light github-dark-dimmed has-focused",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0","data-title":"example.ts","data-lang":"ts",children:_.jsxs(t.code,{"data-line-numbers":!0,children:[_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 1. Import modules."})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" KaPlanckPlugin "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "kaplanck"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" kaplay "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "kaplay"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" { Vec2 } "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "planck"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsx(t.span,{className:"line","data-empty-line":!0,children:" "}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 2. Create a new KAPLAY instance."})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"const"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" k"}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" ="}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" kaplay"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  global: "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"false"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:","})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  plugins: ["}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"KaPlanckPlugin"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"()],"})]}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"});"})}),`
`,_.jsx(t.span,{className:"line","data-empty-line":!0,children:" "}),`
`,_.jsx(t.span,{className:"line focused",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 3. Add a world container with gravity set to x: 0 y: 10."})}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"const"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" worldContainer"}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" ="}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"add"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"([ "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpWorld"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({ "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    gravity: "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"new"}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" Vec2"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"0"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"10"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"), "})]}),`
`,_.jsx(t.span,{className:"line focused",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  }), "})}),`
`,_.jsx(t.span,{className:"line focused",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"]); "})})]})}),`
`,_.jsxs(t.p,{children:["Note that ",_.jsx(t.code,{children:"Vec2"})," is from ",_.jsx(t.strong,{children:"Planck"})," and not from KAPLAY."]}),`
`,_.jsx(t.p,{children:`Now that we have our world container set up, let's add a ground to it.\r
We can do this by creating a static body with an edge shape:`}),`
`,_.jsx(t.pre,{className:"shiki shiki-themes github-light github-dark-dimmed has-focused",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0","data-title":"example.ts","data-lang":"ts",children:_.jsxs(t.code,{"data-line-numbers":!0,children:[_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 1. Import modules."})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" KaPlanckPlugin "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "kaplanck"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" kaplay "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "kaplay"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" { Vec2 } "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "planck"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsx(t.span,{className:"line","data-empty-line":!0,children:" "}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 2. Create a new KAPLAY instance."})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"const"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" k"}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" ="}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" kaplay"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  global: "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"false"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:","})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  plugins: ["}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"KaPlanckPlugin"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"()],"})]}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"});"})}),`
`,_.jsx(t.span,{className:"line","data-empty-line":!0,children:" "}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 3. Add a world container with gravity set to x: 0 y: 10."})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"const"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" worldContainer"}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" ="}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"add"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(["})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpWorld"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    gravity: "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"new"}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" Vec2"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"0"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"10"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"),"})]}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  }),"})}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"]);"})}),`
`,_.jsx(t.span,{className:"line","data-empty-line":!0,children:" "}),`
`,_.jsx(t.span,{className:"line focused",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 4. Add ground by creating a static body with an edge shape."})}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"worldContainer."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"add"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"([ "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpPos"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpCenter"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"()), "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpRotate"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(Math."}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"PI"}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" *"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" 0.1"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"), "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpEdgeShape"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({ "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    v1: "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"new"}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" Vec2"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"-"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"10"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"0"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"), "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    v2: "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"new"}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" Vec2"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"10"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"0"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"), "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    draw: "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"true"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "})]}),`
`,_.jsx(t.span,{className:"line focused",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  }), "})}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpBody"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({ "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    type: "}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:'"static"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "})]}),`
`,_.jsx(t.span,{className:"line focused",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  }), "})}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpFixture"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(), "})]}),`
`,_.jsx(t.span,{className:"line focused",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"]); "})})]})}),`
`,_.jsxs(t.p,{children:["Again, note that here we are using ",_.jsx(t.code,{children:"kpPos"})," and ",_.jsx(t.code,{children:"kpRotate"})," instead of ",_.jsx(t.code,{children:"pos"})," and ",_.jsx(t.code,{children:"rotate"}),"."]}),`
`,_.jsx(t.p,{children:"Finally, let's add a simple ball to the world. We can do this by creating a dynamic body with a circle shape:"}),`
`,_.jsx(t.pre,{className:"shiki shiki-themes github-light github-dark-dimmed has-focused",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0","data-title":"example.ts","data-lang":"ts",children:_.jsxs(t.code,{"data-line-numbers":!0,children:[_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 1. Import modules."})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" KaPlanckPlugin "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "kaplanck"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" kaplay "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "kaplay"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"import"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" { Vec2 } "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"from"}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:' "planck"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:";"})]}),`
`,_.jsx(t.span,{className:"line","data-empty-line":!0,children:" "}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 2. Create a new KAPLAY instance."})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"const"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" k"}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" ="}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" kaplay"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  global: "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"false"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:","})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  plugins: ["}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"KaPlanckPlugin"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"()],"})]}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"});"})}),`
`,_.jsx(t.span,{className:"line","data-empty-line":!0,children:" "}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 3. Add a world container with gravity set to x: 0 y: 10."})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"const"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" worldContainer"}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" ="}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"add"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(["})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpWorld"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    gravity: "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"new"}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" Vec2"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"0"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"10"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"),"})]}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  }),"})}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"]);"})}),`
`,_.jsx(t.span,{className:"line","data-empty-line":!0,children:" "}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 4. Add ground by creating a static body with an edge shape."})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"worldContainer."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"add"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(["})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpPos"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpCenter"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"()),"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpRotate"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(Math."}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"PI"}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" *"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" 0.1"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"),"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpEdgeShape"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    v1: "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"new"}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" Vec2"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"-"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"10"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"0"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"),"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    v2: "}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"new"}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:" Vec2"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"10"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"0"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"),"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    draw: "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"true"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:","})]}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  }),"})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpBody"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({"})]}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    type: "}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:'"static"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:","})]}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  }),"})}),`
`,_.jsxs(t.span,{className:"line",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpFixture"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(),"})]}),`
`,_.jsx(t.span,{className:"line",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"]);"})}),`
`,_.jsx(t.span,{className:"line","data-empty-line":!0,children:" "}),`
`,_.jsx(t.span,{className:"line focused",children:_.jsx(t.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// 5. Add a ball by creating a dynamic body with a circle shape."})}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"worldContainer."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"add"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"([ "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpPos"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpCenter"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"()."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"sub"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({ x: k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"rand"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),_.jsx(t.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"-"}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"10"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"10"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"), y: k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"rand"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"10"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"15"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:") })), "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpRotate"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(), "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpCircleShape"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({ "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    radius: "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"1"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"    draw: "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"true"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "})]}),`
`,_.jsx(t.span,{className:"line focused",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  }), "})}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpBody"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({ type: "}),_.jsx(t.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:'"dynamic"'}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" }), "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"kpFixture"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({ density: "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"1"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", friction: "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"0.3"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" }), "})]}),`
`,_.jsxs(t.span,{className:"line focused",children:[_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"  k."}),_.jsx(t.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"offscreen"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"({ destroy: "}),_.jsx(t.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"true"}),_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" }), "})]}),`
`,_.jsx(t.span,{className:"line focused",children:_.jsx(t.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"]); "})})]})}),`
`,_.jsx(t.p,{children:"The result of this is the following:"}),`
`,_.jsx(qy,{}),`
`,_.jsx(t.p,{children:"I know this is not the most complex example, but it demonstrates a basic setup using KAPLAY and Planck for creating a physics-based games."}),`
`,_.jsx(t.p,{children:"Well with that being said, hope this plugin helps you get started with building physics-based games or interactive applications!"}),`
`,_.jsx(t.p,{children:"If you have any questions or need further assistance, feel free to ask. Happy coding!"})]})}function Ry(i={}){const{wrapper:t}={...rc(),...i.components};return t?_.jsx(t,{...i,children:_.jsx(ic,{...i})}):ic(i)}export{Ry as default,Ty as frontmatter};
